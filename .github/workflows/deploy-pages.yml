name: deploy-pages
run-name: Building and deploying to GitHub pages
on: [push]
jobs:
  deploy-pages:
    runs-on: self-hosted
    steps:
      - name: Build and deploy to pages
        shell: bash
        env:
          ENVIRONMENT: ${{ secrets.ENVIRONMENT }}
        run: |
          [ ! -d "/scottv.dev" ] && git clone https://github.com/vandents/scottv.dev.git
          cd scottv.dev
          git pull
          npm i --loglevel=error
          npx ts-node ./src/set-env.ts "$ENVIRONMENT"
          npm run build
          cd ..
          [ ! -d "/scottv-pages" ] && git clone https://github.com/vandents/scottv.dev.git scottv-pages
          cd scottv-pages
          git checkout gh-pages
          rm -r *
          mv ../scottv.dev/dist/scottvdev/browser/* ./
          git add -A
          git commit -m "Uploading from self-hosted runner"
          git push
