import{B as _t,Ba as ho,D as wl,F as yt,G as ci,Ia as Tl,Tb as vl,a as H,b as De,c as ao,d as b,e as sr,g as ml,h as gl,i as co,j as uo,k as _l,l as lo,m as yl,n as Il,p as ri,r as ii,t as Ue,u as si,v as El,w as oi,z as ai}from"./chunk-JHEXPNAB.js";var Al=()=>{};var Rl=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Up=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],l=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},ui={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,l=a?n[i+1]:0,h=i+2<n.length,d=h?n[i+2]:0,p=o>>2,E=(o&3)<<4|l>>4,v=(l&15)<<2|d>>6,R=d&63;h||(R=64,a||(v=64)),r.push(t[p],t[E],t[v],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Rl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Up(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let E=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||l==null||d==null||E==null)throw new po;let v=o<<2|l>>4;if(r.push(v),d!==64){let R=l<<4&240|d>>2;if(r.push(R),E!==64){let V=d<<6&192|E;r.push(V)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},po=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Bp=function(n){let e=Rl(n);return ui.encodeByteArray(e,!0)},ar=function(n){return Bp(n).replace(/\./g,"")},li=function(n){try{return ui.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function go(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var qp=()=>go().__FIREBASE_DEFAULTS__,$p=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},zp=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}let e=n&&li(n[1]);return e&&JSON.parse(e)},hi=()=>{try{return Al()||qp()||$p()||zp()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Pl=n=>hi()?.emulatorHosts?.[n],Cl=n=>{let e=Pl(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},_o=()=>hi()?.config,kl=n=>hi()?.[`_${n}`];var xt=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Lt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch(e){return!1}}function yo(n){return b(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Dl(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=H({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ar(JSON.stringify(t)),ar(JSON.stringify(a)),""].join(".")}var or={};function jp(){let n={prod:[],emulator:[]};for(let e of Object.keys(or))or[e]?n.emulator.push(e):n.prod.push(e);return n}function Wp(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var bl=!1;function Io(n,e){if(typeof window>"u"||typeof document>"u"||!Lt(window.location.host)||or[n]===e||or[n]||bl)return;or[n]=e;function t(v){return`__firebase__banner__${v}`}let r="__firebase__banner",o=jp().prod.length>0;function a(){let v=document.getElementById(r);v&&v.remove()}function l(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function h(v,R){v.setAttribute("width","24"),v.setAttribute("id",R),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){let v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{bl=!0,a()},v}function p(v,R){v.setAttribute("id",R),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function E(){let v=Wp(r),R=t("text"),V=document.getElementById(R)||document.createElement("span"),x=t("learnmore"),N=document.getElementById(x)||document.createElement("a"),z=t("preprendIcon"),G=document.getElementById(z)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){let Y=v.element;l(Y),p(N,x);let _e=d();h(G,z),Y.append(G,V,N,_e),document.body.appendChild(Y)}o?(V.innerText="Preview backend disconnected.",G.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(G.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,V.innerText="Preview backend running in this workspace."),V.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}function Se(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Nl(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Se())}function Gp(){let n=hi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(e){return!1}}function Vl(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Ol(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function xl(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ll(){return!Gp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function cr(){try{return typeof indexedDB=="object"}catch(n){return!1}}function Ml(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var Hp="FirebaseError",Pe=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Hp,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ne.prototype.create)}},Ne=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?Kp(o,r):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Pe(i,l,r)}};function Kp(n,e){return n.replace(Qp,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Qp=/\{\$([^}]+)}/g;function It(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(Sl(o)&&Sl(a)){if(!It(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Sl(n){return n!==null&&typeof n=="object"}function Eo(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Fl(n,e){let t=new mo(n,e);return t.subscribe.bind(t)}var mo=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Jp(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=fo),i.error===void 0&&(i.error=fo),i.complete===void 0&&(i.complete=fo);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(a){}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Jp(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function fo(){}var $E=14400*1e3;function me(n){return n&&n._delegate?n._delegate:n}var Te=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Mt="[DEFAULT]";var wo=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new xt;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch(i){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Xp(e))try{this.getOrInitializeService({instanceIdentifier:Mt})}catch(t){}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch(o){}}}}clearInstance(e=Mt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return b(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Mt){return this.instances.has(e)}getOptions(e=Mt){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(i)}return i}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);let o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch(o){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Yp(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(i){}return r||null}normalizeInstanceIdentifier(e=Mt){return this.component?this.component.multipleInstances?e:Mt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Yp(n){return n===Mt?void 0:n}function Xp(n){return n.instantiationMode==="EAGER"}var di=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new wo(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Zp=[],q=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(q||{}),em={debug:q.DEBUG,verbose:q.VERBOSE,info:q.INFO,warn:q.WARN,error:q.ERROR,silent:q.SILENT},tm=q.INFO,nm={[q.DEBUG]:"log",[q.VERBOSE]:"log",[q.INFO]:"info",[q.WARN]:"warn",[q.ERROR]:"error"},rm=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=nm[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Be=class{constructor(e){this.name=e,this._logLevel=tm,this._logHandler=rm,this._userLogHandler=null,Zp.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?em[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,q.DEBUG,...e),this._logHandler(this,q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,q.VERBOSE,...e),this._logHandler(this,q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,q.INFO,...e),this._logHandler(this,q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,q.WARN,...e),this._logHandler(this,q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,q.ERROR,...e),this._logHandler(this,q.ERROR,...e)}};var im=(n,e)=>e.some(t=>n instanceof t),Ul,Bl;function sm(){return Ul||(Ul=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function om(){return Bl||(Bl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var ql=new WeakMap,vo=new WeakMap,$l=new WeakMap,To=new WeakMap,bo=new WeakMap;function am(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(qe(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&ql.set(t,n)}).catch(()=>{}),bo.set(e,n),e}function cm(n){if(vo.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});vo.set(n,e)}var Ao={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return vo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||$l.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return qe(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function zl(n){Ao=n(Ao)}function um(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(fi(this),e,...t);return $l.set(r,e.sort?e.sort():[e]),qe(r)}:om().includes(n)?function(...e){return n.apply(fi(this),e),qe(ql.get(this))}:function(...e){return qe(n.apply(fi(this),e))}}function lm(n){return typeof n=="function"?um(n):(n instanceof IDBTransaction&&cm(n),im(n,sm())?new Proxy(n,Ao):n)}function qe(n){if(n instanceof IDBRequest)return am(n);if(To.has(n))return To.get(n);let e=lm(n);return e!==n&&(To.set(n,e),bo.set(e,n)),e}var fi=n=>bo.get(n);function Wl(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),l=qe(a);return r&&a.addEventListener("upgradeneeded",h=>{r(qe(a.result),h.oldVersion,h.newVersion,qe(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}var hm=["get","getKey","getAll","getAllKeys","count"],dm=["put","add","delete","clear"],So=new Map;function jl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(So.get(e))return So.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=dm.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||hm.includes(t)))return;let o=function(a,...l){return b(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),d=h.store;return r&&(d=d.index(l.shift())),(yield Promise.all([d[t](...l),i&&h.done]))[0]})};return So.set(e,o),o}zl(n=>De(H({},n),{get:(e,t,r)=>jl(e,t)||n.get(e,t,r),has:(e,t)=>!!jl(e,t)||n.has(e,t)}));var Po=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(fm(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function fm(n){return n.getComponent()?.type==="VERSION"}var Co="@firebase/app",Gl="0.14.9";var Je=new Be("@firebase/app"),pm="@firebase/app-compat",mm="@firebase/analytics-compat",gm="@firebase/analytics",_m="@firebase/app-check-compat",ym="@firebase/app-check",Im="@firebase/auth",Em="@firebase/auth-compat",wm="@firebase/database",Tm="@firebase/data-connect",vm="@firebase/database-compat",Am="@firebase/functions",bm="@firebase/functions-compat",Sm="@firebase/installations",Rm="@firebase/installations-compat",Pm="@firebase/messaging",Cm="@firebase/messaging-compat",km="@firebase/performance",Dm="@firebase/performance-compat",Nm="@firebase/remote-config",Vm="@firebase/remote-config-compat",Om="@firebase/storage",xm="@firebase/storage-compat",Lm="@firebase/firestore",Mm="@firebase/ai",Fm="@firebase/firestore-compat",Um="firebase",Bm="12.10.0";var ko="[DEFAULT]",qm={[Co]:"fire-core",[pm]:"fire-core-compat",[gm]:"fire-analytics",[mm]:"fire-analytics-compat",[ym]:"fire-app-check",[_m]:"fire-app-check-compat",[Im]:"fire-auth",[Em]:"fire-auth-compat",[wm]:"fire-rtdb",[Tm]:"fire-data-connect",[vm]:"fire-rtdb-compat",[Am]:"fire-fn",[bm]:"fire-fn-compat",[Sm]:"fire-iid",[Rm]:"fire-iid-compat",[Pm]:"fire-fcm",[Cm]:"fire-fcm-compat",[km]:"fire-perf",[Dm]:"fire-perf-compat",[Nm]:"fire-rc",[Vm]:"fire-rc-compat",[Om]:"fire-gcs",[xm]:"fire-gcs-compat",[Lm]:"fire-fst",[Fm]:"fire-fst-compat",[Mm]:"fire-vertex","fire-js":"fire-js",[Um]:"fire-js-all"};var ur=new Map,$m=new Map,Do=new Map;function Hl(n,e){try{n.container.addComponent(e)}catch(t){Je.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ve(n){let e=n.name;if(Do.has(e))return Je.debug(`There were multiple attempts to register component ${e}.`),!1;Do.set(e,n);for(let t of ur.values())Hl(t,n);for(let t of $m.values())Hl(t,n);return!0}function pi(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ye(n){return n==null?!1:n.settings!==void 0}var zm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Et=new Ne("app","Firebase",zm);var No=class{constructor(e,t,r){this._isDeleted=!1,this._options=H({},e),this._config=H({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Te("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Et.create("app-deleted",{appName:this._name})}};var hn=Bm;function xo(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=H({name:ko,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw Et.create("bad-app-name",{appName:String(i)});if(t||(t=_o()),!t)throw Et.create("no-options");let o=ur.get(i);if(o){if(It(t,o.options)&&It(r,o.config))return o;throw Et.create("duplicate-app",{appName:i})}let a=new di(i);for(let h of Do.values())a.addComponent(h);let l=new No(t,r,a);return ur.set(i,l),l}function dn(n=ko){let e=ur.get(n);if(!e&&n===ko&&_o())return xo();if(!e)throw Et.create("no-app",{appName:n});return e}function mi(){return Array.from(ur.values())}function re(n,e,t){let r=qm[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){let a=[`Unable to register library "${r}" with version "${e}":`];i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Je.warn(a.join(" "));return}Ve(new Te(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var jm="firebase-heartbeat-database",Wm=1,lr="firebase-heartbeat-store",Ro=null;function Yl(){return Ro||(Ro=Wl(jm,Wm,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(lr)}catch(t){console.warn(t)}}}}).catch(n=>{throw Et.create("idb-open",{originalErrorMessage:n.message})})),Ro}function Gm(n){return b(this,null,function*(){try{let t=(yield Yl()).transaction(lr),r=yield t.objectStore(lr).get(Xl(n));return yield t.done,r}catch(e){if(e instanceof Pe)Je.warn(e.message);else{let t=Et.create("idb-get",{originalErrorMessage:e?.message});Je.warn(t.message)}}})}function Kl(n,e){return b(this,null,function*(){try{let r=(yield Yl()).transaction(lr,"readwrite");yield r.objectStore(lr).put(e,Xl(n)),yield r.done}catch(t){if(t instanceof Pe)Je.warn(t.message);else{let r=Et.create("idb-set",{originalErrorMessage:t?.message});Je.warn(r.message)}}})}function Xl(n){return`${n.name}!${n.options.appId}`}var Hm=1024,Km=30,Vo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Oo(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return b(this,null,function*(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ql();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Km){let i=Jm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Je.warn(e)}})}getHeartbeatsHeader(){return b(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=Ql(),{heartbeatsToSend:t,unsentEntries:r}=Qm(this._heartbeatsCache.heartbeats),i=ar(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Je.warn(e),""}})}};function Ql(){return new Date().toISOString().substring(0,10)}function Qm(n,e=Hm){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Jl(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Jl(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Oo=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return b(this,null,function*(){return cr()?Ml().then(()=>!0).catch(()=>!1):!1})}read(){return b(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Gm(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return b(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Kl(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return b(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Kl(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function Jl(n){return ar(JSON.stringify({version:2,heartbeats:n})).length}function Jm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Ym(n){Ve(new Te("platform-logger",e=>new Po(e),"PRIVATE")),Ve(new Te("heartbeat",e=>new Vo(e),"PRIVATE")),re(Co,Gl,n),re(Co,Gl,"esm2020"),re("fire-js","")}Ym("");var Xm="firebase",Zm="12.10.0";re(Xm,Zm,"app");var Ut=new yl("ANGULARFIRE2_VERSION");function _i(n,e,t){if(e){if(e.length===1)return e[0];let o=e.filter(a=>a.app===t);if(o.length===1)return o[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var pn=(n,e)=>{let t=e?[e]:mi(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},fn=(function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n})(fn||{}),Zl=ho()&&typeof Zone<"u"?fn.WARN:fn.SILENT;var gi=class{zone;delegate;constructor(e,t=gl){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,o=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(o,t,r)}},Bt=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=Ue(_t);this.outsideAngular=t.runOutsideAngular(()=>new gi(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new gi(typeof Zone>"u"?void 0:Zone.current,ml))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=ri({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),eh=!1;function tg(n,e){!eh&&(Zl>fn.SILENT||ho())&&(eh=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Zl>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function ng(n){let e=Ue(_t,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Ft(n){let e=Ue(_t,{optional:!0});return e?e.run(()=>n()):n()}var rg=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),oi(t,()=>Ft(()=>n.apply(void 0,r)))),$e=(n,e,t)=>(t||=e?fn.WARN:fn.VERBOSE,function(){let r,i=arguments,o,a,l;try{o=Ue(Bt),a=Ue(wl),l=Ue(El)}catch(d){return tg(n,t),n.apply(this,i)}for(let d=0;d<arguments.length;d++)typeof i[d]=="function"&&(e&&(r||=Ft(()=>a.add())),i[d]=rg(i[d],r,l));let h=ng(()=>n.apply(this,i));return e?h instanceof sr?h.pipe(uo(o.outsideAngular),co(o.insideAngular),vl(l)):h instanceof Promise?Ft(()=>{let d=a.add();return new Promise((p,E)=>{h.then(v=>oi(l,()=>Ft(()=>p(v))),v=>oi(l,()=>Ft(()=>E(v)))).finally(d)})}):typeof h=="function"&&r?function(){return setTimeout(r,0),h.apply(this,arguments)}:Ft(()=>h):h instanceof sr?h.pipe(uo(o.outsideAngular),co(o.insideAngular)):Ft(()=>h)});var qt=class{constructor(e){return e}},hr=class{constructor(){return mi()}};function ig(n){return n&&n.length===1?n[0]:new qt(dn())}var Lo=new ii("angularfire2._apps"),sg={provide:qt,useFactory:ig,deps:[[new yt,Lo]]},og={provide:hr,deps:[[new yt,Lo]]};function ag(n){return(e,t)=>{let r=t.get(ci);re("angularfire",Ut.full,"core"),re("angularfire",Ut.full,"app"),re("angular",Il.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new qt(i)}}function kw(n,...e){return si([sg,og,{provide:Lo,useFactory:ag(n),multi:!0,deps:[_t,ai,Bt,...e]}])}var Dw=$e(xo,!0);var cg=new Map,ug={activated:!1,tokenObservers:[]},lg={initialized:!1,enabled:!1};function Oe(n){return cg.get(n)||H({},ug)}function ih(){return lg}var hg="https://content-firebaseappcheck.googleapis.com/v1";var dg="exchangeDebugToken",th={OFFSET_DURATION:300*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},Bw=1440*60*1e3;var Uo=class{constructor(e,t,r,i,o){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=i,i>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return b(this,null,function*(){this.stop();try{this.pending=new xt,this.pending.promise.catch(t=>{}),yield fg(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new xt,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function fg(n){return new Promise(e=>{setTimeout(e,n)})}var pg={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},wt=new Ne("appCheck","AppCheck",pg);function sh(n){if(!Oe(n).activated)throw wt.create("use-before-activation",{appName:n.name})}function oh(r,i){return b(this,arguments,function*({url:n,body:e},t){let o={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let R=yield a.getHeartbeatsHeader();R&&(o["X-Firebase-Client"]=R)}let l={method:"POST",body:JSON.stringify(e),headers:o},h;try{h=yield fetch(n,l)}catch(R){throw wt.create("fetch-network-error",{originalErrorMessage:R?.message})}if(h.status!==200)throw wt.create("fetch-status-error",{httpStatus:h.status});let d;try{d=yield h.json()}catch(R){throw wt.create("fetch-parse-error",{originalErrorMessage:R?.message})}let p=d.ttl.match(/^([\d.]+)(s)$/);if(!p||!p[2]||isNaN(Number(p[1])))throw wt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let E=Number(p[1])*1e3,v=Date.now();return{token:d.token,expireTimeMillis:v+E,issuedAtTimeMillis:v}})}function ah(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${hg}/projects/${t}/apps/${r}:${dg}?key=${i}`,body:{debug_token:e}}}var mg="firebase-app-check-database",gg=1,Bo="firebase-app-check-store";var yi=null;function _g(){return yi||(yi=new Promise((n,e)=>{try{let t=indexedDB.open(mg,gg);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{e(wt.create("storage-open",{originalErrorMessage:r.target.error?.message}))},t.onupgradeneeded=r=>{let i=r.target.result;r.oldVersion===0&&i.createObjectStore(Bo,{keyPath:"compositeKey"})}}catch(t){e(wt.create("storage-open",{originalErrorMessage:t?.message}))}}),yi)}function yg(n,e){return Ig(Eg(n),e)}function Ig(n,e){return b(this,null,function*(){let r=(yield _g()).transaction(Bo,"readwrite"),o=r.objectStore(Bo).put({compositeKey:n,value:e});return new Promise((a,l)=>{o.onsuccess=h=>{a()},r.onerror=h=>{l(wt.create("storage-set",{originalErrorMessage:h.target.error?.message}))}})})}function Eg(n){return`${n.options.appId}-${n.name}`}var dr=new Be("@firebase/app-check");function Mo(n,e){return cr()?yg(n,e).catch(t=>{dr.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function ch(){return ih().enabled}function uh(){return b(this,null,function*(){let n=ih();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var wg={error:"UNKNOWN_ERROR"};function Tg(n){return ui.encodeString(JSON.stringify(n),!1)}function qo(n,e=!1,t=!1){return b(this,null,function*(){let r=n.app;sh(r);let i=Oe(r),o=i.token,a;if(o&&!fr(o)&&(i.token=void 0,o=void 0),!o){let d=yield i.cachedTokenPromise;d&&(fr(d)?o=d:yield Mo(r,void 0))}if(!e&&o&&fr(o))return{token:o.token};let l=!1;if(ch())try{let d=yield uh();i.exchangeTokenPromise||(i.exchangeTokenPromise=oh(ah(r,d),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),l=!0);let p=yield i.exchangeTokenPromise;return yield Mo(r,p),i.token=p,{token:p.token}}catch(d){return d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?dr.warn(d.message):t&&dr.error(d),Fo(d)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),l=!0),o=yield Oe(r).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?dr.warn(d.message):t&&dr.error(d),a=d}let h;return o?a?fr(o)?h={token:o.token,internalError:a}:h=Fo(a):(h={token:o.token},i.token=o,yield Mo(r,o)):h=Fo(a),l&&Sg(r,h),h})}function vg(n){return b(this,null,function*(){let e=n.app;sh(e);let{provider:t}=Oe(e);if(ch()){let r=yield uh(),{token:i}=yield oh(ah(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function Ag(n,e,t,r){let{app:i}=n,o=Oe(i),a={next:t,error:r,type:e};if(o.tokenObservers=[...o.tokenObservers,a],o.token&&fr(o.token)){let l=o.token;Promise.resolve().then(()=>{t({token:l.token}),nh(n)}).catch(()=>{})}o.cachedTokenPromise.then(()=>nh(n))}function lh(n,e){let t=Oe(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function nh(n){let{app:e}=n,t=Oe(e),r=t.tokenRefresher;r||(r=bg(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function bg(n){let{app:e}=n;return new Uo(()=>b(null,null,function*(){let t=Oe(e),r;if(t.token?r=yield qo(n,!0):r=yield qo(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Oe(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-300*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},th.RETRIAL_MIN_WAIT,th.RETRIAL_MAX_WAIT)}function Sg(n,e){let t=Oe(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch(i){}}function fr(n){return n.expireTimeMillis-Date.now()>0}function Fo(n){return{token:Tg(wg),error:n}}var $o=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Oe(this.app);for(let t of e)lh(this.app,t.next);return Promise.resolve()}};function Rg(n,e){return new $o(n,e)}function Pg(n){return{getToken:e=>qo(n,e),getLimitedUseToken:()=>vg(n),addTokenListener:e=>Ag(n,"INTERNAL",e),removeTokenListener:e=>lh(n.app,e)}}var Cg="@firebase/app-check",kg="0.11.1";var Dg="app-check",rh="app-check-internal";function Ng(){Ve(new Te(Dg,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return Rg(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(rh).initialize()})),Ve(new Te(rh,n=>{let e=n.getProvider("app-check").getImmediate();return Pg(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),re(Cg,kg)}Ng();var Vg="app-check";var Ii=class{constructor(){return pn(Vg)}};var Og=["localhost","0.0.0.0","127.0.0.1"],Zw=typeof window<"u"&&Og.includes(window.location.hostname);function yh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Ih=yh,Eh=new Ne("auth","Firebase",yh());var vi=new Be("@firebase/auth");function Lg(n,...e){vi.logLevel<=q.WARN&&vi.warn(`Auth (${hn}): ${n}`,...e)}function wi(n,...e){vi.logLevel<=q.ERROR&&vi.error(`Auth (${hn}): ${n}`,...e)}function hh(n,...e){throw ea(n,...e)}function Zo(n,...e){return ea(n,...e)}function wh(n,e,t){let r=De(H({},Ih()),{[e]:t});return new Ne("auth","Firebase",r).create(e,{appName:n.name})}function Ti(n){return wh(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ea(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Eh.create(n,...e)}function K(n,e,...t){if(!n)throw ea(e,...t)}function pr(n){let e="INTERNAL ASSERTION FAILED: "+n;throw wi(e),new Error(e)}function Ai(n,e){n||pr(e)}function Mg(){return dh()==="http:"||dh()==="https:"}function dh(){return typeof self<"u"&&self.location?.protocol||null}function Fg(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Mg()||Ol()||"connection"in navigator)?navigator.onLine:!0}function Ug(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var jt=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ai(t>e,"Short delay should be less than long delay!"),this.isMobile=Nl()||xl()}get(){return Fg()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Bg(n,e){Ai(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var bi=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;pr("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;pr("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;pr("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var qg={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var $g=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],zg=new jt(3e4,6e4);function Th(n,e){return n.tenantId&&!e.tenantId?De(H({},e),{tenantId:n.tenantId}):e}function ki(o,a,l,h){return b(this,arguments,function*(n,e,t,r,i={}){return vh(n,i,()=>b(null,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let E=Eo(H({key:n.config.apiKey},p)).slice(1),v=yield n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);let R=H({method:e,headers:v},d);return Vl()||(R.referrerPolicy="no-referrer"),n.emulatorConfig&&Lt(n.emulatorConfig.host)&&(R.credentials="include"),bi.fetch()(yield Ah(n,n.config.apiHost,t,E),R)}))})}function vh(n,e,t){return b(this,null,function*(){n._canInitEmulator=!1;let r=H(H({},qg),e);try{let i=new Wo(n),o=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield o.json();if("needConfirmation"in a)throw Ei(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let l=o.ok?a.errorMessage:a.error.message,[h,d]=l.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ei(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Ei(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Ei(n,"user-disabled",a);let p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw wh(n,p,d);hh(n,p)}}catch(i){if(i instanceof Pe)throw i;hh(n,"network-request-failed",{message:String(i)})}})}function Ah(n,e,t,r){return b(this,null,function*(){let i=`${e}${t}?${r}`,o=n,a=o.config.emulator?Bg(n.config,i):`${n.config.apiScheme}://${i}`;return $g.includes(t)&&(yield o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a})}var Wo=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Zo(this.auth,"network-request-failed")),zg.get())})}};function Ei(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Zo(n,e,r);return i.customData._tokenResponse=t,i}function jg(n,e){return b(this,null,function*(){return ki(n,"POST","/v1/accounts:delete",e)})}function Si(n,e){return b(this,null,function*(){return ki(n,"POST","/v1/accounts:lookup",e)})}function mr(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch(e){}}function ta(n,e=!1){return b(this,null,function*(){let t=me(n),r=yield t.getIdToken(e),i=bh(r);K(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:mr(zo(i.auth_time)),issuedAtTime:mr(zo(i.iat)),expirationTime:mr(zo(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function zo(n){return Number(n)*1e3}function bh(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return wi("JWT malformed, contained fewer than 3 sections"),null;try{let i=li(t);return i?JSON.parse(i):(wi("Failed to decode base64 JWT payload"),null)}catch(i){return wi("Caught error parsing JWT payload as JSON",i?.toString()),null}}function fh(n){let e=bh(n);return K(e,"internal-error"),K(typeof e.exp<"u","internal-error"),K(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Go(n,e,t=!1){return b(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Pe&&Wg(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function Wg({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Ho=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>b(this,null,function*(){yield this.iteration()}),t)}iteration(){return b(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var _r=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=mr(this.lastLoginAt),this.creationTime=mr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Ri(n){return b(this,null,function*(){let e=n.auth,t=yield n.getIdToken(),r=yield Go(n,Si(e,{idToken:t}));K(r?.users.length,e,"internal-error");let i=r.users[0];n._notifyReloadListener(i);let o=i.providerUserInfo?.length?Sh(i.providerUserInfo):[],a=Gg(n.providerData,o),l=n.isAnonymous,h=!(n.email&&i.passwordHash)&&!a?.length,d=l?h:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new _r(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(n,p)})}function na(n){return b(this,null,function*(){let e=me(n);yield Ri(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function Gg(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Sh(n){return n.map(r=>{var i=r,{providerId:e}=i,t=ao(i,["providerId"]);return{providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}})}function Hg(n,e){return b(this,null,function*(){let t=yield vh(n,{},()=>b(null,null,function*(){let r=Eo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=yield Ah(n,i,"/v1/token",`key=${o}`),l=yield n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";let h={method:"POST",headers:l,body:r};return n.emulatorConfig&&Lt(n.emulatorConfig.host)&&(h.credentials="include"),bi.fetch()(a,h)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Kg(n,e){return b(this,null,function*(){return ki(n,"POST","/v2/accounts:revokeToken",Th(n,e))})}var gr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){K(e.idToken,"internal-error"),K(typeof e.idToken<"u","internal-error"),K(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):fh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){K(e.length!==0,"internal-error");let t=fh(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return b(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(K(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return b(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:o}=yield Hg(e,t);this.updateTokensAndExpiration(r,i,Number(o))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(K(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(K(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(K(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return pr("not implemented")}};function Tt(n,e){K(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var $t=class n{constructor(o){var a=o,{uid:e,auth:t,stsTokenManager:r}=a,i=ao(a,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ho(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new _r(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return b(this,null,function*(){let t=yield Go(this,this.stsTokenManager.getToken(this.auth,e));return K(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return ta(this,e)}reload(){return na(this)}_assign(e){this!==e&&(K(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>H({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(De(H({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){K(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return b(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Ri(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return b(this,null,function*(){if(Ye(this.auth.app))return Promise.reject(Ti(this.auth));let e=yield this.getIdToken();return yield Go(this,jg(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return De(H({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>H({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,i=t.email??void 0,o=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,h=t._redirectEventId??void 0,d=t.createdAt??void 0,p=t.lastLoginAt??void 0,{uid:E,emailVerified:v,isAnonymous:R,providerData:V,stsTokenManager:x}=t;K(E&&x,e,"internal-error");let N=gr.fromJSON(this.name,x);K(typeof E=="string",e,"internal-error"),Tt(r,e.name),Tt(i,e.name),K(typeof v=="boolean",e,"internal-error"),K(typeof R=="boolean",e,"internal-error"),Tt(o,e.name),Tt(a,e.name),Tt(l,e.name),Tt(h,e.name),Tt(d,e.name),Tt(p,e.name);let z=new n({uid:E,auth:e,email:i,emailVerified:v,displayName:r,isAnonymous:R,photoURL:a,phoneNumber:o,tenantId:l,stsTokenManager:N,createdAt:d,lastLoginAt:p});return V&&Array.isArray(V)&&(z.providerData=V.map(G=>H({},G))),h&&(z._redirectEventId=h),z}static _fromIdTokenResponse(e,t,r=!1){return b(this,null,function*(){let i=new gr;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Ri(o),o})}static _fromGetAccountInfoResponse(e,t,r){return b(this,null,function*(){let i=t.users[0];K(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?Sh(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,l=new gr;l.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new _r(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,d),h})}};var ph=new Map;function zt(n){Ai(n instanceof Function,"Expected a class definition");let e=ph.get(n);return e?(Ai(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ph.set(n,e),e)}var Qg=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return b(this,null,function*(){return!0})}_set(t,r){return b(this,null,function*(){this.storage[t]=r})}_get(t){return b(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return b(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Ko=Qg;function jo(n,e,t){return`firebase:${n}:${e}:${t}`}var Pi=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=jo(this.userKey,i.apiKey,o),this.fullPersistenceKey=jo("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return b(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Si(this.auth,{idToken:e}).catch(()=>{});return t?$t._fromGetAccountInfoResponse(this.auth,t,e):null}return $t._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return b(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return b(this,null,function*(){if(!t.length)return new n(zt(Ko),e,r);let i=(yield Promise.all(t.map(d=>b(null,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),o=i[0]||zt(Ko),a=jo(r,e.config.apiKey,e.name),l=null;for(let d of t)try{let p=yield d._get(a);if(p){let E;if(typeof p=="string"){let v=yield Si(e,{idToken:p}).catch(()=>{});if(!v)break;E=yield $t._fromGetAccountInfoResponse(e,v,p)}else E=$t._fromJSON(e,p);d!==o&&(l=E),o=d;break}}catch(p){}let h=i.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],l&&(yield o._set(a,l.toJSON())),yield Promise.all(t.map(d=>b(null,null,function*(){if(d!==o)try{yield d._remove(a)}catch(p){}}))),new n(o,e,r))})}};function mh(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Zg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Jg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(t_(e))return"Blackberry";if(n_(e))return"Webos";if(Yg(e))return"Safari";if((e.includes("chrome/")||Xg(e))&&!e.includes("edge/"))return"Chrome";if(e_(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Jg(n=Se()){return/firefox\//i.test(n)}function Yg(n=Se()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Xg(n=Se()){return/crios\//i.test(n)}function Zg(n=Se()){return/iemobile/i.test(n)}function e_(n=Se()){return/android/i.test(n)}function t_(n=Se()){return/blackberry/i.test(n)}function n_(n=Se()){return/webos/i.test(n)}function Rh(n,e=[]){let t;switch(n){case"Browser":t=mh(Se());break;case"Worker":t=`${mh(Se())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${hn}/${r}`}var Qo=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,l)=>{try{let h=e(o);a(h)}catch(h){l(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return b(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch(o){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function r_(t){return b(this,arguments,function*(n,e={}){return ki(n,"GET","/v2/passwordPolicy",Th(n,e))})}var i_=6,Jo=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??i_,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var Yo=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ci(this),this.idTokenSubscription=new Ci(this),this.beforeStateQueue=new Qo(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Eh,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=zt(t)),this._initializationPromise=this.queue(()=>b(this,null,function*(){if(!this._deleted&&(this.persistenceManager=yield Pi.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(r){}yield this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return b(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return b(this,null,function*(){try{let t=yield Si(this,{idToken:e}),r=yield $t._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return b(this,null,function*(){if(Ye(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let t=yield this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=yield this.tryRedirectSignIn(e);(!o||o===a)&&l?.user&&(r=l.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{yield this.beforeStateQueue.runMiddleware(r)}catch(o){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return K(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return b(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(r){yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return b(this,null,function*(){try{yield Ri(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=Ug()}_delete(){return b(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return b(this,null,function*(){if(Ye(this.app))return Promise.reject(Ti(this));let t=e?me(e):null;return t&&K(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return b(this,null,function*(){if(!this._deleted)return e&&K(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>b(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return b(this,null,function*(){return Ye(this.app)?Promise.reject(Ti(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Ye(this.app)?Promise.reject(Ti(this)):this.queue(()=>b(this,null,function*(){yield this.assertedPersistence.setPersistence(zt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return b(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return b(this,null,function*(){let e=yield r_(this),t=new Jo(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ne("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return b(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield Kg(this,r)}})}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}_setRedirectUser(e,t){return b(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return b(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&zt(e)||this._popupRedirectResolver;K(t,this,"argument-error"),this.redirectPersistenceManager=yield Pi.create(this,[zt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return b(this,null,function*(){return this._isInitialized&&(yield this.queue(()=>b(this,null,function*(){}))),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null})}_persistUserIfCurrent(e){return b(this,null,function*(){if(e===this.currentUser)return this.queue(()=>b(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,l=this._isInitialized?Promise.resolve():this._initializationPromise;if(K(l,this,"internal-error"),l.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}directlySetCurrentUser(e){return b(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return K(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Rh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return b(this,null,function*(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=yield this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=yield this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e})}_getAppCheckToken(){return b(this,null,function*(){if(Ye(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=yield this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&Lg(`Error while retrieving App Check token: ${e.error}`),e?.token})}};function s_(n){return me(n)}var Ci=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Fl(t=>this.observer=t)}get next(){return K(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var o_={loadJS(){return b(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function a_(n){o_=n}function c_(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function u_(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(zt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}var lT=c_("rcb"),hT=new jt(3e4,6e4);var dT=new jt(2e3,1e4);var fT=600*1e3;var pT=new jt(3e4,6e4);var mT=new jt(5e3,15e3);var gT=encodeURIComponent("fac");var gh="@firebase/auth",_h="1.12.1";var Xo=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}getToken(e){return b(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){K(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function l_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function h_(n){Ve(new Te("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;K(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Rh(n)},d=new Yo(r,i,o,h);return u_(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ve(new Te("auth-internal",e=>{let t=s_(e.getProvider("auth").getImmediate());return(r=>new Xo(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),re(gh,_h,l_(n)),re(gh,_h,"esm2020")}var d_=300,_T=kl("authIdTokenMaxAge")||d_;function f_(){return document.getElementsByTagName("head")?.[0]??document}a_({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=Zo("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",f_().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});h_("Browser");var hy="auth";var Di=class{constructor(){return pn(hy)}};var Ph=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ch={};var Xe,ra;(function(){var n;function e(I,m){function _(){}_.prototype=m.prototype,I.F=m.prototype,I.prototype=new _,I.prototype.constructor=I,I.D=function(w,y,A){for(var g=Array(arguments.length-2),ve=2;ve<arguments.length;ve++)g[ve-2]=arguments[ve];return m.prototype[y].apply(w,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(I,m,_){_||(_=0);let w=Array(16);if(typeof m=="string")for(var y=0;y<16;++y)w[y]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(y=0;y<16;++y)w[y]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=I.g[0],_=I.g[1],y=I.g[2];let A=I.g[3],g;g=m+(A^_&(y^A))+w[0]+3614090360&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(y^m&(_^y))+w[1]+3905402710&4294967295,A=m+(g<<12&4294967295|g>>>20),g=y+(_^A&(m^_))+w[2]+606105819&4294967295,y=A+(g<<17&4294967295|g>>>15),g=_+(m^y&(A^m))+w[3]+3250441966&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(A^_&(y^A))+w[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(y^m&(_^y))+w[5]+1200080426&4294967295,A=m+(g<<12&4294967295|g>>>20),g=y+(_^A&(m^_))+w[6]+2821735955&4294967295,y=A+(g<<17&4294967295|g>>>15),g=_+(m^y&(A^m))+w[7]+4249261313&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(A^_&(y^A))+w[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(y^m&(_^y))+w[9]+2336552879&4294967295,A=m+(g<<12&4294967295|g>>>20),g=y+(_^A&(m^_))+w[10]+4294925233&4294967295,y=A+(g<<17&4294967295|g>>>15),g=_+(m^y&(A^m))+w[11]+2304563134&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(A^_&(y^A))+w[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(y^m&(_^y))+w[13]+4254626195&4294967295,A=m+(g<<12&4294967295|g>>>20),g=y+(_^A&(m^_))+w[14]+2792965006&4294967295,y=A+(g<<17&4294967295|g>>>15),g=_+(m^y&(A^m))+w[15]+1236535329&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(y^A&(_^y))+w[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^y&(m^_))+w[6]+3225465664&4294967295,A=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(A^m))+w[11]+643717713&4294967295,y=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(y^A))+w[0]+3921069994&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^A&(_^y))+w[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^y&(m^_))+w[10]+38016083&4294967295,A=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(A^m))+w[15]+3634488961&4294967295,y=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(y^A))+w[4]+3889429448&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^A&(_^y))+w[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^y&(m^_))+w[14]+3275163606&4294967295,A=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(A^m))+w[3]+4107603335&4294967295,y=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(y^A))+w[8]+1163531501&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^A&(_^y))+w[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^y&(m^_))+w[2]+4243563512&4294967295,A=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(A^m))+w[7]+1735328473&4294967295,y=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(y^A))+w[12]+2368359562&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(_^y^A)+w[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^y)+w[8]+2272392833&4294967295,A=m+(g<<11&4294967295|g>>>21),g=y+(A^m^_)+w[11]+1839030562&4294967295,y=A+(g<<16&4294967295|g>>>16),g=_+(y^A^m)+w[14]+4259657740&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^A)+w[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^y)+w[4]+1272893353&4294967295,A=m+(g<<11&4294967295|g>>>21),g=y+(A^m^_)+w[7]+4139469664&4294967295,y=A+(g<<16&4294967295|g>>>16),g=_+(y^A^m)+w[10]+3200236656&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^A)+w[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^y)+w[0]+3936430074&4294967295,A=m+(g<<11&4294967295|g>>>21),g=y+(A^m^_)+w[3]+3572445317&4294967295,y=A+(g<<16&4294967295|g>>>16),g=_+(y^A^m)+w[6]+76029189&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^A)+w[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^y)+w[12]+3873151461&4294967295,A=m+(g<<11&4294967295|g>>>21),g=y+(A^m^_)+w[15]+530742520&4294967295,y=A+(g<<16&4294967295|g>>>16),g=_+(y^A^m)+w[2]+3299628645&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(y^(_|~A))+w[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~y))+w[7]+1126891415&4294967295,A=m+(g<<10&4294967295|g>>>22),g=y+(m^(A|~_))+w[14]+2878612391&4294967295,y=A+(g<<15&4294967295|g>>>17),g=_+(A^(y|~m))+w[5]+4237533241&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~A))+w[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~y))+w[3]+2399980690&4294967295,A=m+(g<<10&4294967295|g>>>22),g=y+(m^(A|~_))+w[10]+4293915773&4294967295,y=A+(g<<15&4294967295|g>>>17),g=_+(A^(y|~m))+w[1]+2240044497&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~A))+w[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~y))+w[15]+4264355552&4294967295,A=m+(g<<10&4294967295|g>>>22),g=y+(m^(A|~_))+w[6]+2734768916&4294967295,y=A+(g<<15&4294967295|g>>>17),g=_+(A^(y|~m))+w[13]+1309151649&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~A))+w[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~y))+w[11]+3174756917&4294967295,A=m+(g<<10&4294967295|g>>>22),g=y+(m^(A|~_))+w[2]+718787259&4294967295,y=A+(g<<15&4294967295|g>>>17),g=_+(A^(y|~m))+w[9]+3951481745&4294967295,I.g[0]=I.g[0]+m&4294967295,I.g[1]=I.g[1]+(y+(g<<21&4294967295|g>>>11))&4294967295,I.g[2]=I.g[2]+y&4294967295,I.g[3]=I.g[3]+A&4294967295}r.prototype.v=function(I,m){m===void 0&&(m=I.length);let _=m-this.blockSize,w=this.C,y=this.h,A=0;for(;A<m;){if(y==0)for(;A<=_;)i(this,I,A),A+=this.blockSize;if(typeof I=="string"){for(;A<m;)if(w[y++]=I.charCodeAt(A++),y==this.blockSize){i(this,w),y=0;break}}else for(;A<m;)if(w[y++]=I[A++],y==this.blockSize){i(this,w),y=0;break}}this.h=y,this.o+=m},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var m=1;m<I.length-8;++m)I[m]=0;m=this.o*8;for(var _=I.length-8;_<I.length;++_)I[_]=m&255,m/=256;for(this.v(I),I=Array(16),m=0,_=0;_<4;++_)for(let w=0;w<32;w+=8)I[m++]=this.g[_]>>>w&255;return I};function o(I,m){var _=l;return Object.prototype.hasOwnProperty.call(_,I)?_[I]:_[I]=m(I)}function a(I,m){this.h=m;let _=[],w=!0;for(let y=I.length-1;y>=0;y--){let A=I[y]|0;w&&A==m||(_[y]=A,w=!1)}this.g=_}var l={};function h(I){return-128<=I&&I<128?o(I,function(m){return new a([m|0],m<0?-1:0)}):new a([I|0],I<0?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return E;if(I<0)return N(d(-I));let m=[],_=1;for(let w=0;I>=_;w++)m[w]=I/_|0,_*=4294967296;return new a(m,0)}function p(I,m){if(I.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(I.charAt(0)=="-")return N(p(I.substring(1),m));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');let _=d(Math.pow(m,8)),w=E;for(let A=0;A<I.length;A+=8){var y=Math.min(8,I.length-A);let g=parseInt(I.substring(A,A+y),m);y<8?(y=d(Math.pow(m,y)),w=w.j(y).add(d(g))):(w=w.j(_),w=w.add(d(g)))}return w}var E=h(0),v=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(x(this))return-N(this).m();let I=0,m=1;for(let _=0;_<this.g.length;_++){let w=this.i(_);I+=(w>=0?w:4294967296+w)*m,m*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(V(this))return"0";if(x(this))return"-"+N(this).toString(I);let m=d(Math.pow(I,6));var _=this;let w="";for(;;){let y=_e(_,m).g;_=z(_,y.j(m));let A=((_.g.length>0?_.g[0]:_.h)>>>0).toString(I);if(_=y,V(_))return A+w;for(;A.length<6;)A="0"+A;w=A+w}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function V(I){if(I.h!=0)return!1;for(let m=0;m<I.g.length;m++)if(I.g[m]!=0)return!1;return!0}function x(I){return I.h==-1}n.l=function(I){return I=z(this,I),x(I)?-1:V(I)?0:1};function N(I){let m=I.g.length,_=[];for(let w=0;w<m;w++)_[w]=~I.g[w];return new a(_,~I.h).add(v)}n.abs=function(){return x(this)?N(this):this},n.add=function(I){let m=Math.max(this.g.length,I.g.length),_=[],w=0;for(let y=0;y<=m;y++){let A=w+(this.i(y)&65535)+(I.i(y)&65535),g=(A>>>16)+(this.i(y)>>>16)+(I.i(y)>>>16);w=g>>>16,A&=65535,g&=65535,_[y]=g<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function z(I,m){return I.add(N(m))}n.j=function(I){if(V(this)||V(I))return E;if(x(this))return x(I)?N(this).j(N(I)):N(N(this).j(I));if(x(I))return N(this.j(N(I)));if(this.l(R)<0&&I.l(R)<0)return d(this.m()*I.m());let m=this.g.length+I.g.length,_=[];for(var w=0;w<2*m;w++)_[w]=0;for(w=0;w<this.g.length;w++)for(let y=0;y<I.g.length;y++){let A=this.i(w)>>>16,g=this.i(w)&65535,ve=I.i(y)>>>16,lt=I.i(y)&65535;_[2*w+2*y]+=g*lt,G(_,2*w+2*y),_[2*w+2*y+1]+=A*lt,G(_,2*w+2*y+1),_[2*w+2*y+1]+=g*ve,G(_,2*w+2*y+1),_[2*w+2*y+2]+=A*ve,G(_,2*w+2*y+2)}for(I=0;I<m;I++)_[I]=_[2*I+1]<<16|_[2*I];for(I=m;I<2*m;I++)_[I]=0;return new a(_,0)};function G(I,m){for(;(I[m]&65535)!=I[m];)I[m+1]+=I[m]>>>16,I[m]&=65535,m++}function Y(I,m){this.g=I,this.h=m}function _e(I,m){if(V(m))throw Error("division by zero");if(V(I))return new Y(E,E);if(x(I))return m=_e(N(I),m),new Y(N(m.g),N(m.h));if(x(m))return m=_e(I,N(m)),new Y(N(m.g),m.h);if(I.g.length>30){if(x(I)||x(m))throw Error("slowDivide_ only works with positive integers.");for(var _=v,w=m;w.l(I)<=0;)_=ke(_),w=ke(w);var y=pe(_,1),A=pe(w,1);for(w=pe(w,2),_=pe(_,2);!V(w);){var g=A.add(w);g.l(I)<=0&&(y=y.add(_),A=g),w=pe(w,1),_=pe(_,1)}return m=z(I,y.j(m)),new Y(y,m)}for(y=E;I.l(m)>=0;){for(_=Math.max(1,Math.floor(I.m()/m.m())),w=Math.ceil(Math.log(_)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),A=d(_),g=A.j(m);x(g)||g.l(I)>0;)_-=w,A=d(_),g=A.j(m);V(A)&&(A=v),y=y.add(A),I=z(I,g)}return new Y(y,I)}n.B=function(I){return _e(this,I).h},n.and=function(I){let m=Math.max(this.g.length,I.g.length),_=[];for(let w=0;w<m;w++)_[w]=this.i(w)&I.i(w);return new a(_,this.h&I.h)},n.or=function(I){let m=Math.max(this.g.length,I.g.length),_=[];for(let w=0;w<m;w++)_[w]=this.i(w)|I.i(w);return new a(_,this.h|I.h)},n.xor=function(I){let m=Math.max(this.g.length,I.g.length),_=[];for(let w=0;w<m;w++)_[w]=this.i(w)^I.i(w);return new a(_,this.h^I.h)};function ke(I){let m=I.g.length+1,_=[];for(let w=0;w<m;w++)_[w]=I.i(w)<<1|I.i(w-1)>>>31;return new a(_,I.h)}function pe(I,m){let _=m>>5;m%=32;let w=I.g.length-_,y=[];for(let A=0;A<w;A++)y[A]=m>0?I.i(A+_)>>>m|I.i(A+_+1)<<32-m:I.i(A+_);return new a(y,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,ra=Ch.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,Xe=Ch.Integer=a}).apply(typeof Ph<"u"?Ph:typeof self<"u"?self:typeof window<"u"?window:{});var Ni=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ze={};var ia,dy,mn,sa,yr,Vi,oa,aa,ca;(function(){var n,e=Object.defineProperty;function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ni=="object"&&Ni];for(var c=0;c<s.length;++c){var u=s[c];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var u=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var T=s[f];if(!(T in u))break e;u=u[T]}s=s[s.length-1],f=u[s],c=c(f),c!=f&&c!=null&&e(u,s,{configurable:!0,writable:!0,value:c})}}i("Symbol.dispose",function(s){return s||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(s){return s||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(s){return s||function(c){var u=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&u.push([f,c[f]]);return u}});var o=o||{},a=this||self;function l(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function h(s,c,u){return s.call.apply(s.bind,arguments)}function d(s,c,u){return d=h,d.apply(null,arguments)}function p(s,c){var u=Array.prototype.slice.call(arguments,1);return function(){var f=u.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function E(s,c){function u(){}u.prototype=c.prototype,s.Z=c.prototype,s.prototype=new u,s.prototype.constructor=s,s.Ob=function(f,T,S){for(var k=Array(arguments.length-2),B=2;B<arguments.length;B++)k[B-2]=arguments[B];return c.prototype[T].apply(f,k)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?s=>s&&AsyncContext.Snapshot.wrap(s):s=>s;function R(s){let c=s.length;if(c>0){let u=Array(c);for(let f=0;f<c;f++)u[f]=s[f];return u}return[]}function V(s,c){for(let f=1;f<arguments.length;f++){let T=arguments[f];var u=typeof T;if(u=u!="object"?u:T?Array.isArray(T)?"array":u:"null",u=="array"||u=="object"&&typeof T.length=="number"){u=s.length||0;let S=T.length||0;s.length=u+S;for(let k=0;k<S;k++)s[u+k]=T[k]}else s.push(T)}}class x{constructor(c,u){this.i=c,this.j=u,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function N(s){a.setTimeout(()=>{throw s},0)}function z(){var s=I;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class G{constructor(){this.h=this.g=null}add(c,u){let f=Y.get();f.set(c,u),this.h?this.h.next=f:this.g=f,this.h=f}}var Y=new x(()=>new _e,s=>s.reset());class _e{constructor(){this.next=this.g=this.h=null}set(c,u){this.h=c,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let ke,pe=!1,I=new G,m=()=>{let s=Promise.resolve(void 0);ke=()=>{s.then(_)}};function _(){for(var s;s=z();){try{s.h.call(s.g)}catch(u){N(u)}var c=Y;c.j(s),c.h<100&&(c.h++,s.next=c.g,c.g=s)}pe=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let u=()=>{};a.addEventListener("test",u,c),a.removeEventListener("test",u,c)}catch(u){}return s})();function g(s){return/^[\s\xa0]*$/.test(s)}function ve(s,c){y.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s&&this.init(s,c)}E(ve,y),ve.prototype.init=function(s,c){let u=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget,c||(u=="mouseover"?c=s.fromElement:u=="mouseout"&&(c=s.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=s.pointerType,this.state=s.state,this.i=s,s.defaultPrevented&&ve.Z.h.call(this)},ve.prototype.h=function(){ve.Z.h.call(this);let s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var lt="closure_listenable_"+(Math.random()*1e6|0),cp=0;function up(s,c,u,f,T){this.listener=s,this.proxy=null,this.src=c,this.type=u,this.capture=!!f,this.ha=T,this.key=++cp,this.da=this.fa=!1}function qr(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function $r(s,c,u){for(let f in s)c.call(u,s[f],f,s)}function lp(s,c){for(let u in s)c.call(void 0,s[u],u,s)}function fu(s){let c={};for(let u in s)c[u]=s[u];return c}let pu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function mu(s,c){let u,f;for(let T=1;T<arguments.length;T++){f=arguments[T];for(u in f)s[u]=f[u];for(let S=0;S<pu.length;S++)u=pu[S],Object.prototype.hasOwnProperty.call(f,u)&&(s[u]=f[u])}}function zr(s){this.src=s,this.g={},this.h=0}zr.prototype.add=function(s,c,u,f,T){let S=s.toString();s=this.g[S],s||(s=this.g[S]=[],this.h++);let k=Fs(s,c,f,T);return k>-1?(c=s[k],u||(c.fa=!1)):(c=new up(c,this.src,S,!!f,T),c.fa=u,s.push(c)),c};function Ms(s,c){let u=c.type;if(u in s.g){var f=s.g[u],T=Array.prototype.indexOf.call(f,c,void 0),S;(S=T>=0)&&Array.prototype.splice.call(f,T,1),S&&(qr(c),s.g[u].length==0&&(delete s.g[u],s.h--))}}function Fs(s,c,u,f){for(let T=0;T<s.length;++T){let S=s[T];if(!S.da&&S.listener==c&&S.capture==!!u&&S.ha==f)return T}return-1}var Us="closure_lm_"+(Math.random()*1e6|0),Bs={};function gu(s,c,u,f,T){if(f&&f.once)return yu(s,c,u,f,T);if(Array.isArray(c)){for(let S=0;S<c.length;S++)gu(s,c[S],u,f,T);return null}return u=js(u),s&&s[lt]?s.J(c,u,l(f)?!!f.capture:!!f,T):_u(s,c,u,!1,f,T)}function _u(s,c,u,f,T,S){if(!c)throw Error("Invalid event type");let k=l(T)?!!T.capture:!!T,B=$s(s);if(B||(s[Us]=B=new zr(s)),u=B.add(c,u,f,k,S),u.proxy)return u;if(f=hp(),u.proxy=f,f.src=s,f.listener=u,s.addEventListener)A||(T=k),T===void 0&&(T=!1),s.addEventListener(c.toString(),f,T);else if(s.attachEvent)s.attachEvent(Eu(c.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return u}function hp(){function s(u){return c.call(s.src,s.listener,u)}let c=dp;return s}function yu(s,c,u,f,T){if(Array.isArray(c)){for(let S=0;S<c.length;S++)yu(s,c[S],u,f,T);return null}return u=js(u),s&&s[lt]?s.K(c,u,l(f)?!!f.capture:!!f,T):_u(s,c,u,!0,f,T)}function Iu(s,c,u,f,T){if(Array.isArray(c))for(var S=0;S<c.length;S++)Iu(s,c[S],u,f,T);else f=l(f)?!!f.capture:!!f,u=js(u),s&&s[lt]?(s=s.i,S=String(c).toString(),S in s.g&&(c=s.g[S],u=Fs(c,u,f,T),u>-1&&(qr(c[u]),Array.prototype.splice.call(c,u,1),c.length==0&&(delete s.g[S],s.h--)))):s&&(s=$s(s))&&(c=s.g[c.toString()],s=-1,c&&(s=Fs(c,u,f,T)),(u=s>-1?c[s]:null)&&qs(u))}function qs(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[lt])Ms(c.i,s);else{var u=s.type,f=s.proxy;c.removeEventListener?c.removeEventListener(u,f,s.capture):c.detachEvent?c.detachEvent(Eu(u),f):c.addListener&&c.removeListener&&c.removeListener(f),(u=$s(c))?(Ms(u,s),u.h==0&&(u.src=null,c[Us]=null)):qr(s)}}}function Eu(s){return s in Bs?Bs[s]:Bs[s]="on"+s}function dp(s,c){if(s.da)s=!0;else{c=new ve(c,this);let u=s.listener,f=s.ha||s.src;s.fa&&qs(s),s=u.call(f,c)}return s}function $s(s){return s=s[Us],s instanceof zr?s:null}var zs="__closure_events_fn_"+(Math.random()*1e9>>>0);function js(s){return typeof s=="function"?s:(s[zs]||(s[zs]=function(c){return s.handleEvent(c)}),s[zs])}function ye(){w.call(this),this.i=new zr(this),this.M=this,this.G=null}E(ye,w),ye.prototype[lt]=!0,ye.prototype.removeEventListener=function(s,c,u,f){Iu(this,s,c,u,f)};function Ee(s,c){var u,f=s.G;if(f)for(u=[];f;f=f.G)u.push(f);if(s=s.M,f=c.type||c,typeof c=="string")c=new y(c,s);else if(c instanceof y)c.target=c.target||s;else{var T=c;c=new y(f,s),mu(c,T)}T=!0;let S,k;if(u)for(k=u.length-1;k>=0;k--)S=c.g=u[k],T=jr(S,f,!0,c)&&T;if(S=c.g=s,T=jr(S,f,!0,c)&&T,T=jr(S,f,!1,c)&&T,u)for(k=0;k<u.length;k++)S=c.g=u[k],T=jr(S,f,!1,c)&&T}ye.prototype.N=function(){if(ye.Z.N.call(this),this.i){var s=this.i;for(let c in s.g){let u=s.g[c];for(let f=0;f<u.length;f++)qr(u[f]);delete s.g[c],s.h--}}this.G=null},ye.prototype.J=function(s,c,u,f){return this.i.add(String(s),c,!1,u,f)},ye.prototype.K=function(s,c,u,f){return this.i.add(String(s),c,!0,u,f)};function jr(s,c,u,f){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();let T=!0;for(let S=0;S<c.length;++S){let k=c[S];if(k&&!k.da&&k.capture==u){let B=k.listener,ue=k.ha||k.src;k.fa&&Ms(s.i,k),T=B.call(ue,f)!==!1&&T}}return T&&!f.defaultPrevented}function fp(s,c){if(typeof s!="function")if(s&&typeof s.handleEvent=="function")s=d(s.handleEvent,s);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(s,c||0)}function wu(s){s.g=fp(()=>{s.g=null,s.i&&(s.i=!1,wu(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class pp extends w{constructor(c,u){super(),this.m=c,this.l=u,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:wu(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zn(s){w.call(this),this.h=s,this.g={}}E(zn,w);var Tu=[];function vu(s){$r(s.g,function(c,u){this.g.hasOwnProperty(u)&&qs(c)},s),s.g={}}zn.prototype.N=function(){zn.Z.N.call(this),vu(this)},zn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ws=a.JSON.stringify,mp=a.JSON.parse,gp=class{stringify(s){return a.JSON.stringify(s,void 0)}parse(s){return a.JSON.parse(s,void 0)}};function Au(){}function bu(){}var jn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Gs(){y.call(this,"d")}E(Gs,y);function Hs(){y.call(this,"c")}E(Hs,y);var kt={},Su=null;function Wr(){return Su=Su||new ye}kt.Ia="serverreachability";function Ru(s){y.call(this,kt.Ia,s)}E(Ru,y);function Wn(s){let c=Wr();Ee(c,new Ru(c))}kt.STAT_EVENT="statevent";function Pu(s,c){y.call(this,kt.STAT_EVENT,s),this.stat=c}E(Pu,y);function we(s){let c=Wr();Ee(c,new Pu(c,s))}kt.Ja="timingevent";function Cu(s,c){y.call(this,kt.Ja,s),this.size=c}E(Cu,y);function Gn(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){s()},c)}function Hn(){this.g=!0}Hn.prototype.ua=function(){this.g=!1};function _p(s,c,u,f,T,S){s.info(function(){if(s.g)if(S){var k="",B=S.split("&");for(let J=0;J<B.length;J++){var ue=B[J].split("=");if(ue.length>1){let le=ue[0];ue=ue[1];let Fe=le.split("_");k=Fe.length>=2&&Fe[1]=="type"?k+(le+"="+ue+"&"):k+(le+"=redacted&")}}}else k=null;else k=S;return"XMLHTTP REQ ("+f+") [attempt "+T+"]: "+c+`
`+u+`
`+k})}function yp(s,c,u,f,T,S,k){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+T+"]: "+c+`
`+u+`
`+S+" "+k})}function cn(s,c,u,f){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+Ep(s,u)+(f?" "+f:"")})}function Ip(s,c){s.info(function(){return"TIMEOUT: "+c})}Hn.prototype.info=function(){};function Ep(s,c){if(!s.g)return c;if(!c)return null;try{let S=JSON.parse(c);if(S){for(s=0;s<S.length;s++)if(Array.isArray(S[s])){var u=S[s];if(!(u.length<2)){var f=u[1];if(Array.isArray(f)&&!(f.length<1)){var T=f[0];if(T!="noop"&&T!="stop"&&T!="close")for(let k=1;k<f.length;k++)f[k]=""}}}}return Ws(S)}catch(S){return c}}var Gr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ku={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Du;function Ks(){}E(Ks,Au),Ks.prototype.g=function(){return new XMLHttpRequest},Du=new Ks;function Kn(s){return encodeURIComponent(String(s))}function wp(s){var c=1;s=s.split(":");let u=[];for(;c>0&&s.length;)u.push(s.shift()),c--;return s.length&&u.push(s.join(":")),u}function ht(s,c,u,f){this.j=s,this.i=c,this.l=u,this.S=f||1,this.V=new zn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Nu}function Nu(){this.i=null,this.g="",this.h=!1}var Vu={},Qs={};function Js(s,c,u){s.M=1,s.A=Kr(Me(c)),s.u=u,s.R=!0,Ou(s,null)}function Ou(s,c){s.F=Date.now(),Hr(s),s.B=Me(s.A);var u=s.B,f=s.S;Array.isArray(f)||(f=[String(f)]),Hu(u.i,"t",f),s.C=0,u=s.j.L,s.h=new Nu,s.g=hl(s.j,u?c:null,!s.u),s.P>0&&(s.O=new pp(d(s.Y,s,s.g),s.P)),c=s.V,u=s.g,f=s.ba;var T="readystatechange";Array.isArray(T)||(T&&(Tu[0]=T.toString()),T=Tu);for(let S=0;S<T.length;S++){let k=gu(u,T[S],f||c.handleEvent,!1,c.h||c);if(!k)break;c.g[k.key]=k}c=s.J?fu(s.J):{},s.u?(s.v||(s.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.B,s.v,s.u,c)):(s.v="GET",s.g.ea(s.B,s.v,null,c)),Wn(),_p(s.i,s.v,s.B,s.l,s.S,s.u)}ht.prototype.ba=function(s){s=s.target;let c=this.O;c&&pt(s)==3?c.j():this.Y(s)},ht.prototype.Y=function(s){try{if(s==this.g)e:{let B=pt(this.g),ue=this.g.ya(),J=this.g.ca();if(!(B<3)&&(B!=3||this.g&&(this.h.h||this.g.la()||el(this.g)))){this.K||B!=4||ue==7||(ue==8||J<=0?Wn(3):Wn(2)),Ys(this);var c=this.g.ca();this.X=c;var u=Tp(this);if(this.o=c==200,yp(this.i,this.v,this.B,this.l,this.S,B,c),this.o){if(this.U&&!this.L){t:{if(this.g){var f,T=this.g;if((f=T.g?T.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var S=f;break t}}S=null}if(s=S)cn(this.i,this.l,s,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Xs(this,s);else{this.o=!1,this.m=3,we(12),Dt(this),Qn(this);break e}}if(this.R){s=!0;let le;for(;!this.K&&this.C<u.length;)if(le=vp(this,u),le==Qs){B==4&&(this.m=4,we(14),s=!1),cn(this.i,this.l,null,"[Incomplete Response]");break}else if(le==Vu){this.m=4,we(15),cn(this.i,this.l,u,"[Invalid Chunk]"),s=!1;break}else cn(this.i,this.l,le,null),Xs(this,le);if(xu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),B!=4||u.length!=0||this.h.h||(this.m=1,we(16),s=!1),this.o=this.o&&s,!s)cn(this.i,this.l,u,"[Invalid Chunked Response]"),Dt(this),Qn(this);else if(u.length>0&&!this.W){this.W=!0;var k=this.j;k.g==this&&k.aa&&!k.P&&(k.j.info("Great, no buffering proxy detected. Bytes received: "+u.length),so(k),k.P=!0,we(11))}}else cn(this.i,this.l,u,null),Xs(this,u);B==4&&Dt(this),this.o&&!this.K&&(B==4?al(this.j,this):(this.o=!1,Hr(this)))}else Mp(this.g),c==400&&u.indexOf("Unknown SID")>0?(this.m=3,we(12)):(this.m=0,we(13)),Dt(this),Qn(this)}}}catch(B){}};function Tp(s){if(!xu(s))return s.g.la();let c=el(s.g);if(c==="")return"";let u="",f=c.length,T=pt(s.g)==4;if(!s.h.i){if(typeof TextDecoder>"u")return Dt(s),Qn(s),"";s.h.i=new a.TextDecoder}for(let S=0;S<f;S++)s.h.h=!0,u+=s.h.i.decode(c[S],{stream:!(T&&S==f-1)});return c.length=0,s.h.g+=u,s.C=0,s.h.g}function xu(s){return s.g?s.v=="GET"&&s.M!=2&&s.j.Aa:!1}function vp(s,c){var u=s.C,f=c.indexOf(`
`,u);return f==-1?Qs:(u=Number(c.substring(u,f)),isNaN(u)?Vu:(f+=1,f+u>c.length?Qs:(c=c.slice(f,f+u),s.C=f+u,c)))}ht.prototype.cancel=function(){this.K=!0,Dt(this)};function Hr(s){s.T=Date.now()+s.H,Lu(s,s.H)}function Lu(s,c){if(s.D!=null)throw Error("WatchDog timer not null");s.D=Gn(d(s.aa,s),c)}function Ys(s){s.D&&(a.clearTimeout(s.D),s.D=null)}ht.prototype.aa=function(){this.D=null;let s=Date.now();s-this.T>=0?(Ip(this.i,this.B),this.M!=2&&(Wn(),we(17)),Dt(this),this.m=2,Qn(this)):Lu(this,this.T-s)};function Qn(s){s.j.I==0||s.K||al(s.j,s)}function Dt(s){Ys(s);var c=s.O;c&&typeof c.dispose=="function"&&c.dispose(),s.O=null,vu(s.V),s.g&&(c=s.g,s.g=null,c.abort(),c.dispose())}function Xs(s,c){try{var u=s.j;if(u.I!=0&&(u.g==s||Zs(u.h,s))){if(!s.L&&Zs(u.h,s)&&u.I==3){try{var f=u.Ba.g.parse(c)}catch(J){f=null}if(Array.isArray(f)&&f.length==3){var T=f;if(T[0]==0){e:if(!u.v){if(u.g)if(u.g.F+3e3<s.F)ei(u),Xr(u);else break e;io(u),we(18)}}else u.xa=T[1],0<u.xa-u.K&&T[2]<37500&&u.F&&u.A==0&&!u.C&&(u.C=Gn(d(u.Va,u),6e3));Uu(u.h)<=1&&u.ta&&(u.ta=void 0)}else Vt(u,11)}else if((s.L||u.g==s)&&ei(u),!g(c))for(T=u.Ba.g.parse(c),c=0;c<T.length;c++){let J=T[c],le=J[0];if(!(le<=u.K))if(u.K=le,J=J[1],u.I==2)if(J[0]=="c"){u.M=J[1],u.ba=J[2];let Fe=J[3];Fe!=null&&(u.ka=Fe,u.j.info("VER="+u.ka));let Ot=J[4];Ot!=null&&(u.za=Ot,u.j.info("SVER="+u.za));let mt=J[5];mt!=null&&typeof mt=="number"&&mt>0&&(f=1.5*mt,u.O=f,u.j.info("backChannelRequestTimeoutMs_="+f)),f=u;let gt=s.g;if(gt){let ni=gt.g?gt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ni){var S=f.h;S.g||ni.indexOf("spdy")==-1&&ni.indexOf("quic")==-1&&ni.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(eo(S,S.h),S.h=null))}if(f.G){let oo=gt.g?gt.g.getResponseHeader("X-HTTP-Session-Id"):null;oo&&(f.wa=oo,X(f.J,f.G,oo))}}u.I=3,u.l&&u.l.ra(),u.aa&&(u.T=Date.now()-s.F,u.j.info("Handshake RTT: "+u.T+"ms")),f=u;var k=s;if(f.na=ll(f,f.L?f.ba:null,f.W),k.L){Bu(f.h,k);var B=k,ue=f.O;ue&&(B.H=ue),B.D&&(Ys(B),Hr(B)),f.g=k}else sl(f);u.i.length>0&&Zr(u)}else J[0]!="stop"&&J[0]!="close"||Vt(u,7);else u.I==3&&(J[0]=="stop"||J[0]=="close"?J[0]=="stop"?Vt(u,7):ro(u):J[0]!="noop"&&u.l&&u.l.qa(J),u.A=0)}}Wn(4)}catch(J){}}var Ap=class{constructor(s,c){this.g=s,this.map=c}};function Mu(s){this.l=s||10,a.PerformanceNavigationTiming?(s=a.performance.getEntriesByType("navigation"),s=s.length>0&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Fu(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function Uu(s){return s.h?1:s.g?s.g.size:0}function Zs(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function eo(s,c){s.g?s.g.add(c):s.h=c}function Bu(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}Mu.prototype.cancel=function(){if(this.i=qu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function qu(s){if(s.h!=null)return s.i.concat(s.h.G);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let u of s.g.values())c=c.concat(u.G);return c}return R(s.i)}var $u=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function bp(s,c){if(s){s=s.split("&");for(let u=0;u<s.length;u++){let f=s[u].indexOf("="),T,S=null;f>=0?(T=s[u].substring(0,f),S=s[u].substring(f+1)):T=s[u],c(T,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function dt(s){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;s instanceof dt?(this.l=s.l,Jn(this,s.j),this.o=s.o,this.g=s.g,Yn(this,s.u),this.h=s.h,to(this,Ku(s.i)),this.m=s.m):s&&(c=String(s).match($u))?(this.l=!1,Jn(this,c[1]||"",!0),this.o=Xn(c[2]||""),this.g=Xn(c[3]||"",!0),Yn(this,c[4]),this.h=Xn(c[5]||"",!0),to(this,c[6]||"",!0),this.m=Xn(c[7]||"")):(this.l=!1,this.i=new er(null,this.l))}dt.prototype.toString=function(){let s=[];var c=this.j;c&&s.push(Zn(c,zu,!0),":");var u=this.g;return(u||c=="file")&&(s.push("//"),(c=this.o)&&s.push(Zn(c,zu,!0),"@"),s.push(Kn(u).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.u,u!=null&&s.push(":",String(u))),(u=this.h)&&(this.g&&u.charAt(0)!="/"&&s.push("/"),s.push(Zn(u,u.charAt(0)=="/"?Pp:Rp,!0))),(u=this.i.toString())&&s.push("?",u),(u=this.m)&&s.push("#",Zn(u,kp)),s.join("")},dt.prototype.resolve=function(s){let c=Me(this),u=!!s.j;u?Jn(c,s.j):u=!!s.o,u?c.o=s.o:u=!!s.g,u?c.g=s.g:u=s.u!=null;var f=s.h;if(u)Yn(c,s.u);else if(u=!!s.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var T=c.h.lastIndexOf("/");T!=-1&&(f=c.h.slice(0,T+1)+f)}if(T=f,T==".."||T==".")f="";else if(T.indexOf("./")!=-1||T.indexOf("/.")!=-1){f=T.lastIndexOf("/",0)==0,T=T.split("/");let S=[];for(let k=0;k<T.length;){let B=T[k++];B=="."?f&&k==T.length&&S.push(""):B==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&k==T.length&&S.push("")):(S.push(B),f=!0)}f=S.join("/")}else f=T}return u?c.h=f:u=s.i.toString()!=="",u?to(c,Ku(s.i)):u=!!s.m,u&&(c.m=s.m),c};function Me(s){return new dt(s)}function Jn(s,c,u){s.j=u?Xn(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function Yn(s,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);s.u=c}else s.u=null}function to(s,c,u){c instanceof er?(s.i=c,Dp(s.i,s.l)):(u||(c=Zn(c,Cp)),s.i=new er(c,s.l))}function X(s,c,u){s.i.set(c,u)}function Kr(s){return X(s,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),s}function Xn(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function Zn(s,c,u){return typeof s=="string"?(s=encodeURI(s).replace(c,Sp),u&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function Sp(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var zu=/[#\/\?@]/g,Rp=/[#\?:]/g,Pp=/[#\?]/g,Cp=/[#\?@]/g,kp=/#/g;function er(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function Nt(s){s.g||(s.g=new Map,s.h=0,s.i&&bp(s.i,function(c,u){s.add(decodeURIComponent(c.replace(/\+/g," ")),u)}))}n=er.prototype,n.add=function(s,c){Nt(this),this.i=null,s=un(this,s);let u=this.g.get(s);return u||this.g.set(s,u=[]),u.push(c),this.h+=1,this};function ju(s,c){Nt(s),c=un(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function Wu(s,c){return Nt(s),c=un(s,c),s.g.has(c)}n.forEach=function(s,c){Nt(this),this.g.forEach(function(u,f){u.forEach(function(T){s.call(c,T,f,this)},this)},this)};function Gu(s,c){Nt(s);let u=[];if(typeof c=="string")Wu(s,c)&&(u=u.concat(s.g.get(un(s,c))));else for(s=Array.from(s.g.values()),c=0;c<s.length;c++)u=u.concat(s[c]);return u}n.set=function(s,c){return Nt(this),this.i=null,s=un(this,s),Wu(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=Gu(this,s),s.length>0?String(s[0]):c):c};function Hu(s,c,u){ju(s,c),u.length>0&&(s.i=null,s.g.set(un(s,c),R(u)),s.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var u=c[f];let T=Kn(u);u=Gu(this,u);for(let S=0;S<u.length;S++){let k=T;u[S]!==""&&(k+="="+Kn(u[S])),s.push(k)}}return this.i=s.join("&")};function Ku(s){let c=new er;return c.i=s.i,s.g&&(c.g=new Map(s.g),c.h=s.h),c}function un(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function Dp(s,c){c&&!s.j&&(Nt(s),s.i=null,s.g.forEach(function(u,f){let T=f.toLowerCase();f!=T&&(ju(this,f),Hu(this,T,u))},s)),s.j=c}function Np(s,c){let u=new Hn;if(a.Image){let f=new Image;f.onload=p(ft,u,"TestLoadImage: loaded",!0,c,f),f.onerror=p(ft,u,"TestLoadImage: error",!1,c,f),f.onabort=p(ft,u,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(ft,u,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else c(!1)}function Vp(s,c){let u=new Hn,f=new AbortController,T=setTimeout(()=>{f.abort(),ft(u,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:f.signal}).then(S=>{clearTimeout(T),S.ok?ft(u,"TestPingServer: ok",!0,c):ft(u,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(T),ft(u,"TestPingServer: error",!1,c)})}function ft(s,c,u,f,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),f(u)}catch(S){}}function Op(){this.g=new gp}function Qr(s){this.i=s.Sb||null,this.h=s.ab||!1}E(Qr,Au),Qr.prototype.g=function(){return new Jr(this.i,this.h)};function Jr(s,c){ye.call(this),this.H=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}E(Jr,ye),n=Jr.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=s,this.D=c,this.readyState=1,nr(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};s&&(c.body=s),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,tr(this)),this.readyState=0},n.Pa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,nr(this)),this.g&&(this.readyState=3,nr(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Qu(this)}else s.text().then(this.Oa.bind(this),this.ga.bind(this))};function Qu(s){s.j.read().then(s.Ma.bind(s)).catch(s.ga.bind(s))}n.Ma=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?tr(this):nr(this),this.readyState==3&&Qu(this)}},n.Oa=function(s){this.g&&(this.response=this.responseText=s,tr(this))},n.Na=function(s){this.g&&(this.response=s,tr(this))},n.ga=function(){this.g&&tr(this)};function tr(s){s.readyState=4,s.l=null,s.j=null,s.B=null,nr(s)}n.setRequestHeader=function(s,c){this.A.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var u=c.next();!u.done;)u=u.value,s.push(u[0]+": "+u[1]),u=c.next();return s.join(`\r
`)};function nr(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(Jr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Ju(s){let c="";return $r(s,function(u,f){c+=f,c+=":",c+=u,c+=`\r
`}),c}function no(s,c,u){e:{for(f in u){var f=!1;break e}f=!0}f||(u=Ju(u),typeof s=="string"?u!=null&&Kn(u):X(s,c,u))}function te(s){ye.call(this),this.headers=new Map,this.L=s||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}E(te,ye);var xp=/^https?$/i,Lp=["POST","PUT"];n=te.prototype,n.Fa=function(s){this.H=s},n.ea=function(s,c,u,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Du.g(),this.g.onreadystatechange=v(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(S){Yu(this,S);return}if(s=u||"",u=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var T in f)u.set(T,f[T]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())u.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(u.keys()).find(S=>S.toLowerCase()=="content-type"),T=a.FormData&&s instanceof a.FormData,!(Array.prototype.indexOf.call(Lp,c,void 0)>=0)||f||T||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,k]of u)this.g.setRequestHeader(S,k);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(s),this.v=!1}catch(S){Yu(this,S)}};function Yu(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.o=5,Xu(s),Yr(s)}function Xu(s){s.A||(s.A=!0,Ee(s,"complete"),Ee(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=s||7,Ee(this,"complete"),Ee(this,"abort"),Yr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Yr(this,!0)),te.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Zu(this):this.Xa())},n.Xa=function(){Zu(this)};function Zu(s){if(s.h&&typeof o<"u"){if(s.v&&pt(s)==4)setTimeout(s.Ca.bind(s),0);else if(Ee(s,"readystatechange"),pt(s)==4){s.h=!1;try{let S=s.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var u;if(!(u=c)){var f;if(f=S===0){let k=String(s.D).match($u)[1]||null;!k&&a.self&&a.self.location&&(k=a.self.location.protocol.slice(0,-1)),f=!xp.test(k?k.toLowerCase():"")}u=f}if(u)Ee(s,"complete"),Ee(s,"success");else{s.o=6;try{var T=pt(s)>2?s.g.statusText:""}catch(k){T=""}s.l=T+" ["+s.ca()+"]",Xu(s)}}finally{Yr(s)}}}}function Yr(s,c){if(s.g){s.m&&(clearTimeout(s.m),s.m=null);let u=s.g;s.g=null,c||Ee(s,"ready");try{u.onreadystatechange=null}catch(f){}}}n.isActive=function(){return!!this.g};function pt(s){return s.g?s.g.readyState:0}n.ca=function(){try{return pt(this)>2?this.g.status:-1}catch(s){return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch(s){return""}},n.La=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),mp(c)}};function el(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.F){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch(c){return null}}function Mp(s){let c={};s=(s.g&&pt(s)>=2&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if(g(s[f]))continue;var u=wp(s[f]);let T=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();let S=c[T]||[];c[T]=S,S.push(u)}lp(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function rr(s,c,u){return u&&u.internalChannelParams&&u.internalChannelParams[s]||c}function tl(s){this.za=0,this.i=[],this.j=new Hn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=rr("failFast",!1,s),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=rr("baseRetryDelayMs",5e3,s),this.Za=rr("retryDelaySeedMs",1e4,s),this.Ta=rr("forwardChannelMaxRetries",2,s),this.va=rr("forwardChannelRequestTimeoutMs",2e4,s),this.ma=s&&s.xmlHttpFactory||void 0,this.Ua=s&&s.Rb||void 0,this.Aa=s&&s.useFetchStreams||!1,this.O=void 0,this.L=s&&s.supportsCrossDomainXhr||!1,this.M="",this.h=new Mu(s&&s.concurrentRequestLimit),this.Ba=new Op,this.S=s&&s.fastHandshake||!1,this.R=s&&s.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=s&&s.Pb||!1,s&&s.ua&&this.j.ua(),s&&s.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&s&&s.detectBufferingProxy||!1,this.ia=void 0,s&&s.longPollingTimeout&&s.longPollingTimeout>0&&(this.ia=s.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=tl.prototype,n.ka=8,n.I=1,n.connect=function(s,c,u,f){we(0),this.W=s,this.H=c||{},u&&f!==void 0&&(this.H.OSID=u,this.H.OAID=f),this.F=this.X,this.J=ll(this,null,this.W),Zr(this)};function ro(s){if(nl(s),s.I==3){var c=s.V++,u=Me(s.J);if(X(u,"SID",s.M),X(u,"RID",c),X(u,"TYPE","terminate"),ir(s,u),c=new ht(s,s.j,c),c.M=2,c.A=Kr(Me(u)),u=!1,a.navigator&&a.navigator.sendBeacon)try{u=a.navigator.sendBeacon(c.A.toString(),"")}catch(f){}!u&&a.Image&&(new Image().src=c.A,u=!0),u||(c.g=hl(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Hr(c)}ul(s)}function Xr(s){s.g&&(so(s),s.g.cancel(),s.g=null)}function nl(s){Xr(s),s.v&&(a.clearTimeout(s.v),s.v=null),ei(s),s.h.cancel(),s.m&&(typeof s.m=="number"&&a.clearTimeout(s.m),s.m=null)}function Zr(s){if(!Fu(s.h)&&!s.m){s.m=!0;var c=s.Ea;ke||m(),pe||(ke(),pe=!0),I.add(c,s),s.D=0}}function Fp(s,c){return Uu(s.h)>=s.h.j-(s.m?1:0)?!1:s.m?(s.i=c.G.concat(s.i),!0):s.I==1||s.I==2||s.D>=(s.Sa?0:s.Ta)?!1:(s.m=Gn(d(s.Ea,s,c),cl(s,s.D)),s.D++,!0)}n.Ea=function(s){if(this.m)if(this.m=null,this.I==1){if(!s){this.V=Math.floor(Math.random()*1e5),s=this.V++;let T=new ht(this,this.j,s),S=this.o;if(this.U&&(S?(S=fu(S),mu(S,this.U)):S=this.U),this.u!==null||this.R||(T.J=S,S=null),this.S)e:{for(var c=0,u=0;u<this.i.length;u++){t:{var f=this.i[u];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=u;break e}if(c===4096||u===this.i.length-1){c=u+1;break e}}c=1e3}else c=1e3;c=il(this,T,c),u=Me(this.J),X(u,"RID",s),X(u,"CVER",22),this.G&&X(u,"X-HTTP-Session-Id",this.G),ir(this,u),S&&(this.R?c="headers="+Kn(Ju(S))+"&"+c:this.u&&no(u,this.u,S)),eo(this.h,T),this.Ra&&X(u,"TYPE","init"),this.S?(X(u,"$req",c),X(u,"SID","null"),T.U=!0,Js(T,u,null)):Js(T,u,c),this.I=2}}else this.I==3&&(s?rl(this,s):this.i.length==0||Fu(this.h)||rl(this))};function rl(s,c){var u;c?u=c.l:u=s.V++;let f=Me(s.J);X(f,"SID",s.M),X(f,"RID",u),X(f,"AID",s.K),ir(s,f),s.u&&s.o&&no(f,s.u,s.o),u=new ht(s,s.j,u,s.D+1),s.u===null&&(u.J=s.o),c&&(s.i=c.G.concat(s.i)),c=il(s,u,1e3),u.H=Math.round(s.va*.5)+Math.round(s.va*.5*Math.random()),eo(s.h,u),Js(u,f,c)}function ir(s,c){s.H&&$r(s.H,function(u,f){X(c,f,u)}),s.l&&$r({},function(u,f){X(c,f,u)})}function il(s,c,u){u=Math.min(s.i.length,u);let f=s.l?d(s.l.Ka,s.l,s):null;e:{var T=s.i;let B=-1;for(;;){let ue=["count="+u];B==-1?u>0?(B=T[0].g,ue.push("ofs="+B)):B=0:ue.push("ofs="+B);let J=!0;for(let le=0;le<u;le++){var S=T[le].g;let Fe=T[le].map;if(S-=B,S<0)B=Math.max(0,T[le].g-100),J=!1;else try{S="req"+S+"_"||"";try{var k=Fe instanceof Map?Fe:Object.entries(Fe);for(let[Ot,mt]of k){let gt=mt;l(mt)&&(gt=Ws(mt)),ue.push(S+Ot+"="+encodeURIComponent(gt))}}catch(Ot){throw ue.push(S+"type="+encodeURIComponent("_badmap")),Ot}}catch(Ot){f&&f(Fe)}}if(J){k=ue.join("&");break e}}k=void 0}return s=s.i.splice(0,u),c.G=s,k}function sl(s){if(!s.g&&!s.v){s.Y=1;var c=s.Da;ke||m(),pe||(ke(),pe=!0),I.add(c,s),s.A=0}}function io(s){return s.g||s.v||s.A>=3?!1:(s.Y++,s.v=Gn(d(s.Da,s),cl(s,s.A)),s.A++,!0)}n.Da=function(){if(this.v=null,ol(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var s=4*this.T;this.j.info("BP detection timer enabled: "+s),this.B=Gn(d(this.Wa,this),s)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,we(10),Xr(this),ol(this))};function so(s){s.B!=null&&(a.clearTimeout(s.B),s.B=null)}function ol(s){s.g=new ht(s,s.j,"rpc",s.Y),s.u===null&&(s.g.J=s.o),s.g.P=0;var c=Me(s.na);X(c,"RID","rpc"),X(c,"SID",s.M),X(c,"AID",s.K),X(c,"CI",s.F?"0":"1"),!s.F&&s.ia&&X(c,"TO",s.ia),X(c,"TYPE","xmlhttp"),ir(s,c),s.u&&s.o&&no(c,s.u,s.o),s.O&&(s.g.H=s.O);var u=s.g;s=s.ba,u.M=1,u.A=Kr(Me(c)),u.u=null,u.R=!0,Ou(u,s)}n.Va=function(){this.C!=null&&(this.C=null,Xr(this),io(this),we(19))};function ei(s){s.C!=null&&(a.clearTimeout(s.C),s.C=null)}function al(s,c){var u=null;if(s.g==c){ei(s),so(s),s.g=null;var f=2}else if(Zs(s.h,c))u=c.G,Bu(s.h,c),f=1;else return;if(s.I!=0){if(c.o)if(f==1){u=c.u?c.u.length:0,c=Date.now()-c.F;var T=s.D;f=Wr(),Ee(f,new Cu(f,u)),Zr(s)}else sl(s);else if(T=c.m,T==3||T==0&&c.X>0||!(f==1&&Fp(s,c)||f==2&&io(s)))switch(u&&u.length>0&&(c=s.h,c.i=c.i.concat(u)),T){case 1:Vt(s,5);break;case 4:Vt(s,10);break;case 3:Vt(s,6);break;default:Vt(s,2)}}}function cl(s,c){let u=s.Qa+Math.floor(Math.random()*s.Za);return s.isActive()||(u*=2),u*c}function Vt(s,c){if(s.j.info("Error code "+c),c==2){var u=d(s.bb,s),f=s.Ua;let T=!f;f=new dt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Jn(f,"https"),Kr(f),T?Np(f.toString(),u):Vp(f.toString(),u)}else we(2);s.I=0,s.l&&s.l.pa(c),ul(s),nl(s)}n.bb=function(s){s?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))};function ul(s){if(s.I=0,s.ja=[],s.l){let c=qu(s.h);(c.length!=0||s.i.length!=0)&&(V(s.ja,c),V(s.ja,s.i),s.h.i.length=0,R(s.i),s.i.length=0),s.l.oa()}}function ll(s,c,u){var f=u instanceof dt?Me(u):new dt(u);if(f.g!="")c&&(f.g=c+"."+f.g),Yn(f,f.u);else{var T=a.location;f=T.protocol,c=c?c+"."+T.hostname:T.hostname,T=+T.port;let S=new dt(null);f&&Jn(S,f),c&&(S.g=c),T&&Yn(S,T),u&&(S.h=u),f=S}return u=s.G,c=s.wa,u&&c&&X(f,u,c),X(f,"VER",s.ka),ir(s,f),f}function hl(s,c,u){if(c&&!s.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Aa&&!s.ma?new te(new Qr({ab:u})):new te(s.ma),c.Fa(s.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function dl(){}n=dl.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ti(){}ti.prototype.g=function(s,c){return new be(s,c)};function be(s,c){ye.call(this),this.g=new tl(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(s?s["X-WebChannel-Client-Profile"]=c.sa:s={"X-WebChannel-Client-Profile":c.sa}),this.g.U=s,(s=c&&c.Qb)&&!g(s)&&(this.g.u=s),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new ln(this)}E(be,ye),be.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},be.prototype.close=function(){ro(this.g)},be.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var u={};u.__data__=s,s=u}else this.v&&(u={},u.__data__=Ws(s),s=u);c.i.push(new Ap(c.Ya++,s)),c.I==3&&Zr(c)},be.prototype.N=function(){this.g.l=null,delete this.j,ro(this.g),delete this.g,be.Z.N.call(this)};function fl(s){Gs.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let u in c){s=u;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}E(fl,Gs);function pl(){Hs.call(this),this.status=1}E(pl,Hs);function ln(s){this.g=s}E(ln,dl),ln.prototype.ra=function(){Ee(this.g,"a")},ln.prototype.qa=function(s){Ee(this.g,new fl(s))},ln.prototype.pa=function(s){Ee(this.g,new pl)},ln.prototype.oa=function(){Ee(this.g,"b")},ti.prototype.createWebChannel=ti.prototype.g,be.prototype.send=be.prototype.o,be.prototype.open=be.prototype.m,be.prototype.close=be.prototype.close,ca=Ze.createWebChannelTransport=function(){return new ti},aa=Ze.getStatEventTarget=function(){return Wr()},oa=Ze.Event=kt,Vi=Ze.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Gr.NO_ERROR=0,Gr.TIMEOUT=8,Gr.HTTP_ERROR=6,yr=Ze.ErrorCode=Gr,ku.COMPLETE="complete",sa=Ze.EventType=ku,bu.EventType=jn,jn.OPEN="a",jn.CLOSE="b",jn.ERROR="c",jn.MESSAGE="d",ye.prototype.listen=ye.prototype.J,mn=Ze.WebChannel=bu,dy=Ze.FetchXmlHttpFactory=Qr,te.prototype.listenOnce=te.prototype.K,te.prototype.getLastError=te.prototype.Ha,te.prototype.getLastErrorCode=te.prototype.ya,te.prototype.getStatus=te.prototype.ca,te.prototype.getResponseJson=te.prototype.La,te.prototype.getResponseText=te.prototype.la,te.prototype.send=te.prototype.ea,te.prototype.setWithCredentials=te.prototype.Fa,ia=Ze.XhrIo=te}).apply(typeof Ni<"u"?Ni:typeof self<"u"?self:typeof window<"u"?window:{});var he=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};he.UNAUTHENTICATED=new he(null),he.GOOGLE_CREDENTIALS=new he("google-credentials-uid"),he.FIRST_PARTY=new he("first-party-uid"),he.MOCK_USER=new he("mock-user");var Ln="12.10.0";function gd(n){Ln=n}var Ht=new Be("@firebase/firestore");function gn(){return Ht.logLevel}function D(n,...e){if(Ht.logLevel<=q.DEBUG){let t=e.map(Uc);Ht.debug(`Firestore (${Ln}): ${n}`,...t)}}function rt(n,...e){if(Ht.logLevel<=q.ERROR){let t=e.map(Uc);Ht.error(`Firestore (${Ln}): ${n}`,...t)}}function it(n,...e){if(Ht.logLevel<=q.WARN){let t=e.map(Uc);Ht.warn(`Firestore (${Ln}): ${n}`,...t)}}function Uc(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch(e){return n}}function M(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,_d(n,r,t)}function _d(n,e,t){let r=`FIRESTORE (${Ln}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch(i){r+=" CONTEXT: "+t}throw rt(r),new Error(r)}function Q(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||_d(e,i,r)}function F(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends Pe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var et=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Bi=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},qi=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(he.UNAUTHENTICATED))}shutdown(){}},pa=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},$i=class{constructor(e){this.t=e,this.currentUser=he.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new et;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new et,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(()=>b(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},l=h=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?l(h):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new et)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Bi(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new he(e)}},ma=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=he.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}},ga=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new ma(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(he.FIRST_PARTY))}shutdown(){}invalidateToken(){}},zi=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},ji=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ye(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);let r=o=>{o.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.m;return this.m=o.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?i(o):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new zi(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new zi(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function fy(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Kt=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=fy(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}};function j(n,e){return n<e?-1:n>e?1:0}function _a(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),o=e.charAt(r);if(i!==o)return ua(i)===ua(o)?j(i,o):ua(i)?1:-1}return j(n.length,e.length)}var py=55296,my=57343;function ua(n){let e=n.charCodeAt(0);return e>=py&&e<=my}function vn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var kh="__name__",Wi=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&M(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&M(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return j(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):_a(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Xe.fromString(e.substring(4,e.length-2))}},ee=class n extends Wi{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new O(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},gy=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ae=class n extends Wi{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return gy.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===kh}static keyField(){return new n([kh])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new O(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let l=e[i];if(l==="\\"){if(i+1===e.length)throw new O(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new O(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(r+=l,i++):(o(),i++)}if(o(),a)throw new O(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(ee.fromString(e))}static fromName(e){return new n(ee.fromString(e).popFirst(5))}static empty(){return new n(ee.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ee.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ee.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ee(e.slice()))}};function yd(n,e,t){if(!t)throw new O(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Id(n,e,t,r){if(e===!0&&r===!0)throw new O(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Dh(n){if(!L.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Nh(n){if(L.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ed(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ws(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":M(12329,{type:typeof n})}function Pt(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=ws(n);throw new O(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ie(n,e){let t={typeString:n};return e&&(t.value=e),t}function Mn(n,e){if(!Ed(n))throw new O(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new O(P.INVALID_ARGUMENT,t);return!0}var Vh=-62135596800,Oh=1e6,se=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Oh);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Vh)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Oh}_compareTo(e){return this.seconds===e.seconds?j(this.nanoseconds,e.nanoseconds):j(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Mn(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Vh;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};se._jsonSchemaVersion="firestore/timestamp/1.0",se._jsonSchema={type:ie("string",se._jsonSchemaVersion),seconds:ie("number"),nanoseconds:ie("number")};var U=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new se(0,0))}static max(){return new n(new se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ar=-1,Gi=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Gi.UNKNOWN_ID=-1;function _y(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=U.fromTimestamp(r===1e9?new se(t+1,0):new se(t,r));return new Qt(i,L.empty(),e)}function yy(n){return new Qt(n.readTime,n.key,Ar)}var Qt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(U.min(),L.empty(),Ar)}static max(){return new n(U.max(),L.empty(),Ar)}};function Iy(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:j(n.largestBatchId,e.largestBatchId))}var Ey="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ya=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Fn(n){return b(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==Ey)throw n;D("LocalStore","Unexpectedly lost primary lease")})}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(l=>{++i,l.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),l=0;for(let h=0;h<o;h++){let d=h;t(e[d]).next(p=>{a[d]=p,++l,l===o&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function wy(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Un(n){return n.name==="IndexedDbTransactionError"}var Bc=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>r.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}n.ce=-1;return n})(),qc=-1;function Ts(n){return n==null}function br(n){return n===0&&1/n==-1/0}function Ty(n){return typeof n=="number"&&Number.isInteger(n)&&!br(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var wd="";function vy(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=xh(e)),e=Ay(n.get(t),e);return xh(e)}function Ay(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case wd:t+="";break;default:t+=o}}return t}function xh(n){return n+wd+""}var by="remoteDocuments",Td="owner";var vd="mutationQueues";var Ad="mutations";var bd="documentMutations",Sy="remoteDocumentsV14";var Sd="remoteDocumentGlobal";var Rd="targets";var Pd="targetDocuments";var Cd="targetGlobal",kd="collectionParents";var Dd="clientMetadata";var Nd="bundles";var Vd="namedQueries";var Ry="indexConfiguration";var Py="indexState";var Cy="indexEntries";var Od="documentOverlays";var ky="globals";var Dy=[vd,Ad,bd,by,Rd,Td,Cd,Pd,Dd,Sd,kd,Nd,Vd],Ev=[...Dy,Od],Ny=[vd,Ad,bd,Sy,Rd,Td,Cd,Pd,Dd,Sd,kd,Nd,Vd,Od],Vy=Ny,Oy=[...Vy,Ry,Py,Cy];var wv=[...Oy,ky];function Lh(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ct(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function xd(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ne=class n{constructor(e,t){this.comparator=e,this.root=t||je.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,je.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,je.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new En(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new En(this.root,e,this.comparator,!1)}getReverseIterator(){return new En(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new En(this.root,e,this.comparator,!0)}},En=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},je=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw M(27949);return e+(this.isRed()?0:1)}};je.EMPTY=null,je.RED=!0,je.BLACK=!1;je.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new je(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var de=class n{constructor(e){this.comparator=e,this.data=new ne(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Hi(this.data.getIterator())}getIteratorFrom(e){return new Hi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Hi=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var ze=class n{constructor(e){this.fields=e,e.sort(Ae.comparator)}static empty(){return new n([])}unionWith(e){let t=new de(Ae.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return vn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Ki=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var ge=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Ki("Invalid base64 string: "+o):o}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return j(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ge.EMPTY_BYTE_STRING=new ge("");var xy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function st(n){if(Q(!!n,39018),typeof n=="string"){let e=0,t=xy.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Z(n.seconds),nanos:Z(n.nanos)}}function Z(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ot(n){return typeof n=="string"?ge.fromBase64String(n):ge.fromUint8Array(n)}var Ld="server_timestamp",Md="__type__",Fd="__previous_value__",Ud="__local_write_time__";function vs(n){return(n?.mapValue?.fields||{})[Md]?.stringValue===Ld}function As(n){let e=n.mapValue.fields[Fd];return vs(e)?As(e):e}function Sr(n){let e=st(n.mapValue.fields[Ud].timestampValue);return new se(e.seconds,e.nanos)}var Ia=class{constructor(e,t,r,i,o,a,l,h,d,p,E){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p,this.apiKey=E}},Qi="(default)",Rr=class n{constructor(e,t){this.projectId=e,this.database=t||Qi}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Qi}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function Bd(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new O(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Rr(n.options.projectId,e)}var $c="__type__",qd="__max__",Oi={mapValue:{fields:{__type__:{stringValue:qd}}}},zc="__vector__",An="value";function At(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?vs(n)?4:zd(n)?9007199254740991:$d(n)?10:11:M(28295,{value:n})}function Qe(n,e){if(n===e)return!0;let t=At(n);if(t!==At(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Sr(n).isEqual(Sr(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=st(i.timestampValue),l=st(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,o){return ot(i.bytesValue).isEqual(ot(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,o){return Z(i.geoPointValue.latitude)===Z(o.geoPointValue.latitude)&&Z(i.geoPointValue.longitude)===Z(o.geoPointValue.longitude)})(n,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return Z(i.integerValue)===Z(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=Z(i.doubleValue),l=Z(o.doubleValue);return a===l?br(a)===br(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return vn(n.arrayValue.values||[],e.arrayValue.values||[],Qe);case 10:case 11:return(function(i,o){let a=i.mapValue.fields||{},l=o.mapValue.fields||{};if(Lh(a)!==Lh(l))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!Qe(a[h],l[h])))return!1;return!0})(n,e);default:return M(52216,{left:n})}}function Pr(n,e){return(n.values||[]).find(t=>Qe(t,e))!==void 0}function bn(n,e){if(n===e)return 0;let t=At(n),r=At(e);if(t!==r)return j(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return j(n.booleanValue,e.booleanValue);case 2:return(function(o,a){let l=Z(o.integerValue||o.doubleValue),h=Z(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,e);case 3:return Mh(n.timestampValue,e.timestampValue);case 4:return Mh(Sr(n),Sr(e));case 5:return _a(n.stringValue,e.stringValue);case 6:return(function(o,a){let l=ot(o),h=ot(a);return l.compareTo(h)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){let l=o.split("/"),h=a.split("/");for(let d=0;d<l.length&&d<h.length;d++){let p=j(l[d],h[d]);if(p!==0)return p}return j(l.length,h.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){let l=j(Z(o.latitude),Z(a.latitude));return l!==0?l:j(Z(o.longitude),Z(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Fh(n.arrayValue,e.arrayValue);case 10:return(function(o,a){let l=o.fields||{},h=a.fields||{},d=l[An]?.arrayValue,p=h[An]?.arrayValue,E=j(d?.values?.length||0,p?.values?.length||0);return E!==0?E:Fh(d,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===Oi.mapValue&&a===Oi.mapValue)return 0;if(o===Oi.mapValue)return 1;if(a===Oi.mapValue)return-1;let l=o.fields||{},h=Object.keys(l),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let E=0;E<h.length&&E<p.length;++E){let v=_a(h[E],p[E]);if(v!==0)return v;let R=bn(l[h[E]],d[p[E]]);if(R!==0)return R}return j(h.length,p.length)})(n.mapValue,e.mapValue);default:throw M(23264,{he:t})}}function Mh(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return j(n,e);let t=st(n),r=st(e),i=j(t.seconds,r.seconds);return i!==0?i:j(t.nanos,r.nanos)}function Fh(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=bn(t[i],r[i]);if(o)return o}return j(t.length,r.length)}function Sn(n){return Ea(n)}function Ea(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=st(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return ot(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return L.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=Ea(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${Ea(t.fields[a])}`;return i+"}"})(n.mapValue):M(61005,{value:n})}function Mi(n){switch(At(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=As(n);return e?16+Mi(e):16;case 5:return 2*n.stringValue.length;case 6:return ot(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,o)=>i+Mi(o),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return Ct(r.fields,(o,a)=>{i+=o.length+Mi(a)}),i})(n.mapValue);default:throw M(13486,{value:n})}}function wa(n){return!!n&&"integerValue"in n}function jc(n){return!!n&&"arrayValue"in n}function Uh(n){return!!n&&"nullValue"in n}function Bh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Fi(n){return!!n&&"mapValue"in n}function $d(n){return(n?.mapValue?.fields||{})[$c]?.stringValue===zc}function wr(n){if(n.geoPointValue)return{geoPointValue:H({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:H({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ct(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=wr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=wr(n.arrayValue.values[t]);return e}return H({},n)}function zd(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===qd}var vv={mapValue:{fields:{[$c]:{stringValue:zc},[An]:{arrayValue:{}}}}};var Re=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Fi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=wr(t)}setAll(e){let t=Ae.emptyPath(),r={},i=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=l.popLast()}a?r[l.lastSegment()]=wr(a):i.push(l.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());Fi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Qe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Fi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ct(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(wr(this.value))}};function jd(n){let e=[];return Ct(n.fields,(t,r)=>{let i=new Ae([t]);if(Fi(r)){let o=jd(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new ze(e)}var xe=class n{constructor(e,t,r,i,o,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(e){return new n(e,0,U.min(),U.min(),U.min(),Re.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,U.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,U.min(),U.min(),Re.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,U.min(),U.min(),Re.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(U.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Re.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Re.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Jt=class{constructor(e,t){this.position=e,this.inclusive=t}};function qh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=bn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function $h(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Qe(n.position[t],e.position[t]))return!1;return!0}var Yt=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Ly(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ji=class{},ce=class n extends Ji{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new va(e,t,r):t==="array-contains"?new Sa(e,r):t==="in"?new Ra(e,r):t==="not-in"?new Pa(e,r):t==="array-contains-any"?new Ca(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Aa(e,r):new ba(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(bn(t,this.value)):t!==null&&At(this.value)===At(t)&&this.matchesComparison(bn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Le=class n extends Ji{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return Wd(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function Wd(n){return n.op==="and"}function Gd(n){return My(n)&&Wd(n)}function My(n){for(let e of n.filters)if(e instanceof Le)return!1;return!0}function Ta(n){if(n instanceof ce)return n.field.canonicalString()+n.op.toString()+Sn(n.value);if(Gd(n))return n.filters.map(e=>Ta(e)).join(",");{let e=n.filters.map(t=>Ta(t)).join(",");return`${n.op}(${e})`}}function Hd(n,e){return n instanceof ce?(function(r,i){return i instanceof ce&&r.op===i.op&&r.field.isEqual(i.field)&&Qe(r.value,i.value)})(n,e):n instanceof Le?(function(r,i){return i instanceof Le&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,l)=>o&&Hd(a,i.filters[l]),!0):!1})(n,e):void M(19439)}function Kd(n){return n instanceof ce?(function(t){return`${t.field.canonicalString()} ${t.op} ${Sn(t.value)}`})(n):n instanceof Le?(function(t){return t.op.toString()+" {"+t.getFilters().map(Kd).join(" ,")+"}"})(n):"Filter"}var va=class extends ce{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},Aa=class extends ce{constructor(e,t){super(e,"in",t),this.keys=Qd("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},ba=class extends ce{constructor(e,t){super(e,"not-in",t),this.keys=Qd("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Qd(n,e){return(e.arrayValue?.values||[]).map(t=>L.fromName(t.referenceValue))}var Sa=class extends ce{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return jc(t)&&Pr(t.arrayValue,this.value)}},Ra=class extends ce{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Pr(this.value.arrayValue,t)}},Pa=class extends ce{constructor(e,t){super(e,"not-in",t)}matches(e){if(Pr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Pr(this.value.arrayValue,t)}},Ca=class extends ce{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!jc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Pr(this.value.arrayValue,r))}};var ka=class{constructor(e,t=null,r=[],i=[],o=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=l,this.Te=null}};function zh(n,e=null,t=[],r=[],i=null,o=null,a=null){return new ka(n,e,t,r,i,o,a)}function Wc(n){let e=F(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ta(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(o){return o.field.canonicalString()+o.dir})(r)).join(","),Ts(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Sn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Sn(r)).join(",")),e.Te=t}return e.Te}function Gc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Ly(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Hd(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!$h(n.startAt,e.startAt)&&$h(n.endAt,e.endAt)}function Da(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var Rn=class{constructor(e,t=null,r=[],i=[],o=null,a="F",l=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}};function Fy(n,e,t,r,i,o,a,l){return new Rn(n,e,t,r,i,o,a,l)}function bs(n){return new Rn(n)}function jh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Uy(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Jd(n){return n.collectionGroup!==null}function wn(n){let e=F(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new de(Ae.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Yt(o,r))}),t.has(Ae.keyField().canonicalString())||e.Ie.push(new Yt(Ae.keyField(),r))}return e.Ie}function We(n){let e=F(n);return e.Ee||(e.Ee=By(e,wn(n))),e.Ee}function By(n,e){if(n.limitType==="F")return zh(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new Yt(i.field,o)});let t=n.endAt?new Jt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Jt(n.startAt.position,n.startAt.inclusive):null;return zh(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Yi(n,e,t){return new Rn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ss(n,e){return Gc(We(n),We(e))&&n.limitType===e.limitType}function Yd(n){return`${Wc(We(n))}|lt:${n.limitType}`}function _n(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Kd(i)).join(", ")}]`),Ts(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Sn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Sn(i)).join(",")),`Target(${r})`})(We(n))}; limitType=${n.limitType})`}function Rs(n,e){return e.isFoundDocument()&&(function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):L.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,i){for(let o of wn(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(a,l,h){let d=qh(a,l,h);return a.inclusive?d<=0:d<0})(r.startAt,wn(r),i)||r.endAt&&!(function(a,l,h){let d=qh(a,l,h);return a.inclusive?d>=0:d>0})(r.endAt,wn(r),i))})(n,e)}function qy(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Xd(n){return(e,t)=>{let r=!1;for(let i of wn(n)){let o=$y(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function $y(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):(function(o,a,l){let h=a.data.field(o),d=l.data.field(o);return h!==null&&d!==null?bn(h,d):M(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M(19790,{direction:n.dir})}}var at=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ct(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return xd(this.inner)}size(){return this.innerSize}};var zy=new ne(L.comparator);function ct(){return zy}var Zd=new ne(L.comparator);function Er(...n){let e=Zd;for(let t of n)e=e.insert(t.key,t);return e}function ef(n){let e=Zd;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Wt(){return Tr()}function tf(){return Tr()}function Tr(){return new at(n=>n.toString(),(n,e)=>n.isEqual(e))}var jy=new ne(L.comparator),Wy=new de(L.comparator);function $(...n){let e=Wy;for(let t of n)e=e.add(t);return e}var Gy=new de(j);function Hy(){return Gy}function Hc(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:br(e)?"-0":e}}function nf(n){return{integerValue:""+n}}function Ky(n,e){return Ty(e)?nf(e):Hc(n,e)}var Pn=class{constructor(){this._=void 0}};function Qy(n,e,t){return n instanceof Cn?(function(i,o){let a={fields:{[Md]:{stringValue:Ld},[Ud]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&vs(o)&&(o=As(o)),o&&(a.fields[Fd]=o),{mapValue:a}})(t,e):n instanceof Xt?sf(n,e):n instanceof Zt?of(n,e):(function(i,o){let a=rf(i,o),l=Wh(a)+Wh(i.Ae);return wa(a)&&wa(i.Ae)?nf(l):Hc(i.serializer,l)})(n,e)}function Jy(n,e,t){return n instanceof Xt?sf(n,e):n instanceof Zt?of(n,e):t}function rf(n,e){return n instanceof kn?(function(r){return wa(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}var Cn=class extends Pn{},Xt=class extends Pn{constructor(e){super(),this.elements=e}};function sf(n,e){let t=af(e);for(let r of n.elements)t.some(i=>Qe(i,r))||t.push(r);return{arrayValue:{values:t}}}var Zt=class extends Pn{constructor(e){super(),this.elements=e}};function of(n,e){let t=af(e);for(let r of n.elements)t=t.filter(i=>!Qe(i,r));return{arrayValue:{values:t}}}var kn=class extends Pn{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function Wh(n){return Z(n.integerValue||n.doubleValue)}function af(n){return jc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Yy(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Xt&&i instanceof Xt||r instanceof Zt&&i instanceof Zt?vn(r.elements,i.elements,Qe):r instanceof kn&&i instanceof kn?Qe(r.Ae,i.Ae):r instanceof Cn&&i instanceof Cn})(n.transform,e.transform)}var Na=class{constructor(e,t){this.version=e,this.transformResults=t}},vt=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Ui(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Dn=class{};function cf(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Cr(n.key,vt.none()):new Nn(n.key,n.data,vt.none());{let t=n.data,r=Re.empty(),i=new de(Ae.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new ut(n.key,r,new ze(i.toArray()),vt.none())}}function Xy(n,e,t){n instanceof Nn?(function(i,o,a){let l=i.value.clone(),h=Hh(i.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof ut?(function(i,o,a){if(!Ui(i.precondition,o))return void o.convertToUnknownDocument(a.version);let l=Hh(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(uf(i)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,e,t):(function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function vr(n,e,t,r){return n instanceof Nn?(function(o,a,l,h){if(!Ui(o.precondition,a))return l;let d=o.value.clone(),p=Kh(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof ut?(function(o,a,l,h){if(!Ui(o.precondition,a))return l;let d=Kh(o.fieldTransforms,h,a),p=a.data;return p.setAll(uf(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(E=>E.field))})(n,e,t,r):(function(o,a,l){return Ui(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function Zy(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=rf(r.transform,i||null);o!=null&&(t===null&&(t=Re.empty()),t.set(r.field,o))}return t||null}function Gh(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&vn(r,i,(o,a)=>Yy(o,a))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Nn=class extends Dn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},ut=class extends Dn{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function uf(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function Hh(n,e,t){let r=new Map;Q(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,l=e.data.field(o.field);r.set(o.field,Jy(a,l,t[i]))}return r}function Kh(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,Qy(o,a,e))}return r}var Cr=class extends Dn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Va=class extends Dn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Oa=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&Xy(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=vr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=vr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=tf();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,l=this.applyToLocalView(a,o.mutatedFields);l=t.has(i.key)?null:l;let h=cf(a,l);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(U.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$())}isEqual(e){return this.batchId===e.batchId&&vn(this.mutations,e.mutations,(t,r)=>Gh(t,r))&&vn(this.baseMutations,e.baseMutations,(t,r)=>Gh(t,r))}},xa=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Q(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return jy})(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var La=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Ma=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var oe,W;function eI(n){switch(n){case P.OK:return M(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return M(15467,{code:n})}}function lf(n){if(n===void 0)return rt("GRPC error has no .code"),P.UNKNOWN;switch(n){case oe.OK:return P.OK;case oe.CANCELLED:return P.CANCELLED;case oe.UNKNOWN:return P.UNKNOWN;case oe.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case oe.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case oe.INTERNAL:return P.INTERNAL;case oe.UNAVAILABLE:return P.UNAVAILABLE;case oe.UNAUTHENTICATED:return P.UNAUTHENTICATED;case oe.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case oe.NOT_FOUND:return P.NOT_FOUND;case oe.ALREADY_EXISTS:return P.ALREADY_EXISTS;case oe.PERMISSION_DENIED:return P.PERMISSION_DENIED;case oe.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case oe.ABORTED:return P.ABORTED;case oe.OUT_OF_RANGE:return P.OUT_OF_RANGE;case oe.UNIMPLEMENTED:return P.UNIMPLEMENTED;case oe.DATA_LOSS:return P.DATA_LOSS;default:return M(39323,{code:n})}}(W=oe||(oe={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";var tI=null;function nI(){return new TextEncoder}var rI=new Xe([4294967295,4294967295],0);function Qh(n){let e=nI().encode(n),t=new ra;return t.update(e),new Uint8Array(t.digest())}function Jh(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Xe([t,r],0),new Xe([i,o],0)]}var Fa=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Gt(`Invalid padding: ${t}`);if(r<0)throw new Gt(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Gt(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Gt(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Xe.fromNumber(this.ge)}ye(e,t,r){let i=e.add(t.multiply(Xe.fromNumber(r)));return i.compare(rI)===1&&(i=new Xe([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=Qh(e),[r,i]=Jh(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);if(!this.we(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.ge===0)return;let t=Qh(e),[r,i]=Jh(t);for(let o=0;o<this.hashCount;o++){let a=this.ye(r,i,o);this.be(a)}}be(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Gt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Xi=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,kr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(U.min(),i,new ne(j),ct(),$())}},kr=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,$(),$(),$())}};var Tn=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=i}},Zi=class{constructor(e,t){this.targetId=e,this.Ce=t}},es=class{constructor(e,t,r=ge.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},ts=class{constructor(){this.ve=0,this.Fe=Yh(),this.Me=ge.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=$(),t=$(),r=$();return this.Fe.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M(38017,{changeType:o})}}),new kr(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=Yh()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}},Ua=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=ct(),this.He=xi(),this.Je=xi(),this.Ze=new ne(j)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:M(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,i)=>{this.rt(i)&&t(i)})}st(e){let t=e.targetId,r=e.Ce.count,i=this.ot(t);if(i){let o=i.target;if(Da(o))if(r===0){let a=new L(o.path);this.et(t,a,xe.newNoDocument(a,U.min()))}else Q(r===1,20013,{expectedCount:r});else{let a=this._t(t);if(a!==r){let l=this.ut(e),h=l?this.ct(l,e,a):1;if(h!==0){this.it(t);let d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,d)}tI?.lt((function(p,E,v,R,V){let x={localCacheCount:p,existenceFilterCount:E.count,databaseId:v.database,projectId:v.projectId},N=E.unchangedNames;return N&&(x.bloomFilter={applied:V===0,hashCount:N?.hashCount??0,bitmapLength:N?.bits?.bitmap?.length??0,padding:N?.bits?.padding??0,mightContain:z=>R?.mightContain(z)??!1}),x})(a,e.Ce,this.Ge.ht(),l,h))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,l;try{a=ot(r).toUint8Array()}catch(h){if(h instanceof Ki)return it("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Fa(a,i,o)}catch(h){return it(h instanceof Gt?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(l)||(this.et(t,o,null),i++)}),i}Tt(e){let t=new Map;this.ze.forEach((o,a)=>{let l=this.ot(a);if(l){if(o.current&&Da(l.target)){let h=new L(l.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,xe.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}});let r=$();this.Je.forEach((o,a)=>{let l=!0;a.forEachWhile(h=>{let d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(o))}),this.je.forEach((o,a)=>a.setReadTime(e));let i=new Xi(e,t,this.Ze,this.je,r);return this.je=ct(),this.He=xi(),this.Je=xi(),this.Ze=new ne(j),i}Ye(e,t){if(!this.rt(e))return;let r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.qe(t,1):i.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new ts,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new de(j),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new de(j),this.He=this.He.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||D("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ts),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function xi(){return new ne(L.comparator)}function Yh(){return new ne(L.comparator)}var iI={asc:"ASCENDING",desc:"DESCENDING"},sI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oI={and:"AND",or:"OR"},Ba=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function qa(n,e){return n.useProto3Json||Ts(e)?e:{value:e}}function ns(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hf(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function aI(n,e){return ns(n,e.toTimestamp())}function Ge(n){return Q(!!n,49232),U.fromTimestamp((function(t){let r=st(t);return new se(r.seconds,r.nanos)})(n))}function Kc(n,e){return $a(n,e).canonicalString()}function $a(n,e){let t=(function(i){return new ee(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function df(n){let e=ee.fromString(n);return Q(_f(e),10190,{key:e.toString()}),e}function za(n,e){return Kc(n.databaseId,e.path)}function la(n,e){let t=df(e);if(t.get(1)!==n.databaseId.projectId)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(pf(t))}function ff(n,e){return Kc(n.databaseId,e)}function cI(n){let e=df(n);return e.length===4?ee.emptyPath():pf(e)}function ja(n){return new ee(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function pf(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Xh(n,e,t){return{name:za(n,e),fields:t.value.mapValue.fields}}function uI(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:M(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(Q(p===void 0||typeof p=="string",58123),ge.fromBase64String(p||"")):(Q(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),ge.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(d){let p=d.code===void 0?P.UNKNOWN:lf(d.code);return new O(p,d.message||"")})(a);t=new es(r,i,o,l||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=la(n,r.document.name),o=Ge(r.document.updateTime),a=r.document.createTime?Ge(r.document.createTime):U.min(),l=new Re({mapValue:{fields:r.document.fields}}),h=xe.newFoundDocument(i,o,a,l),d=r.targetIds||[],p=r.removedTargetIds||[];t=new Tn(d,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=la(n,r.document),o=r.readTime?Ge(r.readTime):U.min(),a=xe.newNoDocument(i,o),l=r.removedTargetIds||[];t=new Tn([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=la(n,r.document),o=r.removedTargetIds||[];t=new Tn([],o,i,null)}else{if(!("filter"in e))return M(11601,{Vt:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new Ma(i,o),l=r.targetId;t=new Zi(l,a)}}return t}function lI(n,e){let t;if(e instanceof Nn)t={update:Xh(n,e.key,e.value)};else if(e instanceof Cr)t={delete:za(n,e.key)};else if(e instanceof ut)t={update:Xh(n,e.key,e.data),updateMask:II(e.fieldMask)};else{if(!(e instanceof Va))return M(16599,{dt:e.type});t={verify:za(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(o,a){let l=a.transform;if(l instanceof Cn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Xt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Zt)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof kn)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw M(20930,{transform:a.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:aI(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:M(27497)})(n,e.precondition)),t}function hI(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map(t=>(function(i,o){let a=i.updateTime?Ge(i.updateTime):Ge(o);return a.isEqual(U.min())&&(a=Ge(o)),new Na(a,i.transformResults||[])})(t,e))):[]}function dI(n,e){return{documents:[ff(n,e.path)]}}function fI(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=ff(n,i);let o=(function(d){if(d.length!==0)return gf(Le.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);let a=(function(d){if(d.length!==0)return d.map(p=>(function(v){return{field:yn(v.field),direction:gI(v.dir)}})(p))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);let l=qa(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:i}}function pI(n){let e=cI(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Q(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(E){let v=mf(E);return v instanceof Le&&Gd(v)?v.getFilters():[v]})(t.where));let a=[];t.orderBy&&(a=(function(E){return E.map(v=>(function(V){return new Yt(In(V.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(V.direction))})(v))})(t.orderBy));let l=null;t.limit&&(l=(function(E){let v;return v=typeof E=="object"?E.value:E,Ts(v)?null:v})(t.limit));let h=null;t.startAt&&(h=(function(E){let v=!!E.before,R=E.values||[];return new Jt(R,v)})(t.startAt));let d=null;return t.endAt&&(d=(function(E){let v=!E.before,R=E.values||[];return new Jt(R,v)})(t.endAt)),Fy(e,i,a,o,l,"F",h,d)}function mI(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function mf(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=In(t.unaryFilter.field);return ce.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=In(t.unaryFilter.field);return ce.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=In(t.unaryFilter.field);return ce.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=In(t.unaryFilter.field);return ce.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ce.create(In(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Le.create(t.compositeFilter.filters.map(r=>mf(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M(1026)}})(t.compositeFilter.op))})(n):M(30097,{filter:n})}function gI(n){return iI[n]}function _I(n){return sI[n]}function yI(n){return oI[n]}function yn(n){return{fieldPath:n.canonicalString()}}function In(n){return Ae.fromServerFormat(n.fieldPath)}function gf(n){return n instanceof ce?(function(t){if(t.op==="=="){if(Bh(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NAN"}};if(Uh(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Bh(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NOT_NAN"}};if(Uh(t.value))return{unaryFilter:{field:yn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yn(t.field),op:_I(t.op),value:t.value}}})(n):n instanceof Le?(function(t){let r=t.getFilters().map(i=>gf(i));return r.length===1?r[0]:{compositeFilter:{op:yI(t.op),filters:r}}})(n):M(54877,{filter:n})}function II(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function _f(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function yf(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}var Dr=class n{constructor(e,t,r,i,o=U.min(),a=U.min(),l=ge.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Wa=class{constructor(e){this.yt=e}};function If(n){let e=pI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Yi(e,e.limit,"L"):e}var rs=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Z(e.integerValue));else if("doubleValue"in e){let r=Z(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),br(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=st(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(ot(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?zd(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):$d(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):M(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};this.Ft(t,55);for(let i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let i=An,o=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Z(o)),this.Ot(i,t),this.Ct(r[i],t)}qt(e,t){let r=e.values||[];this.Ft(t,50);for(let i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),L.fromName(e).path.forEach(r=>{this.Ft(t,60),this.$t(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};rs.Wt=new rs;var Ga=class{constructor(){this.Sn=new Ha}addToCollectionParentIndex(e,t){return this.Sn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(Qt.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(Qt.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},Ha=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new de(ee.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new de(ee.comparator)).toArray()}};var Av=new Uint8Array(0);var Zh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ef=41943040,Ce=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};Ce.DEFAULT_COLLECTION_PERCENTILE=10,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ce.DEFAULT=new Ce(Ef,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ce.DISABLED=new Ce(-1,0,0);var Nr=class n{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new n(0)}static ar(){return new n(-1)}};var ed="LruGarbageCollector",EI=1048576;function td([n,e],[t,r]){let i=j(n,t);return i===0?j(e,r):i}var Ka=class{constructor(e){this.Pr=e,this.buffer=new de(td),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();td(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Qa=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){D(ed,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>b(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Un(t)?D(ed,"Ignoring IndexedDB error during garbage collection: ",t):yield Fn(t)}yield this.Ar(3e5)}))}},Ja=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(Bc.ce);let r=new Ka(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.mr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Zh)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Zh):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,i,o,a,l,h,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(E=>(E>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),i=this.params.maximumSequenceNumbersToCollect):i=E,a=Date.now(),this.nthSequenceNumber(e,i))).next(E=>(r=E,l=Date.now(),this.removeTargets(e,r,t))).next(E=>(o=E,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(E=>(d=Date.now(),gn()<=q.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(l-a)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${E} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:E})))}};function wI(n,e){return new Ja(n,e)}var Ya=class{constructor(){this.changes=new at(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Xa=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Za=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&vr(r.mutation,i,ze.empty(),se.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,$()).next(()=>r))}getLocalViewOfDocuments(e,t,r=$()){let i=Wt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=Er();return o.forEach((l,h)=>{a=a.insert(l,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Wt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,$()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,r,i){let o=ct(),a=Tr(),l=(function(){return Tr()})();return t.forEach((h,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof ut)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),vr(p.mutation,d,p.mutation.getFieldMask(),se.now())):a.set(d.key,ze.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>l.set(d,new Xa(p,a.get(d)??null))),l))}recalculateAndSaveOverlays(e,t){let r=Tr(),i=new ne((a,l)=>a-l),o=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let l of a)l.keys().forEach(h=>{let d=t.get(h);if(d===null)return;let p=r.get(h)||ze.empty();p=l.applyToLocalView(d,p),r.set(h,p);let E=(i.get(l.batchId)||$()).add(h);i=i.insert(l.batchId,E)})}).next(()=>{let a=[],l=i.getReverseIterator();for(;l.hasNext();){let h=l.getNext(),d=h.key,p=h.value,E=tf();p.forEach(v=>{if(!o.has(v)){let R=cf(t.get(v),r.get(v));R!==null&&E.set(v,R),o=o.add(v)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,E))}return C.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return Uy(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Jd(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):C.resolve(Wt()),l=Ar,h=o;return a.next(d=>C.forEach(d,(p,E)=>(l<E.largestBatchId&&(l=E.largestBatchId),o.get(p)?C.resolve():this.remoteDocumentCache.getEntry(e,p).next(v=>{h=h.insert(p,v)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,h,d,$())).next(p=>({batchId:l,changes:ef(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=Er();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=Er();return this.indexManager.getCollectionParents(e,o).next(l=>C.forEach(l,h=>{let d=(function(E,v){return new Rn(v,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((E,v)=>{a=a.insert(E,v)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,xe.newInvalidDocument(p)))});let l=Er();return a.forEach((h,d)=>{let p=o.get(h);p!==void 0&&vr(p.mutation,d,ze.empty(),se.now()),Rs(t,d)&&(l=l.insert(h,d))}),l})}};var ec=class{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return C.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Ge(i.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(i){return{name:i.name,query:If(i.bundledQuery),readTime:Ge(i.readTime)}})(t)),C.resolve()}};var tc=class{constructor(){this.overlays=new ne(L.comparator),this.Lr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Wt();return C.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.bt(e,t,o)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Lr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Lr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=Wt(),o=t.length+1,a=new L(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){let h=l.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new ne((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Wt(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let l=Wt(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,p)=>l.set(d,p)),!(l.size()>=i)););return C.resolve(l)}bt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.Lr.get(i.largestBatchId).delete(r.key);this.Lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new La(t,r));let o=this.Lr.get(t);o===void 0&&(o=$(),this.Lr.set(t,o)),this.Lr.set(t,o.add(r.key))}};var nc=class{constructor(){this.sessionToken=ge.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var Vr=class{constructor(){this.kr=new de(ae.Kr),this.qr=new de(ae.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new ae(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new ae(e,t))}Qr(e,t){e.forEach(r=>this.removeReference(r,t))}Gr(e){let t=new L(new ee([])),r=new ae(t,e),i=new ae(t,e+1),o=[];return this.qr.forEachInRange([r,i],a=>{this.Wr(a),o.push(a.key)}),o}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new L(new ee([])),r=new ae(t,e),i=new ae(t,e+1),o=$();return this.qr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new ae(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ae=class{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return L.comparator(e.key,t.key)||j(e.Hr,t.Hr)}static Ur(e,t){return j(e.Hr,t.Hr)||L.comparator(e.key,t.key)}};var rc=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new de(ae.Kr)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Oa(o,t,r,i);this.mutationQueue.push(a);for(let l of i)this.Jr=this.Jr.add(new ae(l.key,o)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),o=i<0?0:i;return C.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?qc:this.Yn-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ae(t,0),i=new ae(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([r,i],a=>{let l=this.Zr(a.Hr);o.push(l)}),C.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new de(j);return t.forEach(i=>{let o=new ae(i,0),a=new ae(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],l=>{r=r.add(l.Hr)})}),C.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;L.isDocumentKey(o)||(o=o.child(""));let a=new ae(new L(o),0),l=new de(j);return this.Jr.forEachWhile(h=>{let d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(l=l.add(h.Hr)),!0)},a),C.resolve(this.Yr(l))}Yr(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Q(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return C.forEach(t.mutations,i=>{let o=new ae(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new ae(t,0),i=this.Jr.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var ic=class{constructor(e){this.ti=e,this.docs=(function(){return new ne(L.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():xe.newInvalidDocument(t))}getEntries(e,t){let r=ct();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():xe.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=ct(),a=t.path,l=new L(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){let{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Iy(yy(p),r)<=0||(i.has(p.key)||Rs(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return C.resolve(o)}getAllFromCollectionGroup(e,t,r,i){M(9500)}ni(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new sc(this)}getSize(e){return C.resolve(this.size)}},sc=class extends Ya{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}};var oc=class{constructor(e){this.persistence=e,this.ri=new at(t=>Wc(t),Gc),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.ii=0,this.si=new Vr,this.targetCount=0,this.oi=Nr._r()}forEachTarget(e,t){return this.ri.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),C.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new Nr(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.lr(t),C.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.ri.forEach((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),C.waitFor(o).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),C.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),C.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this.si.containsKey(t))}};var is=class{constructor(e,t){this._i={},this.overlays={},this.ai=new Bc(0),this.ui=!1,this.ui=!0,this.ci=new nc,this.referenceDelegate=e(this),this.li=new oc(this),this.indexManager=new Ga,this.remoteDocumentCache=(function(i){return new ic(i)})(r=>this.referenceDelegate.hi(r)),this.serializer=new Wa(t),this.Pi=new ec(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new tc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new rc(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){D("MemoryPersistence","Starting transaction:",e);let i=new ac(this.ai.next());return this.referenceDelegate.Ti(),r(i).next(o=>this.referenceDelegate.Ii(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ei(e,t){return C.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}},ac=class extends ya{constructor(e){super(),this.currentSequenceNumber=e}},cc=class n{constructor(e){this.persistence=e,this.Ri=new Vr,this.Ai=null}static Vi(e){return new n(e)}get di(){if(this.Ai)return this.Ai;throw M(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(i=>this.di.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.di.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.di,r=>{let i=L.fromPath(r);return this.mi(e,i).next(o=>{o||t.removeEntry(i,U.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return C.or([()=>C.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},ss=class n{constructor(e,t){this.persistence=e,this.fi=new at(r=>vy(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=wI(this,t)}static Vi(e,t){return new n(e,t)}Ti(){}Ii(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}pr(e){let t=0;return this.mr(e,r=>{t++}).next(()=>t)}mr(e,t){return C.forEach(this.fi,(r,i)=>this.wr(e,r,i).next(o=>o?C.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ni(e,a=>this.wr(e,a,t).next(l=>{l||(r++,o.removeEntry(a,U.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),C.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Mi(e.data.value)),t}wr(e,t,r){return C.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.fi.get(t);return C.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var uc=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=i}static Es(e,t){let r=$(),i=$();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var lc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var hc=class{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return Ll()?8:wy(Se())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.gs(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ps(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new lc;return this.ys(e,t,a).next(l=>{if(o.result=l,this.As)return this.ws(e,t,a,l.size)})}).next(()=>o.result)}ws(e,t,r,i){return r.documentReadCount<this.Vs?(gn()<=q.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",_n(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),C.resolve()):(gn()<=q.DEBUG&&D("QueryEngine","Query:",_n(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ds*i?(gn()<=q.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",_n(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,We(t))):C.resolve())}gs(e,t){if(jh(t))return C.resolve(null);let r=We(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Yi(t,null,"F"),r=We(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=$(...o);return this.fs.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(h=>{let d=this.bs(t,l);return this.Ss(t,d,a,h.readTime)?this.gs(e,Yi(t,null,"F")):this.Ds(e,d,t,h)}))})))}ps(e,t,r,i){return jh(t)||i.isEqual(U.min())?C.resolve(null):this.fs.getDocuments(e,r).next(o=>{let a=this.bs(t,o);return this.Ss(t,a,r,i)?C.resolve(null):(gn()<=q.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),_n(t)),this.Ds(e,a,t,_y(i,Ar)).next(l=>l))})}bs(e,t){let r=new de(Xd(e));return t.forEach((i,o)=>{Rs(e,o)&&(r=r.add(o))}),r}Ss(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}ys(e,t,r){return gn()<=q.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",_n(t)),this.fs.getDocumentsMatchingQuery(e,t,Qt.min(),r)}Ds(e,t,r,i){return this.fs.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var Qc="LocalStore",TI=3e8,dc=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.vs=new ne(j),this.Fs=new at(o=>Wc(o),Gc),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Za(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}};function vI(n,e,t,r){return new dc(n,e,t,r)}function wf(n,e){return b(this,null,function*(){let t=F(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Os(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],l=[],h=$();for(let d of i){a.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}for(let d of o){l.push(d.batchId);for(let p of d.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(d=>({Ns:d,removedBatchIds:a,addedBatchIds:l}))})})})}function AI(n,e){let t=F(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return(function(l,h,d,p){let E=d.batch,v=E.keys(),R=C.resolve();return v.forEach(V=>{R=R.next(()=>p.getEntry(h,V)).next(x=>{let N=d.docVersions.get(V);Q(N!==null,48541),x.version.compareTo(N)<0&&(E.applyToRemoteDocument(x,d),x.isValidDocument()&&(x.setReadTime(d.commitVersion),p.addEntry(x)))})}),R.next(()=>l.mutationQueue.removeMutationBatch(h,E))})(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=$();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(h=h.add(l.batch.mutations[d].key));return h})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Tf(n){let e=F(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function bI(n,e){let t=F(n),r=e.snapshotVersion,i=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.xs.newChangeBuffer({trackRemovals:!0});i=t.vs;let l=[];e.targetChanges.forEach((p,E)=>{let v=i.get(E);if(!v)return;l.push(t.li.removeMatchingKeys(o,p.removedDocuments,E).next(()=>t.li.addMatchingKeys(o,p.addedDocuments,E)));let R=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(E)!==null?R=R.withResumeToken(ge.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(E,R),(function(x,N,z){return x.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=TI?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0})(v,R,p)&&l.push(t.li.updateTargetData(o,R))});let h=ct(),d=$();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))}),l.push(SI(o,a,e.documentUpdates).next(p=>{h=p.Bs,d=p.Ls})),!r.isEqual(U.min())){let p=t.li.getLastRemoteSnapshotVersion(o).next(E=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,r));l.push(p)}return C.waitFor(l).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,d)).next(()=>h)}).then(o=>(t.vs=i,o))}function SI(n,e,t){let r=$(),i=$();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=ct();return t.forEach((l,h)=>{let d=o.get(l);h.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(l)),h.isNoDocument()&&h.version.isEqual(U.min())?(e.removeEntry(l,h.readTime),a=a.insert(l,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(l,h)):D(Qc,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",h.version)}),{Bs:a,Ls:i}})}function RI(n,e){let t=F(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=qc),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function PI(n,e){let t=F(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.li.getTargetData(r,e).next(o=>o?(i=o,C.resolve(i)):t.li.allocateTargetId(r).next(a=>(i=new Dr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.vs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r})}function fc(n,e,t){return b(this,null,function*(){let r=F(n),i=r.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Un(a))throw a;D(Qc,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(i.target)})}function nd(n,e,t){let r=F(n),i=U.min(),o=$();return r.persistence.runTransaction("Execute query","readwrite",a=>(function(h,d,p){let E=F(h),v=E.Fs.get(p);return v!==void 0?C.resolve(E.vs.get(v)):E.li.getTargetData(d,p)})(r,a,We(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,l.targetId).next(h=>{o=h})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:U.min(),t?o:$())).next(l=>(CI(r,qy(e),l),{documents:l,ks:o})))}function CI(n,e,t){let r=n.Ms.get(e)||U.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Ms.set(e,r)}var os=class{constructor(){this.activeTargetIds=Hy()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var pc=class{constructor(){this.vo=new os,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new os,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var mc=class{Mo(e){}shutdown(){}};var rd="ConnectivityMonitor",as=class{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){D(rd,"Network connectivity changed: AVAILABLE");for(let e of this.Lo)e(0)}Bo(){D(rd,"Network connectivity changed: UNAVAILABLE");for(let e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Li=null;function gc(){return Li===null?Li=(function(){return 268435456+Math.round(2147483648*Math.random())})():Li++,"0x"+Li.toString(16)}var ha="RestConnection",kI={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"},_c=class{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.$o=this.databaseId.database===Qi?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,o){let a=gc(),l=this.Qo(e,t.toUriEncodedString());D(ha,`Sending RPC '${e}' ${a}:`,l,r);let h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(h,i,o);let{host:d}=new URL(l),p=Lt(d);return this.zo(e,l,h,r,p).then(E=>(D(ha,`Received RPC '${e}' ${a}: `,E),E),E=>{throw it(ha,`RPC '${e}' ${a} failed with error: `,E,"url: ",l,"request:",r),E})}jo(e,t,r,i,o,a){return this.Wo(e,t,r,i,o)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ln})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}Qo(e,t){let r=kI[e],i=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}};var yc=class{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}};var Ie="WebChannelConnection",Ir=(n,e,t)=>{n.listen(e,r=>{try{t(r)}catch(i){setTimeout(()=>{throw i},0)}})},cs=class n extends _c{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!n.c_){let e=aa();Ir(e,oa.STAT_EVENT,t=>{t.stat===Vi.PROXY?D(Ie,"STAT_EVENT: detected buffering proxy"):t.stat===Vi.NOPROXY&&D(Ie,"STAT_EVENT: detected no buffering proxy")}),n.c_=!0}}zo(e,t,r,i,o){let a=gc();return new Promise((l,h)=>{let d=new ia;d.setWithCredentials(!0),d.listenOnce(sa.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case yr.NO_ERROR:let E=d.getResponseJson();D(Ie,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(E)),l(E);break;case yr.TIMEOUT:D(Ie,`RPC '${e}' ${a} timed out`),h(new O(P.DEADLINE_EXCEEDED,"Request time out"));break;case yr.HTTP_ERROR:let v=d.getStatus();if(D(Ie,`RPC '${e}' ${a} failed with status:`,v,"response text:",d.getResponseText()),v>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let V=R?.error;if(V&&V.status&&V.message){let x=(function(z){let G=z.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(G)>=0?G:P.UNKNOWN})(V.status);h(new O(x,V.message))}else h(new O(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new O(P.UNAVAILABLE,"Connection failed."));break;default:M(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{D(Ie,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);D(Ie,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}T_(e,t,r){let i=gc(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(l.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Go(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let d=o.join("");D(Ie,`Creating RPC '${e}' stream ${i}: ${d}`,l);let p=a.createWebChannel(d,l);this.I_(p);let E=!1,v=!1,R=new yc({Ho:V=>{v?D(Ie,`Not sending because RPC '${e}' stream ${i} is closed:`,V):(E||(D(Ie,`Opening RPC '${e}' stream ${i} transport.`),p.open(),E=!0),D(Ie,`RPC '${e}' stream ${i} sending:`,V),p.send(V))},Jo:()=>p.close()});return Ir(p,mn.EventType.OPEN,()=>{v||(D(Ie,`RPC '${e}' stream ${i} transport opened.`),R.i_())}),Ir(p,mn.EventType.CLOSE,()=>{v||(v=!0,D(Ie,`RPC '${e}' stream ${i} transport closed`),R.o_(),this.E_(p))}),Ir(p,mn.EventType.ERROR,V=>{v||(v=!0,it(Ie,`RPC '${e}' stream ${i} transport errored. Name:`,V.name,"Message:",V.message),R.o_(new O(P.UNAVAILABLE,"The operation could not be completed")))}),Ir(p,mn.EventType.MESSAGE,V=>{if(!v){let x=V.data[0];Q(!!x,16349);let N=x,z=N?.error||N[0]?.error;if(z){D(Ie,`RPC '${e}' stream ${i} received error:`,z);let G=z.status,Y=(function(pe){let I=oe[pe];if(I!==void 0)return lf(I)})(G),_e=z.message;G==="NOT_FOUND"&&_e.includes("database")&&_e.includes("does not exist")&&_e.includes(this.databaseId.database)&&it(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),Y===void 0&&(Y=P.INTERNAL,_e="Unknown error status: "+G+" with message "+z.message),v=!0,R.o_(new O(Y,_e)),p.close()}else D(Ie,`RPC '${e}' stream ${i} received:`,x),R.__(x)}}),n.u_(),setTimeout(()=>{R.s_()},0),R}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return ca()}};function DI(n){return new cs(n)}function da(){return typeof document<"u"?document:null}function Fr(n){return new Ba(n,!0)}cs.c_=!1;var us=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=i,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}};var id="PersistentStream",ls=class{constructor(e,t,r,i,o,a,l,h){this.Ci=e,this.b_=r,this.S_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new us(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return b(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}k_(){return b(this,null,function*(){if(this.O_())return this.close(0)})}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return b(this,null,function*(){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(rt(t.toString()),rt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.t_(t)})}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===t&&this.G_(r,i)},r=>{e(()=>{let i=new O(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.H_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(()=>b(this,null,function*(){this.state=0,this.start()}))}z_(e){return D(id,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(D(id,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Ic=class extends ls{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=uI(this.serializer,e),r=(function(o){if(!("targetChange"in o))return U.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?U.min():a.readTime?Ge(a.readTime):U.min()})(e);return this.listener.J_(t,r)}Z_(e){let t={};t.database=ja(this.serializer),t.addTarget=(function(o,a){let l,h=a.target;if(l=Da(h)?{documents:dI(o,h)}:{query:fI(o,h).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=hf(o,a.resumeToken);let d=qa(o,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(U.min())>0){l.readTime=ns(o,a.snapshotVersion.toTimestamp());let d=qa(o,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,e);let r=mI(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){let t={};t.database=ja(this.serializer),t.removeTarget=e,this.K_(t)}},Ec=class extends ls{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=hI(e.writeResults,e.commitTime),r=Ge(e.commitTime);return this.listener.na(r,t)}ra(){let e={};e.database=ja(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>lI(this.serializer,r))};this.K_(t)}};var wc=class{},Tc=class extends wc{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Wo(e,$a(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(P.UNKNOWN,o.toString())})}jo(e,t,r,i,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.jo(e,$a(t,r),i,a,l,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(P.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}};function NI(n,e,t,r){return new Tc(n,e,t,r)}var vc=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(rt(t),this.aa=!1):D("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var en="RemoteStore",Ac=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo(a=>{r.enqueueAndForget(()=>b(this,null,function*(){rn(this)&&(D(en,"Restarting streams for network reachability change."),yield(function(h){return b(this,null,function*(){let d=F(h);d.Ea.add(4),yield Ur(d),d.Va.set("Unknown"),d.Ea.delete(4),yield Ps(d)})})(this))}))}),this.Va=new vc(r,i)}};function Ps(n){return b(this,null,function*(){if(rn(n))for(let e of n.Ra)yield e(!0)})}function Ur(n){return b(this,null,function*(){for(let e of n.Ra)yield e(!1)})}function vf(n,e){let t=F(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Zc(t)?Xc(t):Bn(t).O_()&&Yc(t,e))}function Jc(n,e){let t=F(n),r=Bn(t);t.Ia.delete(e),r.O_()&&Af(t,e),t.Ia.size===0&&(r.O_()?r.L_():rn(t)&&t.Va.set("Unknown"))}function Yc(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(U.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Bn(n).Z_(e)}function Af(n,e){n.da.$e(e),Bn(n).X_(e)}function Xc(n){n.da=new Ua({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Bn(n).start(),n.Va.ua()}function Zc(n){return rn(n)&&!Bn(n).x_()&&n.Ia.size>0}function rn(n){return F(n).Ea.size===0}function bf(n){n.da=void 0}function VI(n){return b(this,null,function*(){n.Va.set("Online")})}function OI(n){return b(this,null,function*(){n.Ia.forEach((e,t)=>{Yc(n,e)})})}function xI(n,e){return b(this,null,function*(){bf(n),Zc(n)?(n.Va.ha(e),Xc(n)):n.Va.set("Unknown")})}function LI(n,e,t){return b(this,null,function*(){if(n.Va.set("Online"),e instanceof es&&e.state===2&&e.cause)try{yield(function(i,o){return b(this,null,function*(){let a=o.cause;for(let l of o.targetIds)i.Ia.has(l)&&(yield i.remoteSyncer.rejectListen(l,a),i.Ia.delete(l),i.da.removeTarget(l))})})(n,e)}catch(r){D(en,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield hs(n,r)}else if(e instanceof Tn?n.da.Xe(e):e instanceof Zi?n.da.st(e):n.da.tt(e),!t.isEqual(U.min()))try{let r=yield Tf(n.localStore);t.compareTo(r)>=0&&(yield(function(o,a){let l=o.da.Tt(a);return l.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){let p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}}),l.targetMismatches.forEach((h,d)=>{let p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(ge.EMPTY_BYTE_STRING,p.snapshotVersion)),Af(o,h);let E=new Dr(p.target,h,d,p.sequenceNumber);Yc(o,E)}),o.remoteSyncer.applyRemoteEvent(l)})(n,t))}catch(r){D(en,"Failed to raise snapshot:",r),yield hs(n,r)}})}function hs(n,e,t){return b(this,null,function*(){if(!Un(e))throw e;n.Ea.add(1),yield Ur(n),n.Va.set("Offline"),t||(t=()=>Tf(n.localStore)),n.asyncQueue.enqueueRetryable(()=>b(null,null,function*(){D(en,"Retrying IndexedDB access"),yield t(),n.Ea.delete(1),yield Ps(n)}))})}function Sf(n,e){return e().catch(t=>hs(n,t,e))}function Cs(n){return b(this,null,function*(){let e=F(n),t=bt(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:qc;for(;MI(e);)try{let i=yield RI(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,FI(e,i)}catch(i){yield hs(e,i)}Rf(e)&&Pf(e)})}function MI(n){return rn(n)&&n.Ta.length<10}function FI(n,e){n.Ta.push(e);let t=bt(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function Rf(n){return rn(n)&&!bt(n).x_()&&n.Ta.length>0}function Pf(n){bt(n).start()}function UI(n){return b(this,null,function*(){bt(n).ra()})}function BI(n){return b(this,null,function*(){let e=bt(n);for(let t of n.Ta)e.ea(t.mutations)})}function qI(n,e,t){return b(this,null,function*(){let r=n.Ta.shift(),i=xa.from(r,e,t);yield Sf(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Cs(n)})}function $I(n,e){return b(this,null,function*(){e&&bt(n).Y_&&(yield(function(r,i){return b(this,null,function*(){if((function(a){return eI(a)&&a!==P.ABORTED})(i.code)){let o=r.Ta.shift();bt(r).B_(),yield Sf(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Cs(r)}})})(n,e)),Rf(n)&&Pf(n)})}function sd(n,e){return b(this,null,function*(){let t=F(n);t.asyncQueue.verifyOperationInProgress(),D(en,"RemoteStore received new credentials");let r=rn(t);t.Ea.add(3),yield Ur(t),r&&t.Va.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield Ps(t)})}function zI(n,e){return b(this,null,function*(){let t=F(n);e?(t.Ea.delete(2),yield Ps(t)):e||(t.Ea.add(2),yield Ur(t),t.Va.set("Unknown"))})}function Bn(n){return n.ma||(n.ma=(function(t,r,i){let o=F(t);return o.sa(),new Ic(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Zo:VI.bind(null,n),Yo:OI.bind(null,n),t_:xI.bind(null,n),J_:LI.bind(null,n)}),n.Ra.push(e=>b(null,null,function*(){e?(n.ma.B_(),Zc(n)?Xc(n):n.Va.set("Unknown")):(yield n.ma.stop(),bf(n))}))),n.ma}function bt(n){return n.fa||(n.fa=(function(t,r,i){let o=F(t);return o.sa(),new Ec(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:UI.bind(null,n),t_:$I.bind(null,n),ta:BI.bind(null,n),na:qI.bind(null,n)}),n.Ra.push(e=>b(null,null,function*(){e?(n.fa.B_(),yield Cs(n)):(yield n.fa.stop(),n.Ta.length>0&&(D(en,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}var bc=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new et,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,l=new n(e,t,a,i,o);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function eu(n,e){if(rt("AsyncQueue",`${e}: ${n}`),Un(n))return new O(P.UNAVAILABLE,`${e}: ${n}`);throw n}var Or=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=Er(),this.sortedSet=new ne(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var ds=class{constructor(){this.ga=new ne(L.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):M(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}},tn=class n{constructor(e,t,r,i,o,a,l,h,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new n(e,t,Or.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ss(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Sc=class{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}},Rc=class{constructor(){this.queries=od(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=F(t),o=i.queries;i.queries=od(),o.forEach((a,l)=>{for(let h of l.ba)h.onError(r)})})(this,new O(P.ABORTED,"Firestore shutting down"))}};function od(){return new at(n=>Yd(n),Ss)}function jI(n,e){return b(this,null,function*(){let t=F(n),r=3,i=e.query,o=t.queries.get(i);o?!o.Sa()&&e.Da()&&(r=2):(o=new Sc,r=e.Da()?0:1);try{switch(r){case 0:o.wa=yield t.onListen(i,!0);break;case 1:o.wa=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let l=eu(a,`Initialization of query '${_n(e.query)}' failed`);return void e.onError(l)}t.queries.set(i,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&tu(t)})}function WI(n,e){return b(this,null,function*(){let t=F(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?i=e.Da()?0:1:!o.Sa()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function GI(n,e){let t=F(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let l of a.ba)l.Fa(i)&&(r=!0);a.wa=i}}r&&tu(t)}function HI(n,e,t){let r=F(n),i=r.queries.get(e);if(i)for(let o of i.ba)o.onError(t);r.queries.delete(e)}function tu(n){n.Ca.forEach(e=>{e.next()})}var Pc,ad;(ad=Pc||(Pc={})).Ma="default",ad.Cache="cache";var Cc=class{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new tn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Pc.Cache}};var fs=class{constructor(e){this.key=e}},ps=class{constructor(e){this.key=e}},kc=class{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=$(),this.mutatedKeys=$(),this.eu=Xd(e),this.tu=new Or(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new ds,i=t?t.tu:this.tu,o=t?t.mutatedKeys:this.mutatedKeys,a=i,l=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,E)=>{let v=i.get(p),R=Rs(this.query,E)?E:null,V=!!v&&this.mutatedKeys.has(v.key),x=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),N=!1;v&&R?v.data.isEqual(R.data)?V!==x&&(r.track({type:3,doc:R}),N=!0):this.su(v,R)||(r.track({type:2,doc:R}),N=!0,(h&&this.eu(R,h)>0||d&&this.eu(R,d)<0)&&(l=!0)):!v&&R?(r.track({type:0,doc:R}),N=!0):v&&!R&&(r.track({type:1,doc:v}),N=!0,(h||d)&&(l=!0)),N&&(R?(a=a.add(R),o=x?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Ss:l,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let a=e.iu.ya();a.sort((p,E)=>(function(R,V){let x=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{Vt:N})}};return x(R)-x(V)})(p.type,E.type)||this.eu(p.doc,E.doc)),this.ou(r),i=i??!1;let l=t&&!i?this._u():[],h=this.Ya.size===0&&this.current&&!i?1:0,d=h!==this.Xa;return this.Xa=h,a.length!==0||d?{snapshot:new tn(this.query,e.tu,o,a,e.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ds,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=$(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))});let t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new ps(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new fs(r))}),t}cu(e){this.Za=e.ks,this.Ya=$();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return tn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}},nu="SyncEngine",Dc=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Nc=class{constructor(e){this.key=e,this.hu=!1}},Vc=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new at(l=>Yd(l),Ss),this.Iu=new Map,this.Eu=new Set,this.Ru=new ne(L.comparator),this.Au=new Map,this.Vu=new Vr,this.du={},this.mu=new Map,this.fu=Nr.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function KI(n,e,t=!0){return b(this,null,function*(){let r=Of(n),i,o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.lu()):i=yield Cf(r,e,t,!0),i})}function QI(n,e){return b(this,null,function*(){let t=Of(n);yield Cf(t,e,!0,!1)})}function Cf(n,e,t,r){return b(this,null,function*(){let i=yield PI(n.localStore,We(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),l;return r&&(l=yield JI(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&vf(n.remoteStore,i),l})}function JI(n,e,t,r,i){return b(this,null,function*(){n.pu=(E,v,R)=>(function(x,N,z,G){return b(this,null,function*(){let Y=N.view.ru(z);Y.Ss&&(Y=yield nd(x.localStore,N.query,!1).then(({documents:I})=>N.view.ru(I,Y)));let _e=G&&G.targetChanges.get(N.targetId),ke=G&&G.targetMismatches.get(N.targetId)!=null,pe=N.view.applyChanges(Y,x.isPrimaryClient,_e,ke);return ud(x,N.targetId,pe.au),pe.snapshot})})(n,E,v,R);let o=yield nd(n.localStore,e,!0),a=new kc(e,o.ks),l=a.ru(o.documents),h=kr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(l,n.isPrimaryClient,h);ud(n,t,d.au);let p=new Dc(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot})}function YI(n,e,t){return b(this,null,function*(){let r=F(n),i=r.Tu.get(e),o=r.Iu.get(i.targetId);if(o.length>1)return r.Iu.set(i.targetId,o.filter(a=>!Ss(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield fc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Jc(r.remoteStore,i.targetId),Oc(r,i.targetId)}).catch(Fn))):(Oc(r,i.targetId),yield fc(r.localStore,i.targetId,!0))})}function XI(n,e){return b(this,null,function*(){let t=F(n),r=t.Tu.get(e),i=t.Iu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Jc(t.remoteStore,r.targetId))})}function ZI(n,e,t){return b(this,null,function*(){let r=oE(n);try{let i=yield(function(a,l){let h=F(a),d=se.now(),p=l.reduce((R,V)=>R.add(V.key),$()),E,v;return h.persistence.runTransaction("Locally write mutations","readwrite",R=>{let V=ct(),x=$();return h.xs.getEntries(R,p).next(N=>{V=N,V.forEach((z,G)=>{G.isValidDocument()||(x=x.add(z))})}).next(()=>h.localDocuments.getOverlayedDocuments(R,V)).next(N=>{E=N;let z=[];for(let G of l){let Y=Zy(G,E.get(G.key).overlayedDocument);Y!=null&&z.push(new ut(G.key,Y,jd(Y.value.mapValue),vt.exists(!0)))}return h.mutationQueue.addMutationBatch(R,d,z,l)}).next(N=>{v=N;let z=N.applyToLocalDocumentSet(E,x);return h.documentOverlayCache.saveOverlays(R,N.batchId,z)})}).then(()=>({batchId:v.batchId,changes:ef(E)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(a,l,h){let d=a.du[a.currentUser.toKey()];d||(d=new ne(j)),d=d.insert(l,h),a.du[a.currentUser.toKey()]=d})(r,i.batchId,t),yield Br(r,i.changes),yield Cs(r.remoteStore)}catch(i){let o=eu(i,"Failed to persist write");t.reject(o)}})}function kf(n,e){return b(this,null,function*(){let t=F(n);try{let r=yield bI(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Au.get(o);a&&(Q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.hu=!0:i.modifiedDocuments.size>0?Q(a.hu,14607):i.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))}),yield Br(t,r,e)}catch(r){yield Fn(r)}})}function cd(n,e,t){let r=F(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Tu.forEach((o,a)=>{let l=a.view.va(e);l.snapshot&&i.push(l.snapshot)}),(function(a,l){let h=F(a);h.onlineState=l;let d=!1;h.queries.forEach((p,E)=>{for(let v of E.ba)v.va(l)&&(d=!0)}),d&&tu(h)})(r.eventManager,e),i.length&&r.Pu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function eE(n,e,t){return b(this,null,function*(){let r=F(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Au.get(e),o=i&&i.key;if(o){let a=new ne(L.comparator);a=a.insert(o,xe.newNoDocument(o,U.min()));let l=$().add(o),h=new Xi(U.min(),new Map,new ne(j),a,l);yield kf(r,h),r.Ru=r.Ru.remove(o),r.Au.delete(e),ru(r)}else yield fc(r.localStore,e,!1).then(()=>Oc(r,e,t)).catch(Fn)})}function tE(n,e){return b(this,null,function*(){let t=F(n),r=e.batch.batchId;try{let i=yield AI(t.localStore,e);Nf(t,r,null),Df(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Br(t,i)}catch(i){yield Fn(i)}})}function nE(n,e,t){return b(this,null,function*(){let r=F(n);try{let i=yield(function(a,l){let h=F(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return h.mutationQueue.lookupMutationBatch(d,l).next(E=>(Q(E!==null,37113),p=E.keys(),h.mutationQueue.removeMutationBatch(d,E))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>h.localDocuments.getDocuments(d,p))})})(r.localStore,e);Nf(r,e,t),Df(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Br(r,i)}catch(i){yield Fn(i)}})}function Df(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Nf(n,e,t){let r=F(n),i=r.du[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.du[r.currentUser.toKey()]=i}}function Oc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach(r=>{n.Vu.containsKey(r)||Vf(n,r)})}function Vf(n,e){n.Eu.delete(e.path.canonicalString());let t=n.Ru.get(e);t!==null&&(Jc(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),ru(n))}function ud(n,e,t){for(let r of t)r instanceof fs?(n.Vu.addReference(r.key,e),rE(n,r)):r instanceof ps?(D(nu,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||Vf(n,r.key)):M(19791,{wu:r})}function rE(n,e){let t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(D(nu,"New document in limbo: "+t),n.Eu.add(r),ru(n))}function ru(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){let e=n.Eu.values().next().value;n.Eu.delete(e);let t=new L(ee.fromString(e)),r=n.fu.next();n.Au.set(r,new Nc(t)),n.Ru=n.Ru.insert(t,r),vf(n.remoteStore,new Dr(We(bs(t.path)),r,"TargetPurposeLimboResolution",Bc.ce))}}function Br(n,e,t){return b(this,null,function*(){let r=F(n),i=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((l,h)=>{a.push(r.pu(h,e,t).then(d=>{if((d||t)&&r.isPrimaryClient){let p=d?!d.fromCache:t?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){i.push(d);let p=uc.Es(h.targetId,d);o.push(p)}}))}),yield Promise.all(a),r.Pu.J_(i),yield(function(h,d){return b(this,null,function*(){let p=F(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",E=>C.forEach(d,v=>C.forEach(v.Ts,R=>p.persistence.referenceDelegate.addReference(E,v.targetId,R)).next(()=>C.forEach(v.Is,R=>p.persistence.referenceDelegate.removeReference(E,v.targetId,R)))))}catch(E){if(!Un(E))throw E;D(Qc,"Failed to update sequence numbers: "+E)}for(let E of d){let v=E.targetId;if(!E.fromCache){let R=p.vs.get(v),V=R.snapshotVersion,x=R.withLastLimboFreeSnapshotVersion(V);p.vs=p.vs.insert(v,x)}}})})(r.localStore,o))})}function iE(n,e){return b(this,null,function*(){let t=F(n);if(!t.currentUser.isEqual(e)){D(nu,"User change. New user:",e.toKey());let r=yield wf(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach(l=>{l.forEach(h=>{h.reject(new O(P.CANCELLED,a))})}),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Br(t,r.Ns)}})}function sE(n,e){let t=F(n),r=t.Au.get(e);if(r&&r.hu)return $().add(r.key);{let i=$(),o=t.Iu.get(e);if(!o)return i;for(let a of o){let l=t.Tu.get(a);i=i.unionWith(l.view.nu)}return i}}function Of(n){let e=F(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=kf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=sE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=eE.bind(null,e),e.Pu.J_=GI.bind(null,e.eventManager),e.Pu.yu=HI.bind(null,e.eventManager),e}function oE(n){let e=F(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=tE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=nE.bind(null,e),e}var iu=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return b(this,null,function*(){this.serializer=Fr(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)})}Fu(t,r){return null}Mu(t,r){return null}vu(t){return vI(this.persistence,new hc,t.initialUser,this.serializer)}Cu(t){return new is(cc.Vi,this.serializer)}Du(t){return new pc}terminate(){return b(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),ms=class extends iu{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Q(this.persistence.referenceDelegate instanceof ss,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new Qa(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?Ce.withCacheSize(this.cacheSizeBytes):Ce.DEFAULT;return new is(r=>ss.Vi(r,t),this.serializer)}};var xf=(()=>{class n{initialize(t,r){return b(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>cd(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=iE.bind(null,this.syncEngine),yield zI(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new Rc})()}createDatastore(t){let r=Fr(t.databaseInfo.databaseId),i=DI(t.databaseInfo);return NI(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,o,a,l,h){return new Ac(i,o,a,l,h)})(this.localStore,this.datastore,t.asyncQueue,r=>cd(this.syncEngine,r,0),(function(){return as.v()?new as:new mc})())}createSyncEngine(t,r){return(function(o,a,l,h,d,p,E){let v=new Vc(o,a,l,h,d,p);return E&&(v.gu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return b(this,null,function*(){yield(function(r){return b(this,null,function*(){let i=F(r);D(en,"RemoteStore shutting down."),i.Ea.add(5),yield Ur(i),i.Aa.shutdown(),i.Va.set("Unknown")})})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var xc=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):rt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var St="FirestoreClient",Lc=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=i,this.user=he.UNAUTHENTICATED,this.clientId=Kt.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>b(this,null,function*(){D(St,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(D(St,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new et;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>b(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=eu(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function fa(n,e){return b(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),D(St,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>b(null,null,function*(){r.isEqual(i)||(yield wf(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function ld(n,e){return b(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield aE(n);D(St,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>sd(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>sd(e.remoteStore,i)),n._onlineComponents=e})}function aE(n){return b(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D(St,"Using user provided OfflineComponentProvider");try{yield fa(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;it("Error using user provided cache. Falling back to memory cache: "+t),yield fa(n,new iu)}}else D(St,"Using default OfflineComponentProvider"),yield fa(n,new ms(void 0));return n._offlineComponents})}function Lf(n){return b(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(D(St,"Using user provided OnlineComponentProvider"),yield ld(n,n._uninitializedComponentsProvider._online)):(D(St,"Using default OnlineComponentProvider"),yield ld(n,new xf))),n._onlineComponents})}function cE(n){return Lf(n).then(e=>e.syncEngine)}function hd(n){return b(this,null,function*(){let e=yield Lf(n),t=e.eventManager;return t.onListen=KI.bind(null,e.syncEngine),t.onUnlisten=YI.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=QI.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=XI.bind(null,e.syncEngine),t})}function Mf(n,e,t,r){let i=new xc(r),o=new Cc(e,i,t);return n.asyncQueue.enqueueAndForget(()=>b(null,null,function*(){return jI(yield hd(n),o)})),()=>{i.Nu(),n.asyncQueue.enqueueAndForget(()=>b(null,null,function*(){return WI(yield hd(n),o)}))}}function Ff(n,e){let t=new et;return n.asyncQueue.enqueueAndForget(()=>b(null,null,function*(){return ZI(yield cE(n),e,t)})),t.promise}function Uf(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var uE="ComponentProvider",dd=new Map;function lE(n,e,t,r,i){return new Ia(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Uf(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,r)}var Bf="firestore.googleapis.com",fd=!0,gs=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new O(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Bf,this.ssl=fd}else this.host=e.host,this.ssl=e.ssl??fd;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Ef;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<EI)throw new O(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Id("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Uf(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Vn=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gs({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gs(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new qi;switch(r.type){case"firstParty":return new ga(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return b(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=dd.get(t);r&&(D(uE,"Removing Datastore"),dd.delete(t),r.terminate())})(this),Promise.resolve()}};function su(n,e,t,r={}){n=Pt(n,Vn);let i=Lt(e),o=n._getSettings(),a=De(H({},o),{emulatorOptions:n._getEmulatorOptions()}),l=`${e}:${t}`;i&&(yo(`https://${l}`),Io("Firestore",!0)),o.host!==Bf&&o.host!==l&&it("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=De(H({},o),{host:l,ssl:i,emulatorOptions:r});if(!It(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=he.MOCK_USER;else{d=Dl(r.mockUserToken,n._app?.options.projectId);let E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new O(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new he(E)}n._authCredentials=new pa(new Bi(d,p))}}var On=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},fe=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new tt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Mn(t,n._jsonSchema))return new n(e,r||null,new L(ee.fromString(t.referencePath)))}};fe._jsonSchemaVersion="firestore/documentReference/1.0",fe._jsonSchema={type:ie("string",fe._jsonSchemaVersion),referencePath:ie("string")};var tt=class n extends On{constructor(e,t,r){super(e,t,bs(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new fe(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function ou(n,e,...t){if(n=me(n),yd("collection","path",e),n instanceof Vn){let r=ee.fromString(e,...t);return Nh(r),new tt(n,null,r)}{if(!(n instanceof fe||n instanceof tt))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ee.fromString(e,...t));return Nh(r),new tt(n.firestore,null,r)}}function ks(n,e,...t){if(n=me(n),arguments.length===1&&(e=Kt.newId()),yd("doc","path",e),n instanceof Vn){let r=ee.fromString(e,...t);return Dh(r),new fe(n,null,new L(r))}{if(!(n instanceof fe||n instanceof tt))throw new O(P.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ee.fromString(e,...t));return Dh(r),new fe(n.firestore,n instanceof tt?n.converter:null,new L(r))}}var pd="AsyncQueue",_s=class{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new us(this,"async_queue_retry"),this._c=()=>{let r=da();r&&D(pd,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=da();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=da();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new et;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}lc(){return b(this,null,function*(){if(this.Yu.length!==0){try{yield this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Un(e))throw e;D(pd,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,rt("INTERNAL UNHANDLED ERROR: ",md(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=bc.createAndSchedule(this,e,t,r,o=>this.hc(o));return this.tc.push(i),i}uc(){this.nc&&M(47125,{Pc:md(this.nc)})}verifyOperationInProgress(){}Tc(){return b(this,null,function*(){let e;do e=this.ac,yield e;while(e!==this.ac)})}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function md(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}var Rt=class extends Vn{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new _s,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return b(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new _s(e),this._firestoreClient=void 0,yield e}})}};function au(n,e){let t=typeof n=="object"?n:dn(),r=typeof n=="string"?n:e||Qi,i=pi(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=Cl("firestore");o&&su(i,...o)}return i}function Ds(n){if(n._terminated)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||hE(n),n._firestoreClient}function hE(n){let e=n._freezeSettings(),t=lE(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Lc(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){let o=i?._online.build();return{_offline:i?._offline.build(o),_online:o}})(n._componentsProvider))}var He=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(ge.fromBase64String(e))}catch(t){throw new O(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(ge.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Mn(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};He._jsonSchemaVersion="firestore/bytes/1.0",He._jsonSchema={type:ie("string",He._jsonSchemaVersion),bytes:ie("string")};var nn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ae(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var xn=class{constructor(e){this._methodName=e}};var nt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return j(this._lat,e._lat)||j(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Mn(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};nt._jsonSchemaVersion="firestore/geoPoint/1.0",nt._jsonSchema={type:ie("string",nt._jsonSchemaVersion),latitude:ie("number"),longitude:ie("number")};var Ke=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Mn(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new O(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Ke._jsonSchemaVersion="firestore/vectorValue/1.0",Ke._jsonSchema={type:ie("string",Ke._jsonSchemaVersion),vectorValues:ie("object")};var dE=/^__.*__$/;var ys=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ut(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function qf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{dataSource:n})}}var Mc=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(H(H({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Es(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(qf(this.dataSource)&&dE.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},Fc=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Fr(e)}createContext(e,t,r,i=!1){return new Mc({dataSource:e,methodName:t,targetDoc:r,path:Ae.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function $f(n){let e=n._freezeSettings(),t=Fr(n._databaseId);return new Fc(n._databaseId,!!e.ignoreUndefinedProperties,t)}var Is=class n extends xn{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function zf(n,e,t,r){let i=n.createContext(1,e,t);Gf("Data must be an object, but it was:",i,r);let o=[],a=Re.empty();Ct(r,(h,d)=>{let p=cu(e,h,t);d=me(d);let E=i.childContextForFieldPath(p);if(d instanceof Is)o.push(p);else{let v=Ns(d,E);v!=null&&(o.push(p),a.set(p,v))}});let l=new ze(o);return new ys(a,l,i.fieldTransforms)}function jf(n,e,t,r,i,o){let a=n.createContext(1,e,t),l=[xr(e,r,t)],h=[i];if(o.length%2!=0)throw new O(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)l.push(xr(e,o[v])),h.push(o[v+1]);let d=[],p=Re.empty();for(let v=l.length-1;v>=0;--v)if(!mE(d,l[v])){let R=l[v],V=h[v];V=me(V);let x=a.childContextForFieldPath(R);if(V instanceof Is)d.push(R);else{let N=Ns(V,x);N!=null&&(d.push(R),p.set(R,N))}}let E=new ze(d);return new ys(p,E,a.fieldTransforms)}function Ns(n,e){if(Wf(n=me(n)))return Gf("Unsupported field value:",e,n),fE(n,e);if(n instanceof xn)return(function(r,i){if(!qf(i.dataSource))throw i.createError(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.createError(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,i){let o=[],a=0;for(let l of r){let h=Ns(l,i.childContextForArray(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,i){if((r=me(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Ky(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=se.fromDate(r);return{timestampValue:ns(i.serializer,o)}}if(r instanceof se){let o=new se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ns(i.serializer,o)}}if(r instanceof nt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof He)return{bytesValue:hf(i.serializer,r._byteString)};if(r instanceof fe){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Kc(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Ke)return(function(a,l){let h=a instanceof Ke?a.toArray():a;return{mapValue:{fields:{[$c]:{stringValue:zc},[An]:{arrayValue:{values:h.map(p=>{if(typeof p!="number")throw l.createError("VectorValues must only contain numeric values.");return Hc(l.serializer,p)})}}}}}})(r,i);if(yf(r))return r._toProto(i.serializer);throw i.createError(`Unsupported field value: ${ws(r)}`)})(n,e)}function fE(n,e){let t={};return xd(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ct(n,(r,i)=>{let o=Ns(i,e.childContextForField(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function Wf(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof se||n instanceof nt||n instanceof He||n instanceof fe||n instanceof xn||n instanceof Ke||yf(n))}function Gf(n,e,t){if(!Wf(t)||!Ed(t)){let r=ws(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function xr(n,e,t){if((e=me(e))instanceof nn)return e._internalPath;if(typeof e=="string")return cu(n,e);throw Es("Field path arguments must be of type string or ",n,!1,void 0,t)}var pE=new RegExp("[~\\*/\\[\\]]");function cu(n,e,t){if(e.search(pE)>=0)throw Es(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new nn(...e.split("."))._internalPath}catch(r){throw Es(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Es(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new O(P.INVALID_ARGUMENT,l+n+h)}function mE(n,e){return n.some(t=>t.isEqual(e))}var Lr=class{convertValue(e,t="none"){switch(At(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Z(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ot(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Ct(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){let t=e.fields?.[An].arrayValue?.values?.map(r=>Z(r.doubleValue));return new Ke(t)}convertGeoPoint(e){return new nt(Z(e.latitude),Z(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=As(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Sr(e));default:return null}}convertTimestamp(e){let t=st(e);return new se(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ee.fromString(e);Q(_f(r),9688,{name:e});let i=new Rr(r.get(1),r.get(3)),o=new L(r.popFirst(5));return i.isEqual(t)||rt(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};var Mr=class extends Lr{constructor(e){super(),this.firestore=e}convertBytes(e){return new He(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new fe(this.firestore,null,t)}};var Hf="@firebase/firestore",Kf="4.12.0";function Qf(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let o of r)if(o in i&&typeof i[o]=="function")return!0;return!1})(n,["next","error","complete"])}var Vs=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new fe(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new uu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(xr("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},uu=class extends Vs{data(){return super.data()}};function kE(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var sn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},on=class n extends Vs{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new qn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(xr("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};on._jsonSchemaVersion="firestore/documentSnapshot/1.0",on._jsonSchema={type:ie("string",on._jsonSchemaVersion),bundleSource:ie("string","DocumentSnapshot"),bundleName:ie("string"),bundle:ie("string")};var qn=class extends on{data(e={}){return super.data(e)}},$n=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new sn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new qn(this._firestore,this._userDataWriter,r.key,r,new sn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(l=>{let h=new qn(i._firestore,i._userDataWriter,l.doc.key,l.doc,new sn(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>o||l.type!==3).map(l=>{let h=new qn(i._firestore,i._userDataWriter,l.doc.key,l.doc,new sn(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),p=a.indexOf(l.doc.key)),{type:DE(l.type),doc:h,oldIndex:d,newIndex:p}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Kt.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function DE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:n})}}$n._jsonSchemaVersion="firestore/querySnapshot/1.0",$n._jsonSchema={type:ie("string",$n._jsonSchemaVersion),bundleSource:ie("string","QuerySnapshot"),bundleName:ie("string"),bundle:ie("string")};function ep(n,e,t,...r){n=Pt(n,fe);let i=Pt(n.firestore,Rt),o=$f(i),a;return a=typeof(e=me(e))=="string"||e instanceof nn?jf(o,"updateDoc",n._key,e,t,r):zf(o,"updateDoc",n._key,e),NE(i,[a.toMutation(n._key,vt.exists(!0))])}function lu(n,...e){n=me(n);let t={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||Qf(e[r])||(t=e[r++]);let i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(Qf(e[r])){let d=e[r];e[r]=d.next?.bind(d),e[r+1]=d.error?.bind(d),e[r+2]=d.complete?.bind(d)}let o,a,l;if(n instanceof fe)a=Pt(n.firestore,Rt),l=bs(n._key.path),o={next:d=>{e[r]&&e[r](VE(a,n,d))},error:e[r+1],complete:e[r+2]};else{let d=Pt(n,On);a=Pt(d.firestore,Rt),l=d._query;let p=new Mr(a);o={next:E=>{e[r]&&e[r](new $n(a,p,d,E))},error:e[r+1],complete:e[r+2]},kE(n._query)}let h=Ds(a);return Mf(h,l,i,o)}function NE(n,e){let t=Ds(n);return Ff(t,e)}function VE(n,e,t){let r=t.docs.get(e._key),i=new Mr(n);return new on(n,i,e._key,r,new sn(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){gd(hn),Ve(new Te("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),l=new Rt(new $i(r.getProvider("auth-internal")),new ji(a,r.getProvider("app-check-internal")),Bd(a,i),a);return o=H({useFetchStreams:t},o),l._setSettings(o),l},"PUBLIC").setMultipleInstances(!0)),re(Hf,Kf,e),re(Hf,Kf,"esm2020")})();var Os=function(){return Os=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Os.apply(this,arguments)};var xE={includeMetadataChanges:!1};function tp(n,e){return e===void 0&&(e=xE),new sr(function(t){var r=lu(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function np(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Os(Os({},r),(t={},t[e.idField]=n.id,t))}function rp(n){return tp(n,{includeMetadataChanges:!0}).pipe(lo(function(e){return e.docs}))}function ip(n,e){return e===void 0&&(e={}),rp(n).pipe(lo(function(t){return t.map(function(r){return np(r,e)})}))}var an=class{constructor(e){return e}},sp="firestore",hu=class{constructor(){return pn(sp)}};var du=new ii("angularfire2.firestore-instances");function LE(n,e){let t=_i(sp,n,e);return t&&new an(t)}function ME(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new an(r)}}var FE={provide:hu,deps:[[new yt,du]]},UE={provide:an,useFactory:LE,deps:[[new yt,du],qt]};function Nb(n,...e){return re("angularfire",Ut.full,"fst"),si([UE,FE,{provide:du,useFactory:ME(n),multi:!0,deps:[_t,ai,Bt,hr,[new yt,Di],[new yt,Ii],...e]}])}var op=$e(ip,!0);var ap=$e(ou,!0,2);var xs=$e(ks,!0,2);var Vb=$e(au,!0);var Ls=$e(ep,!0,2);var qb=(()=>{class n{constructor(){if(this.initPlayers={},this.players={},this.isBrowser=Tl(Ue(ci)),this.firestore=null,this.isBrowser){this.firestore=Ue(an);let t=ap(this.firestore,"players");this.playersArray$=op(t),this.playersSub=this.playersArray$.subscribe(r=>{this.players=r[0],this.initPlayers=r[0]})}else this.playersArray$=_l([])}getInitialStats(){return this.initPlayers}getStats(){return this.playersArray$}addHumanWin(){this.players.humanWins&&this.firestore&&(this.players.humanWins=+this.players.humanWins+1+"",Ls(xs(this.firestore,"players/0as5g7EZpksHb74yeGBc"),{humanWins:this.players.humanWins}))}addRobotWin(){this.players.robotWins&&this.firestore&&(this.players.robotWins=+this.players.robotWins+1+"",Ls(xs(this.firestore,"players/0as5g7EZpksHb74yeGBc"),{robotWins:this.players.robotWins}))}addDraw(){this.players.draw&&this.firestore&&(this.players.draw=+this.players.draw+1+"",Ls(xs(this.firestore,"players/0as5g7EZpksHb74yeGBc"),{draw:this.players.draw}))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=ri({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{kw as a,Dw as b,Nb as c,Vb as d,qb as e};
