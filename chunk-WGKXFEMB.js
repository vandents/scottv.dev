import{B as nr,Ba as ml,D as pm,F as rr,G as nc,Ia as mm,Tb as gm,a as fe,b as Vt,c as hl,d as P,e as go,g as cm,h as um,i as dl,j as fl,k as lm,l as pl,m as hm,n as dm,p as Ya,r as Xa,t as Kt,u as Za,v as fm,w as ec,z as tc}from"./chunk-DBF2XWVE.js";var _m=()=>{};var Em=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},nw=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],c=n[t++],u=n[t++],d=((i&7)<<18|(s&63)<<12|(c&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(d>>10)),e[r++]=String.fromCharCode(56320+(d&1023))}else{let s=n[t++],c=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|c&63)}}return e.join("")},rc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],c=i+1<n.length,u=c?n[i+1]:0,d=i+2<n.length,f=d?n[i+2]:0,I=s>>2,S=(s&3)<<4|u>>4,R=(u&15)<<2|f>>6,k=f&63;d||(k=64,c||(R=64)),r.push(t[I],t[S],t[R],t[k])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Em(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):nw(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let f=i<n.length?t[n.charAt(i)]:64;++i;let S=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||u==null||f==null||S==null)throw new _l;let R=s<<2|u>>4;if(r.push(R),f!==64){let k=u<<4&240|f>>2;if(r.push(k),S!==64){let x=f<<6&192|S;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},_l=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},rw=function(n){let e=Em(n);return rc.encodeByteArray(e,!0)},yo=function(n){return rw(n).replace(/\./g,"")},ic=function(n){try{return rc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Il(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var iw=()=>Il().__FIREBASE_DEFAULTS__,sw=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},ow=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}let e=n&&ic(n[1]);return e&&JSON.parse(e)},sc=()=>{try{return _m()||iw()||sw()||ow()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},wm=n=>sc()?.emulatorHosts?.[n],Tm=n=>{let e=wm(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},El=()=>sc()?.config,vm=n=>sc()?.[`_${n}`];var Lr=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Mr(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch(e){return!1}}function wl(n){return P(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Am(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let c=fe({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[yo(JSON.stringify(t)),yo(JSON.stringify(c)),""].join(".")}var _o={};function aw(){let n={prod:[],emulator:[]};for(let e of Object.keys(_o))_o[e]?n.emulator.push(e):n.prod.push(e);return n}function cw(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var ym=!1;function Tl(n,e){if(typeof window>"u"||typeof document>"u"||!Mr(window.location.host)||_o[n]===e||_o[n]||ym)return;_o[n]=e;function t(R){return`__firebase__banner__${R}`}let r="__firebase__banner",s=aw().prod.length>0;function c(){let R=document.getElementById(r);R&&R.remove()}function u(R){R.style.display="flex",R.style.background="#7faaf0",R.style.position="fixed",R.style.bottom="5px",R.style.left="5px",R.style.padding=".5em",R.style.borderRadius="5px",R.style.alignItems="center"}function d(R,k){R.setAttribute("width","24"),R.setAttribute("id",k),R.setAttribute("height","24"),R.setAttribute("viewBox","0 0 24 24"),R.setAttribute("fill","none"),R.style.marginLeft="-6px"}function f(){let R=document.createElement("span");return R.style.cursor="pointer",R.style.marginLeft="16px",R.style.fontSize="24px",R.innerHTML=" &times;",R.onclick=()=>{ym=!0,c()},R}function I(R,k){R.setAttribute("id",k),R.innerText="Learn more",R.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",R.setAttribute("target","__blank"),R.style.paddingLeft="5px",R.style.textDecoration="underline"}function S(){let R=cw(r),k=t("text"),x=document.getElementById(k)||document.createElement("span"),U=t("learnmore"),O=document.getElementById(U)||document.createElement("a"),W=t("preprendIcon"),K=document.getElementById(W)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(R.created){let Q=R.element;u(Q),I(O,U);let ie=f();d(K,W),Q.append(K,x,O,ie),document.body.appendChild(Q)}s?(x.innerText="Preview backend disconnected.",K.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(K.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",k)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",S):S()}function yt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function bm(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(yt())}function uw(){let n=sc()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(e){return!1}}function Sm(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Rm(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Pm(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Cm(){return!uw()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Io(){try{return typeof indexedDB=="object"}catch(n){return!1}}function Dm(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var lw="FirebaseError",Tt=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=lw,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xt.prototype.create)}},xt=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],c=s?hw(s,r):"Error",u=`${this.serviceName}: ${c} (${i}).`;return new Tt(i,u,r)}};function hw(n,e){return n.replace(dw,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var dw=/\{\$([^}]+)}/g;function ir(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],c=e[i];if(Im(s)&&Im(c)){if(!ir(s,c))return!1}else if(s!==c)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Im(n){return n!==null&&typeof n=="object"}function vl(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function km(n,e){let t=new yl(n,e);return t.subscribe.bind(t)}var yl=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");fw(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=gl),i.error===void 0&&(i.error=gl),i.complete===void 0&&(i.complete=gl);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(c){}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function fw(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function gl(){}var CP=14400*1e3;function tt(n){return n&&n._delegate?n._delegate:n}var ct=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Fr="[DEFAULT]";var Al=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Lr;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch(i){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(mw(e))try{this.getOrInitializeService({instanceIdentifier:Fr})}catch(t){}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch(s){}}}}clearInstance(e=Fr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return P(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Fr){return this.instances.has(e)}getOptions(e=Fr){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,c]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(s);r===u&&c.resolve(i)}return i}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(r)??new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch(s){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:pw(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(i){}return r||null}normalizeInstanceIdentifier(e=Fr){return this.component?this.component.multipleInstances?e:Fr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function pw(n){return n===Fr?void 0:n}function mw(n){return n.instantiationMode==="EAGER"}var oc=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Al(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var gw=[],se=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(se||{}),_w={debug:se.DEBUG,verbose:se.VERBOSE,info:se.INFO,warn:se.WARN,error:se.ERROR,silent:se.SILENT},yw=se.INFO,Iw={[se.DEBUG]:"log",[se.VERBOSE]:"log",[se.INFO]:"info",[se.WARN]:"warn",[se.ERROR]:"error"},Ew=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=Iw[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Wt=class{constructor(e){this.name=e,this._logLevel=yw,this._logHandler=Ew,this._userLogHandler=null,gw.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in se))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_w[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,se.DEBUG,...e),this._logHandler(this,se.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,se.VERBOSE,...e),this._logHandler(this,se.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,se.INFO,...e),this._logHandler(this,se.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,se.WARN,...e),this._logHandler(this,se.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,se.ERROR,...e),this._logHandler(this,se.ERROR,...e)}};var ww=(n,e)=>e.some(t=>n instanceof t),Nm,Vm;function Tw(){return Nm||(Nm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vw(){return Vm||(Vm=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var xm=new WeakMap,Sl=new WeakMap,Om=new WeakMap,bl=new WeakMap,Pl=new WeakMap;function Aw(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",c)},s=()=>{t(Ht(n.result)),i()},c=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",c)});return e.then(t=>{t instanceof IDBCursor&&xm.set(t,n)}).catch(()=>{}),Pl.set(e,n),e}function bw(n){if(Sl.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",c),n.removeEventListener("abort",c)},s=()=>{t(),i()},c=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",c),n.addEventListener("abort",c)});Sl.set(n,e)}var Rl={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Sl.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Om.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ht(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Lm(n){Rl=n(Rl)}function Sw(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(ac(this),e,...t);return Om.set(r,e.sort?e.sort():[e]),Ht(r)}:vw().includes(n)?function(...e){return n.apply(ac(this),e),Ht(xm.get(this))}:function(...e){return Ht(n.apply(ac(this),e))}}function Rw(n){return typeof n=="function"?Sw(n):(n instanceof IDBTransaction&&bw(n),ww(n,Tw())?new Proxy(n,Rl):n)}function Ht(n){if(n instanceof IDBRequest)return Aw(n);if(bl.has(n))return bl.get(n);let e=Rw(n);return e!==n&&(bl.set(n,e),Pl.set(e,n)),e}var ac=n=>Pl.get(n);function cc(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let c=indexedDB.open(n,e),u=Ht(c);return r&&c.addEventListener("upgradeneeded",d=>{r(Ht(c.result),d.oldVersion,d.newVersion,Ht(c.transaction),d)}),t&&c.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),u.then(d=>{s&&d.addEventListener("close",()=>s()),i&&d.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}var Pw=["get","getKey","getAll","getAllKeys","count"],Cw=["put","add","delete","clear"],Cl=new Map;function Mm(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Cl.get(e))return Cl.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=Cw.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Pw.includes(t)))return;let s=function(c,...u){return P(this,null,function*(){let d=this.transaction(c,i?"readwrite":"readonly"),f=d.store;return r&&(f=f.index(u.shift())),(yield Promise.all([f[t](...u),i&&d.done]))[0]})};return Cl.set(e,s),s}Lm(n=>Vt(fe({},n),{get:(e,t,r)=>Mm(e,t)||n.get(e,t,r),has:(e,t)=>!!Mm(e,t)||n.has(e,t)}));var kl=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Dw(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function Dw(n){return n.getComponent()?.type==="VERSION"}var Nl="@firebase/app",Fm="0.14.8";var fn=new Wt("@firebase/app"),kw="@firebase/app-compat",Nw="@firebase/analytics-compat",Vw="@firebase/analytics",xw="@firebase/app-check-compat",Ow="@firebase/app-check",Lw="@firebase/auth",Mw="@firebase/auth-compat",Fw="@firebase/database",Uw="@firebase/data-connect",Bw="@firebase/database-compat",qw="@firebase/functions",$w="@firebase/functions-compat",jw="@firebase/installations",zw="@firebase/installations-compat",Gw="@firebase/messaging",Kw="@firebase/messaging-compat",Ww="@firebase/performance",Hw="@firebase/performance-compat",Qw="@firebase/remote-config",Jw="@firebase/remote-config-compat",Yw="@firebase/storage",Xw="@firebase/storage-compat",Zw="@firebase/firestore",eT="@firebase/ai",tT="@firebase/firestore-compat",nT="firebase",rT="12.9.0";var Vl="[DEFAULT]",iT={[Nl]:"fire-core",[kw]:"fire-core-compat",[Vw]:"fire-analytics",[Nw]:"fire-analytics-compat",[Ow]:"fire-app-check",[xw]:"fire-app-check-compat",[Lw]:"fire-auth",[Mw]:"fire-auth-compat",[Fw]:"fire-rtdb",[Uw]:"fire-data-connect",[Bw]:"fire-rtdb-compat",[qw]:"fire-fn",[$w]:"fire-fn-compat",[jw]:"fire-iid",[zw]:"fire-iid-compat",[Gw]:"fire-fcm",[Kw]:"fire-fcm-compat",[Ww]:"fire-perf",[Hw]:"fire-perf-compat",[Qw]:"fire-rc",[Jw]:"fire-rc-compat",[Yw]:"fire-gcs",[Xw]:"fire-gcs-compat",[Zw]:"fire-fst",[tT]:"fire-fst-compat",[eT]:"fire-vertex","fire-js":"fire-js",[nT]:"fire-js-all"};var Eo=new Map,sT=new Map,xl=new Map;function Um(n,e){try{n.container.addComponent(e)}catch(t){fn.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ot(n){let e=n.name;if(xl.has(e))return fn.debug(`There were multiple attempts to register component ${e}.`),!1;xl.set(e,n);for(let t of Eo.values())Um(t,n);for(let t of sT.values())Um(t,n);return!0}function uc(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function pn(n){return n==null?!1:n.settings!==void 0}var oT={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},sr=new xt("app","Firebase",oT);var Ol=class{constructor(e,t,r){this._isDeleted=!1,this._options=fe({},e),this._config=fe({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ct("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sr.create("app-deleted",{appName:this._name})}};var $i=rT;function Fl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=fe({name:Vl,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw sr.create("bad-app-name",{appName:String(i)});if(t||(t=El()),!t)throw sr.create("no-options");let s=Eo.get(i);if(s){if(ir(t,s.options)&&ir(r,s.config))return s;throw sr.create("duplicate-app",{appName:i})}let c=new oc(i);for(let d of xl.values())c.addComponent(d);let u=new Ol(t,r,c);return Eo.set(i,u),u}function ji(n=Vl){let e=Eo.get(n);if(!e&&n===Vl&&El())return Fl();if(!e)throw sr.create("no-app",{appName:n});return e}function lc(){return Array.from(Eo.values())}function Ce(n,e,t){let r=iT[n]??n;t&&(r+=`-${t}`);let i=r.match(/\s|\//),s=e.match(/\s|\//);if(i||s){let c=[`Unable to register library "${r}" with version "${e}":`];i&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&c.push("and"),s&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),fn.warn(c.join(" "));return}Ot(new ct(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var aT="firebase-heartbeat-database",cT=1,wo="firebase-heartbeat-store",Dl=null;function jm(){return Dl||(Dl=cc(aT,cT,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(wo)}catch(t){console.warn(t)}}}}).catch(n=>{throw sr.create("idb-open",{originalErrorMessage:n.message})})),Dl}function uT(n){return P(this,null,function*(){try{let t=(yield jm()).transaction(wo),r=yield t.objectStore(wo).get(zm(n));return yield t.done,r}catch(e){if(e instanceof Tt)fn.warn(e.message);else{let t=sr.create("idb-get",{originalErrorMessage:e?.message});fn.warn(t.message)}}})}function Bm(n,e){return P(this,null,function*(){try{let r=(yield jm()).transaction(wo,"readwrite");yield r.objectStore(wo).put(e,zm(n)),yield r.done}catch(t){if(t instanceof Tt)fn.warn(t.message);else{let r=sr.create("idb-set",{originalErrorMessage:t?.message});fn.warn(r.message)}}})}function zm(n){return`${n.name}!${n.options.appId}`}var lT=1024,hT=30,Ll=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Ml(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return P(this,null,function*(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=qm();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(i=>i.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>hT){let i=fT(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){fn.warn(e)}})}getHeartbeatsHeader(){return P(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=qm(),{heartbeatsToSend:t,unsentEntries:r}=dT(this._heartbeatsCache.heartbeats),i=yo(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return fn.warn(e),""}})}};function qm(){return new Date().toISOString().substring(0,10)}function dT(n,e=lT){let t=[],r=n.slice();for(let i of n){let s=t.find(c=>c.agent===i.agent);if(s){if(s.dates.push(i.date),$m(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),$m(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Ml=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return P(this,null,function*(){return Io()?Dm().then(()=>!0).catch(()=>!1):!1})}read(){return P(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield uT(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return P(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Bm(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return P(this,null,function*(){if(yield this._canUseIndexedDBPromise){let r=yield this.read();return Bm(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function $m(n){return yo(JSON.stringify({version:2,heartbeats:n})).length}function fT(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function pT(n){Ot(new ct("platform-logger",e=>new kl(e),"PRIVATE")),Ot(new ct("heartbeat",e=>new Ll(e),"PRIVATE")),Ce(Nl,Fm,n),Ce(Nl,Fm,"esm2020"),Ce("fire-js","")}pT("");var mT="firebase",gT="12.9.0";Ce(mT,gT,"app");var Br=new hm("ANGULARFIRE2_VERSION");function dc(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(c=>c.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Gi=(n,e)=>{let t=e?[e]:lc(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(c=>{r.includes(c)||r.push(c)})}),r},zi=(function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n})(zi||{}),Gm=ml()&&typeof Zone<"u"?zi.WARN:zi.SILENT;var hc=class{zone;delegate;constructor(e,t=um){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(c){i?i.runGuarded(()=>{e.apply(this,[c])}):e.apply(this,[c])};return this.delegate.schedule(s,t,r)}},qr=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=Kt(nr);this.outsideAngular=t.runOutsideAngular(()=>new hc(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new hc(typeof Zone>"u"?void 0:Zone.current,cm))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=Ya({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Km=!1;function yT(n,e){!Km&&(Gm>zi.SILENT||ml())&&(Km=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Gm>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function IT(n){let e=Kt(nr,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Ur(n){let e=Kt(nr,{optional:!0});return e?e.run(()=>n()):n()}var ET=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),ec(t,()=>Ur(()=>n.apply(void 0,r)))),Qt=(n,e,t)=>(t||=e?zi.WARN:zi.VERBOSE,function(){let r,i=arguments,s,c,u;try{s=Kt(qr),c=Kt(pm),u=Kt(fm)}catch(f){return yT(n,t),n.apply(this,i)}for(let f=0;f<arguments.length;f++)typeof i[f]=="function"&&(e&&(r||=Ur(()=>c.add())),i[f]=ET(i[f],r,u));let d=IT(()=>n.apply(this,i));return e?d instanceof go?d.pipe(fl(s.outsideAngular),dl(s.insideAngular),gm(u)):d instanceof Promise?Ur(()=>{let f=c.add();return new Promise((I,S)=>{d.then(R=>ec(u,()=>Ur(()=>I(R))),R=>ec(u,()=>Ur(()=>S(R)))).finally(f)})}):typeof d=="function"&&r?function(){return setTimeout(r,0),d.apply(this,arguments)}:Ur(()=>d):d instanceof go?d.pipe(fl(s.outsideAngular),dl(s.insideAngular)):Ur(()=>d)});var $r=class{constructor(e){return e}},To=class{constructor(){return lc()}};function wT(n){return n&&n.length===1?n[0]:new $r(ji())}var Ul=new Xa("angularfire2._apps"),TT={provide:$r,useFactory:wT,deps:[[new rr,Ul]]},vT={provide:To,deps:[[new rr,Ul]]};function AT(n){return(e,t)=>{let r=t.get(nc);Ce("angularfire",Br.full,"core"),Ce("angularfire",Br.full,"app"),Ce("angular",dm.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new $r(i)}}function _C(n,...e){return Za([TT,vT,{provide:Ul,useFactory:AT(n),multi:!0,deps:[nr,tc,qr,...e]}])}var yC=Qt(Fl,!0);var bT=new Map,ST={activated:!1,tokenObservers:[]},RT={initialized:!1,enabled:!1};function Lt(n){return bT.get(n)||fe({},ST)}function Jm(){return RT}var PT="https://content-firebaseappcheck.googleapis.com/v1";var CT="exchangeDebugToken",Wm={OFFSET_DURATION:300*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},RC=1440*60*1e3;var $l=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return P(this,null,function*(){this.stop();try{this.pending=new Lr,this.pending.promise.catch(t=>{}),yield DT(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Lr,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function DT(n){return new Promise(e=>{setTimeout(e,n)})}var kT={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},or=new xt("appCheck","AppCheck",kT);function Ym(n){if(!Lt(n).activated)throw or.create("use-before-activation",{appName:n.name})}function Xm(r,i){return P(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},c=t.getImmediate({optional:!0});if(c){let k=yield c.getHeartbeatsHeader();k&&(s["X-Firebase-Client"]=k)}let u={method:"POST",body:JSON.stringify(e),headers:s},d;try{d=yield fetch(n,u)}catch(k){throw or.create("fetch-network-error",{originalErrorMessage:k?.message})}if(d.status!==200)throw or.create("fetch-status-error",{httpStatus:d.status});let f;try{f=yield d.json()}catch(k){throw or.create("fetch-parse-error",{originalErrorMessage:k?.message})}let I=f.ttl.match(/^([\d.]+)(s)$/);if(!I||!I[2]||isNaN(Number(I[1])))throw or.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${f.ttl}`});let S=Number(I[1])*1e3,R=Date.now();return{token:f.token,expireTimeMillis:R+S,issuedAtTimeMillis:R}})}function Zm(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${PT}/projects/${t}/apps/${r}:${CT}?key=${i}`,body:{debug_token:e}}}var NT="firebase-app-check-database",VT=1,jl="firebase-app-check-store";var fc=null;function xT(){return fc||(fc=new Promise((n,e)=>{try{let t=indexedDB.open(NT,VT);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{e(or.create("storage-open",{originalErrorMessage:r.target.error?.message}))},t.onupgradeneeded=r=>{let i=r.target.result;r.oldVersion===0&&i.createObjectStore(jl,{keyPath:"compositeKey"})}}catch(t){e(or.create("storage-open",{originalErrorMessage:t?.message}))}}),fc)}function OT(n,e){return LT(MT(n),e)}function LT(n,e){return P(this,null,function*(){let r=(yield xT()).transaction(jl,"readwrite"),s=r.objectStore(jl).put({compositeKey:n,value:e});return new Promise((c,u)=>{s.onsuccess=d=>{c()},r.onerror=d=>{u(or.create("storage-set",{originalErrorMessage:d.target.error?.message}))}})})}function MT(n){return`${n.options.appId}-${n.name}`}var vo=new Wt("@firebase/app-check");function Bl(n,e){return Io()?OT(n,e).catch(t=>{vo.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function eg(){return Jm().enabled}function tg(){return P(this,null,function*(){let n=Jm();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var FT={error:"UNKNOWN_ERROR"};function UT(n){return rc.encodeString(JSON.stringify(n),!1)}function zl(n,e=!1,t=!1){return P(this,null,function*(){let r=n.app;Ym(r);let i=Lt(r),s=i.token,c;if(s&&!Ao(s)&&(i.token=void 0,s=void 0),!s){let f=yield i.cachedTokenPromise;f&&(Ao(f)?s=f:yield Bl(r,void 0))}if(!e&&s&&Ao(s))return{token:s.token};let u=!1;if(eg())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=Xm(Zm(r,yield tg()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);let f=yield i.exchangeTokenPromise;return yield Bl(r,f),i.token=f,{token:f.token}}catch(f){return f.code==="appCheck/throttled"||f.code==="appCheck/initial-throttle"?vo.warn(f.message):t&&vo.error(f),ql(f)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),s=yield Lt(r).exchangeTokenPromise}catch(f){f.code==="appCheck/throttled"||f.code==="appCheck/initial-throttle"?vo.warn(f.message):t&&vo.error(f),c=f}let d;return s?c?Ao(s)?d={token:s.token,internalError:c}:d=ql(c):(d={token:s.token},i.token=s,yield Bl(r,s)):d=ql(c),u&&jT(r,d),d})}function BT(n){return P(this,null,function*(){let e=n.app;Ym(e);let{provider:t}=Lt(e);if(eg()){let r=yield tg(),{token:i}=yield Xm(Zm(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function qT(n,e,t,r){let{app:i}=n,s=Lt(i),c={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,c],s.token&&Ao(s.token)){let u=s.token;Promise.resolve().then(()=>{t({token:u.token}),Hm(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Hm(n))}function ng(n,e){let t=Lt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Hm(n){let{app:e}=n,t=Lt(e),r=t.tokenRefresher;r||(r=$T(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function $T(n){let{app:e}=n;return new $l(()=>P(null,null,function*(){let t=Lt(e),r;if(t.token?r=yield zl(n,!0):r=yield zl(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Lt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-300*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Wm.RETRIAL_MIN_WAIT,Wm.RETRIAL_MAX_WAIT)}function jT(n,e){let t=Lt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch(i){}}function Ao(n){return n.expireTimeMillis-Date.now()>0}function ql(n){return{token:UT(FT),error:n}}var Gl=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Lt(this.app);for(let t of e)ng(this.app,t.next);return Promise.resolve()}};function zT(n,e){return new Gl(n,e)}function GT(n){return{getToken:e=>zl(n,e),getLimitedUseToken:()=>BT(n),addTokenListener:e=>qT(n,"INTERNAL",e),removeTokenListener:e=>ng(n.app,e)}}var KT="@firebase/app-check",WT="0.11.0";var HT="app-check",Qm="app-check-internal";function QT(){Ot(new ct(HT,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return zT(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Qm).initialize()})),Ot(new ct(Qm,n=>{let e=n.getProvider("app-check").getImmediate();return GT(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Ce(KT,WT)}QT();var JT="app-check";var pc=class{constructor(){return Gi(JT)}};var YT=["localhost","0.0.0.0","127.0.0.1"],BC=typeof window<"u"&&YT.includes(window.location.hostname);var rg=()=>{};var ig=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},XT=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],c=n[t++],u=n[t++],d=((i&7)<<18|(s&63)<<12|(c&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(d>>10)),e[r++]=String.fromCharCode(56320+(d&1023))}else{let s=n[t++],c=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|c&63)}}return e.join("")},sg={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],c=i+1<n.length,u=c?n[i+1]:0,d=i+2<n.length,f=d?n[i+2]:0,I=s>>2,S=(s&3)<<4|u>>4,R=(u&15)<<2|f>>6,k=f&63;d||(k=64,c||(R=64)),r.push(t[I],t[S],t[R],t[k])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(ig(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):XT(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let f=i<n.length?t[n.charAt(i)]:64;++i;let S=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||u==null||f==null||S==null)throw new Kl;let R=s<<2|u>>4;if(r.push(R),f!==64){let k=u<<4&240|f>>2;if(r.push(k),S!==64){let x=f<<6&192|S;r.push(x)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Kl=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},ZT=function(n){let e=ig(n);return sg.encodeByteArray(e,!0)},Wl=function(n){return ZT(n).replace(/\./g,"")},og=function(n){try{return sg.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ag(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var ev=()=>ag().__FIREBASE_DEFAULTS__,tv=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},nv=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}let e=n&&og(n[1]);return e&&JSON.parse(e)},rv=()=>{try{return rg()||ev()||tv()||nv()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}};function cg(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch(e){return!1}}function ug(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function iv(){var n;let e=(n=rv())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(t){return!1}}function lg(){return!iv()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Hl(){try{return typeof indexedDB=="object"}catch(n){return!1}}function hg(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var sv="FirebaseError",mn=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=sv,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bo.prototype.create)}},bo=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],c=s?ov(s,r):"Error",u=`${this.serviceName}: ${c} (${i}).`;return new mn(i,u,r)}};function ov(n,e){return n.replace(av,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var av=/\{\$([^}]+)}/g;var GC=14400*1e3;function dg(n){return n&&n._delegate?n._delegate:n}var ar=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var cv=[],oe=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(oe||{}),uv={debug:oe.DEBUG,verbose:oe.VERBOSE,info:oe.INFO,warn:oe.WARN,error:oe.ERROR,silent:oe.SILENT},lv=oe.INFO,hv={[oe.DEBUG]:"log",[oe.VERBOSE]:"log",[oe.INFO]:"info",[oe.WARN]:"warn",[oe.ERROR]:"error"},dv=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=hv[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Ki=class{constructor(e){this.name=e,this._logLevel=lv,this._logHandler=dv,this._userLogHandler=null,cv.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in oe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?uv[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,oe.DEBUG,...e),this._logHandler(this,oe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,oe.VERBOSE,...e),this._logHandler(this,oe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,oe.INFO,...e),this._logHandler(this,oe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,oe.WARN,...e),this._logHandler(this,oe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,oe.ERROR,...e),this._logHandler(this,oe.ERROR,...e)}};var Jl=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(pv(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function pv(n){let e=n.getComponent();return e?.type==="VERSION"}var Yl="@firebase/app",fg="0.13.2";var gn=new Ki("@firebase/app"),mv="@firebase/app-compat",gv="@firebase/analytics-compat",_v="@firebase/analytics",yv="@firebase/app-check-compat",Iv="@firebase/app-check",Ev="@firebase/auth",wv="@firebase/auth-compat",Tv="@firebase/database",vv="@firebase/data-connect",Av="@firebase/database-compat",bv="@firebase/functions",Sv="@firebase/functions-compat",Rv="@firebase/installations",Pv="@firebase/installations-compat",Cv="@firebase/messaging",Dv="@firebase/messaging-compat",kv="@firebase/performance",Nv="@firebase/performance-compat",Vv="@firebase/remote-config",xv="@firebase/remote-config-compat",Ov="@firebase/storage",Lv="@firebase/storage-compat",Mv="@firebase/firestore",Fv="@firebase/ai",Uv="@firebase/firestore-compat",Bv="firebase",qv="11.10.0";var $v={[Yl]:"fire-core",[mv]:"fire-core-compat",[_v]:"fire-analytics",[gv]:"fire-analytics-compat",[Iv]:"fire-app-check",[yv]:"fire-app-check-compat",[Ev]:"fire-auth",[wv]:"fire-auth-compat",[Tv]:"fire-rtdb",[vv]:"fire-data-connect",[Av]:"fire-rtdb-compat",[bv]:"fire-fn",[Sv]:"fire-fn-compat",[Rv]:"fire-iid",[Pv]:"fire-iid-compat",[Cv]:"fire-fcm",[Dv]:"fire-fcm-compat",[kv]:"fire-perf",[Nv]:"fire-perf-compat",[Vv]:"fire-rc",[xv]:"fire-rc-compat",[Ov]:"fire-gcs",[Lv]:"fire-gcs-compat",[Mv]:"fire-fst",[Uv]:"fire-fst-compat",[Fv]:"fire-vertex","fire-js":"fire-js",[Bv]:"fire-js-all"};var jv=new Map,zv=new Map,pg=new Map;function mg(n,e){try{n.container.addComponent(e)}catch(t){gn.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function So(n){let e=n.name;if(pg.has(e))return gn.debug(`There were multiple attempts to register component ${e}.`),!1;pg.set(e,n);for(let t of jv.values())mg(t,n);for(let t of zv.values())mg(t,n);return!0}function Ig(n){return n==null?!1:n.settings!==void 0}var Gv={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},eh=new bo("app","Firebase",Gv);var Eg=qv;function Wi(n,e,t){var r;let i=(r=$v[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),c=e.match(/\s|\//);if(s||c){let u=[`Unable to register library "${i}" with version "${e}":`];s&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&c&&u.push("and"),c&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),gn.warn(u.join(" "));return}So(new ar(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var Kv="firebase-heartbeat-database",Wv=1,Ro="firebase-heartbeat-store",Ql=null;function wg(){return Ql||(Ql=cc(Kv,Wv,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Ro)}catch(t){console.warn(t)}}}}).catch(n=>{throw eh.create("idb-open",{originalErrorMessage:n.message})})),Ql}function Hv(n){return P(this,null,function*(){try{let t=(yield wg()).transaction(Ro),r=yield t.objectStore(Ro).get(Tg(n));return yield t.done,r}catch(e){if(e instanceof mn)gn.warn(e.message);else{let t=eh.create("idb-get",{originalErrorMessage:e?.message});gn.warn(t.message)}}})}function gg(n,e){return P(this,null,function*(){try{let r=(yield wg()).transaction(Ro,"readwrite");yield r.objectStore(Ro).put(e,Tg(n)),yield r.done}catch(t){if(t instanceof mn)gn.warn(t.message);else{let r=eh.create("idb-set",{originalErrorMessage:t?.message});gn.warn(r.message)}}})}function Tg(n){return`${n.name}!${n.options.appId}`}var Qv=1024,Jv=30,Xl=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Zl(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return P(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=_g();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(c=>c.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>Jv){let c=Xv(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(c,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){gn.warn(r)}})}getHeartbeatsHeader(){return P(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=_g(),{heartbeatsToSend:r,unsentEntries:i}=Yv(this._heartbeatsCache.heartbeats),s=Wl(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return gn.warn(t),""}})}};function _g(){return new Date().toISOString().substring(0,10)}function Yv(n,e=Qv){let t=[],r=n.slice();for(let i of n){let s=t.find(c=>c.agent===i.agent);if(s){if(s.dates.push(i.date),yg(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),yg(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Zl=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return P(this,null,function*(){return Hl()?hg().then(()=>!0).catch(()=>!1):!1})}read(){return P(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Hv(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return P(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return gg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return P(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return gg(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function yg(n){return Wl(JSON.stringify({version:2,heartbeats:n})).length}function Xv(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Zv(n){So(new ar("platform-logger",e=>new Jl(e),"PRIVATE")),So(new ar("heartbeat",e=>new Xl(e),"PRIVATE")),Wi(Yl,fg,n),Wi(Yl,fg,"esm2017"),Wi("fire-js","")}Zv("");function kg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Ng=kg,Vg=new xt("auth","Firebase",kg());var yc=new Wt("@firebase/auth");function eA(n,...e){yc.logLevel<=se.WARN&&yc.warn(`Auth (${$i}): ${n}`,...e)}function gc(n,...e){yc.logLevel<=se.ERROR&&yc.error(`Auth (${$i}): ${n}`,...e)}function vg(n,...e){throw dh(n,...e)}function hh(n,...e){return dh(n,...e)}function xg(n,e,t){let r=Vt(fe({},Ng()),{[e]:t});return new xt("auth","Firebase",r).create(e,{appName:n.name})}function _c(n){return xg(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function dh(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Vg.create(n,...e)}function me(n,e,...t){if(!n)throw dh(e,...t)}function Po(n){let e="INTERNAL ASSERTION FAILED: "+n;throw gc(e),new Error(e)}function Ic(n,e){n||Po(e)}function tA(){return Ag()==="http:"||Ag()==="https:"}function Ag(){return typeof self<"u"&&self.location?.protocol||null}function nA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(tA()||Rm()||"connection"in navigator)?navigator.onLine:!0}function rA(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Gr=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ic(t>e,"Short delay should be less than long delay!"),this.isMobile=bm()||Pm()}get(){return nA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function iA(n,e){Ic(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Ec=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Po("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Po("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Po("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var sA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var oA=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],aA=new Gr(3e4,6e4);function Og(n,e){return n.tenantId&&!e.tenantId?Vt(fe({},e),{tenantId:n.tenantId}):e}function bc(s,c,u,d){return P(this,arguments,function*(n,e,t,r,i={}){return Lg(n,i,()=>P(null,null,function*(){let f={},I={};r&&(e==="GET"?I=r:f={body:JSON.stringify(r)});let S=vl(fe({key:n.config.apiKey},I)).slice(1),R=yield n._getAdditionalHeaders();R["Content-Type"]="application/json",n.languageCode&&(R["X-Firebase-Locale"]=n.languageCode);let k=fe({method:e,headers:R},f);return Sm()||(k.referrerPolicy="no-referrer"),n.emulatorConfig&&Mr(n.emulatorConfig.host)&&(k.credentials="include"),Ec.fetch()(yield Mg(n,n.config.apiHost,t,S),k)}))})}function Lg(n,e,t){return P(this,null,function*(){n._canInitEmulator=!1;let r=fe(fe({},sA),e);try{let i=new rh(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let c=yield s.json();if("needConfirmation"in c)throw mc(n,"account-exists-with-different-credential",c);if(s.ok&&!("errorMessage"in c))return c;{let u=s.ok?c.errorMessage:c.error.message,[d,f]=u.split(" : ");if(d==="FEDERATED_USER_ID_ALREADY_LINKED")throw mc(n,"credential-already-in-use",c);if(d==="EMAIL_EXISTS")throw mc(n,"email-already-in-use",c);if(d==="USER_DISABLED")throw mc(n,"user-disabled",c);let I=r[d]||d.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw xg(n,I,f);vg(n,I)}}catch(i){if(i instanceof Tt)throw i;vg(n,"network-request-failed",{message:String(i)})}})}function Mg(n,e,t,r){return P(this,null,function*(){let i=`${e}${t}?${r}`,s=n,c=s.config.emulator?iA(n.config,i):`${n.config.apiScheme}://${i}`;return oA.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(c).toString():c})}var rh=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(hh(this.auth,"network-request-failed")),aA.get())})}};function mc(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=hh(n,e,r);return i.customData._tokenResponse=t,i}function cA(n,e){return P(this,null,function*(){return bc(n,"POST","/v1/accounts:delete",e)})}function wc(n,e){return P(this,null,function*(){return bc(n,"POST","/v1/accounts:lookup",e)})}function Co(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch(e){}}function fh(n,e=!1){return P(this,null,function*(){let t=tt(n),r=yield t.getIdToken(e),i=Fg(r);me(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,c=s?.sign_in_provider;return{claims:i,token:r,authTime:Co(th(i.auth_time)),issuedAtTime:Co(th(i.iat)),expirationTime:Co(th(i.exp)),signInProvider:c||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function th(n){return Number(n)*1e3}function Fg(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return gc("JWT malformed, contained fewer than 3 sections"),null;try{let i=ic(t);return i?JSON.parse(i):(gc("Failed to decode base64 JWT payload"),null)}catch(i){return gc("Caught error parsing JWT payload as JSON",i?.toString()),null}}function bg(n){let e=Fg(n);return me(e,"internal-error"),me(typeof e.exp<"u","internal-error"),me(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function ih(n,e,t=!1){return P(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Tt&&uA(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function uA({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var sh=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>P(this,null,function*(){yield this.iteration()}),t)}iteration(){return P(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var ko=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Co(this.lastLoginAt),this.creationTime=Co(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function Tc(n){return P(this,null,function*(){let e=n.auth,t=yield n.getIdToken(),r=yield ih(n,wc(e,{idToken:t}));me(r?.users.length,e,"internal-error");let i=r.users[0];n._notifyReloadListener(i);let s=i.providerUserInfo?.length?Ug(i.providerUserInfo):[],c=lA(n.providerData,s),u=n.isAnonymous,d=!(n.email&&i.passwordHash)&&!c?.length,f=u?d:!1,I={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new ko(i.createdAt,i.lastLoginAt),isAnonymous:f};Object.assign(n,I)})}function ph(n){return P(this,null,function*(){let e=tt(n);yield Tc(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function lA(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Ug(n){return n.map(r=>{var i=r,{providerId:e}=i,t=hl(i,["providerId"]);return{providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}})}function hA(n,e){return P(this,null,function*(){let t=yield Lg(n,{},()=>P(null,null,function*(){let r=vl({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,c=yield Mg(n,i,"/v1/token",`key=${s}`),u=yield n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";let d={method:"POST",headers:u,body:r};return n.emulatorConfig&&Mr(n.emulatorConfig.host)&&(d.credentials="include"),Ec.fetch()(c,d)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function dA(n,e){return P(this,null,function*(){return bc(n,"POST","/v2/accounts:revokeToken",Og(n,e))})}var Do=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){me(e.idToken,"internal-error"),me(typeof e.idToken<"u","internal-error"),me(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):bg(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){me(e.length!==0,"internal-error");let t=bg(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return P(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(me(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return P(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield hA(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,c=new n;return r&&(me(typeof r=="string","internal-error",{appName:e}),c.refreshToken=r),i&&(me(typeof i=="string","internal-error",{appName:e}),c.accessToken=i),s&&(me(typeof s=="number","internal-error",{appName:e}),c.expirationTime=s),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Po("not implemented")}};function cr(n,e){me(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var jr=class n{constructor(s){var c=s,{uid:e,auth:t,stsTokenManager:r}=c,i=hl(c,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new sh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new ko(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return P(this,null,function*(){let t=yield ih(this,this.stsTokenManager.getToken(this.auth,e));return me(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return fh(this,e)}reload(){return ph(this)}_assign(e){this!==e&&(me(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>fe({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Vt(fe({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){me(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return P(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield Tc(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return P(this,null,function*(){if(pn(this.auth.app))return Promise.reject(_c(this.auth));let e=yield this.getIdToken();return yield ih(this,cA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Vt(fe({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>fe({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,c=t.photoURL??void 0,u=t.tenantId??void 0,d=t._redirectEventId??void 0,f=t.createdAt??void 0,I=t.lastLoginAt??void 0,{uid:S,emailVerified:R,isAnonymous:k,providerData:x,stsTokenManager:U}=t;me(S&&U,e,"internal-error");let O=Do.fromJSON(this.name,U);me(typeof S=="string",e,"internal-error"),cr(r,e.name),cr(i,e.name),me(typeof R=="boolean",e,"internal-error"),me(typeof k=="boolean",e,"internal-error"),cr(s,e.name),cr(c,e.name),cr(u,e.name),cr(d,e.name),cr(f,e.name),cr(I,e.name);let W=new n({uid:S,auth:e,email:i,emailVerified:R,displayName:r,isAnonymous:k,photoURL:c,phoneNumber:s,tenantId:u,stsTokenManager:O,createdAt:f,lastLoginAt:I});return x&&Array.isArray(x)&&(W.providerData=x.map(K=>fe({},K))),d&&(W._redirectEventId=d),W}static _fromIdTokenResponse(e,t,r=!1){return P(this,null,function*(){let i=new Do;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield Tc(s),s})}static _fromGetAccountInfoResponse(e,t,r){return P(this,null,function*(){let i=t.users[0];me(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Ug(i.providerUserInfo):[],c=!(i.email&&i.passwordHash)&&!s?.length,u=new Do;u.updateFromIdToken(r);let d=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:c}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new ko(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(d,f),d})}};var Sg=new Map;function zr(n){Ic(n instanceof Function,"Expected a class definition");let e=Sg.get(n);return e?(Ic(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Sg.set(n,e),e)}var fA=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return P(this,null,function*(){return!0})}_set(t,r){return P(this,null,function*(){this.storage[t]=r})}_get(t){return P(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return P(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),oh=fA;function nh(n,e,t){return`firebase:${n}:${e}:${t}`}var vc=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=nh(this.userKey,i.apiKey,s),this.fullPersistenceKey=nh("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return P(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield wc(this.auth,{idToken:e}).catch(()=>{});return t?jr._fromGetAccountInfoResponse(this.auth,t,e):null}return jr._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return P(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return P(this,null,function*(){if(!t.length)return new n(zr(oh),e,r);let i=(yield Promise.all(t.map(f=>P(null,null,function*(){if(yield f._isAvailable())return f})))).filter(f=>f),s=i[0]||zr(oh),c=nh(r,e.config.apiKey,e.name),u=null;for(let f of t)try{let I=yield f._get(c);if(I){let S;if(typeof I=="string"){let R=yield wc(e,{idToken:I}).catch(()=>{});if(!R)break;S=yield jr._fromGetAccountInfoResponse(e,R,I)}else S=jr._fromJSON(e,I);f!==s&&(u=S),s=f;break}}catch(I){}let d=i.filter(f=>f._shouldAllowMigration);return!s._shouldAllowMigration||!d.length?new n(s,e,r):(s=d[0],u&&(yield s._set(c,u.toJSON())),yield Promise.all(t.map(f=>P(null,null,function*(){if(f!==s)try{yield f._remove(c)}catch(I){}}))),new n(s,e,r))})}};function Rg(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(_A(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(pA(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(IA(e))return"Blackberry";if(EA(e))return"Webos";if(mA(e))return"Safari";if((e.includes("chrome/")||gA(e))&&!e.includes("edge/"))return"Chrome";if(yA(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function pA(n=yt()){return/firefox\//i.test(n)}function mA(n=yt()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function gA(n=yt()){return/crios\//i.test(n)}function _A(n=yt()){return/iemobile/i.test(n)}function yA(n=yt()){return/android/i.test(n)}function IA(n=yt()){return/blackberry/i.test(n)}function EA(n=yt()){return/webos/i.test(n)}function Bg(n,e=[]){let t;switch(n){case"Browser":t=Rg(yt());break;case"Worker":t=`${Rg(yt())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${$i}/${r}`}var ah=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((c,u)=>{try{let d=e(s);c(d)}catch(d){u(d)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return P(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch(s){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function wA(t){return P(this,arguments,function*(n,e={}){return bc(n,"GET","/v2/passwordPolicy",Og(n,e))})}var TA=6,ch=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??TA,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var uh=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ac(this),this.idTokenSubscription=new Ac(this),this.beforeStateQueue=new ah(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Vg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=zr(t)),this._initializationPromise=this.queue(()=>P(this,null,function*(){if(!this._deleted&&(this.persistenceManager=yield vc.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(r){}yield this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return P(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return P(this,null,function*(){try{let t=yield wc(this,{idToken:e}),r=yield jr._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return P(this,null,function*(){if(pn(this.app)){let s=this.app.settings.authIdToken;return s?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(c,c))}):this.directlySetCurrentUser(null)}let t=yield this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let s=this.redirectUser?._redirectEventId,c=r?._redirectEventId,u=yield this.tryRedirectSignIn(e);(!s||s===c)&&u?.user&&(r=u.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{yield this.beforeStateQueue.runMiddleware(r)}catch(s){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return me(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return P(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(r){yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return P(this,null,function*(){try{yield Tc(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=rA()}_delete(){return P(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return P(this,null,function*(){if(pn(this.app))return Promise.reject(_c(this));let t=e?tt(e):null;return t&&me(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return P(this,null,function*(){if(!this._deleted)return e&&me(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>P(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return P(this,null,function*(){return pn(this.app)?Promise.reject(_c(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return pn(this.app)?Promise.reject(_c(this)):this.queue(()=>P(this,null,function*(){yield this.assertedPersistence.setPersistence(zr(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return P(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return P(this,null,function*(){let e=yield wA(this),t=new ch(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new xt("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return P(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield dA(this,r)}})}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}_setRedirectUser(e,t){return P(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return P(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&zr(e)||this._popupRedirectResolver;me(t,this,"argument-error"),this.redirectPersistenceManager=yield vc.create(this,[zr(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return P(this,null,function*(){return this._isInitialized&&(yield this.queue(()=>P(this,null,function*(){}))),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null})}_persistUserIfCurrent(e){return P(this,null,function*(){if(e===this.currentUser)return this.queue(()=>P(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),c=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(me(u,this,"internal-error"),u.then(()=>{c||s(this.currentUser)}),typeof t=="function"){let d=e.addObserver(t,r,i);return()=>{c=!0,d()}}else{let d=e.addObserver(t);return()=>{c=!0,d()}}}directlySetCurrentUser(e){return P(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return me(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Bg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return P(this,null,function*(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=yield this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=yield this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e})}_getAppCheckToken(){return P(this,null,function*(){if(pn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=yield this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&eA(`Error while retrieving App Check token: ${e.error}`),e?.token})}};function vA(n){return tt(n)}var Ac=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=km(t=>this.observer=t)}get next(){return me(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var AA={loadJS(){return P(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function bA(n){AA=n}function SA(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function RA(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(zr);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}var E1=SA("rcb"),w1=new Gr(3e4,6e4);var T1=new Gr(2e3,1e4);var v1=600*1e3;var A1=new Gr(3e4,6e4);var b1=new Gr(5e3,15e3);var S1=encodeURIComponent("fac");var Pg="@firebase/auth",Cg="1.12.0";var lh=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}getToken(e){return P(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){me(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function PA(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function CA(n){Ot(new ct("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:c,authDomain:u}=r.options;me(c&&!c.includes(":"),"invalid-api-key",{appName:r.name});let d={apiKey:c,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Bg(n)},f=new uh(r,i,s,d);return RA(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Ot(new ct("auth-internal",e=>{let t=vA(e.getProvider("auth").getImmediate());return(r=>new lh(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ce(Pg,Cg,PA(n)),Ce(Pg,Cg,"esm2020")}var DA=300,R1=vm("authIdTokenMaxAge")||DA;function kA(){return document.getElementsByTagName("head")?.[0]??document}bA({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=hh("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",kA().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});CA("Browser");var Cb="auth";var Sc=class{constructor(){return Gi(Cb)}};var qg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$g={};var _n,mh;(function(){var n;function e(T,g){function y(){}y.prototype=g.prototype,T.D=g.prototype,T.prototype=new y,T.prototype.constructor=T,T.C=function(w,E,b){for(var _=Array(arguments.length-2),we=2;we<arguments.length;we++)_[we-2]=arguments[we];return g.prototype[E].apply(w,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,g,y){y||(y=0);var w=Array(16);if(typeof g=="string")for(var E=0;16>E;++E)w[E]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(E=0;16>E;++E)w[E]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=T.g[0],y=T.g[1],E=T.g[2];var b=T.g[3],_=g+(b^y&(E^b))+w[0]+3614090360&4294967295;g=y+(_<<7&4294967295|_>>>25),_=b+(E^g&(y^E))+w[1]+3905402710&4294967295,b=g+(_<<12&4294967295|_>>>20),_=E+(y^b&(g^y))+w[2]+606105819&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(g^E&(b^g))+w[3]+3250441966&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(b^y&(E^b))+w[4]+4118548399&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(E^g&(y^E))+w[5]+1200080426&4294967295,b=g+(_<<12&4294967295|_>>>20),_=E+(y^b&(g^y))+w[6]+2821735955&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(g^E&(b^g))+w[7]+4249261313&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(b^y&(E^b))+w[8]+1770035416&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(E^g&(y^E))+w[9]+2336552879&4294967295,b=g+(_<<12&4294967295|_>>>20),_=E+(y^b&(g^y))+w[10]+4294925233&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(g^E&(b^g))+w[11]+2304563134&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(b^y&(E^b))+w[12]+1804603682&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(E^g&(y^E))+w[13]+4254626195&4294967295,b=g+(_<<12&4294967295|_>>>20),_=E+(y^b&(g^y))+w[14]+2792965006&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(g^E&(b^g))+w[15]+1236535329&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(E^b&(y^E))+w[1]+4129170786&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(g^y))+w[6]+3225465664&4294967295,b=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(b^g))+w[11]+643717713&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(E^b))+w[0]+3921069994&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^b&(y^E))+w[5]+3593408605&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(g^y))+w[10]+38016083&4294967295,b=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(b^g))+w[15]+3634488961&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(E^b))+w[4]+3889429448&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^b&(y^E))+w[9]+568446438&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(g^y))+w[14]+3275163606&4294967295,b=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(b^g))+w[3]+4107603335&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(E^b))+w[8]+1163531501&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^b&(y^E))+w[13]+2850285829&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(g^y))+w[2]+4243563512&4294967295,b=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(b^g))+w[7]+1735328473&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(E^b))+w[12]+2368359562&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(y^E^b)+w[5]+4294588738&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^E)+w[8]+2272392833&4294967295,b=g+(_<<11&4294967295|_>>>21),_=E+(b^g^y)+w[11]+1839030562&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^g)+w[14]+4259657740&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^b)+w[1]+2763975236&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^E)+w[4]+1272893353&4294967295,b=g+(_<<11&4294967295|_>>>21),_=E+(b^g^y)+w[7]+4139469664&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^g)+w[10]+3200236656&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^b)+w[13]+681279174&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^E)+w[0]+3936430074&4294967295,b=g+(_<<11&4294967295|_>>>21),_=E+(b^g^y)+w[3]+3572445317&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^g)+w[6]+76029189&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^b)+w[9]+3654602809&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^E)+w[12]+3873151461&4294967295,b=g+(_<<11&4294967295|_>>>21),_=E+(b^g^y)+w[15]+530742520&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^g)+w[2]+3299628645&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(E^(y|~b))+w[0]+4096336452&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~E))+w[7]+1126891415&4294967295,b=g+(_<<10&4294967295|_>>>22),_=E+(g^(b|~y))+w[14]+2878612391&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~g))+w[5]+4237533241&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~b))+w[12]+1700485571&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~E))+w[3]+2399980690&4294967295,b=g+(_<<10&4294967295|_>>>22),_=E+(g^(b|~y))+w[10]+4293915773&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~g))+w[1]+2240044497&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~b))+w[8]+1873313359&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~E))+w[15]+4264355552&4294967295,b=g+(_<<10&4294967295|_>>>22),_=E+(g^(b|~y))+w[6]+2734768916&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~g))+w[13]+1309151649&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~b))+w[4]+4149444226&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~E))+w[11]+3174756917&4294967295,b=g+(_<<10&4294967295|_>>>22),_=E+(g^(b|~y))+w[2]+718787259&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~g))+w[9]+3951481745&4294967295,T.g[0]=T.g[0]+g&4294967295,T.g[1]=T.g[1]+(E+(_<<21&4294967295|_>>>11))&4294967295,T.g[2]=T.g[2]+E&4294967295,T.g[3]=T.g[3]+b&4294967295}r.prototype.u=function(T,g){g===void 0&&(g=T.length);for(var y=g-this.blockSize,w=this.B,E=this.h,b=0;b<g;){if(E==0)for(;b<=y;)i(this,T,b),b+=this.blockSize;if(typeof T=="string"){for(;b<g;)if(w[E++]=T.charCodeAt(b++),E==this.blockSize){i(this,w),E=0;break}}else for(;b<g;)if(w[E++]=T[b++],E==this.blockSize){i(this,w),E=0;break}}this.h=E,this.o+=g},r.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var g=1;g<T.length-8;++g)T[g]=0;var y=8*this.o;for(g=T.length-8;g<T.length;++g)T[g]=y&255,y/=256;for(this.u(T),T=Array(16),g=y=0;4>g;++g)for(var w=0;32>w;w+=8)T[y++]=this.g[g]>>>w&255;return T};function s(T,g){var y=u;return Object.prototype.hasOwnProperty.call(y,T)?y[T]:y[T]=g(T)}function c(T,g){this.h=g;for(var y=[],w=!0,E=T.length-1;0<=E;E--){var b=T[E]|0;w&&b==g||(y[E]=b,w=!1)}this.g=y}var u={};function d(T){return-128<=T&&128>T?s(T,function(g){return new c([g|0],0>g?-1:0)}):new c([T|0],0>T?-1:0)}function f(T){if(isNaN(T)||!isFinite(T))return S;if(0>T)return O(f(-T));for(var g=[],y=1,w=0;T>=y;w++)g[w]=T/y|0,y*=4294967296;return new c(g,0)}function I(T,g){if(T.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(T.charAt(0)=="-")return O(I(T.substring(1),g));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=f(Math.pow(g,8)),w=S,E=0;E<T.length;E+=8){var b=Math.min(8,T.length-E),_=parseInt(T.substring(E,E+b),g);8>b?(b=f(Math.pow(g,b)),w=w.j(b).add(f(_))):(w=w.j(y),w=w.add(f(_)))}return w}var S=d(0),R=d(1),k=d(16777216);n=c.prototype,n.m=function(){if(U(this))return-O(this).m();for(var T=0,g=1,y=0;y<this.g.length;y++){var w=this.i(y);T+=(0<=w?w:4294967296+w)*g,g*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(x(this))return"0";if(U(this))return"-"+O(this).toString(T);for(var g=f(Math.pow(T,6)),y=this,w="";;){var E=ie(y,g).g;y=W(y,E.j(g));var b=((0<y.g.length?y.g[0]:y.h)>>>0).toString(T);if(y=E,x(y))return b+w;for(;6>b.length;)b="0"+b;w=b+w}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function x(T){if(T.h!=0)return!1;for(var g=0;g<T.g.length;g++)if(T.g[g]!=0)return!1;return!0}function U(T){return T.h==-1}n.l=function(T){return T=W(this,T),U(T)?-1:x(T)?0:1};function O(T){for(var g=T.g.length,y=[],w=0;w<g;w++)y[w]=~T.g[w];return new c(y,~T.h).add(R)}n.abs=function(){return U(this)?O(this):this},n.add=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],w=0,E=0;E<=g;E++){var b=w+(this.i(E)&65535)+(T.i(E)&65535),_=(b>>>16)+(this.i(E)>>>16)+(T.i(E)>>>16);w=_>>>16,b&=65535,_&=65535,y[E]=_<<16|b}return new c(y,y[y.length-1]&-2147483648?-1:0)};function W(T,g){return T.add(O(g))}n.j=function(T){if(x(this)||x(T))return S;if(U(this))return U(T)?O(this).j(O(T)):O(O(this).j(T));if(U(T))return O(this.j(O(T)));if(0>this.l(k)&&0>T.l(k))return f(this.m()*T.m());for(var g=this.g.length+T.g.length,y=[],w=0;w<2*g;w++)y[w]=0;for(w=0;w<this.g.length;w++)for(var E=0;E<T.g.length;E++){var b=this.i(w)>>>16,_=this.i(w)&65535,we=T.i(E)>>>16,lt=T.i(E)&65535;y[2*w+2*E]+=_*lt,K(y,2*w+2*E),y[2*w+2*E+1]+=b*lt,K(y,2*w+2*E+1),y[2*w+2*E+1]+=_*we,K(y,2*w+2*E+1),y[2*w+2*E+2]+=b*we,K(y,2*w+2*E+2)}for(w=0;w<g;w++)y[w]=y[2*w+1]<<16|y[2*w];for(w=g;w<2*g;w++)y[w]=0;return new c(y,0)};function K(T,g){for(;(T[g]&65535)!=T[g];)T[g+1]+=T[g]>>>16,T[g]&=65535,g++}function Q(T,g){this.g=T,this.h=g}function ie(T,g){if(x(g))throw Error("division by zero");if(x(T))return new Q(S,S);if(U(T))return g=ie(O(T),g),new Q(O(g.g),O(g.h));if(U(g))return g=ie(T,O(g)),new Q(O(g.g),g.h);if(30<T.g.length){if(U(T)||U(g))throw Error("slowDivide_ only works with positive integers.");for(var y=R,w=g;0>=w.l(T);)y=Ae(y),w=Ae(w);var E=ne(y,1),b=ne(w,1);for(w=ne(w,2),y=ne(y,2);!x(w);){var _=b.add(w);0>=_.l(T)&&(E=E.add(y),b=_),w=ne(w,1),y=ne(y,1)}return g=W(T,E.j(g)),new Q(E,g)}for(E=S;0<=T.l(g);){for(y=Math.max(1,Math.floor(T.m()/g.m())),w=Math.ceil(Math.log(y)/Math.LN2),w=48>=w?1:Math.pow(2,w-48),b=f(y),_=b.j(g);U(_)||0<_.l(T);)y-=w,b=f(y),_=b.j(g);x(b)&&(b=R),E=E.add(b),T=W(T,_)}return new Q(E,T)}n.A=function(T){return ie(this,T).h},n.and=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],w=0;w<g;w++)y[w]=this.i(w)&T.i(w);return new c(y,this.h&T.h)},n.or=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],w=0;w<g;w++)y[w]=this.i(w)|T.i(w);return new c(y,this.h|T.h)},n.xor=function(T){for(var g=Math.max(this.g.length,T.g.length),y=[],w=0;w<g;w++)y[w]=this.i(w)^T.i(w);return new c(y,this.h^T.h)};function Ae(T){for(var g=T.g.length+1,y=[],w=0;w<g;w++)y[w]=T.i(w)<<1|T.i(w-1)>>>31;return new c(y,T.h)}function ne(T,g){var y=g>>5;g%=32;for(var w=T.g.length-y,E=[],b=0;b<w;b++)E[b]=0<g?T.i(b+y)>>>g|T.i(b+y+1)<<32-g:T.i(b+y);return new c(E,T.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,mh=$g.Md5=r,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.A,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=f,c.fromString=I,_n=$g.Integer=c}).apply(typeof qg<"u"?qg:typeof self<"u"?self:typeof window<"u"?window:{});var Rc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yn={};var gh,Db,Hi,_h,No,Pc,yh,Ih,Eh;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,p){return o==Array.prototype||o==Object.prototype||(o[l]=p.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Rc=="object"&&Rc];for(var l=0;l<o.length;++l){var p=o[l];if(p&&p.Math==Math)return p}throw Error("Cannot find global object")}var r=t(this);function i(o,l){if(l)e:{var p=r;o=o.split(".");for(var v=0;v<o.length-1;v++){var D=o[v];if(!(D in p))break e;p=p[D]}o=o[o.length-1],v=p[o],l=l(v),l!=v&&l!=null&&e(p,o,{configurable:!0,writable:!0,value:l})}}function s(o,l){o instanceof String&&(o+="");var p=0,v=!1,D={next:function(){if(!v&&p<o.length){var V=p++;return{value:l(V,o[V]),done:!1}}return v=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D}i("Array.prototype.values",function(o){return o||function(){return s(this,function(l,p){return p})}});var c=c||{},u=this||self;function d(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function f(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function I(o,l,p){return o.call.apply(o.bind,arguments)}function S(o,l,p){if(!o)throw Error();if(2<arguments.length){var v=Array.prototype.slice.call(arguments,2);return function(){var D=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(D,v),o.apply(l,D)}}return function(){return o.apply(l,arguments)}}function R(o,l,p){return R=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?I:S,R.apply(null,arguments)}function k(o,l){var p=Array.prototype.slice.call(arguments,1);return function(){var v=p.slice();return v.push.apply(v,arguments),o.apply(this,v)}}function x(o,l){function p(){}p.prototype=l.prototype,o.aa=l.prototype,o.prototype=new p,o.prototype.constructor=o,o.Qb=function(v,D,V){for(var B=Array(arguments.length-2),he=2;he<arguments.length;he++)B[he-2]=arguments[he];return l.prototype[D].apply(v,B)}}function U(o){let l=o.length;if(0<l){let p=Array(l);for(let v=0;v<l;v++)p[v]=o[v];return p}return[]}function O(o,l){for(let p=1;p<arguments.length;p++){let v=arguments[p];if(d(v)){let D=o.length||0,V=v.length||0;o.length=D+V;for(let B=0;B<V;B++)o[D+B]=v[B]}else o.push(v)}}class W{constructor(l,p){this.i=l,this.j=p,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function K(o){return/^[\s\xa0]*$/.test(o)}function Q(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function ie(o){return ie[" "](o),o}ie[" "]=function(){};var Ae=Q().indexOf("Gecko")!=-1&&!(Q().toLowerCase().indexOf("webkit")!=-1&&Q().indexOf("Edge")==-1)&&!(Q().indexOf("Trident")!=-1||Q().indexOf("MSIE")!=-1)&&Q().indexOf("Edge")==-1;function ne(o,l,p){for(let v in o)l.call(p,o[v],v,o)}function T(o,l){for(let p in o)l.call(void 0,o[p],p,o)}function g(o){let l={};for(let p in o)l[p]=o[p];return l}let y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function w(o,l){let p,v;for(let D=1;D<arguments.length;D++){v=arguments[D];for(p in v)o[p]=v[p];for(let V=0;V<y.length;V++)p=y[V],Object.prototype.hasOwnProperty.call(v,p)&&(o[p]=v[p])}}function E(o){var l=1;o=o.split(":");let p=[];for(;0<l&&o.length;)p.push(o.shift()),l--;return o.length&&p.push(o.join(":")),p}function b(o){u.setTimeout(()=>{throw o},0)}function _(){var o=Vn;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class we{constructor(){this.h=this.g=null}add(l,p){let v=lt.get();v.set(l,p),this.h?this.h.next=v:this.g=v,this.h=v}}var lt=new W(()=>new al,o=>o.reset());class al{constructor(){this.next=this.g=this.h=null}set(l,p){this.h=l,this.g=p,this.next=null}reset(){this.next=this.g=this.h=null}}let yr,Ut=!1,Vn=new we,Aa=()=>{let o=u.Promise.resolve(void 0);yr=()=>{o.then(ba)}};var ba=()=>{for(var o;o=_();){try{o.h.call(o.g)}catch(p){b(p)}var l=lt;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}Ut=!1};function St(){this.s=this.s,this.C=this.C}St.prototype.s=!1,St.prototype.ma=function(){this.s||(this.s=!0,this.N())},St.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ue(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Ue.prototype.h=function(){this.defaultPrevented=!0};var gi=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let p=()=>{};u.addEventListener("test",p,l),u.removeEventListener("test",p,l)}catch(p){}return o})();function sn(o,l){if(Ue.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var p=this.type=o.type,v=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(Ae){e:{try{ie(l.nodeName);var D=!0;break e}catch(V){}D=!1}D||(l=null)}}else p=="mouseover"?l=o.fromElement:p=="mouseout"&&(l=o.toElement);this.relatedTarget=l,v?(this.clientX=v.clientX!==void 0?v.clientX:v.pageX,this.clientY=v.clientY!==void 0?v.clientY:v.pageY,this.screenX=v.screenX||0,this.screenY=v.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Ks[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&sn.aa.h.call(this)}}x(sn,Ue);var Ks={2:"touch",3:"pen",4:"mouse"};sn.prototype.h=function(){sn.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var on="closure_listenable_"+(1e6*Math.random()|0),Ws=0;function Sa(o,l,p,v,D){this.listener=o,this.proxy=null,this.src=l,this.type=p,this.capture=!!v,this.ha=D,this.key=++Ws,this.da=this.fa=!1}function Ir(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function _i(o){this.src=o,this.g={},this.h=0}_i.prototype.add=function(o,l,p,v,D){var V=o.toString();o=this.g[V],o||(o=this.g[V]=[],this.h++);var B=Ii(o,l,v,D);return-1<B?(l=o[B],p||(l.fa=!1)):(l=new Sa(l,this.src,V,!!v,D),l.fa=p,o.push(l)),l};function yi(o,l){var p=l.type;if(p in o.g){var v=o.g[p],D=Array.prototype.indexOf.call(v,l,void 0),V;(V=0<=D)&&Array.prototype.splice.call(v,D,1),V&&(Ir(l),o.g[p].length==0&&(delete o.g[p],o.h--))}}function Ii(o,l,p,v){for(var D=0;D<o.length;++D){var V=o[D];if(!V.da&&V.listener==l&&V.capture==!!p&&V.ha==v)return D}return-1}var Er="closure_lm_"+(1e6*Math.random()|0),Ei={};function Ra(o,l,p,v,D){if(v&&v.once)return Ti(o,l,p,v,D);if(Array.isArray(l)){for(var V=0;V<l.length;V++)Ra(o,l[V],p,v,D);return null}return p=an(p),o&&o[on]?o.K(l,p,f(v)?!!v.capture:!!v,D):wi(o,l,p,!1,v,D)}function wi(o,l,p,v,D,V){if(!l)throw Error("Invalid event type");var B=f(D)?!!D.capture:!!D,he=vi(o);if(he||(o[Er]=he=new _i(o)),p=he.add(l,p,v,B,V),p.proxy)return p;if(v=Hs(),p.proxy=v,v.src=o,v.listener=p,o.addEventListener)gi||(D=B),D===void 0&&(D=!1),o.addEventListener(l.toString(),v,D);else if(o.attachEvent)o.attachEvent(wr(l.toString()),v);else if(o.addListener&&o.removeListener)o.addListener(v);else throw Error("addEventListener and attachEvent are unavailable.");return p}function Hs(){function o(p){return l.call(o.src,o.listener,p)}let l=cl;return o}function Ti(o,l,p,v,D){if(Array.isArray(l)){for(var V=0;V<l.length;V++)Ti(o,l[V],p,v,D);return null}return p=an(p),o&&o[on]?o.L(l,p,f(v)?!!v.capture:!!v,D):wi(o,l,p,!0,v,D)}function Be(o,l,p,v,D){if(Array.isArray(l))for(var V=0;V<l.length;V++)Be(o,l[V],p,v,D);else v=f(v)?!!v.capture:!!v,p=an(p),o&&o[on]?(o=o.i,l=String(l).toString(),l in o.g&&(V=o.g[l],p=Ii(V,p,v,D),-1<p&&(Ir(V[p]),Array.prototype.splice.call(V,p,1),V.length==0&&(delete o.g[l],o.h--)))):o&&(o=vi(o))&&(l=o.g[l.toString()],o=-1,l&&(o=Ii(l,p,v,D)),(p=-1<o?l[o]:null)&&qe(p))}function qe(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[on])yi(l.i,o);else{var p=o.type,v=o.proxy;l.removeEventListener?l.removeEventListener(p,v,o.capture):l.detachEvent?l.detachEvent(wr(p),v):l.addListener&&l.removeListener&&l.removeListener(v),(p=vi(l))?(yi(p,o),p.h==0&&(p.src=null,l[Er]=null)):Ir(o)}}}function wr(o){return o in Ei?Ei[o]:Ei[o]="on"+o}function cl(o,l){if(o.da)o=!0;else{l=new sn(l,this);var p=o.listener,v=o.ha||o.src;o.fa&&qe(o),o=p.call(v,l)}return o}function vi(o){return o=o[Er],o instanceof _i?o:null}var Qs="__closure_events_fn_"+(1e9*Math.random()>>>0);function an(o){return typeof o=="function"?o:(o[Qs]||(o[Qs]=function(l){return o.handleEvent(l)}),o[Qs])}function $e(){St.call(this),this.i=new _i(this),this.M=this,this.F=null}x($e,St),$e.prototype[on]=!0,$e.prototype.removeEventListener=function(o,l,p,v){Be(this,o,l,p,v)};function We(o,l){var p,v=o.F;if(v)for(p=[];v;v=v.F)p.push(v);if(o=o.M,v=l.type||l,typeof l=="string")l=new Ue(l,o);else if(l instanceof Ue)l.target=l.target||o;else{var D=l;l=new Ue(v,o),w(l,D)}if(D=!0,p)for(var V=p.length-1;0<=V;V--){var B=l.g=p[V];D=xn(B,v,!0,l)&&D}if(B=l.g=o,D=xn(B,v,!0,l)&&D,D=xn(B,v,!1,l)&&D,p)for(V=0;V<p.length;V++)B=l.g=p[V],D=xn(B,v,!1,l)&&D}$e.prototype.N=function(){if($e.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var p=o.g[l],v=0;v<p.length;v++)Ir(p[v]);delete o.g[l],o.h--}}this.F=null},$e.prototype.K=function(o,l,p,v){return this.i.add(String(o),l,!1,p,v)},$e.prototype.L=function(o,l,p,v){return this.i.add(String(o),l,!0,p,v)};function xn(o,l,p,v){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var D=!0,V=0;V<l.length;++V){var B=l[V];if(B&&!B.da&&B.capture==p){var he=B.listener,Pe=B.ha||B.src;B.fa&&yi(o.i,B),D=he.call(Pe,v)!==!1&&D}}return D&&!v.defaultPrevented}function Pa(o,l,p){if(typeof o=="function")p&&(o=R(o,p));else if(o&&typeof o.handleEvent=="function")o=R(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function Ca(o){o.g=Pa(()=>{o.g=null,o.i&&(o.i=!1,Ca(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class Da extends St{constructor(l,p){super(),this.m=l,this.l=p,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Ca(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function On(o){St.call(this),this.h=o,this.g={}}x(On,St);var Ln=[];function Ai(o){ne(o.g,function(l,p){this.g.hasOwnProperty(p)&&qe(l)},o),o.g={}}On.prototype.N=function(){On.aa.N.call(this),Ai(this)},On.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Tr=u.JSON.stringify,cn=u.JSON.parse,ka=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Mn(){}Mn.prototype.h=null;function Js(o){return o.h||(o.h=o.i())}function Fn(){}var Un={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function je(){Ue.call(this,"d")}x(je,Ue);function bi(){Ue.call(this,"c")}x(bi,Ue);var pt={},Bn=null;function Si(){return Bn=Bn||new $e}pt.La="serverreachability";function Na(o){Ue.call(this,pt.La,o)}x(Na,Ue);function Et(o){let l=Si();We(l,new Na(l))}pt.STAT_EVENT="statevent";function Va(o,l){Ue.call(this,pt.STAT_EVENT,o),this.stat=l}x(Va,Ue);function Je(o){let l=Si();We(l,new Va(l,o))}pt.Ma="timingevent";function vr(o,l){Ue.call(this,pt.Ma,o),this.size=l}x(vr,Ue);function qn(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function $n(){this.g=!0}$n.prototype.xa=function(){this.g=!1};function Ys(o,l,p,v,D,V){o.info(function(){if(o.g)if(V)for(var B="",he=V.split("&"),Pe=0;Pe<he.length;Pe++){var de=he[Pe].split("=");if(1<de.length){var Ze=de[0];de=de[1];var et=Ze.split("_");B=2<=et.length&&et[1]=="type"?B+(Ze+"="+de+"&"):B+(Ze+"=redacted&")}}else B=null;else B=V;return"XMLHTTP REQ ("+v+") [attempt "+D+"]: "+l+`
`+p+`
`+B})}function Ar(o,l,p,v,D,V,B){o.info(function(){return"XMLHTTP RESP ("+v+") [ attempt "+D+"]: "+l+`
`+p+`
`+V+" "+B})}function jn(o,l,p,v){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+xa(o,p)+(v?" "+v:"")})}function Bt(o,l){o.info(function(){return"TIMEOUT: "+l})}$n.prototype.info=function(){};function xa(o,l){if(!o.g)return l;if(!l)return null;try{var p=JSON.parse(l);if(p){for(o=0;o<p.length;o++)if(Array.isArray(p[o])){var v=p[o];if(!(2>v.length)){var D=v[1];if(Array.isArray(D)&&!(1>D.length)){var V=D[0];if(V!="noop"&&V!="stop"&&V!="close")for(var B=1;B<D.length;B++)D[B]=""}}}}return Tr(p)}catch(he){return l}}var br={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ri={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Sr;function Rr(){}x(Rr,Mn),Rr.prototype.g=function(){return new XMLHttpRequest},Rr.prototype.i=function(){return{}},Sr=new Rr;function qt(o,l,p,v){this.j=o,this.i=l,this.l=p,this.R=v||1,this.U=new On(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Xs}function Xs(){this.i=null,this.g="",this.h=!1}var Oa={},zn={};function Pi(o,l,p){o.L=1,o.v=Ni(Rt(l)),o.m=p,o.P=!0,Ci(o,null)}function Ci(o,l){o.F=Date.now(),Kn(o),o.A=Rt(o.v);var p=o.A,v=o.R;Array.isArray(v)||(v=[String(v)]),ja(p.i,"t",v),o.C=0,p=o.j.J,o.h=new Xs,o.g=h(o.j,p?l:null,!o.m),0<o.O&&(o.M=new Da(R(o.Y,o,o.g),o.O)),l=o.U,p=o.g,v=o.ca;var D="readystatechange";Array.isArray(D)||(D&&(Ln[0]=D.toString()),D=Ln);for(var V=0;V<D.length;V++){var B=Ra(p,D[V],v||l.handleEvent,!1,l.h||l);if(!B)break;l.g[B.key]=B}l=o.H?g(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Et(),Ys(o.i,o.u,o.A,o.l,o.R,o.m)}qt.prototype.ca=function(o){o=o.target;let l=this.M;l&&dt(o)==3?l.j():this.Y(o)},qt.prototype.Y=function(o){try{if(o==this.g)e:{let et=dt(this.g);var l=this.g.Ba();let qi=this.g.Z();if(!(3>et)&&(et!=3||this.g&&(this.h.h||this.g.oa()||Ha(this.g)))){this.J||et!=4||l==7||(l==8||0>=qi?Et(3):Et(2)),Di(this);var p=this.g.Z();this.X=p;t:if(Gn(this)){var v=Ha(this.g);o="";var D=v.length,V=dt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){$t(this),Wn(this);var B="";break t}this.h.i=new u.TextDecoder}for(l=0;l<D;l++)this.h.h=!0,o+=this.h.i.decode(v[l],{stream:!(V&&l==D-1)});v.length=0,this.h.g+=o,this.C=0,B=this.h.g}else B=this.g.oa();if(this.o=p==200,Ar(this.i,this.u,this.A,this.l,this.R,et,p),this.o){if(this.T&&!this.K){t:{if(this.g){var he,Pe=this.g;if((he=Pe.g?Pe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(he)){var de=he;break t}}de=null}if(p=de)jn(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Pr(this,p);else{this.o=!1,this.s=3,Je(12),$t(this),Wn(this);break e}}if(this.P){p=!0;let Nt;for(;!this.J&&this.C<B.length;)if(Nt=un(this,B),Nt==zn){et==4&&(this.s=4,Je(14),p=!1),jn(this.i,this.l,null,"[Incomplete Response]");break}else if(Nt==Oa){this.s=4,Je(15),jn(this.i,this.l,B,"[Invalid Chunk]"),p=!1;break}else jn(this.i,this.l,Nt,null),Pr(this,Nt);if(Gn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),et!=4||B.length!=0||this.h.h||(this.s=1,Je(16),p=!1),this.o=this.o&&p,!p)jn(this.i,this.l,B,"[Invalid Chunked Response]"),$t(this),Wn(this);else if(0<B.length&&!this.W){this.W=!0;var Ze=this.j;Ze.g==this&&Ze.ba&&!Ze.M&&(Ze.j.info("Great, no buffering proxy detected. Bytes received: "+B.length),Bi(Ze),Ze.M=!0,Je(11))}}else jn(this.i,this.l,B,null),Pr(this,B);et==4&&$t(this),this.o&&!this.J&&(et==4?Xe(this.j,this):(this.o=!1,Kn(this)))}else Qa(this.g),p==400&&0<B.indexOf("Unknown SID")?(this.s=3,Je(12)):(this.s=0,Je(13)),$t(this),Wn(this)}}}catch(et){}};function Gn(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function un(o,l){var p=o.C,v=l.indexOf(`
`,p);return v==-1?zn:(p=Number(l.substring(p,v)),isNaN(p)?Oa:(v+=1,v+p>l.length?zn:(l=l.slice(v,v+p),o.C=v+p,l)))}qt.prototype.cancel=function(){this.J=!0,$t(this)};function Kn(o){o.S=Date.now()+o.I,La(o,o.I)}function La(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=qn(R(o.ba,o),l)}function Di(o){o.B&&(u.clearTimeout(o.B),o.B=null)}qt.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Bt(this.i,this.A),this.L!=2&&(Et(),Je(17)),$t(this),this.s=2,Wn(this)):La(this,this.S-o)};function Wn(o){o.j.G==0||o.J||Xe(o.j,o)}function $t(o){Di(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,Ai(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Pr(o,l){try{var p=o.j;if(p.G!=0&&(p.g==o||ro(p.h,o))){if(!o.K&&ro(p.h,o)&&p.G==3){try{var v=p.Da.g.parse(l)}catch(de){v=null}if(Array.isArray(v)&&v.length==3){var D=v;if(D[0]==0){e:if(!p.u){if(p.g)if(p.g.F+3e3<o.F)hn(p),er(p);else break e;Ui(p),Je(18)}}else p.za=D[1],0<p.za-p.T&&37500>D[2]&&p.F&&p.v==0&&!p.C&&(p.C=qn(R(p.Za,p),6e3));if(1>=no(p.h)&&p.ca){try{p.ca()}catch(de){}p.ca=void 0}}else Gt(p,11)}else if((o.K||p.g==o)&&hn(p),!K(l))for(D=p.Da.g.parse(l),l=0;l<D.length;l++){let de=D[l];if(p.T=de[0],de=de[1],p.G==2)if(de[0]=="c"){p.K=de[1],p.ia=de[2];let Ze=de[3];Ze!=null&&(p.la=Ze,p.j.info("VER="+p.la));let et=de[4];et!=null&&(p.Aa=et,p.j.info("SVER="+p.Aa));let qi=de[5];qi!=null&&typeof qi=="number"&&0<qi&&(v=1.5*qi,p.L=v,p.j.info("backChannelRequestTimeoutMs_="+v)),v=p;let Nt=o.g;if(Nt){let Ja=Nt.g?Nt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ja){var V=v.h;V.g||Ja.indexOf("spdy")==-1&&Ja.indexOf("quic")==-1&&Ja.indexOf("h2")==-1||(V.j=V.l,V.g=new Set,V.h&&(wt(V,V.h),V.h=null))}if(v.D){let ll=Nt.g?Nt.g.getResponseHeader("X-HTTP-Session-Id"):null;ll&&(v.ya=ll,Ie(v.I,v.D,ll))}}p.G=3,p.l&&p.l.ua(),p.ba&&(p.R=Date.now()-o.F,p.j.info("Handshake RTT: "+p.R+"ms")),v=p;var B=o;if(v.qa=a(v,v.J?v.ia:null,v.W),B.K){mt(v.h,B);var he=B,Pe=v.L;Pe&&(he.I=Pe),he.B&&(Di(he),Kn(he)),v.g=B}else fo(v);0<p.i.length&&Or(p)}else de[0]!="stop"&&de[0]!="close"||Gt(p,7);else p.G==3&&(de[0]=="stop"||de[0]=="close"?de[0]=="stop"?Gt(p,7):Li(p):de[0]!="noop"&&p.l&&p.l.ta(de),p.v=0)}}Et(4)}catch(de){}}var Zs=class{constructor(o,l){this.g=o,this.map=l}};function eo(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function to(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function no(o){return o.h?1:o.g?o.g.size:0}function ro(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function wt(o,l){o.g?o.g.add(l):o.h=l}function mt(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}eo.prototype.cancel=function(){if(this.i=Hn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function Hn(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let p of o.g.values())l=l.concat(p.D);return l}return U(o.i)}function Cr(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(d(o)){for(var l=[],p=o.length,v=0;v<p;v++)l.push(o[v]);return l}l=[],p=0;for(v in o)l[p++]=o[v];return l}function io(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(d(o)||typeof o=="string"){var l=[];o=o.length;for(var p=0;p<o;p++)l.push(p);return l}l=[],p=0;for(let v in o)l[p++]=v;return l}}}function _e(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(d(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var p=io(o),v=Cr(o),D=v.length,V=0;V<D;V++)l.call(void 0,v[V],p&&p[V],o)}var Dr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function kr(o,l){if(o){o=o.split("&");for(var p=0;p<o.length;p++){var v=o[p].indexOf("="),D=null;if(0<=v){var V=o[p].substring(0,v);D=o[p].substring(v+1)}else V=o[p];l(V,D?decodeURIComponent(D.replace(/\+/g," ")):"")}}}function gt(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof gt){this.h=o.h,Nr(this,o.j),this.o=o.o,this.g=o.g,ki(this,o.s),this.l=o.l;var l=o.i,p=new Vr;p.i=l.i,l.g&&(p.g=new Map(l.g),p.h=l.h),Ma(this,p),this.m=o.m}else o&&(l=String(o).match(Dr))?(this.h=!1,Nr(this,l[1]||"",!0),this.o=Pt(l[2]||""),this.g=Pt(l[3]||"",!0),ki(this,l[4]),this.l=Pt(l[5]||"",!0),Ma(this,l[6]||"",!0),this.m=Pt(l[7]||"")):(this.h=!1,this.i=new Vr(null,this.h))}gt.prototype.toString=function(){var o=[],l=this.j;l&&o.push(_t(l,so,!0),":");var p=this.g;return(p||l=="file")&&(o.push("//"),(l=this.o)&&o.push(_t(l,so,!0),"@"),o.push(encodeURIComponent(String(p)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p=this.s,p!=null&&o.push(":",String(p))),(p=this.l)&&(this.g&&p.charAt(0)!="/"&&o.push("/"),o.push(_t(p,p.charAt(0)=="/"?Ba:Ua,!0))),(p=this.i.toString())&&o.push("?",p),(p=this.m)&&o.push("#",_t(p,Qn)),o.join("")};function Rt(o){return new gt(o)}function Nr(o,l,p){o.j=p?Pt(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function ki(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function Ma(o,l,p){l instanceof Vr?(o.i=l,Vi(o.i,o.h)):(p||(l=_t(l,qa)),o.i=new Vr(l,o.h))}function Ie(o,l,p){o.i.set(l,p)}function Ni(o){return Ie(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Pt(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function _t(o,l,p){return typeof o=="string"?(o=encodeURI(o).replace(l,Fa),p&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Fa(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var so=/[#\/\?@]/g,Ua=/[#\?:]/g,Ba=/[#\?]/g,qa=/[#\?@]/g,Qn=/#/g;function Vr(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function jt(o){o.g||(o.g=new Map,o.h=0,o.i&&kr(o.i,function(l,p){o.add(decodeURIComponent(l.replace(/\+/g," ")),p)}))}n=Vr.prototype,n.add=function(o,l){jt(this),this.i=null,o=Dt(this,o);var p=this.g.get(o);return p||this.g.set(o,p=[]),p.push(l),this.h+=1,this};function $a(o,l){jt(o),l=Dt(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function Ct(o,l){return jt(o),l=Dt(o,l),o.g.has(l)}n.forEach=function(o,l){jt(this),this.g.forEach(function(p,v){p.forEach(function(D){o.call(l,D,v,this)},this)},this)},n.na=function(){jt(this);let o=Array.from(this.g.values()),l=Array.from(this.g.keys()),p=[];for(let v=0;v<l.length;v++){let D=o[v];for(let V=0;V<D.length;V++)p.push(l[v])}return p},n.V=function(o){jt(this);let l=[];if(typeof o=="string")Ct(this,o)&&(l=l.concat(this.g.get(Dt(this,o))));else{o=Array.from(this.g.values());for(let p=0;p<o.length;p++)l=l.concat(o[p])}return l},n.set=function(o,l){return jt(this),this.i=null,o=Dt(this,o),Ct(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},n.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function ja(o,l,p){$a(o,l),0<p.length&&(o.i=null,o.g.set(Dt(o,l),U(p)),o.h+=p.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(var p=0;p<l.length;p++){var v=l[p];let V=encodeURIComponent(String(v)),B=this.V(v);for(v=0;v<B.length;v++){var D=V;B[v]!==""&&(D+="="+encodeURIComponent(String(B[v]))),o.push(D)}}return this.i=o.join("&")};function Dt(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Vi(o,l){l&&!o.j&&(jt(o),o.i=null,o.g.forEach(function(p,v){var D=v.toLowerCase();v!=D&&($a(this,v),ja(this,D,p))},o)),o.j=l}function za(o,l){let p=new $n;if(u.Image){let v=new Image;v.onload=k(ht,p,"TestLoadImage: loaded",!0,l,v),v.onerror=k(ht,p,"TestLoadImage: error",!1,l,v),v.onabort=k(ht,p,"TestLoadImage: abort",!1,l,v),v.ontimeout=k(ht,p,"TestLoadImage: timeout",!1,l,v),u.setTimeout(function(){v.ontimeout&&v.ontimeout()},1e4),v.src=o}else l(!1)}function xr(o,l){let p=new $n,v=new AbortController,D=setTimeout(()=>{v.abort(),ht(p,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:v.signal}).then(V=>{clearTimeout(D),V.ok?ht(p,"TestPingServer: ok",!0,l):ht(p,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(D),ht(p,"TestPingServer: error",!1,l)})}function ht(o,l,p,v,D){try{D&&(D.onload=null,D.onerror=null,D.onabort=null,D.ontimeout=null),v(p)}catch(V){}}function Ga(){this.g=new ka}function oo(o,l,p){let v=p||"";try{_e(o,function(D,V){let B=D;f(D)&&(B=Tr(D)),l.push(v+V+"="+encodeURIComponent(B))})}catch(D){throw l.push(v+"type="+encodeURIComponent("_badmap")),D}}function ye(o){this.l=o.Ub||null,this.j=o.eb||!1}x(ye,Mn),ye.prototype.g=function(){return new xi(this.l,this.j)},ye.prototype.i=(function(o){return function(){return o}})({});function xi(o,l){$e.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(xi,$e),n=xi.prototype,n.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,Yn(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Jn(this)),this.readyState=0},n.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Yn(this)),this.g&&(this.readyState=3,Yn(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ka(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ka(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}n.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Jn(this):Yn(this),this.readyState==3&&Ka(this)}},n.Ra=function(o){this.g&&(this.response=this.responseText=o,Jn(this))},n.Qa=function(o){this.g&&(this.response=o,Jn(this))},n.ga=function(){this.g&&Jn(this)};function Jn(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Yn(o)}n.setRequestHeader=function(o,l){this.u.append(o,l)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var p=l.next();!p.done;)p=p.value,o.push(p[0]+": "+p[1]),p=l.next();return o.join(`\r
`)};function Yn(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(xi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function ao(o){let l="";return ne(o,function(p,v){l+=v,l+=":",l+=p,l+=`\r
`}),l}function Xn(o,l,p){e:{for(v in p){var v=!1;break e}v=!0}v||(p=ao(p),typeof o=="string"?p!=null&&encodeURIComponent(String(p)):Ie(o,l,p))}function pe(o){$e.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(pe,$e);var Wa=/^https?$/i,ul=["POST","PUT"];n=pe.prototype,n.Ha=function(o){this.J=o},n.ea=function(o,l,p,v){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Sr.g(),this.v=this.o?Js(this.o):Js(Sr),this.g.onreadystatechange=R(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(V){Zn(this,V);return}if(o=p||"",p=new Map(this.headers),v)if(Object.getPrototypeOf(v)===Object.prototype)for(var D in v)p.set(D,v[D]);else if(typeof v.keys=="function"&&typeof v.get=="function")for(let V of v.keys())p.set(V,v.get(V));else throw Error("Unknown input type for opt_headers: "+String(v));v=Array.from(p.keys()).find(V=>V.toLowerCase()=="content-type"),D=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(ul,l,void 0))||v||D||p.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[V,B]of p)this.g.setRequestHeader(V,B);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{uo(this),this.u=!0,this.g.send(o),this.u=!1}catch(V){Zn(this,V)}};function Zn(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,co(o),ln(o)}function co(o){o.A||(o.A=!0,We(o,"complete"),We(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,We(this,"complete"),We(this,"abort"),ln(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ln(this,!0)),pe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Oi(this):this.bb())},n.bb=function(){Oi(this)};function Oi(o){if(o.h&&typeof c<"u"&&(!o.v[1]||dt(o)!=4||o.Z()!=2)){if(o.u&&dt(o)==4)Pa(o.Ea,0,o);else if(We(o,"readystatechange"),dt(o)==4){o.h=!1;try{let B=o.Z();e:switch(B){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var p;if(!(p=l)){var v;if(v=B===0){var D=String(o.D).match(Dr)[1]||null;!D&&u.self&&u.self.location&&(D=u.self.location.protocol.slice(0,-1)),v=!Wa.test(D?D.toLowerCase():"")}p=v}if(p)We(o,"complete"),We(o,"success");else{o.m=6;try{var V=2<dt(o)?o.g.statusText:""}catch(he){V=""}o.l=V+" ["+o.Z()+"]",co(o)}}finally{ln(o)}}}}function ln(o,l){if(o.g){uo(o);let p=o.g,v=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||We(o,"ready");try{p.onreadystatechange=v}catch(D){}}}function uo(o){o.I&&(u.clearTimeout(o.I),o.I=null)}n.isActive=function(){return!!this.g};function dt(o){return o.g?o.g.readyState:0}n.Z=function(){try{return 2<dt(this)?this.g.status:-1}catch(o){return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(o){return""}},n.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),cn(l)}};function Ha(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch(l){return null}}function Qa(o){let l={};o=(o.g&&2<=dt(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let v=0;v<o.length;v++){if(K(o[v]))continue;var p=E(o[v]);let D=p[0];if(p=p[1],typeof p!="string")continue;p=p.trim();let V=l[D]||[];l[D]=V,V.push(p)}T(l,function(v){return v.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function kt(o,l,p){return p&&p.internalChannelParams&&p.internalChannelParams[o]||l}function lo(o){this.Aa=0,this.i=[],this.j=new $n,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=kt("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=kt("baseRetryDelayMs",5e3,o),this.cb=kt("retryDelaySeedMs",1e4,o),this.Wa=kt("forwardChannelMaxRetries",2,o),this.wa=kt("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new eo(o&&o.concurrentRequestLimit),this.Da=new Ga,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=lo.prototype,n.la=8,n.G=1,n.connect=function(o,l,p,v){Je(0),this.W=o,this.H=l||{},p&&v!==void 0&&(this.H.OSID=p,this.H.OAID=v),this.F=this.X,this.I=a(this,null,this.W),Or(this)};function Li(o){if(Mi(o),o.G==3){var l=o.U++,p=Rt(o.I);if(Ie(p,"SID",o.K),Ie(p,"RID",l),Ie(p,"TYPE","terminate"),tr(o,p),l=new qt(o,o.j,l),l.L=2,l.v=Ni(Rt(p)),p=!1,u.navigator&&u.navigator.sendBeacon)try{p=u.navigator.sendBeacon(l.v.toString(),"")}catch(v){}!p&&u.Image&&(new Image().src=l.v,p=!0),p||(l.g=h(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Kn(l)}dn(o)}function er(o){o.g&&(Bi(o),o.g.cancel(),o.g=null)}function Mi(o){er(o),o.u&&(u.clearTimeout(o.u),o.u=null),hn(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function Or(o){if(!to(o.h)&&!o.s){o.s=!0;var l=o.Ga;yr||Aa(),Ut||(yr(),Ut=!0),Vn.add(l,o),o.B=0}}function Fi(o,l){return no(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=qn(R(o.Ga,o,l),mo(o,o.B)),o.B++,!0)}n.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let D=new qt(this,this.j,o),V=this.o;if(this.S&&(V?(V=g(V),w(V,this.S)):V=this.S),this.m!==null||this.O||(D.H=V,V=null),this.P)e:{for(var l=0,p=0;p<this.i.length;p++){t:{var v=this.i[p];if("__data__"in v.map&&(v=v.map.__data__,typeof v=="string")){v=v.length;break t}v=void 0}if(v===void 0)break;if(l+=v,4096<l){l=p;break e}if(l===4096||p===this.i.length-1){l=p+1;break e}}l=1e3}else l=1e3;l=zt(this,D,l),p=Rt(this.I),Ie(p,"RID",o),Ie(p,"CVER",22),this.D&&Ie(p,"X-HTTP-Session-Id",this.D),tr(this,p),V&&(this.O?l="headers="+encodeURIComponent(String(ao(V)))+"&"+l:this.m&&Xn(p,this.m,V)),wt(this.h,D),this.Ua&&Ie(p,"TYPE","init"),this.P?(Ie(p,"$req",l),Ie(p,"SID","null"),D.T=!0,Pi(D,p,null)):Pi(D,p,l),this.G=2}}else this.G==3&&(o?ho(this,o):this.i.length==0||to(this.h)||ho(this))};function ho(o,l){var p;l?p=l.l:p=o.U++;let v=Rt(o.I);Ie(v,"SID",o.K),Ie(v,"RID",p),Ie(v,"AID",o.T),tr(o,v),o.m&&o.o&&Xn(v,o.m,o.o),p=new qt(o,o.j,p,o.B+1),o.m===null&&(p.H=o.o),l&&(o.i=l.D.concat(o.i)),l=zt(o,p,1e3),p.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),wt(o.h,p),Pi(p,v,l)}function tr(o,l){o.H&&ne(o.H,function(p,v){Ie(l,v,p)}),o.l&&_e({},function(p,v){Ie(l,v,p)})}function zt(o,l,p){p=Math.min(o.i.length,p);var v=o.l?R(o.l.Na,o.l,o):null;e:{var D=o.i;let V=-1;for(;;){let B=["count="+p];V==-1?0<p?(V=D[0].g,B.push("ofs="+V)):V=0:B.push("ofs="+V);let he=!0;for(let Pe=0;Pe<p;Pe++){let de=D[Pe].g,Ze=D[Pe].map;if(de-=V,0>de)V=Math.max(0,D[Pe].g-100),he=!1;else try{oo(Ze,B,"req"+de+"_")}catch(et){v&&v(Ze)}}if(he){v=B.join("&");break e}}}return o=o.i.splice(0,p),l.D=o,v}function fo(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;yr||Aa(),Ut||(yr(),Ut=!0),Vn.add(l,o),o.v=0}}function Ui(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=qn(R(o.Fa,o),mo(o,o.v)),o.v++,!0)}n.Fa=function(){if(this.u=null,po(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=qn(R(this.ab,this),o)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Je(10),er(this),po(this))};function Bi(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function po(o){o.g=new qt(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=Rt(o.qa);Ie(l,"RID","rpc"),Ie(l,"SID",o.K),Ie(l,"AID",o.T),Ie(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&Ie(l,"TO",o.ja),Ie(l,"TYPE","xmlhttp"),tr(o,l),o.m&&o.o&&Xn(l,o.m,o.o),o.L&&(o.g.I=o.L);var p=o.g;o=o.ia,p.L=1,p.v=Ni(Rt(l)),p.m=null,p.P=!0,Ci(p,o)}n.Za=function(){this.C!=null&&(this.C=null,er(this),Ui(this),Je(19))};function hn(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Xe(o,l){var p=null;if(o.g==l){hn(o),Bi(o),o.g=null;var v=2}else if(ro(o.h,l))p=l.D,mt(o.h,l),v=1;else return;if(o.G!=0){if(l.o)if(v==1){p=l.m?l.m.length:0,l=Date.now()-l.F;var D=o.B;v=Si(),We(v,new vr(v,p)),Or(o)}else fo(o);else if(D=l.s,D==3||D==0&&0<l.X||!(v==1&&Fi(o,l)||v==2&&Ui(o)))switch(p&&0<p.length&&(l=o.h,l.i=l.i.concat(p)),D){case 1:Gt(o,5);break;case 4:Gt(o,10);break;case 3:Gt(o,6);break;default:Gt(o,2)}}}function mo(o,l){let p=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(p*=2),p*l}function Gt(o,l){if(o.j.info("Error code "+l),l==2){var p=R(o.fb,o),v=o.Xa;let D=!v;v=new gt(v||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Nr(v,"https"),Ni(v),D?za(v.toString(),p):xr(v.toString(),p)}else Je(2);o.G=0,o.l&&o.l.sa(l),dn(o),Mi(o)}n.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Je(2)):(this.j.info("Failed to ping google.com"),Je(1))};function dn(o){if(o.G=0,o.ka=[],o.l){let l=Hn(o.h);(l.length!=0||o.i.length!=0)&&(O(o.ka,l),O(o.ka,o.i),o.h.i.length=0,U(o.i),o.i.length=0),o.l.ra()}}function a(o,l,p){var v=p instanceof gt?Rt(p):new gt(p);if(v.g!="")l&&(v.g=l+"."+v.g),ki(v,v.s);else{var D=u.location;v=D.protocol,l=l?l+"."+D.hostname:D.hostname,D=+D.port;var V=new gt(null);v&&Nr(V,v),l&&(V.g=l),D&&ki(V,D),p&&(V.l=p),v=V}return p=o.D,l=o.ya,p&&l&&Ie(v,p,l),Ie(v,"VER",o.la),tr(o,v),v}function h(o,l,p){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new pe(new ye({eb:p})):new pe(o.pa),l.Ha(o.J),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function m(){}n=m.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function A(){}A.prototype.g=function(o,l){return new C(o,l)};function C(o,l){$e.call(this),this.g=new lo(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!K(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!K(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new J(this)}x(C,$e),C.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},C.prototype.close=function(){Li(this.g)},C.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var p={};p.__data__=o,o=p}else this.u&&(p={},p.__data__=Tr(o),o=p);l.i.push(new Zs(l.Ya++,o)),l.G==3&&Or(l)},C.prototype.N=function(){this.g.l=null,delete this.j,Li(this.g),delete this.g,C.aa.N.call(this)};function N(o){je.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(let p in l){o=p;break e}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}x(N,je);function q(){bi.call(this),this.status=1}x(q,bi);function J(o){this.g=o}x(J,m),J.prototype.ua=function(){We(this.g,"a")},J.prototype.ta=function(o){We(this.g,new N(o))},J.prototype.sa=function(o){We(this.g,new q)},J.prototype.ra=function(){We(this.g,"b")},A.prototype.createWebChannel=A.prototype.g,C.prototype.send=C.prototype.o,C.prototype.open=C.prototype.m,C.prototype.close=C.prototype.close,Eh=yn.createWebChannelTransport=function(){return new A},Ih=yn.getStatEventTarget=function(){return Si()},yh=yn.Event=pt,Pc=yn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},br.NO_ERROR=0,br.TIMEOUT=8,br.HTTP_ERROR=6,No=yn.ErrorCode=br,Ri.COMPLETE="complete",_h=yn.EventType=Ri,Fn.EventType=Un,Un.OPEN="a",Un.CLOSE="b",Un.ERROR="c",Un.MESSAGE="d",$e.prototype.listen=$e.prototype.K,Hi=yn.WebChannel=Fn,Db=yn.FetchXmlHttpFactory=ye,pe.prototype.listenOnce=pe.prototype.L,pe.prototype.getLastError=pe.prototype.Ka,pe.prototype.getLastErrorCode=pe.prototype.Ba,pe.prototype.getStatus=pe.prototype.Z,pe.prototype.getResponseJson=pe.prototype.Oa,pe.prototype.getResponseText=pe.prototype.oa,pe.prototype.send=pe.prototype.ea,pe.prototype.setWithCredentials=pe.prototype.Ha,gh=yn.XhrIo=pe}).apply(typeof Rc<"u"?Rc:typeof self<"u"?self:typeof window<"u"?window:{});var jg="@firebase/firestore",zg="4.8.0";var rt=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};rt.UNAUTHENTICATED=new rt(null),rt.GOOGLE_CREDENTIALS=new rt("google-credentials-uid"),rt.FIRST_PARTY=new rt("first-party-uid"),rt.MOCK_USER=new rt("mock-user");var Is="11.10.0";var Yr=new Ki("@firebase/firestore");function Qi(){return Yr.logLevel}function j(n,...e){if(Yr.logLevel<=oe.DEBUG){let t=e.map(sf);Yr.debug(`Firestore (${Is}): ${n}`,...t)}}function wn(n,...e){if(Yr.logLevel<=oe.ERROR){let t=e.map(sf);Yr.error(`Firestore (${Is}): ${n}`,...t)}}function Xr(n,...e){if(Yr.logLevel<=oe.WARN){let t=e.map(sf);Yr.warn(`Firestore (${Is}): ${n}`,...t)}}function sf(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch(e){return n}}function X(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,x_(n,r,t)}function x_(n,e,t){let r=`FIRESTORE (${Is}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch(i){r+=" CONTEXT: "+t}throw wn(r),new Error(r)}function ve(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||x_(e,i,r)}function ce(n,e){return n}var $={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},H=class extends mn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ur=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Rh=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Ph=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(rt.UNAUTHENTICATED))}shutdown(){}};var Ch=class{constructor(e){this.t=e,this.currentUser=rt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ve(this.o===void 0,42304);let r=this.i,i=d=>this.i!==r?(r=this.i,t(d)):Promise.resolve(),s=new ur;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ur,e.enqueueRetryable(()=>i(this.currentUser))};let c=()=>{let d=s;e.enqueueRetryable(()=>P(this,null,function*(){yield d.promise,yield i(this.currentUser)}))},u=d=>{j("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit(d=>u(d)),setTimeout(()=>{if(!this.auth){let d=this.t.getImmediate({optional:!0});d?u(d):(j("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ur)}},0),c()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(j("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ve(typeof r.accessToken=="string",31837,{l:r}),new Rh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return ve(e===null||typeof e=="string",2055,{h:e}),new rt(e)}},Dh=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=rt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},kh=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Dh(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(rt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},xc=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Nh=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ig(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ve(this.o===void 0,3512);let r=s=>{s.error!=null&&j("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let c=s.token!==this.m;return this.m=s.token,j("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{j("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):j("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new xc(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ve(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new xc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function kb(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function O_(){return new TextEncoder}var Oc=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=kb(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function re(n,e){return n<e?-1:n>e?1:0}function Vh(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return re(r,i);{let s=O_(),c=Nb(s.encode(Gg(n,t)),s.encode(Gg(e,t)));return c!==0?c:re(r,i)}}t+=r>65535?2:1}return re(n.length,e.length)}function Gg(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function Nb(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return re(n[t],e[t]);return re(n.length,e.length)}function as(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var Kg="__name__",Lc=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&X(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&X(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return re(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Vh(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return _n.fromString(e.substring(4,e.length-2))}},ze=class n extends Lc{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new H($.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},Vb=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Mt=class n extends Lc{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return Vb.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Kg}static keyField(){return new n([Kg])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new H($.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},c=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new H($.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let d=e[i+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new H($.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else u==="`"?(c=!c,i++):u!=="."||c?(r+=u,i++):(s(),i++)}if(s(),c)throw new H($.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var Y=class n{constructor(e){this.path=e}static fromPath(e){return new n(ze.fromString(e))}static fromName(e){return new n(ze.fromString(e).popFirst(5))}static empty(){return new n(ze.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ze.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ze.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ze(e.slice()))}};function xb(n,e,t,r){if(e===!0&&r===!0)throw new H($.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Ob(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Lb(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":X(12329,{type:typeof n})}function wh(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new H($.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Lb(n);throw new H($.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function xe(n,e){let t={typeString:n};return e&&(t.value=e),t}function Xo(n,e){if(!Ob(n))throw new H($.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let c=n[r];if(i&&typeof c!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&c!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new H($.INVALID_ARGUMENT,t);return!0}var Wg=-62135596800,Hg=1e6,ut=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Hg);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new H($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new H($.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Wg)throw new H($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new H($.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Hg}_compareTo(e){return this.seconds===e.seconds?re(this.nanoseconds,e.nanoseconds):re(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Xo(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Wg;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ut._jsonSchemaVersion="firestore/timestamp/1.0",ut._jsonSchema={type:xe("string",ut._jsonSchemaVersion),seconds:xe("number"),nanoseconds:xe("number")};var Z=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new ut(0,0))}static max(){return new n(new ut(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Uo=-1,xh=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};xh.UNKNOWN_ID=-1;function Mb(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Z.fromTimestamp(r===1e9?new ut(t+1,0):new ut(t,r));return new Zr(i,Y.empty(),e)}function Fb(n){return new Zr(n.readTime,n.key,Uo)}var Zr=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(Z.min(),Y.empty(),Uo)}static max(){return new n(Z.max(),Y.empty(),Uo)}};function Ub(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Y.comparator(n.documentKey,e.documentKey),t!==0?t:re(n.largestBatchId,e.largestBatchId))}var Bb="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Oh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function cu(n){return P(this,null,function*(){if(n.code!==$.FAILED_PRECONDITION||n.message!==Bb)throw n;j("LocalStore","Unexpectedly lost primary lease")})}var M=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&X(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,c=!1;e.forEach(u=>{++i,u.next(()=>{++s,c&&s===i&&t()},d=>r(d))}),c=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,c=new Array(s),u=0;for(let d=0;d<s;d++){let f=d;t(e[f]).next(I=>{c[f]=I,++u,u===s&&r(c)},I=>i(I))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function qb(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Es(n){return n.name==="IndexedDbTransactionError"}var of=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}n.ue=-1;return n})(),$b=-1;function uu(n){return n==null}function Mc(n){return n===0&&1/n==-1/0}var L_="";function jb(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Qg(e)),e=zb(n.get(t),e);return Qg(e)}function zb(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case L_:t+="";break;default:t+=s}}return t}function Qg(n){return n+L_+""}var Gb="remoteDocuments",M_="owner";var F_="mutationQueues";var U_="mutations";var B_="documentMutations",Kb="remoteDocumentsV14";var q_="remoteDocumentGlobal";var $_="targets";var j_="targetDocuments";var z_="targetGlobal",G_="collectionParents";var K_="clientMetadata";var W_="bundles";var H_="namedQueries";var Wb="indexConfiguration";var Hb="indexState";var Qb="indexEntries";var Q_="documentOverlays";var Jb="globals";var Yb=[F_,U_,B_,Gb,$_,M_,z_,j_,K_,q_,G_,W_,H_],MD=[...Yb,Q_],Xb=[F_,U_,B_,Kb,$_,M_,z_,j_,K_,q_,G_,W_,H_,Q_],Zb=Xb,eS=[...Zb,Wb,Hb,Qb];var FD=[...eS,Jb];function Jg(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Zo(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function tS(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var De=class n{constructor(e,t){this.comparator=e,this.root=t||Jt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Jt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Jt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Zi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Zi(this.root,e,this.comparator,!1)}getReverseIterator(){return new Zi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Zi(this.root,e,this.comparator,!0)}},Zi=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Jt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw X(43730,{key:this.key,value:this.value});if(this.right.isRed())throw X(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw X(27949);return e+(this.isRed()?0:1)}};Jt.EMPTY=null,Jt.RED=!0,Jt.BLACK=!1;Jt.EMPTY=new class{constructor(){this.size=0}get key(){throw X(57766)}get value(){throw X(16141)}get color(){throw X(16727)}get left(){throw X(29726)}get right(){throw X(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new Jt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var He=class n{constructor(e){this.comparator=e,this.data=new De(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Fc(this.data.getIterator())}getIteratorFrom(e){return new Fc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Fc=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Kr=class n{constructor(e){this.fields=e,e.sort(Mt.comparator)}static empty(){return new n([])}unionWith(e){let t=new He(Mt.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return as(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Uc=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var it=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Uc("Invalid base64 string: "+s):s}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let s="";for(let c=0;c<i.length;++c)s+=String.fromCharCode(i[c]);return s})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return re(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};it.EMPTY_BYTE_STRING=new it("");var nS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tn(n){if(ve(!!n,39018),typeof n=="string"){let e=0,t=nS.exec(n);if(ve(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Te(n.seconds),nanos:Te(n.nanos)}}function Te(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function vn(n){return typeof n=="string"?it.fromBase64String(n):it.fromUint8Array(n)}var J_="server_timestamp",Y_="__type__",X_="__previous_value__",Z_="__local_write_time__";function af(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Y_])===null||t===void 0?void 0:t.stringValue)===J_}function lu(n){let e=n.mapValue.fields[X_];return af(e)?lu(e):e}function Bo(n){let e=Tn(n.mapValue.fields[Z_].timestampValue);return new ut(e.seconds,e.nanos)}var Lh=class{constructor(e,t,r,i,s,c,u,d,f,I){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=c,this.autoDetectLongPolling=u,this.longPollingOptions=d,this.useFetchStreams=f,this.isUsingEmulator=I}},Mh="(default)",Bc=class n{constructor(e,t){this.projectId=e,this.database=t||Mh}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Mh}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var ey="__type__",ty="__max__",Cc={mapValue:{fields:{__type__:{stringValue:ty}}}},ny="__vector__",qo="value";function lr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?af(n)?4:iy(n)?9007199254740991:ry(n)?10:11:X(28295,{value:n})}function Xt(n,e){if(n===e)return!0;let t=lr(n);if(t!==lr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Bo(n).isEqual(Bo(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let c=Tn(i.timestampValue),u=Tn(s.timestampValue);return c.seconds===u.seconds&&c.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return vn(i.bytesValue).isEqual(vn(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return Te(i.geoPointValue.latitude)===Te(s.geoPointValue.latitude)&&Te(i.geoPointValue.longitude)===Te(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return Te(i.integerValue)===Te(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let c=Te(i.doubleValue),u=Te(s.doubleValue);return c===u?Mc(c)===Mc(u):isNaN(c)&&isNaN(u)}return!1})(n,e);case 9:return as(n.arrayValue.values||[],e.arrayValue.values||[],Xt);case 10:case 11:return(function(i,s){let c=i.mapValue.fields||{},u=s.mapValue.fields||{};if(Jg(c)!==Jg(u))return!1;for(let d in c)if(c.hasOwnProperty(d)&&(u[d]===void 0||!Xt(c[d],u[d])))return!1;return!0})(n,e);default:return X(52216,{left:n})}}function $o(n,e){return(n.values||[]).find(t=>Xt(t,e))!==void 0}function cs(n,e){if(n===e)return 0;let t=lr(n),r=lr(e);if(t!==r)return re(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return re(n.booleanValue,e.booleanValue);case 2:return(function(s,c){let u=Te(s.integerValue||s.doubleValue),d=Te(c.integerValue||c.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1})(n,e);case 3:return Yg(n.timestampValue,e.timestampValue);case 4:return Yg(Bo(n),Bo(e));case 5:return Vh(n.stringValue,e.stringValue);case 6:return(function(s,c){let u=vn(s),d=vn(c);return u.compareTo(d)})(n.bytesValue,e.bytesValue);case 7:return(function(s,c){let u=s.split("/"),d=c.split("/");for(let f=0;f<u.length&&f<d.length;f++){let I=re(u[f],d[f]);if(I!==0)return I}return re(u.length,d.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,c){let u=re(Te(s.latitude),Te(c.latitude));return u!==0?u:re(Te(s.longitude),Te(c.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Xg(n.arrayValue,e.arrayValue);case 10:return(function(s,c){var u,d,f,I;let S=s.fields||{},R=c.fields||{},k=(u=S[qo])===null||u===void 0?void 0:u.arrayValue,x=(d=R[qo])===null||d===void 0?void 0:d.arrayValue,U=re(((f=k?.values)===null||f===void 0?void 0:f.length)||0,((I=x?.values)===null||I===void 0?void 0:I.length)||0);return U!==0?U:Xg(k,x)})(n.mapValue,e.mapValue);case 11:return(function(s,c){if(s===Cc.mapValue&&c===Cc.mapValue)return 0;if(s===Cc.mapValue)return 1;if(c===Cc.mapValue)return-1;let u=s.fields||{},d=Object.keys(u),f=c.fields||{},I=Object.keys(f);d.sort(),I.sort();for(let S=0;S<d.length&&S<I.length;++S){let R=Vh(d[S],I[S]);if(R!==0)return R;let k=cs(u[d[S]],f[I[S]]);if(k!==0)return k}return re(d.length,I.length)})(n.mapValue,e.mapValue);default:throw X(23264,{le:t})}}function Yg(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return re(n,e);let t=Tn(n),r=Tn(e),i=re(t.seconds,r.seconds);return i!==0?i:re(t.nanos,r.nanos)}function Xg(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=cs(t[i],r[i]);if(s)return s}return re(t.length,r.length)}function us(n){return Fh(n)}function Fh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=Tn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return vn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return Y.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Fh(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let c of r)s?s=!1:i+=",",i+=`${c}:${Fh(t.fields[c])}`;return i+"}"})(n.mapValue):X(61005,{value:n})}function Nc(n){switch(lr(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=lu(n);return e?16+Nc(e):16;case 5:return 2*n.stringValue.length;case 6:return vn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,s)=>i+Nc(s),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return Zo(r.fields,(s,c)=>{i+=s.length+Nc(c)}),i})(n.mapValue);default:throw X(13486,{value:n})}}function Uh(n){return!!n&&"integerValue"in n}function cf(n){return!!n&&"arrayValue"in n}function Zg(n){return!!n&&"nullValue"in n}function e_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Th(n){return!!n&&"mapValue"in n}function ry(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[ey])===null||t===void 0?void 0:t.stringValue)===ny}function xo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Zo(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=xo(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function iy(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===ty}var BD={mapValue:{fields:{[ey]:{stringValue:ny},[qo]:{arrayValue:{}}}}};var In=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Th(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xo(t)}setAll(e){let t=Mt.emptyPath(),r={},i=[];e.forEach((c,u)=>{if(!t.isImmediateParentOf(u)){let d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=u.popLast()}c?r[u.lastSegment()]=xo(c):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Th(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Th(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Zo(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(xo(this.value))}};var Ft=class n{constructor(e,t,r,i,s,c,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=c,this.documentState=u}static newInvalidDocument(e){return new n(e,0,Z.min(),Z.min(),Z.min(),In.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,Z.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,Z.min(),Z.min(),In.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Z.min(),Z.min(),In.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=In.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=In.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ls=class{constructor(e,t){this.position=e,this.inclusive=t}};function t_(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],c=n.position[i];if(s.field.isKeyField()?r=Y.comparator(Y.fromName(c.referenceValue),t.key):r=cs(c,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function n_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xt(n.position[t],e.position[t]))return!1;return!0}var hs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function rS(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var qc=class{},Ge=class n extends qc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new qh(e,t,r):t==="array-contains"?new zh(e,r):t==="in"?new Gh(e,r):t==="not-in"?new Kh(e,r):t==="array-contains-any"?new Wh(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new $h(e,r):new jh(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(cs(t,this.value)):t!==null&&lr(this.value)===lr(t)&&this.matchesComparison(cs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return X(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Zt=class n extends qc{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return sy(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function sy(n){return n.op==="and"}function oy(n){return iS(n)&&sy(n)}function iS(n){for(let e of n.filters)if(e instanceof Zt)return!1;return!0}function Bh(n){if(n instanceof Ge)return n.field.canonicalString()+n.op.toString()+us(n.value);if(oy(n))return n.filters.map(e=>Bh(e)).join(",");{let e=n.filters.map(t=>Bh(t)).join(",");return`${n.op}(${e})`}}function ay(n,e){return n instanceof Ge?(function(r,i){return i instanceof Ge&&r.op===i.op&&r.field.isEqual(i.field)&&Xt(r.value,i.value)})(n,e):n instanceof Zt?(function(r,i){return i instanceof Zt&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,c,u)=>s&&ay(c,i.filters[u]),!0):!1})(n,e):void X(19439)}function cy(n){return n instanceof Ge?(function(t){return`${t.field.canonicalString()} ${t.op} ${us(t.value)}`})(n):n instanceof Zt?(function(t){return t.op.toString()+" {"+t.getFilters().map(cy).join(" ,")+"}"})(n):"Filter"}var qh=class extends Ge{constructor(e,t,r){super(e,t,r),this.key=Y.fromName(r.referenceValue)}matches(e){let t=Y.comparator(e.key,this.key);return this.matchesComparison(t)}},$h=class extends Ge{constructor(e,t){super(e,"in",t),this.keys=uy("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},jh=class extends Ge{constructor(e,t){super(e,"not-in",t),this.keys=uy("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function uy(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Y.fromName(r.referenceValue))}var zh=class extends Ge{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return cf(t)&&$o(t.arrayValue,this.value)}},Gh=class extends Ge{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&$o(this.value.arrayValue,t)}},Kh=class extends Ge{constructor(e,t){super(e,"not-in",t)}matches(e){if($o(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!$o(this.value.arrayValue,t)}},Wh=class extends Ge{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!cf(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>$o(this.value.arrayValue,r))}};var Hh=class{constructor(e,t=null,r=[],i=[],s=null,c=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=c,this.endAt=u,this.Pe=null}};function r_(n,e=null,t=[],r=[],i=null,s=null,c=null){return new Hh(n,e,t,r,i,s,c)}function uf(n){let e=ce(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Bh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(s){return s.field.canonicalString()+s.dir})(r)).join(","),uu(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>us(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>us(r)).join(",")),e.Pe=t}return e.Pe}function lf(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!rS(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!ay(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!n_(n.startAt,e.startAt)&&n_(n.endAt,e.endAt)}function Qh(n){return Y.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var ds=class{constructor(e,t=null,r=[],i=[],s=null,c="F",u=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=c,this.startAt=u,this.endAt=d,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function sS(n,e,t,r,i,s,c,u){return new ds(n,e,t,r,i,s,c,u)}function hf(n){return new ds(n)}function i_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function oS(n){return n.collectionGroup!==null}function Oo(n){let e=ce(n);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let u=new He(Mt.comparator);return c.filters.forEach(d=>{d.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new hs(s,r))}),t.has(Mt.keyField().canonicalString())||e.Te.push(new hs(Mt.keyField(),r))}return e.Te}function Yt(n){let e=ce(n);return e.Ie||(e.Ie=aS(e,Oo(n))),e.Ie}function aS(n,e){if(n.limitType==="F")return r_(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new hs(i.field,s)});let t=n.endAt?new ls(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ls(n.startAt.position,n.startAt.inclusive):null;return r_(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Jh(n,e,t){return new ds(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function hu(n,e){return lf(Yt(n),Yt(e))&&n.limitType===e.limitType}function ly(n){return`${uf(Yt(n))}|lt:${n.limitType}`}function Ji(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>cy(i)).join(", ")}]`),uu(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(c){return`${c.field.canonicalString()} (${c.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>us(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>us(i)).join(",")),`Target(${r})`})(Yt(n))}; limitType=${n.limitType})`}function du(n,e){return e.isFoundDocument()&&(function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Y.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(let s of Oo(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(c,u,d){let f=t_(c,u,d);return c.inclusive?f<=0:f<0})(r.startAt,Oo(r),i)||r.endAt&&!(function(c,u,d){let f=t_(c,u,d);return c.inclusive?f>=0:f>0})(r.endAt,Oo(r),i))})(n,e)}function cS(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function hy(n){return(e,t)=>{let r=!1;for(let i of Oo(n)){let s=uS(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function uS(n,e,t){let r=n.field.isKeyField()?Y.comparator(e.key,t.key):(function(s,c,u){let d=c.data.field(s),f=u.data.field(s);return d!==null&&f!==null?cs(d,f):X(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return X(19790,{direction:n.dir})}}var An=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Zo(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return tS(this.inner)}size(){return this.innerSize}};var lS=new De(Y.comparator);function hr(){return lS}var dy=new De(Y.comparator);function Vo(...n){let e=dy;for(let t of n)e=e.insert(t.key,t);return e}function hS(n){let e=dy;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Wr(){return Lo()}function fy(){return Lo()}function Lo(){return new An(n=>n.toString(),(n,e)=>n.isEqual(e))}var qD=new De(Y.comparator),dS=new He(Y.comparator);function le(...n){let e=dS;for(let t of n)e=e.add(t);return e}var fS=new He(re);function pS(){return fS}function mS(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Mc(e)?"-0":e}}function gS(n){return{integerValue:""+n}}var fs=class{constructor(){this._=void 0}};function _S(n,e,t){return n instanceof jo?(function(i,s){let c={fields:{[Y_]:{stringValue:J_},[Z_]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&af(s)&&(s=lu(s)),s&&(c.fields[X_]=s),{mapValue:c}})(t,e):n instanceof ps?py(n,e):n instanceof ms?my(n,e):(function(i,s){let c=IS(i,s),u=s_(c)+s_(i.Ee);return Uh(c)&&Uh(i.Ee)?gS(u):mS(i.serializer,u)})(n,e)}function yS(n,e,t){return n instanceof ps?py(n,e):n instanceof ms?my(n,e):t}function IS(n,e){return n instanceof zo?(function(r){return Uh(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}var jo=class extends fs{},ps=class extends fs{constructor(e){super(),this.elements=e}};function py(n,e){let t=gy(e);for(let r of n.elements)t.some(i=>Xt(i,r))||t.push(r);return{arrayValue:{values:t}}}var ms=class extends fs{constructor(e){super(),this.elements=e}};function my(n,e){let t=gy(e);for(let r of n.elements)t=t.filter(i=>!Xt(i,r));return{arrayValue:{values:t}}}var zo=class extends fs{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function s_(n){return Te(n.integerValue||n.doubleValue)}function gy(n){return cf(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function ES(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof ps&&i instanceof ps||r instanceof ms&&i instanceof ms?as(r.elements,i.elements,Xt):r instanceof zo&&i instanceof zo?Xt(r.Ee,i.Ee):r instanceof jo&&i instanceof jo})(n.transform,e.transform)}var Mo=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Vc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Go=class{};function _y(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Yh(n.key,Mo.none()):new Ko(n.key,n.data,Mo.none());{let t=n.data,r=In.empty(),i=new He(Mt.comparator);for(let s of e.fields)if(!i.has(s)){let c=t.field(s);c===null&&s.length>1&&(s=s.popLast(),c=t.field(s)),c===null?r.delete(s):r.set(s,c),i=i.add(s)}return new gs(n.key,r,new Kr(i.toArray()),Mo.none())}}function wS(n,e,t){n instanceof Ko?(function(i,s,c){let u=i.value.clone(),d=a_(i.fieldTransforms,s,c.transformResults);u.setAll(d),s.convertToFoundDocument(c.version,u).setHasCommittedMutations()})(n,e,t):n instanceof gs?(function(i,s,c){if(!Vc(i.precondition,s))return void s.convertToUnknownDocument(c.version);let u=a_(i.fieldTransforms,s,c.transformResults),d=s.data;d.setAll(yy(i)),d.setAll(u),s.convertToFoundDocument(c.version,d).setHasCommittedMutations()})(n,e,t):(function(i,s,c){s.convertToNoDocument(c.version).setHasCommittedMutations()})(0,e,t)}function Fo(n,e,t,r){return n instanceof Ko?(function(s,c,u,d){if(!Vc(s.precondition,c))return u;let f=s.value.clone(),I=c_(s.fieldTransforms,d,c);return f.setAll(I),c.convertToFoundDocument(c.version,f).setHasLocalMutations(),null})(n,e,t,r):n instanceof gs?(function(s,c,u,d){if(!Vc(s.precondition,c))return u;let f=c_(s.fieldTransforms,d,c),I=c.data;return I.setAll(yy(s)),I.setAll(f),c.convertToFoundDocument(c.version,I).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(S=>S.field))})(n,e,t,r):(function(s,c,u){return Vc(s.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):u})(n,e,t)}function o_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&as(r,i,(s,c)=>ES(s,c))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Ko=class extends Go{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},gs=class extends Go{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function yy(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function a_(n,e,t){let r=new Map;ve(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let s=n[i],c=s.transform,u=e.data.field(s.field);r.set(s.field,yS(c,u,t[i]))}return r}function c_(n,e,t){let r=new Map;for(let i of n){let s=i.transform,c=t.data.field(i.field);r.set(i.field,_S(s,c,e))}return r}var Yh=class extends Go{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};var Xh=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&wS(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Fo(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Fo(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=fy();return this.mutations.forEach(i=>{let s=e.get(i.key),c=s.overlayedDocument,u=this.applyToLocalView(c,s.mutatedFields);u=t.has(i.key)?null:u;let d=_y(c,u);d!==null&&r.set(i.key,d),c.isValidDocument()||c.convertToNoDocument(Z.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),le())}isEqual(e){return this.batchId===e.batchId&&as(this.mutations,e.mutations,(t,r)=>o_(t,r))&&as(this.baseMutations,e.baseMutations,(t,r)=>o_(t,r))}};var Zh=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ed=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Ne,ae;function Iy(n){if(n===void 0)return wn("GRPC error has no .code"),$.UNKNOWN;switch(n){case Ne.OK:return $.OK;case Ne.CANCELLED:return $.CANCELLED;case Ne.UNKNOWN:return $.UNKNOWN;case Ne.DEADLINE_EXCEEDED:return $.DEADLINE_EXCEEDED;case Ne.RESOURCE_EXHAUSTED:return $.RESOURCE_EXHAUSTED;case Ne.INTERNAL:return $.INTERNAL;case Ne.UNAVAILABLE:return $.UNAVAILABLE;case Ne.UNAUTHENTICATED:return $.UNAUTHENTICATED;case Ne.INVALID_ARGUMENT:return $.INVALID_ARGUMENT;case Ne.NOT_FOUND:return $.NOT_FOUND;case Ne.ALREADY_EXISTS:return $.ALREADY_EXISTS;case Ne.PERMISSION_DENIED:return $.PERMISSION_DENIED;case Ne.FAILED_PRECONDITION:return $.FAILED_PRECONDITION;case Ne.ABORTED:return $.ABORTED;case Ne.OUT_OF_RANGE:return $.OUT_OF_RANGE;case Ne.UNIMPLEMENTED:return $.UNIMPLEMENTED;case Ne.DATA_LOSS:return $.DATA_LOSS;default:return X(39323,{code:n})}}(ae=Ne||(Ne={}))[ae.OK=0]="OK",ae[ae.CANCELLED=1]="CANCELLED",ae[ae.UNKNOWN=2]="UNKNOWN",ae[ae.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ae[ae.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ae[ae.NOT_FOUND=5]="NOT_FOUND",ae[ae.ALREADY_EXISTS=6]="ALREADY_EXISTS",ae[ae.PERMISSION_DENIED=7]="PERMISSION_DENIED",ae[ae.UNAUTHENTICATED=16]="UNAUTHENTICATED",ae[ae.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ae[ae.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ae[ae.ABORTED=10]="ABORTED",ae[ae.OUT_OF_RANGE=11]="OUT_OF_RANGE",ae[ae.UNIMPLEMENTED=12]="UNIMPLEMENTED",ae[ae.INTERNAL=13]="INTERNAL",ae[ae.UNAVAILABLE=14]="UNAVAILABLE",ae[ae.DATA_LOSS=15]="DATA_LOSS";var u_=null;var TS=new _n([4294967295,4294967295],0);function l_(n){let e=O_().encode(n),t=new mh;return t.update(e),new Uint8Array(t.digest())}function h_(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new _n([t,r],0),new _n([i,s],0)]}var td=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Hr(`Invalid padding: ${t}`);if(r<0)throw new Hr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Hr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Hr(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=_n.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(_n.fromNumber(r)));return i.compare(TS)===1&&(i=new _n([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=l_(e),[r,i]=h_(t);for(let s=0;s<this.hashCount;s++){let c=this.pe(r,i,s);if(!this.ye(c))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),c=new n(s,i,t);return r.forEach(u=>c.insert(u)),c}insert(e){if(this.fe===0)return;let t=l_(e),[r,i]=h_(t);for(let s=0;s<this.hashCount;s++){let c=this.pe(r,i,s);this.we(c)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Hr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var $c=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Wo.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(Z.min(),i,new De(re),hr(),le())}},Wo=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,le(),le(),le())}};var es=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},jc=class{constructor(e,t){this.targetId=e,this.De=t}},zc=class{constructor(e,t,r=it.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Gc=class{constructor(){this.ve=0,this.Ce=d_(),this.Fe=it.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=le(),t=le(),r=le();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:X(38017,{changeType:s})}}),new Wo(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=d_()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,ve(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},nd=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=hr(),this.je=Dc(),this.Je=Dc(),this.He=new De(re)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:X(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let s=i.target;if(Qh(s))if(r===0){let c=new Y(s.path);this.Xe(t,c,Ft.newNoDocument(c,Z.min()))}else ve(r===1,20013,{expectedCount:r});else{let c=this.ot(t);if(c!==r){let u=this._t(e),d=u?this.ut(u,e,c):1;if(d!==0){this.rt(t);let f=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,f)}u_?.ct((function(I,S,R,k,x){var U,O,W,K,Q,ie;let Ae={localCacheCount:I,existenceFilterCount:S.count,databaseId:R.database,projectId:R.projectId},ne=S.unchangedNames;return ne&&(Ae.bloomFilter={applied:x===0,hashCount:(U=ne?.hashCount)!==null&&U!==void 0?U:0,bitmapLength:(K=(W=(O=ne?.bits)===null||O===void 0?void 0:O.bitmap)===null||W===void 0?void 0:W.length)!==null&&K!==void 0?K:0,padding:(ie=(Q=ne?.bits)===null||Q===void 0?void 0:Q.padding)!==null&&ie!==void 0?ie:0,mightContain:T=>{var g;return(g=k?.mightContain(T))!==null&&g!==void 0&&g}}),Ae})(c,e.De,this.We.lt(),u,d))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,c,u;try{c=vn(r).toUint8Array()}catch(d){if(d instanceof Uc)return Xr("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{u=new td(c,i,s)}catch(d){return Xr(d instanceof Hr?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return u.fe===0?null:u}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let c=this.We.lt(),u=`projects/${c.projectId}/databases/${c.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,c)=>{let u=this.st(c);if(u){if(s.current&&Qh(u.target)){let d=new Y(u.target.path);this.Tt(d).has(c)||this.It(c,d)||this.Xe(c,d,Ft.newNoDocument(d,e))}s.Ne&&(t.set(c,s.Le()),s.ke())}});let r=le();this.Je.forEach((s,c)=>{let u=!0;c.forEachWhile(d=>{let f=this.st(d);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(s))}),this.ze.forEach((s,c)=>c.setReadTime(e));let i=new $c(e,t,this.He,this.ze,r);return this.ze=hr(),this.je=Dc(),this.Je=Dc(),this.He=new De(re),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Gc,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new He(re),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new He(re),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||j("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Gc),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function Dc(){return new De(Y.comparator)}function d_(){return new De(Y.comparator)}var vS={asc:"ASCENDING",desc:"DESCENDING"},AS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},bS={and:"AND",or:"OR"},rd=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function id(n,e){return n.useProto3Json||uu(e)?e:{value:e}}function SS(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function RS(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function ts(n){return ve(!!n,49232),Z.fromTimestamp((function(t){let r=Tn(t);return new ut(r.seconds,r.nanos)})(n))}function PS(n,e){return sd(n,e).canonicalString()}function sd(n,e){let t=(function(i){return new ze(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Ey(n){let e=ze.fromString(n);return ve(by(e),10190,{key:e.toString()}),e}function vh(n,e){let t=Ey(e);if(t.get(1)!==n.databaseId.projectId)throw new H($.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new H($.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Y(Ty(t))}function wy(n,e){return PS(n.databaseId,e)}function CS(n){let e=Ey(n);return e.length===4?ze.emptyPath():Ty(e)}function f_(n){return new ze(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ty(n){return ve(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function DS(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:X(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(f,I){return f.useProto3Json?(ve(I===void 0||typeof I=="string",58123),it.fromBase64String(I||"")):(ve(I===void 0||I instanceof Buffer||I instanceof Uint8Array,16193),it.fromUint8Array(I||new Uint8Array))})(n,e.targetChange.resumeToken),c=e.targetChange.cause,u=c&&(function(f){let I=f.code===void 0?$.UNKNOWN:Iy(f.code);return new H(I,f.message||"")})(c);t=new zc(r,i,s,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=vh(n,r.document.name),s=ts(r.document.updateTime),c=r.document.createTime?ts(r.document.createTime):Z.min(),u=new In({mapValue:{fields:r.document.fields}}),d=Ft.newFoundDocument(i,s,c,u),f=r.targetIds||[],I=r.removedTargetIds||[];t=new es(f,I,d.key,d)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=vh(n,r.document),s=r.readTime?ts(r.readTime):Z.min(),c=Ft.newNoDocument(i,s),u=r.removedTargetIds||[];t=new es([],u,c.key,c)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=vh(n,r.document),s=r.removedTargetIds||[];t=new es([],s,i,null)}else{if(!("filter"in e))return X(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,c=new ed(i,s),u=r.targetId;t=new jc(u,c)}}return t}function kS(n,e){return{documents:[wy(n,e.path)]}}function NS(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=wy(n,i);let s=(function(f){if(f.length!==0)return Ay(Zt.create(f,"and"))})(e.filters);s&&(t.structuredQuery.where=s);let c=(function(f){if(f.length!==0)return f.map(I=>(function(R){return{field:Yi(R.field),direction:OS(R.dir)}})(I))})(e.orderBy);c&&(t.structuredQuery.orderBy=c);let u=id(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{Vt:t,parent:i}}function VS(n){let e=CS(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){ve(r===1,65062);let I=t.from[0];I.allDescendants?i=I.collectionId:e=e.child(I.collectionId)}let s=[];t.where&&(s=(function(S){let R=vy(S);return R instanceof Zt&&oy(R)?R.getFilters():[R]})(t.where));let c=[];t.orderBy&&(c=(function(S){return S.map(R=>(function(x){return new hs(Xi(x.field),(function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(x.direction))})(R))})(t.orderBy));let u=null;t.limit&&(u=(function(S){let R;return R=typeof S=="object"?S.value:S,uu(R)?null:R})(t.limit));let d=null;t.startAt&&(d=(function(S){let R=!!S.before,k=S.values||[];return new ls(k,R)})(t.startAt));let f=null;return t.endAt&&(f=(function(S){let R=!S.before,k=S.values||[];return new ls(k,R)})(t.endAt)),sS(e,i,c,s,u,"F",d,f)}function xS(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return X(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function vy(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Xi(t.unaryFilter.field);return Ge.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Xi(t.unaryFilter.field);return Ge.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Xi(t.unaryFilter.field);return Ge.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let c=Xi(t.unaryFilter.field);return Ge.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return X(61313);default:return X(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Ge.create(Xi(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return X(58110);default:return X(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Zt.create(t.compositeFilter.filters.map(r=>vy(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return X(1026)}})(t.compositeFilter.op))})(n):X(30097,{filter:n})}function OS(n){return vS[n]}function LS(n){return AS[n]}function MS(n){return bS[n]}function Yi(n){return{fieldPath:n.canonicalString()}}function Xi(n){return Mt.fromServerFormat(n.fieldPath)}function Ay(n){return n instanceof Ge?(function(t){if(t.op==="=="){if(e_(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NAN"}};if(Zg(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(e_(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NOT_NAN"}};if(Zg(t.value))return{unaryFilter:{field:Yi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yi(t.field),op:LS(t.op),value:t.value}}})(n):n instanceof Zt?(function(t){let r=t.getFilters().map(i=>Ay(i));return r.length===1?r[0]:{compositeFilter:{op:MS(t.op),filters:r}}})(n):X(54877,{filter:n})}function by(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ho=class n{constructor(e,t,r,i,s=Z.min(),c=Z.min(),u=it.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=u,this.expectedCount=d}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var od=class{constructor(e){this.gt=e}};function FS(n){let e=VS({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Jh(e,e.limit,"L"):e}var Kc=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(Te(e.integerValue));else if("doubleValue"in e){let r=Te(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),Mc(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=Tn(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(vn(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?iy(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):ry(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):X(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let s=e.fields||{};this.Ct(t,53);let c=qo,u=((i=(r=s[c].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(Te(u)),this.xt(c,t),this.Dt(s[c],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),Y.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};Kc.Ut=new Kc;var ad=class{constructor(){this.Dn=new cd}addToCollectionParentIndex(e,t){return this.Dn.add(t),M.resolve()}getCollectionParents(e,t){return M.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return M.resolve()}deleteFieldIndex(e,t){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,t){return M.resolve()}getDocumentsMatchingTarget(e,t){return M.resolve(null)}getIndexType(e,t){return M.resolve(0)}getFieldIndexes(e,t){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,t){return M.resolve(Zr.min())}getMinOffsetFromCollectionGroup(e,t){return M.resolve(Zr.min())}updateCollectionGroup(e,t,r){return M.resolve()}updateIndexEntries(e,t){return M.resolve()}},cd=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new He(ze.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new He(ze.comparator)).toArray()}};var $D=new Uint8Array(0);var p_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Sy=41943040,vt=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};vt.DEFAULT_COLLECTION_PERCENTILE=10,vt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,vt.DEFAULT=new vt(Sy,vt.DEFAULT_COLLECTION_PERCENTILE,vt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),vt.DISABLED=new vt(-1,0,0);var Qo=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var m_="LruGarbageCollector",US=1048576;function g_([n,e],[t,r]){let i=re(n,t);return i===0?re(e,r):i}var ud=class{constructor(e){this.Tr=e,this.buffer=new He(g_),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();g_(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},ld=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){j(m_,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>P(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Es(t)?j(m_,"Ignoring IndexedDB error during garbage collection: ",t):yield cu(t)}yield this.Rr(3e5)}))}},hd=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return M.resolve(of.ue);let r=new ud(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(j("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve(p_)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(j("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),p_):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,c,u,d,f,I=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(S=>(S>this.params.maximumSequenceNumbersToCollect?(j("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${S}`),i=this.params.maximumSequenceNumbersToCollect):i=S,c=Date.now(),this.nthSequenceNumber(e,i))).next(S=>(r=S,u=Date.now(),this.removeTargets(e,r,t))).next(S=>(s=S,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(S=>(f=Date.now(),Qi()<=oe.DEBUG&&j("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-I}ms
	Determined least recently used ${i} in `+(u-c)+`ms
	Removed ${s} targets in `+(d-u)+`ms
	Removed ${S} documents in `+(f-d)+`ms
Total Duration: ${f-I}ms`),M.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:S})))}};function BS(n,e){return new hd(n,e)}var dd=class{constructor(){this.changes=new An(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ft.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?M.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var fd=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var pd=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Fo(r.mutation,i,Kr.empty(),ut.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,le()).next(()=>r))}getLocalViewOfDocuments(e,t,r=le()){let i=Wr();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let c=Vo();return s.forEach((u,d)=>{c=c.insert(u,d.overlayedDocument)}),c}))}getOverlayedDocuments(e,t){let r=Wr();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,le()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((c,u)=>{t.set(c,u)})})}computeViews(e,t,r,i){let s=hr(),c=Lo(),u=(function(){return Lo()})();return t.forEach((d,f)=>{let I=r.get(f.key);i.has(f.key)&&(I===void 0||I.mutation instanceof gs)?s=s.insert(f.key,f):I!==void 0?(c.set(f.key,I.mutation.getFieldMask()),Fo(I.mutation,f,I.mutation.getFieldMask(),ut.now())):c.set(f.key,Kr.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((f,I)=>c.set(f,I)),t.forEach((f,I)=>{var S;return u.set(f,new fd(I,(S=c.get(f))!==null&&S!==void 0?S:null))}),u))}recalculateAndSaveOverlays(e,t){let r=Lo(),i=new De((c,u)=>c-u),s=le();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(c=>{for(let u of c)u.keys().forEach(d=>{let f=t.get(d);if(f===null)return;let I=r.get(d)||Kr.empty();I=u.applyToLocalView(f,I),r.set(d,I);let S=(i.get(u.batchId)||le()).add(d);i=i.insert(u.batchId,S)})}).next(()=>{let c=[],u=i.getReverseIterator();for(;u.hasNext();){let d=u.getNext(),f=d.key,I=d.value,S=fy();I.forEach(R=>{if(!s.has(R)){let k=_y(t.get(R),r.get(R));k!==null&&S.set(R,k),s=s.add(R)}}),c.push(this.documentOverlayCache.saveOverlays(e,f,S))}return M.waitFor(c)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return(function(c){return Y.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):oS(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let c=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):M.resolve(Wr()),u=Uo,d=s;return c.next(f=>M.forEach(f,(I,S)=>(u<S.largestBatchId&&(u=S.largestBatchId),s.get(I)?M.resolve():this.remoteDocumentCache.getEntry(e,I).next(R=>{d=d.insert(I,R)}))).next(()=>this.populateOverlays(e,f,s)).next(()=>this.computeViews(e,d,f,le())).next(I=>({batchId:u,changes:hS(I)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Y(t)).next(r=>{let i=Vo();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,c=Vo();return this.indexManager.getCollectionParents(e,s).next(u=>M.forEach(u,d=>{let f=(function(S,R){return new ds(R,null,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,S.startAt,S.endAt)})(t,d.child(s));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next(I=>{I.forEach((S,R)=>{c=c.insert(S,R)})})}).next(()=>c))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(c=>(s=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(c=>{s.forEach((d,f)=>{let I=f.getKey();c.get(I)===null&&(c=c.insert(I,Ft.newInvalidDocument(I)))});let u=Vo();return c.forEach((d,f)=>{let I=s.get(d);I!==void 0&&Fo(I.mutation,f,Kr.empty(),ut.now()),du(t,f)&&(u=u.insert(d,f))}),u})}};var md=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return M.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:ts(i.createTime)}})(t)),M.resolve()}getNamedQuery(e,t){return M.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(i){return{name:i.name,query:FS(i.bundledQuery),readTime:ts(i.readTime)}})(t)),M.resolve()}};var gd=class{constructor(){this.overlays=new De(Y.comparator),this.kr=new Map}getOverlay(e,t){return M.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Wr();return M.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),M.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),M.resolve()}getOverlaysForCollection(e,t,r){let i=Wr(),s=t.length+1,c=new Y(t.child("")),u=this.overlays.getIteratorFrom(c);for(;u.hasNext();){let d=u.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return M.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new De((f,I)=>f-I),c=this.overlays.getIterator();for(;c.hasNext();){let f=c.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let I=s.get(f.largestBatchId);I===null&&(I=Wr(),s=s.insert(f.largestBatchId,I)),I.set(f.getKey(),f)}}let u=Wr(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((f,I)=>u.set(f,I)),!(u.size()>=i)););return M.resolve(u)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let c=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,c)}this.overlays=this.overlays.insert(r.key,new Zh(t,r));let s=this.kr.get(t);s===void 0&&(s=le(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}};var _d=class{constructor(){this.sessionToken=it.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,M.resolve()}};var Jo=class{constructor(){this.qr=new He(Ve.Qr),this.$r=new He(Ve.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new Ve(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new Ve(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new Y(new ze([])),r=new Ve(t,e),i=new Ve(t,e+1),s=[];return this.$r.forEachInRange([r,i],c=>{this.Wr(c),s.push(c.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new Y(new ze([])),r=new Ve(t,e),i=new Ve(t,e+1),s=le();return this.$r.forEachInRange([r,i],c=>{s=s.add(c.key)}),s}containsKey(e){let t=new Ve(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Ve=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return Y.comparator(e.key,t.key)||re(e.Hr,t.Hr)}static Ur(e,t){return re(e.Hr,t.Hr)||Y.comparator(e.key,t.key)}};var yd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new He(Ve.Qr)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let c=new Xh(s,t,r,i);this.mutationQueue.push(c);for(let u of i)this.Yr=this.Yr.add(new Ve(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return M.resolve(c)}lookupMutationBatch(e,t){return M.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return M.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?$b:this.er-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Ve(t,0),i=new Ve(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],c=>{let u=this.Zr(c.Hr);s.push(u)}),M.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new He(re);return t.forEach(i=>{let s=new Ve(i,0),c=new Ve(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,c],u=>{r=r.add(u.Hr)})}),M.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;Y.isDocumentKey(s)||(s=s.child(""));let c=new Ve(new Y(s),0),u=new He(re);return this.Yr.forEachWhile(d=>{let f=d.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(u=u.add(d.Hr)),!0)},c),M.resolve(this.ei(u))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){ve(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return M.forEach(t.mutations,i=>{let s=new Ve(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new Ve(t,0),i=this.Yr.firstAfterOrEqual(r);return M.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Id=class{constructor(e){this.ni=e,this.docs=(function(){return new De(Y.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,c=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:c}),this.size+=c-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return M.resolve(r?r.document.mutableCopy():Ft.newInvalidDocument(t))}getEntries(e,t){let r=hr();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ft.newInvalidDocument(i))}),M.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=hr(),c=t.path,u=new Y(c.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(u);for(;d.hasNext();){let{key:f,value:{document:I}}=d.getNext();if(!c.isPrefixOf(f.path))break;f.path.length>c.length+1||Ub(Fb(I),r)<=0||(i.has(I.key)||du(t,I))&&(s=s.insert(I.key,I.mutableCopy()))}return M.resolve(s)}getAllFromCollectionGroup(e,t,r,i){X(9500)}ri(e,t){return M.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Ed(this)}getSize(e){return M.resolve(this.size)}},Ed=class extends dd{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),M.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var wd=class{constructor(e){this.persistence=e,this.ii=new An(t=>uf(t),lf),this.lastRemoteSnapshotVersion=Z.min(),this.highestTargetId=0,this.si=0,this.oi=new Jo,this.targetCount=0,this._i=Qo.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),M.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new Qo(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,M.resolve()}updateTargetData(e,t){return this.hr(t),M.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ii.forEach((c,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ii.delete(c),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),M.waitFor(s).next(()=>i)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return M.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),M.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(c=>{s.push(i.markPotentiallyOrphaned(e,c))}),M.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),M.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return M.resolve(r)}containsKey(e,t){return M.resolve(this.oi.containsKey(t))}};var Wc=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new of(0),this.ci=!1,this.ci=!0,this.li=new _d,this.referenceDelegate=e(this),this.hi=new wd(this),this.indexManager=new ad,this.remoteDocumentCache=(function(i){return new Id(i)})(r=>this.referenceDelegate.Pi(r)),this.serializer=new od(t),this.Ti=new md(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new gd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new yd(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){j("MemoryPersistence","Starting transaction:",e);let i=new Td(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return M.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},Td=class extends Oh{constructor(e){super(),this.currentSequenceNumber=e}},vd=class n{constructor(e){this.persistence=e,this.Ai=new Jo,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw X(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),M.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),M.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),M.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.mi,r=>{let i=Y.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,Z.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return M.or([()=>M.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},Hc=class n{constructor(e,t){this.persistence=e,this.gi=new An(r=>jb(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=BS(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return M.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return M.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?M.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,c=>this.Sr(e,c,t).next(u=>{u||(r++,s.removeEntry(c,Z.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),M.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),M.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),M.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),M.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Nc(e.data.value)),t}Sr(e,t,r){return M.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return M.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Ad=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=le(),i=le();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var bd=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Sd=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return lg()?8:qb(ug())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ps(e,t).next(c=>{s.result=c}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(c=>{s.result=c})}).next(()=>{if(s.result)return;let c=new bd;return this.ws(e,t,c).next(u=>{if(s.result=u,this.Rs)return this.Ss(e,t,c,u.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(Qi()<=oe.DEBUG&&j("QueryEngine","SDK will not create cache indexes for query:",Ji(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),M.resolve()):(Qi()<=oe.DEBUG&&j("QueryEngine","Query:",Ji(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Qi()<=oe.DEBUG&&j("QueryEngine","The SDK decides to create cache indexes for query:",Ji(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Yt(t))):M.resolve())}ps(e,t){if(i_(t))return M.resolve(null);let r=Yt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Jh(t,null,"F"),r=Yt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let c=le(...s);return this.gs.getDocuments(e,c).next(u=>this.indexManager.getMinOffset(e,r).next(d=>{let f=this.bs(t,u);return this.Ds(t,f,c,d.readTime)?this.ps(e,Jh(t,null,"F")):this.vs(e,f,t,d)}))})))}ys(e,t,r,i){return i_(t)||i.isEqual(Z.min())?M.resolve(null):this.gs.getDocuments(e,r).next(s=>{let c=this.bs(t,s);return this.Ds(t,c,r,i)?M.resolve(null):(Qi()<=oe.DEBUG&&j("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ji(t)),this.vs(e,c,t,Mb(i,Uo)).next(u=>u))})}bs(e,t){let r=new He(hy(e));return t.forEach((i,s)=>{du(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return Qi()<=oe.DEBUG&&j("QueryEngine","Using full collection scan to execute query:",Ji(t)),this.gs.getDocumentsMatchingQuery(e,t,Zr.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(c=>{s=s.insert(c.key,c)}),s))}};var df="LocalStore",qS=3e8,Rd=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new De(re),this.Ms=new An(s=>uf(s),lf),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new pd(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function $S(n,e,t,r){return new Rd(n,e,t,r)}function Ry(n,e){return P(this,null,function*(){let t=ce(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let c=[],u=[],d=le();for(let f of i){c.push(f.batchId);for(let I of f.mutations)d=d.add(I.key)}for(let f of s){u.push(f.batchId);for(let I of f.mutations)d=d.add(I.key)}return t.localDocuments.getDocuments(r,d).next(f=>({Bs:f,removedBatchIds:c,addedBatchIds:u}))})})})}function Py(n){let e=ce(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function jS(n,e){let t=ce(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let c=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let u=[];e.targetChanges.forEach((I,S)=>{let R=i.get(S);if(!R)return;u.push(t.hi.removeMatchingKeys(s,I.removedDocuments,S).next(()=>t.hi.addMatchingKeys(s,I.addedDocuments,S)));let k=R.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(S)!==null?k=k.withResumeToken(it.EMPTY_BYTE_STRING,Z.min()).withLastLimboFreeSnapshotVersion(Z.min()):I.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(I.resumeToken,r)),i=i.insert(S,k),(function(U,O,W){return U.resumeToken.approximateByteSize()===0||O.snapshotVersion.toMicroseconds()-U.snapshotVersion.toMicroseconds()>=qS?!0:W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0})(R,k,I)&&u.push(t.hi.updateTargetData(s,k))});let d=hr(),f=le();if(e.documentUpdates.forEach(I=>{e.resolvedLimboDocuments.has(I)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,I))}),u.push(zS(s,c,e.documentUpdates).next(I=>{d=I.Ls,f=I.ks})),!r.isEqual(Z.min())){let I=t.hi.getLastRemoteSnapshotVersion(s).next(S=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));u.push(I)}return M.waitFor(u).next(()=>c.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,f)).next(()=>d)}).then(s=>(t.Fs=i,s))}function zS(n,e,t){let r=le(),i=le();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let c=hr();return t.forEach((u,d)=>{let f=s.get(u);d.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(u)),d.isNoDocument()&&d.version.isEqual(Z.min())?(e.removeEntry(u,d.readTime),c=c.insert(u,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||d.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(d),c=c.insert(u,d)):j(df,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",d.version)}),{Ls:c,ks:i}})}function GS(n,e){let t=ce(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,M.resolve(i)):t.hi.allocateTargetId(r).next(c=>(i=new Ho(e,c,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}function Pd(n,e,t){return P(this,null,function*(){let r=ce(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,c=>r.persistence.referenceDelegate.removeTarget(c,i)))}catch(c){if(!Es(c))throw c;j(df,`Failed to update sequence numbers for target ${e}: ${c}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)})}function __(n,e,t){let r=ce(n),i=Z.min(),s=le();return r.persistence.runTransaction("Execute query","readwrite",c=>(function(d,f,I){let S=ce(d),R=S.Ms.get(I);return R!==void 0?M.resolve(S.Fs.get(R)):S.hi.getTargetData(f,I)})(r,c,Yt(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(c,u.targetId).next(d=>{s=d})}).next(()=>r.Cs.getDocumentsMatchingQuery(c,e,t?i:Z.min(),t?s:le())).next(u=>(KS(r,cS(e),u),{documents:u,qs:s})))}function KS(n,e,t){let r=n.xs.get(e)||Z.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}var Qc=class{constructor(){this.activeTargetIds=pS()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Cd=class{constructor(){this.Fo=new Qc,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Qc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Dd=class{xo(e){}shutdown(){}};var y_="ConnectivityMonitor",Jc=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){j(y_,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){j(y_,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var kc=null;function kd(){return kc===null?kc=(function(){return 268435456+Math.round(2147483648*Math.random())})():kc++,"0x"+kc.toString(16)}var Ah="RestConnection",WS={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Nd=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===Mh?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let c=kd(),u=this.Go(e,t.toUriEncodedString());j(Ah,`Sending RPC '${e}' ${c}:`,u,r);let d={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(d,i,s);let{host:f}=new URL(u),I=cg(f);return this.jo(e,u,d,r,I).then(S=>(j(Ah,`Received RPC '${e}' ${c}: `,S),S),S=>{throw Xr(Ah,`RPC '${e}' ${c} failed with error: `,S,"url: ",u,"request:",r),S})}Jo(e,t,r,i,s,c){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Is})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let r=WS[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};var Vd=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var nt="WebChannelConnection",xd=class extends Nd{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){let c=kd();return new Promise((u,d)=>{let f=new gh;f.setWithCredentials(!0),f.listenOnce(_h.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case No.NO_ERROR:let S=f.getResponseJson();j(nt,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(S)),u(S);break;case No.TIMEOUT:j(nt,`RPC '${e}' ${c} timed out`),d(new H($.DEADLINE_EXCEEDED,"Request time out"));break;case No.HTTP_ERROR:let R=f.getStatus();if(j(nt,`RPC '${e}' ${c} failed with status:`,R,"response text:",f.getResponseText()),R>0){let k=f.getResponseJson();Array.isArray(k)&&(k=k[0]);let x=k?.error;if(x&&x.status&&x.message){let U=(function(W){let K=W.toLowerCase().replace(/_/g,"-");return Object.values($).indexOf(K)>=0?K:$.UNKNOWN})(x.status);d(new H(U,x.message))}else d(new H($.UNKNOWN,"Server responded with status "+f.getStatus()))}else d(new H($.UNAVAILABLE,"Connection failed."));break;default:X(9055,{c_:e,streamId:c,l_:f.getLastErrorCode(),h_:f.getLastError()})}}finally{j(nt,`RPC '${e}' ${c} completed.`)}});let I=JSON.stringify(i);j(nt,`RPC '${e}' ${c} sending request:`,i),f.send(t,"POST",I,r,15)})}P_(e,t,r){let i=kd(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=Eh(),u=Ih(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(d.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(d.useFetchStreams=!0),this.zo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;let I=s.join("");j(nt,`Creating RPC '${e}' stream ${i}: ${I}`,d);let S=c.createWebChannel(I,d);this.T_(S);let R=!1,k=!1,x=new Vd({Ho:O=>{k?j(nt,`Not sending because RPC '${e}' stream ${i} is closed:`,O):(R||(j(nt,`Opening RPC '${e}' stream ${i} transport.`),S.open(),R=!0),j(nt,`RPC '${e}' stream ${i} sending:`,O),S.send(O))},Yo:()=>S.close()}),U=(O,W,K)=>{O.listen(W,Q=>{try{K(Q)}catch(ie){setTimeout(()=>{throw ie},0)}})};return U(S,Hi.EventType.OPEN,()=>{k||(j(nt,`RPC '${e}' stream ${i} transport opened.`),x.s_())}),U(S,Hi.EventType.CLOSE,()=>{k||(k=!0,j(nt,`RPC '${e}' stream ${i} transport closed`),x.__(),this.I_(S))}),U(S,Hi.EventType.ERROR,O=>{k||(k=!0,Xr(nt,`RPC '${e}' stream ${i} transport errored. Name:`,O.name,"Message:",O.message),x.__(new H($.UNAVAILABLE,"The operation could not be completed")))}),U(S,Hi.EventType.MESSAGE,O=>{var W;if(!k){let K=O.data[0];ve(!!K,16349);let Q=K,ie=Q?.error||((W=Q[0])===null||W===void 0?void 0:W.error);if(ie){j(nt,`RPC '${e}' stream ${i} received error:`,ie);let Ae=ie.status,ne=(function(y){let w=Ne[y];if(w!==void 0)return Iy(w)})(Ae),T=ie.message;ne===void 0&&(ne=$.INTERNAL,T="Unknown error status: "+Ae+" with message "+ie.message),k=!0,x.__(new H(ne,T)),S.close()}else j(nt,`RPC '${e}' stream ${i} received:`,K),x.a_(K)}}),U(u,yh.STAT_EVENT,O=>{O.stat===Pc.PROXY?j(nt,`RPC '${e}' stream ${i} detected buffering proxy`):O.stat===Pc.NOPROXY&&j(nt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.o_()},0),x}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function bh(){return typeof document<"u"?document:null}function Cy(n){return new rd(n,!0)}var Yc=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&j("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var I_="PersistentStream",Od=class{constructor(e,t,r,i,s,c,u,d){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=u,this.listener=d,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Yc(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return P(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return P(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return P(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===$.RESOURCE_EXHAUSTED?(wn(t.toString()),wn("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===$.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new H($.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>P(this,null,function*(){this.state=0,this.start()}))}G_(e){return j(I_,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(j(I_,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Ld=class extends Od{constructor(e,t,r,i,s,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,c),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=DS(this.serializer,e),r=(function(s){if(!("targetChange"in s))return Z.min();let c=s.targetChange;return c.targetIds&&c.targetIds.length?Z.min():c.readTime?ts(c.readTime):Z.min()})(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=f_(this.serializer),t.addTarget=(function(s,c){let u,d=c.target;if(u=Qh(d)?{documents:kS(s,d)}:{query:NS(s,d).Vt},u.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){u.resumeToken=RS(s,c.resumeToken);let f=id(s,c.expectedCount);f!==null&&(u.expectedCount=f)}else if(c.snapshotVersion.compareTo(Z.min())>0){u.readTime=SS(s,c.snapshotVersion.toTimestamp());let f=id(s,c.expectedCount);f!==null&&(u.expectedCount=f)}return u})(this.serializer,e);let r=xS(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=f_(this.serializer),t.removeTarget=e,this.k_(t)}};var Md=class{},Fd=class extends Md{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new H($.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,c])=>this.connection.Wo(e,sd(t,r),i,s,c)).catch(s=>{throw s.name==="FirebaseError"?(s.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new H($.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,u])=>this.connection.Jo(e,sd(t,r),i,c,u,s)).catch(c=>{throw c.name==="FirebaseError"?(c.code===$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new H($.UNKNOWN,c.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Ud=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(wn(t),this._a=!1):j("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var _s="RemoteStore",Bd=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(c=>{r.enqueueAndForget(()=>P(this,null,function*(){ta(this)&&(j(_s,"Restarting streams for network reachability change."),yield(function(d){return P(this,null,function*(){let f=ce(d);f.Ia.add(4),yield ea(f),f.Aa.set("Unknown"),f.Ia.delete(4),yield fu(f)})})(this))}))}),this.Aa=new Ud(r,i)}};function fu(n){return P(this,null,function*(){if(ta(n))for(let e of n.da)yield e(!0)})}function ea(n){return P(this,null,function*(){for(let e of n.da)yield e(!1)})}function Dy(n,e){let t=ce(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),gf(t)?mf(t):ws(t).x_()&&pf(t,e))}function ff(n,e){let t=ce(n),r=ws(t);t.Ta.delete(e),r.x_()&&ky(t,e),t.Ta.size===0&&(r.x_()?r.B_():ta(t)&&t.Aa.set("Unknown"))}function pf(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Z.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ws(n).H_(e)}function ky(n,e){n.Ra.$e(e),ws(n).Y_(e)}function mf(n){n.Ra=new nd({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),ws(n).start(),n.Aa.aa()}function gf(n){return ta(n)&&!ws(n).M_()&&n.Ta.size>0}function ta(n){return ce(n).Ia.size===0}function Ny(n){n.Ra=void 0}function HS(n){return P(this,null,function*(){n.Aa.set("Online")})}function QS(n){return P(this,null,function*(){n.Ta.forEach((e,t)=>{pf(n,e)})})}function JS(n,e){return P(this,null,function*(){Ny(n),gf(n)?(n.Aa.la(e),mf(n)):n.Aa.set("Unknown")})}function YS(n,e,t){return P(this,null,function*(){if(n.Aa.set("Online"),e instanceof zc&&e.state===2&&e.cause)try{yield(function(i,s){return P(this,null,function*(){let c=s.cause;for(let u of s.targetIds)i.Ta.has(u)&&(yield i.remoteSyncer.rejectListen(u,c),i.Ta.delete(u),i.Ra.removeTarget(u))})})(n,e)}catch(r){j(_s,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield E_(n,r)}else if(e instanceof es?n.Ra.Ye(e):e instanceof jc?n.Ra.it(e):n.Ra.et(e),!t.isEqual(Z.min()))try{let r=yield Py(n.localStore);t.compareTo(r)>=0&&(yield(function(s,c){let u=s.Ra.Pt(c);return u.targetChanges.forEach((d,f)=>{if(d.resumeToken.approximateByteSize()>0){let I=s.Ta.get(f);I&&s.Ta.set(f,I.withResumeToken(d.resumeToken,c))}}),u.targetMismatches.forEach((d,f)=>{let I=s.Ta.get(d);if(!I)return;s.Ta.set(d,I.withResumeToken(it.EMPTY_BYTE_STRING,I.snapshotVersion)),ky(s,d);let S=new Ho(I.target,d,f,I.sequenceNumber);pf(s,S)}),s.remoteSyncer.applyRemoteEvent(u)})(n,t))}catch(r){j(_s,"Failed to raise snapshot:",r),yield E_(n,r)}})}function E_(n,e,t){return P(this,null,function*(){if(!Es(e))throw e;n.Ia.add(1),yield ea(n),n.Aa.set("Offline"),t||(t=()=>Py(n.localStore)),n.asyncQueue.enqueueRetryable(()=>P(null,null,function*(){j(_s,"Retrying IndexedDB access"),yield t(),n.Ia.delete(1),yield fu(n)}))})}function w_(n,e){return P(this,null,function*(){let t=ce(n);t.asyncQueue.verifyOperationInProgress(),j(_s,"RemoteStore received new credentials");let r=ta(t);t.Ia.add(3),yield ea(t),r&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield fu(t)})}function XS(n,e){return P(this,null,function*(){let t=ce(n);e?(t.Ia.delete(2),yield fu(t)):e||(t.Ia.add(2),yield ea(t),t.Aa.set("Unknown"))})}function ws(n){return n.Va||(n.Va=(function(t,r,i){let s=ce(t);return s.ia(),new Ld(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:HS.bind(null,n),e_:QS.bind(null,n),n_:JS.bind(null,n),J_:YS.bind(null,n)}),n.da.push(e=>P(null,null,function*(){e?(n.Va.N_(),gf(n)?mf(n):n.Aa.set("Unknown")):(yield n.Va.stop(),Ny(n))}))),n.Va}var qd=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ur,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(c=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let c=Date.now()+r,u=new n(e,t,c,i,s);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new H($.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Vy(n,e){if(wn("AsyncQueue",`${e}: ${n}`),Es(n))return new H($.UNAVAILABLE,`${e}: ${n}`);throw n}var Xc=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Y.comparator(t.key,r.key):(t,r)=>Y.comparator(t.key,r.key),this.keyedMap=Vo(),this.sortedSet=new De(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Zc=class{constructor(){this.fa=new De(Y.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):X(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},ys=class n{constructor(e,t,r,i,s,c,u,d,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=c,this.syncStateChanged=u,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,s){let c=[];return t.forEach(u=>{c.push({type:0,doc:u})}),new n(e,t,Xc.emptySet(t),c,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var $d=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},jd=class{constructor(){this.queries=T_(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=ce(t),s=i.queries;i.queries=T_(),s.forEach((c,u)=>{for(let d of u.wa)d.onError(r)})})(this,new H($.ABORTED,"Firestore shutting down"))}};function T_(){return new An(n=>ly(n),hu)}function ZS(n,e){return P(this,null,function*(){let t=ce(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new $d,r=e.ba()?0:1);try{switch(r){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(c){let u=Vy(c,`Initialization of query '${Ji(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&_f(t)})}function e0(n,e){return P(this,null,function*(){let t=ce(n),r=e.query,i=3,s=t.queries.get(r);if(s){let c=s.wa.indexOf(e);c>=0&&(s.wa.splice(c,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function t0(n,e){let t=ce(n),r=!1;for(let i of e){let s=i.query,c=t.queries.get(s);if(c){for(let u of c.wa)u.Ca(i)&&(r=!0);c.ya=i}}r&&_f(t)}function n0(n,e,t){let r=ce(n),i=r.queries.get(e);if(i)for(let s of i.wa)s.onError(t);r.queries.delete(e)}function _f(n){n.Da.forEach(e=>{e.next()})}var zd,v_;(v_=zd||(zd={})).Fa="default",v_.Cache="cache";var Gd=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ys(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=ys.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==zd.Cache}};var eu=class{constructor(e){this.key=e}},tu=class{constructor(e){this.key=e}},Kd=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=le(),this.mutatedKeys=le(),this.Xa=hy(e),this.eu=new Xc(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new Zc,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,c=i,u=!1,d=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((I,S)=>{let R=i.get(I),k=du(this.query,S)?S:null,x=!!R&&this.mutatedKeys.has(R.key),U=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations),O=!1;R&&k?R.data.isEqual(k.data)?x!==U&&(r.track({type:3,doc:k}),O=!0):this.iu(R,k)||(r.track({type:2,doc:k}),O=!0,(d&&this.Xa(k,d)>0||f&&this.Xa(k,f)<0)&&(u=!0)):!R&&k?(r.track({type:0,doc:k}),O=!0):R&&!k&&(r.track({type:1,doc:R}),O=!0,(d||f)&&(u=!0)),O&&(k?(c=c.add(k),s=U?s.add(I):s.delete(I)):(c=c.delete(I),s=s.delete(I)))}),this.query.limit!==null)for(;c.size>this.query.limit;){let I=this.query.limitType==="F"?c.last():c.first();c=c.delete(I.key),s=s.delete(I.key),r.track({type:1,doc:I})}return{eu:c,ru:r,Ds:u,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let c=e.ru.pa();c.sort((I,S)=>(function(k,x){let U=O=>{switch(O){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return X(20277,{At:O})}};return U(k)-U(x)})(I.type,S.type)||this.Xa(I.doc,S.doc)),this.su(r),i=i!=null&&i;let u=t&&!i?this.ou():[],d=this.Za.size===0&&this.current&&!i?1:0,f=d!==this.Ya;return this.Ya=d,c.length!==0||f?{snapshot:new ys(this.query,e.eu,s,c,e.mutatedKeys,d===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Zc,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=le(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new tu(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new eu(r))}),t}uu(e){this.Ha=e.qs,this.Za=le();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return ys.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},yf="SyncEngine",Wd=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Hd=class{constructor(e){this.key=e,this.lu=!1}},Qd=class{constructor(e,t,r,i,s,c){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=c,this.hu={},this.Pu=new An(u=>ly(u),hu),this.Tu=new Map,this.Iu=new Set,this.du=new De(Y.comparator),this.Eu=new Map,this.Au=new Jo,this.Ru={},this.Vu=new Map,this.mu=Qo.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function r0(n,e,t=!0){return P(this,null,function*(){let r=Fy(n),i,s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield xy(r,e,t,!0),i})}function i0(n,e){return P(this,null,function*(){let t=Fy(n);yield xy(t,e,!0,!1)})}function xy(n,e,t,r){return P(this,null,function*(){let i=yield GS(n.localStore,Yt(e)),s=i.targetId,c=n.sharedClientState.addLocalQueryTarget(s,t),u;return r&&(u=yield s0(n,e,s,c==="current",i.resumeToken)),n.isPrimaryClient&&t&&Dy(n.remoteStore,i),u})}function s0(n,e,t,r,i){return P(this,null,function*(){n.gu=(S,R,k)=>(function(U,O,W,K){return P(this,null,function*(){let Q=O.view.nu(W);Q.Ds&&(Q=yield __(U.localStore,O.query,!1).then(({documents:T})=>O.view.nu(T,Q)));let ie=K&&K.targetChanges.get(O.targetId),Ae=K&&K.targetMismatches.get(O.targetId)!=null,ne=O.view.applyChanges(Q,U.isPrimaryClient,ie,Ae);return b_(U,O.targetId,ne._u),ne.snapshot})})(n,S,R,k);let s=yield __(n.localStore,e,!0),c=new Kd(e,s.qs),u=c.nu(s.documents),d=Wo.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),f=c.applyChanges(u,n.isPrimaryClient,d);b_(n,t,f._u);let I=new Wd(e,t,c);return n.Pu.set(e,I),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),f.snapshot})}function o0(n,e,t){return P(this,null,function*(){let r=ce(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(c=>!hu(c,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Pd(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ff(r.remoteStore,i.targetId),Jd(r,i.targetId)}).catch(cu))):(Jd(r,i.targetId),yield Pd(r.localStore,i.targetId,!0))})}function a0(n,e){return P(this,null,function*(){let t=ce(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ff(t.remoteStore,r.targetId))})}function Oy(n,e){return P(this,null,function*(){let t=ce(n);try{let r=yield jS(t.localStore,e);e.targetChanges.forEach((i,s)=>{let c=t.Eu.get(s);c&&(ve(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?c.lu=!0:i.modifiedDocuments.size>0?ve(c.lu,14607):i.removedDocuments.size>0&&(ve(c.lu,42227),c.lu=!1))}),yield My(t,r,e)}catch(r){yield cu(r)}})}function A_(n,e,t){let r=ce(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((s,c)=>{let u=c.view.va(e);u.snapshot&&i.push(u.snapshot)}),(function(c,u){let d=ce(c);d.onlineState=u;let f=!1;d.queries.forEach((I,S)=>{for(let R of S.wa)R.va(u)&&(f=!0)}),f&&_f(d)})(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function c0(n,e,t){return P(this,null,function*(){let r=ce(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),s=i&&i.key;if(s){let c=new De(Y.comparator);c=c.insert(s,Ft.newNoDocument(s,Z.min()));let u=le().add(s),d=new $c(Z.min(),new Map,new De(re),c,u);yield Oy(r,d),r.du=r.du.remove(s),r.Eu.delete(e),If(r)}else yield Pd(r.localStore,e,!1).then(()=>Jd(r,e,t)).catch(cu)})}function Jd(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||Ly(n,r)})}function Ly(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(ff(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),If(n))}function b_(n,e,t){for(let r of t)r instanceof eu?(n.Au.addReference(r.key,e),u0(n,r)):r instanceof tu?(j(yf,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||Ly(n,r.key)):X(19791,{yu:r})}function u0(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(j(yf,"New document in limbo: "+t),n.Iu.add(r),If(n))}function If(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new Y(ze.fromString(e)),r=n.mu.next();n.Eu.set(r,new Hd(t)),n.du=n.du.insert(t,r),Dy(n.remoteStore,new Ho(Yt(hf(t.path)),r,"TargetPurposeLimboResolution",of.ue))}}function My(n,e,t){return P(this,null,function*(){let r=ce(n),i=[],s=[],c=[];r.Pu.isEmpty()||(r.Pu.forEach((u,d)=>{c.push(r.gu(d,e,t).then(f=>{var I;if((f||t)&&r.isPrimaryClient){let S=f?!f.fromCache:(I=t?.targetChanges.get(d.targetId))===null||I===void 0?void 0:I.current;r.sharedClientState.updateQueryState(d.targetId,S?"current":"not-current")}if(f){i.push(f);let S=Ad.Es(d.targetId,f);s.push(S)}}))}),yield Promise.all(c),r.hu.J_(i),yield(function(d,f){return P(this,null,function*(){let I=ce(d);try{yield I.persistence.runTransaction("notifyLocalViewChanges","readwrite",S=>M.forEach(f,R=>M.forEach(R.Is,k=>I.persistence.referenceDelegate.addReference(S,R.targetId,k)).next(()=>M.forEach(R.ds,k=>I.persistence.referenceDelegate.removeReference(S,R.targetId,k)))))}catch(S){if(!Es(S))throw S;j(df,"Failed to update sequence numbers: "+S)}for(let S of f){let R=S.targetId;if(!S.fromCache){let k=I.Fs.get(R),x=k.snapshotVersion,U=k.withLastLimboFreeSnapshotVersion(x);I.Fs=I.Fs.insert(R,U)}}})})(r.localStore,s))})}function l0(n,e){return P(this,null,function*(){let t=ce(n);if(!t.currentUser.isEqual(e)){j(yf,"User change. New user:",e.toKey());let r=yield Ry(t.localStore,e);t.currentUser=e,(function(s,c){s.Vu.forEach(u=>{u.forEach(d=>{d.reject(new H($.CANCELLED,c))})}),s.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield My(t,r.Bs)}})}function h0(n,e){let t=ce(n),r=t.Eu.get(e);if(r&&r.lu)return le().add(r.key);{let i=le(),s=t.Tu.get(e);if(!s)return i;for(let c of s){let u=t.Pu.get(c);i=i.unionWith(u.view.tu)}return i}}function Fy(n){let e=ce(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Oy.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=h0.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=c0.bind(null,e),e.hu.J_=t0.bind(null,e.eventManager),e.hu.pu=n0.bind(null,e.eventManager),e}var Uy=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return P(this,null,function*(){this.serializer=Cy(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,r){return null}Fu(t,r){return null}vu(t){return $S(this.persistence,new Sd,t.initialUser,this.serializer)}Du(t){return new Wc(vd.Vi,this.serializer)}bu(t){return new Cd}terminate(){return P(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Yd=class extends Uy{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){ve(this.persistence.referenceDelegate instanceof Hc,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new ld(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?vt.withCacheSize(this.cacheSizeBytes):vt.DEFAULT;return new Wc(r=>Hc.Vi(r,t),this.serializer)}};var d0=(()=>{class n{initialize(t,r){return P(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>A_(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=l0.bind(null,this.syncEngine),yield XS(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new jd})()}createDatastore(t){let r=Cy(t.databaseInfo.databaseId),i=(function(c){return new xd(c)})(t.databaseInfo);return(function(c,u,d,f){return new Fd(c,u,d,f)})(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,s,c,u,d){return new Bd(i,s,c,u,d)})(this.localStore,this.datastore,t.asyncQueue,r=>A_(this.syncEngine,r,0),(function(){return Jc.C()?new Jc:new Dd})())}createSyncEngine(t,r){return(function(s,c,u,d,f,I,S){let R=new Qd(s,c,u,d,f,I);return S&&(R.fu=!0),R})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return P(this,null,function*(){var t,r;yield(function(s){return P(this,null,function*(){let c=ce(s);j(_s,"RemoteStore shutting down."),c.Ia.add(5),yield ea(c),c.Ea.shutdown(),c.Aa.set("Unknown")})})(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var Xd=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):wn("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var dr="FirestoreClient",Zd=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=rt.UNAUTHENTICATED,this.clientId=Oc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,c=>P(this,null,function*(){j(dr,"Received user=",c.uid),yield this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(r,c=>(j(dr,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ur;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Vy(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Sh(n,e){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),j(dr,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>P(null,null,function*(){r.isEqual(i)||(yield Ry(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>{Xr("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{j("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Xr("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e})}function S_(n,e){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield f0(n);j(dr,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>w_(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>w_(e.remoteStore,i)),n._onlineComponents=e})}function f0(n){return P(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){j(dr,"Using user provided OfflineComponentProvider");try{yield Sh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===$.FAILED_PRECONDITION||i.code===$.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;Xr("Error using user provided cache. Falling back to memory cache: "+t),yield Sh(n,new Uy)}}else j(dr,"Using default OfflineComponentProvider"),yield Sh(n,new Yd(void 0));return n._offlineComponents})}function p0(n){return P(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(j(dr,"Using user provided OnlineComponentProvider"),yield S_(n,n._uninitializedComponentsProvider._online)):(j(dr,"Using default OnlineComponentProvider"),yield S_(n,new d0))),n._onlineComponents})}function R_(n){return P(this,null,function*(){let e=yield p0(n),t=e.eventManager;return t.onListen=r0.bind(null,e.syncEngine),t.onUnlisten=o0.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=i0.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=a0.bind(null,e.syncEngine),t})}function By(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var P_=new Map;var m0="firestore.googleapis.com",C_=!0,nu=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new H($.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=m0,this.ssl=C_}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:C_;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Sy;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<US)throw new H($.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}xb("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=By((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new H($.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new H($.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new H($.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},ef=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nu({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new H($.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new H($.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nu(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Ph;switch(r.type){case"firstParty":return new kh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new H($.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return P(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=P_.get(t);r&&(j("ComponentProvider","Removing Datastore"),P_.delete(t),r.terminate())})(this),Promise.resolve()}};var ru=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},En=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new tf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Xo(t,n._jsonSchema))return new n(e,r||null,new Y(ze.fromString(t.referencePath)))}};En._jsonSchemaVersion="firestore/documentReference/1.0",En._jsonSchema={type:xe("string",En._jsonSchemaVersion),referencePath:xe("string")};var tf=class n extends ru{constructor(e,t,r){super(e,t,hf(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new En(this.firestore,null,new Y(e))}withConverter(e){return new n(this.firestore,e,this._path)}};var D_="AsyncQueue",iu=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Yc(this,"async_queue_retry"),this.oc=()=>{let r=bh();r&&j(D_,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=bh();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=bh();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new ur;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return P(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Es(e))throw e;j(D_,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,wn("INTERNAL UNHANDLED ERROR: ",k_(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=qd.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&X(47125,{hc:k_(this.tc)})}verifyOperationInProgress(){}Pc(){return P(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function k_(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function N_(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}var Yo=class extends ef{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new iu,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return P(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new iu(e),this._firestoreClient=void 0,yield e}})}};function g0(n){if(n._terminated)throw new H($.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||_0(n),n._firestoreClient}function _0(n){var e,t,r;let i=n._freezeSettings(),s=(function(u,d,f,I){return new Lh(u,d,f,I.host,I.ssl,I.experimentalForceLongPolling,I.experimentalAutoDetectLongPolling,By(I.experimentalLongPollingOptions),I.useFetchStreams,I.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Zd(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&(function(u){let d=u?._online.build();return{_offline:u?._offline.build(d),_online:d}})(n._componentsProvider))}var ns=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(it.fromBase64String(e))}catch(t){throw new H($.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(it.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Xo(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};ns._jsonSchemaVersion="firestore/bytes/1.0",ns._jsonSchema={type:xe("string",ns._jsonSchemaVersion),bytes:xe("string")};var su=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new H($.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Mt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var rs=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new H($.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new H($.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return re(this._lat,e._lat)||re(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(Xo(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};rs._jsonSchemaVersion="firestore/geoPoint/1.0",rs._jsonSchema={type:xe("string",rs._jsonSchemaVersion),latitude:xe("number"),longitude:xe("number")};var is=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Xo(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new H($.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};is._jsonSchemaVersion="firestore/vectorValue/1.0",is._jsonSchema={type:xe("string",is._jsonSchemaVersion),vectorValues:xe("object")};var y0=new RegExp("[~\\*/\\[\\]]");function I0(n,e,t){if(e.search(y0)>=0)throw V_(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new su(...e.split("."))._internalPath}catch(r){throw V_(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function V_(n,e,t,r,i){let s=r&&!r.isEmpty(),c=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let d="";return(s||c)&&(d+=" (found",s&&(d+=` in field ${r}`),c&&(d+=` in document ${i}`),d+=")"),new H($.INVALID_ARGUMENT,u+n+d)}var ou=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new En(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new nf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(qy("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},nf=class extends ou{data(){return super.data()}};function qy(n,e){return typeof e=="string"?I0(n,e):e instanceof su?e._internalPath:e._delegate._internalPath}function E0(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new H($.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var rf=class{convertValue(e,t="none"){switch(lr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Te(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(vn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw X(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Zo(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[qo].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(c=>Te(c.doubleValue));return new is(s)}convertGeoPoint(e){return new rs(Te(e.latitude),Te(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=lu(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Bo(e));default:return null}}convertTimestamp(e){let t=Tn(e);return new ut(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ze.fromString(e);ve(by(r),9688,{name:e});let i=new Bc(r.get(1),r.get(3)),s=new Y(r.popFirst(5));return i.isEqual(t)||wn(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};var Qr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Jr=class n extends ou{constructor(e,t,r,i,s,c){super(e,t,r,i,c),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new ss(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(qy("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new H($.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Jr._jsonSchemaVersion="firestore/documentSnapshot/1.0",Jr._jsonSchema={type:xe("string",Jr._jsonSchemaVersion),bundleSource:xe("string","DocumentSnapshot"),bundleName:xe("string"),bundle:xe("string")};var ss=class extends Jr{data(e={}){return super.data(e)}},os=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Qr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ss(this._firestore,this._userDataWriter,r.key,r,new Qr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new H($.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let c=0;return i._snapshot.docChanges.map(u=>{let d=new ss(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Qr(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:d,oldIndex:-1,newIndex:c++}})}{let c=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let d=new ss(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Qr(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),f=-1,I=-1;return u.type!==0&&(f=c.indexOf(u.doc.key),c=c.delete(u.doc.key)),u.type!==1&&(c=c.add(u.doc),I=c.indexOf(u.doc.key)),{type:w0(u.type),doc:d,oldIndex:f,newIndex:I}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new H($.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Oc.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function w0(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return X(61501,{type:n})}}os._jsonSchemaVersion="firestore/querySnapshot/1.0",os._jsonSchema={type:xe("string",os._jsonSchemaVersion),bundleSource:xe("string","QuerySnapshot"),bundleName:xe("string"),bundle:xe("string")};var au=class extends rf{constructor(e){super(),this.firestore=e}convertBytes(e){return new ns(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new En(this.firestore,null,t)}};function $y(n,...e){var t,r,i;n=dg(n);let s={includeMetadataChanges:!1,source:"default"},c=0;typeof e[c]!="object"||N_(e[c])||(s=e[c++]);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(N_(e[c])){let S=e[c];e[c]=(t=S.next)===null||t===void 0?void 0:t.bind(S),e[c+1]=(r=S.error)===null||r===void 0?void 0:r.bind(S),e[c+2]=(i=S.complete)===null||i===void 0?void 0:i.bind(S)}let d,f,I;if(n instanceof En)f=wh(n.firestore,Yo),I=hf(n._key.path),d={next:S=>{e[c]&&e[c](T0(f,n,S))},error:e[c+1],complete:e[c+2]};else{let S=wh(n,ru);f=wh(S.firestore,Yo),I=S._query;let R=new au(f);d={next:k=>{e[c]&&e[c](new os(f,R,S,k))},error:e[c+1],complete:e[c+2]},E0(n._query)}return(function(R,k,x,U){let O=new Xd(U),W=new Gd(k,O,x);return R.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return ZS(yield R_(R),W)})),()=>{O.Ou(),R.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return e0(yield R_(R),W)}))}})(g0(f),I,u,d)}function T0(n,e,t){let r=t.docs.get(e._key),i=new au(n);return new Jr(n,i,e._key,r,new Qr(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){Is=i})(Eg),So(new ar("firestore",(r,{instanceIdentifier:i,options:s})=>{let c=r.getProvider("app").getImmediate(),u=new Yo(new Ch(r.getProvider("auth-internal")),new Nh(c,r.getProvider("app-check-internal")),(function(f,I){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new H($.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bc(f.options.projectId,I)})(c,i),c);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Wi(jg,zg,e),Wi(jg,zg,"esm2017")})();var pu=function(){return pu=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},pu.apply(this,arguments)};var v0={includeMetadataChanges:!1};function jy(n,e){return e===void 0&&(e=v0),new go(function(t){var r=$y(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function zy(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:pu(pu({},r),(t={},t[e.idField]=n.id,t))}function Gy(n){return jy(n,{includeMetadataChanges:!0}).pipe(pl(function(e){return e.docs}))}function Ky(n,e){return e===void 0&&(e={}),Gy(n).pipe(pl(function(t){return t.map(function(r){return zy(r,e)})}))}var Wy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Hy={};var mu,Qy;(function(){var n;function e(T,g){function y(){}y.prototype=g.prototype,T.F=g.prototype,T.prototype=new y,T.prototype.constructor=T,T.D=function(w,E,b){for(var _=Array(arguments.length-2),we=2;we<arguments.length;we++)_[we-2]=arguments[we];return g.prototype[E].apply(w,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(T,g,y){y||(y=0);let w=Array(16);if(typeof g=="string")for(var E=0;E<16;++E)w[E]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(E=0;E<16;++E)w[E]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=T.g[0],y=T.g[1],E=T.g[2];let b=T.g[3],_;_=g+(b^y&(E^b))+w[0]+3614090360&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(E^g&(y^E))+w[1]+3905402710&4294967295,b=g+(_<<12&4294967295|_>>>20),_=E+(y^b&(g^y))+w[2]+606105819&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(g^E&(b^g))+w[3]+3250441966&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(b^y&(E^b))+w[4]+4118548399&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(E^g&(y^E))+w[5]+1200080426&4294967295,b=g+(_<<12&4294967295|_>>>20),_=E+(y^b&(g^y))+w[6]+2821735955&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(g^E&(b^g))+w[7]+4249261313&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(b^y&(E^b))+w[8]+1770035416&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(E^g&(y^E))+w[9]+2336552879&4294967295,b=g+(_<<12&4294967295|_>>>20),_=E+(y^b&(g^y))+w[10]+4294925233&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(g^E&(b^g))+w[11]+2304563134&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(b^y&(E^b))+w[12]+1804603682&4294967295,g=y+(_<<7&4294967295|_>>>25),_=b+(E^g&(y^E))+w[13]+4254626195&4294967295,b=g+(_<<12&4294967295|_>>>20),_=E+(y^b&(g^y))+w[14]+2792965006&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(g^E&(b^g))+w[15]+1236535329&4294967295,y=E+(_<<22&4294967295|_>>>10),_=g+(E^b&(y^E))+w[1]+4129170786&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(g^y))+w[6]+3225465664&4294967295,b=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(b^g))+w[11]+643717713&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(E^b))+w[0]+3921069994&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^b&(y^E))+w[5]+3593408605&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(g^y))+w[10]+38016083&4294967295,b=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(b^g))+w[15]+3634488961&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(E^b))+w[4]+3889429448&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^b&(y^E))+w[9]+568446438&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(g^y))+w[14]+3275163606&4294967295,b=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(b^g))+w[3]+4107603335&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(E^b))+w[8]+1163531501&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(E^b&(y^E))+w[13]+2850285829&4294967295,g=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(g^y))+w[2]+4243563512&4294967295,b=g+(_<<9&4294967295|_>>>23),_=E+(g^y&(b^g))+w[7]+1735328473&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^g&(E^b))+w[12]+2368359562&4294967295,y=E+(_<<20&4294967295|_>>>12),_=g+(y^E^b)+w[5]+4294588738&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^E)+w[8]+2272392833&4294967295,b=g+(_<<11&4294967295|_>>>21),_=E+(b^g^y)+w[11]+1839030562&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^g)+w[14]+4259657740&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^b)+w[1]+2763975236&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^E)+w[4]+1272893353&4294967295,b=g+(_<<11&4294967295|_>>>21),_=E+(b^g^y)+w[7]+4139469664&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^g)+w[10]+3200236656&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^b)+w[13]+681279174&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^E)+w[0]+3936430074&4294967295,b=g+(_<<11&4294967295|_>>>21),_=E+(b^g^y)+w[3]+3572445317&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^g)+w[6]+76029189&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(y^E^b)+w[9]+3654602809&4294967295,g=y+(_<<4&4294967295|_>>>28),_=b+(g^y^E)+w[12]+3873151461&4294967295,b=g+(_<<11&4294967295|_>>>21),_=E+(b^g^y)+w[15]+530742520&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^g)+w[2]+3299628645&4294967295,y=E+(_<<23&4294967295|_>>>9),_=g+(E^(y|~b))+w[0]+4096336452&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~E))+w[7]+1126891415&4294967295,b=g+(_<<10&4294967295|_>>>22),_=E+(g^(b|~y))+w[14]+2878612391&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~g))+w[5]+4237533241&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~b))+w[12]+1700485571&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~E))+w[3]+2399980690&4294967295,b=g+(_<<10&4294967295|_>>>22),_=E+(g^(b|~y))+w[10]+4293915773&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~g))+w[1]+2240044497&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~b))+w[8]+1873313359&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~E))+w[15]+4264355552&4294967295,b=g+(_<<10&4294967295|_>>>22),_=E+(g^(b|~y))+w[6]+2734768916&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~g))+w[13]+1309151649&4294967295,y=E+(_<<21&4294967295|_>>>11),_=g+(E^(y|~b))+w[4]+4149444226&4294967295,g=y+(_<<6&4294967295|_>>>26),_=b+(y^(g|~E))+w[11]+3174756917&4294967295,b=g+(_<<10&4294967295|_>>>22),_=E+(g^(b|~y))+w[2]+718787259&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~g))+w[9]+3951481745&4294967295,T.g[0]=T.g[0]+g&4294967295,T.g[1]=T.g[1]+(E+(_<<21&4294967295|_>>>11))&4294967295,T.g[2]=T.g[2]+E&4294967295,T.g[3]=T.g[3]+b&4294967295}r.prototype.v=function(T,g){g===void 0&&(g=T.length);let y=g-this.blockSize,w=this.C,E=this.h,b=0;for(;b<g;){if(E==0)for(;b<=y;)i(this,T,b),b+=this.blockSize;if(typeof T=="string"){for(;b<g;)if(w[E++]=T.charCodeAt(b++),E==this.blockSize){i(this,w),E=0;break}}else for(;b<g;)if(w[E++]=T[b++],E==this.blockSize){i(this,w),E=0;break}}this.h=E,this.o+=g},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var g=1;g<T.length-8;++g)T[g]=0;g=this.o*8;for(var y=T.length-8;y<T.length;++y)T[y]=g&255,g/=256;for(this.v(T),T=Array(16),g=0,y=0;y<4;++y)for(let w=0;w<32;w+=8)T[g++]=this.g[y]>>>w&255;return T};function s(T,g){var y=u;return Object.prototype.hasOwnProperty.call(y,T)?y[T]:y[T]=g(T)}function c(T,g){this.h=g;let y=[],w=!0;for(let E=T.length-1;E>=0;E--){let b=T[E]|0;w&&b==g||(y[E]=b,w=!1)}this.g=y}var u={};function d(T){return-128<=T&&T<128?s(T,function(g){return new c([g|0],g<0?-1:0)}):new c([T|0],T<0?-1:0)}function f(T){if(isNaN(T)||!isFinite(T))return S;if(T<0)return O(f(-T));let g=[],y=1;for(let w=0;T>=y;w++)g[w]=T/y|0,y*=4294967296;return new c(g,0)}function I(T,g){if(T.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(T.charAt(0)=="-")return O(I(T.substring(1),g));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');let y=f(Math.pow(g,8)),w=S;for(let b=0;b<T.length;b+=8){var E=Math.min(8,T.length-b);let _=parseInt(T.substring(b,b+E),g);E<8?(E=f(Math.pow(g,E)),w=w.j(E).add(f(_))):(w=w.j(y),w=w.add(f(_)))}return w}var S=d(0),R=d(1),k=d(16777216);n=c.prototype,n.m=function(){if(U(this))return-O(this).m();let T=0,g=1;for(let y=0;y<this.g.length;y++){let w=this.i(y);T+=(w>=0?w:4294967296+w)*g,g*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(x(this))return"0";if(U(this))return"-"+O(this).toString(T);let g=f(Math.pow(T,6));var y=this;let w="";for(;;){let E=ie(y,g).g;y=W(y,E.j(g));let b=((y.g.length>0?y.g[0]:y.h)>>>0).toString(T);if(y=E,x(y))return b+w;for(;b.length<6;)b="0"+b;w=b+w}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function x(T){if(T.h!=0)return!1;for(let g=0;g<T.g.length;g++)if(T.g[g]!=0)return!1;return!0}function U(T){return T.h==-1}n.l=function(T){return T=W(this,T),U(T)?-1:x(T)?0:1};function O(T){let g=T.g.length,y=[];for(let w=0;w<g;w++)y[w]=~T.g[w];return new c(y,~T.h).add(R)}n.abs=function(){return U(this)?O(this):this},n.add=function(T){let g=Math.max(this.g.length,T.g.length),y=[],w=0;for(let E=0;E<=g;E++){let b=w+(this.i(E)&65535)+(T.i(E)&65535),_=(b>>>16)+(this.i(E)>>>16)+(T.i(E)>>>16);w=_>>>16,b&=65535,_&=65535,y[E]=_<<16|b}return new c(y,y[y.length-1]&-2147483648?-1:0)};function W(T,g){return T.add(O(g))}n.j=function(T){if(x(this)||x(T))return S;if(U(this))return U(T)?O(this).j(O(T)):O(O(this).j(T));if(U(T))return O(this.j(O(T)));if(this.l(k)<0&&T.l(k)<0)return f(this.m()*T.m());let g=this.g.length+T.g.length,y=[];for(var w=0;w<2*g;w++)y[w]=0;for(w=0;w<this.g.length;w++)for(let E=0;E<T.g.length;E++){let b=this.i(w)>>>16,_=this.i(w)&65535,we=T.i(E)>>>16,lt=T.i(E)&65535;y[2*w+2*E]+=_*lt,K(y,2*w+2*E),y[2*w+2*E+1]+=b*lt,K(y,2*w+2*E+1),y[2*w+2*E+1]+=_*we,K(y,2*w+2*E+1),y[2*w+2*E+2]+=b*we,K(y,2*w+2*E+2)}for(T=0;T<g;T++)y[T]=y[2*T+1]<<16|y[2*T];for(T=g;T<2*g;T++)y[T]=0;return new c(y,0)};function K(T,g){for(;(T[g]&65535)!=T[g];)T[g+1]+=T[g]>>>16,T[g]&=65535,g++}function Q(T,g){this.g=T,this.h=g}function ie(T,g){if(x(g))throw Error("division by zero");if(x(T))return new Q(S,S);if(U(T))return g=ie(O(T),g),new Q(O(g.g),O(g.h));if(U(g))return g=ie(T,O(g)),new Q(O(g.g),g.h);if(T.g.length>30){if(U(T)||U(g))throw Error("slowDivide_ only works with positive integers.");for(var y=R,w=g;w.l(T)<=0;)y=Ae(y),w=Ae(w);var E=ne(y,1),b=ne(w,1);for(w=ne(w,2),y=ne(y,2);!x(w);){var _=b.add(w);_.l(T)<=0&&(E=E.add(y),b=_),w=ne(w,1),y=ne(y,1)}return g=W(T,E.j(g)),new Q(E,g)}for(E=S;T.l(g)>=0;){for(y=Math.max(1,Math.floor(T.m()/g.m())),w=Math.ceil(Math.log(y)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),b=f(y),_=b.j(g);U(_)||_.l(T)>0;)y-=w,b=f(y),_=b.j(g);x(b)&&(b=R),E=E.add(b),T=W(T,_)}return new Q(E,T)}n.B=function(T){return ie(this,T).h},n.and=function(T){let g=Math.max(this.g.length,T.g.length),y=[];for(let w=0;w<g;w++)y[w]=this.i(w)&T.i(w);return new c(y,this.h&T.h)},n.or=function(T){let g=Math.max(this.g.length,T.g.length),y=[];for(let w=0;w<g;w++)y[w]=this.i(w)|T.i(w);return new c(y,this.h|T.h)},n.xor=function(T){let g=Math.max(this.g.length,T.g.length),y=[];for(let w=0;w<g;w++)y[w]=this.i(w)^T.i(w);return new c(y,this.h^T.h)};function Ae(T){let g=T.g.length+1,y=[];for(let w=0;w<g;w++)y[w]=T.i(w)<<1|T.i(w-1)>>>31;return new c(y,T.h)}function ne(T,g){let y=g>>5;g%=32;let w=T.g.length-y,E=[];for(let b=0;b<w;b++)E[b]=g>0?T.i(b+y)>>>g|T.i(b+y+1)<<32-g:T.i(b+y);return new c(E,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Qy=Hy.Md5=r,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.B,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=f,c.fromString=I,mu=Hy.Integer=c}).apply(typeof Wy<"u"?Wy:typeof self<"u"?self:typeof window<"u"?window:{});var gu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},bn={};var Ef,A0,Ts,wf,na,_u,Tf,vf,Af;(function(){var n,e=Object.defineProperty;function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof gu=="object"&&gu];for(var h=0;h<a.length;++h){var m=a[h];if(m&&m.Math==Math)return m}throw Error("Cannot find global object")}var r=t(this);function i(a,h){if(h)e:{var m=r;a=a.split(".");for(var A=0;A<a.length-1;A++){var C=a[A];if(!(C in m))break e;m=m[C]}a=a[a.length-1],A=m[a],h=h(A),h!=A&&h!=null&&e(m,a,{configurable:!0,writable:!0,value:h})}}i("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(a){return a||function(h){var m=[],A;for(A in h)Object.prototype.hasOwnProperty.call(h,A)&&m.push([A,h[A]]);return m}});var s=s||{},c=this||self;function u(a){var h=typeof a;return h=="object"&&a!=null||h=="function"}function d(a,h,m){return a.call.apply(a.bind,arguments)}function f(a,h,m){return f=d,f.apply(null,arguments)}function I(a,h){var m=Array.prototype.slice.call(arguments,1);return function(){var A=m.slice();return A.push.apply(A,arguments),a.apply(this,A)}}function S(a,h){function m(){}m.prototype=h.prototype,a.Z=h.prototype,a.prototype=new m,a.prototype.constructor=a,a.Ob=function(A,C,N){for(var q=Array(arguments.length-2),J=2;J<arguments.length;J++)q[J-2]=arguments[J];return h.prototype[C].apply(A,q)}}var R=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function k(a){let h=a.length;if(h>0){let m=Array(h);for(let A=0;A<h;A++)m[A]=a[A];return m}return[]}function x(a,h){for(let A=1;A<arguments.length;A++){let C=arguments[A];var m=typeof C;if(m=m!="object"?m:C?Array.isArray(C)?"array":m:"null",m=="array"||m=="object"&&typeof C.length=="number"){m=a.length||0;let N=C.length||0;a.length=m+N;for(let q=0;q<N;q++)a[m+q]=C[q]}else a.push(C)}}class U{constructor(h,m){this.i=h,this.j=m,this.h=0,this.g=null}get(){let h;return this.h>0?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function O(a){c.setTimeout(()=>{throw a},0)}function W(){var a=T;let h=null;return a.g&&(h=a.g,a.g=a.g.next,a.g||(a.h=null),h.next=null),h}class K{constructor(){this.h=this.g=null}add(h,m){let A=Q.get();A.set(h,m),this.h?this.h.next=A:this.g=A,this.h=A}}var Q=new U(()=>new ie,a=>a.reset());class ie{constructor(){this.next=this.g=this.h=null}set(h,m){this.h=h,this.g=m,this.next=null}reset(){this.next=this.g=this.h=null}}let Ae,ne=!1,T=new K,g=()=>{let a=Promise.resolve(void 0);Ae=()=>{a.then(y)}};function y(){for(var a;a=W();){try{a.h.call(a.g)}catch(m){O(m)}var h=Q;h.j(a),h.h<100&&(h.h++,a.next=h.g,h.g=a)}ne=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(a,h){this.type=a,this.g=this.target=h,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,h=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let m=()=>{};c.addEventListener("test",m,h),c.removeEventListener("test",m,h)}catch(m){}return a})();function _(a){return/^[\s\xa0]*$/.test(a)}function we(a,h){E.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,h)}S(we,E),we.prototype.init=function(a,h){let m=this.type=a.type,A=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=h,h=a.relatedTarget,h||(m=="mouseover"?h=a.fromElement:m=="mouseout"&&(h=a.toElement)),this.relatedTarget=h,A?(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&we.Z.h.call(this)},we.prototype.h=function(){we.Z.h.call(this);let a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var lt="closure_listenable_"+(Math.random()*1e6|0),al=0;function yr(a,h,m,A,C){this.listener=a,this.proxy=null,this.src=h,this.type=m,this.capture=!!A,this.ha=C,this.key=++al,this.da=this.fa=!1}function Ut(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function Vn(a,h,m){for(let A in a)h.call(m,a[A],A,a)}function Aa(a,h){for(let m in a)h.call(void 0,a[m],m,a)}function ba(a){let h={};for(let m in a)h[m]=a[m];return h}let St="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ue(a,h){let m,A;for(let C=1;C<arguments.length;C++){A=arguments[C];for(m in A)a[m]=A[m];for(let N=0;N<St.length;N++)m=St[N],Object.prototype.hasOwnProperty.call(A,m)&&(a[m]=A[m])}}function gi(a){this.src=a,this.g={},this.h=0}gi.prototype.add=function(a,h,m,A,C){let N=a.toString();a=this.g[N],a||(a=this.g[N]=[],this.h++);let q=Ks(a,h,A,C);return q>-1?(h=a[q],m||(h.fa=!1)):(h=new yr(h,this.src,N,!!A,C),h.fa=m,a.push(h)),h};function sn(a,h){let m=h.type;if(m in a.g){var A=a.g[m],C=Array.prototype.indexOf.call(A,h,void 0),N;(N=C>=0)&&Array.prototype.splice.call(A,C,1),N&&(Ut(h),a.g[m].length==0&&(delete a.g[m],a.h--))}}function Ks(a,h,m,A){for(let C=0;C<a.length;++C){let N=a[C];if(!N.da&&N.listener==h&&N.capture==!!m&&N.ha==A)return C}return-1}var on="closure_lm_"+(Math.random()*1e6|0),Ws={};function Sa(a,h,m,A,C){if(A&&A.once)return yi(a,h,m,A,C);if(Array.isArray(h)){for(let N=0;N<h.length;N++)Sa(a,h[N],m,A,C);return null}return m=Ti(m),a&&a[lt]?a.J(h,m,u(A)?!!A.capture:!!A,C):Ir(a,h,m,!1,A,C)}function Ir(a,h,m,A,C,N){if(!h)throw Error("Invalid event type");let q=u(C)?!!C.capture:!!C,J=wi(a);if(J||(a[on]=J=new gi(a)),m=J.add(h,m,A,q,N),m.proxy)return m;if(A=_i(),m.proxy=A,A.src=a,A.listener=m,a.addEventListener)b||(C=q),C===void 0&&(C=!1),a.addEventListener(h.toString(),A,C);else if(a.attachEvent)a.attachEvent(Ei(h.toString()),A);else if(a.addListener&&a.removeListener)a.addListener(A);else throw Error("addEventListener and attachEvent are unavailable.");return m}function _i(){function a(m){return h.call(a.src,a.listener,m)}let h=Ra;return a}function yi(a,h,m,A,C){if(Array.isArray(h)){for(let N=0;N<h.length;N++)yi(a,h[N],m,A,C);return null}return m=Ti(m),a&&a[lt]?a.K(h,m,u(A)?!!A.capture:!!A,C):Ir(a,h,m,!0,A,C)}function Ii(a,h,m,A,C){if(Array.isArray(h))for(var N=0;N<h.length;N++)Ii(a,h[N],m,A,C);else A=u(A)?!!A.capture:!!A,m=Ti(m),a&&a[lt]?(a=a.i,N=String(h).toString(),N in a.g&&(h=a.g[N],m=Ks(h,m,A,C),m>-1&&(Ut(h[m]),Array.prototype.splice.call(h,m,1),h.length==0&&(delete a.g[N],a.h--)))):a&&(a=wi(a))&&(h=a.g[h.toString()],a=-1,h&&(a=Ks(h,m,A,C)),(m=a>-1?h[a]:null)&&Er(m))}function Er(a){if(typeof a!="number"&&a&&!a.da){var h=a.src;if(h&&h[lt])sn(h.i,a);else{var m=a.type,A=a.proxy;h.removeEventListener?h.removeEventListener(m,A,a.capture):h.detachEvent?h.detachEvent(Ei(m),A):h.addListener&&h.removeListener&&h.removeListener(A),(m=wi(h))?(sn(m,a),m.h==0&&(m.src=null,h[on]=null)):Ut(a)}}}function Ei(a){return a in Ws?Ws[a]:Ws[a]="on"+a}function Ra(a,h){if(a.da)a=!0;else{h=new we(h,this);let m=a.listener,A=a.ha||a.src;a.fa&&Er(a),a=m.call(A,h)}return a}function wi(a){return a=a[on],a instanceof gi?a:null}var Hs="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ti(a){return typeof a=="function"?a:(a[Hs]||(a[Hs]=function(h){return a.handleEvent(h)}),a[Hs])}function Be(){w.call(this),this.i=new gi(this),this.M=this,this.G=null}S(Be,w),Be.prototype[lt]=!0,Be.prototype.removeEventListener=function(a,h,m,A){Ii(this,a,h,m,A)};function qe(a,h){var m,A=a.G;if(A)for(m=[];A;A=A.G)m.push(A);if(a=a.M,A=h.type||h,typeof h=="string")h=new E(h,a);else if(h instanceof E)h.target=h.target||a;else{var C=h;h=new E(A,a),Ue(h,C)}C=!0;let N,q;if(m)for(q=m.length-1;q>=0;q--)N=h.g=m[q],C=wr(N,A,!0,h)&&C;if(N=h.g=a,C=wr(N,A,!0,h)&&C,C=wr(N,A,!1,h)&&C,m)for(q=0;q<m.length;q++)N=h.g=m[q],C=wr(N,A,!1,h)&&C}Be.prototype.N=function(){if(Be.Z.N.call(this),this.i){var a=this.i;for(let h in a.g){let m=a.g[h];for(let A=0;A<m.length;A++)Ut(m[A]);delete a.g[h],a.h--}}this.G=null},Be.prototype.J=function(a,h,m,A){return this.i.add(String(a),h,!1,m,A)},Be.prototype.K=function(a,h,m,A){return this.i.add(String(a),h,!0,m,A)};function wr(a,h,m,A){if(h=a.i.g[String(h)],!h)return!0;h=h.concat();let C=!0;for(let N=0;N<h.length;++N){let q=h[N];if(q&&!q.da&&q.capture==m){let J=q.listener,o=q.ha||q.src;q.fa&&sn(a.i,q),C=J.call(o,A)!==!1&&C}}return C&&!A.defaultPrevented}function cl(a,h){if(typeof a!="function")if(a&&typeof a.handleEvent=="function")a=f(a.handleEvent,a);else throw Error("Invalid listener argument");return Number(h)>2147483647?-1:c.setTimeout(a,h||0)}function vi(a){a.g=cl(()=>{a.g=null,a.i&&(a.i=!1,vi(a))},a.l);let h=a.h;a.h=null,a.m.apply(null,h)}class Qs extends w{constructor(h,m){super(),this.m=h,this.l=m,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:vi(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function an(a){w.call(this),this.h=a,this.g={}}S(an,w);var $e=[];function We(a){Vn(a.g,function(h,m){this.g.hasOwnProperty(m)&&Er(h)},a),a.g={}}an.prototype.N=function(){an.Z.N.call(this),We(this)},an.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xn=c.JSON.stringify,Pa=c.JSON.parse,Ca=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function Da(){}function On(){}var Ln={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ai(){E.call(this,"d")}S(Ai,E);function Tr(){E.call(this,"c")}S(Tr,E);var cn={},ka=null;function Mn(){return ka=ka||new Be}cn.Ia="serverreachability";function Js(a){E.call(this,cn.Ia,a)}S(Js,E);function Fn(a){let h=Mn();qe(h,new Js(h))}cn.STAT_EVENT="statevent";function Un(a,h){E.call(this,cn.STAT_EVENT,a),this.stat=h}S(Un,E);function je(a){let h=Mn();qe(h,new Un(h,a))}cn.Ja="timingevent";function bi(a,h){E.call(this,cn.Ja,a),this.size=h}S(bi,E);function pt(a,h){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},h)}function Bn(){this.g=!0}Bn.prototype.ua=function(){this.g=!1};function Si(a,h,m,A,C,N){a.info(function(){if(a.g)if(N){var q="",J=N.split("&");for(let l=0;l<J.length;l++){var o=J[l].split("=");if(o.length>1){let p=o[0];o=o[1];let v=p.split("_");q=v.length>=2&&v[1]=="type"?q+(p+"="+o+"&"):q+(p+"=redacted&")}}}else q=null;else q=N;return"XMLHTTP REQ ("+A+") [attempt "+C+"]: "+h+`
`+m+`
`+q})}function Na(a,h,m,A,C,N,q){a.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+C+"]: "+h+`
`+m+`
`+N+" "+q})}function Et(a,h,m,A){a.info(function(){return"XMLHTTP TEXT ("+h+"): "+Je(a,m)+(A?" "+A:"")})}function Va(a,h){a.info(function(){return"TIMEOUT: "+h})}Bn.prototype.info=function(){};function Je(a,h){if(!a.g)return h;if(!h)return null;try{let N=JSON.parse(h);if(N){for(a=0;a<N.length;a++)if(Array.isArray(N[a])){var m=N[a];if(!(m.length<2)){var A=m[1];if(Array.isArray(A)&&!(A.length<1)){var C=A[0];if(C!="noop"&&C!="stop"&&C!="close")for(let q=1;q<A.length;q++)A[q]=""}}}}return xn(N)}catch(N){return h}}var vr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},qn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},$n;function Ys(){}S(Ys,Da),Ys.prototype.g=function(){return new XMLHttpRequest},$n=new Ys;function Ar(a){return encodeURIComponent(String(a))}function jn(a){var h=1;a=a.split(":");let m=[];for(;h>0&&a.length;)m.push(a.shift()),h--;return a.length&&m.push(a.join(":")),m}function Bt(a,h,m,A){this.j=a,this.i=h,this.l=m,this.S=A||1,this.V=new an(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new xa}function xa(){this.i=null,this.g="",this.h=!1}var br={},Ri={};function Sr(a,h,m){a.M=1,a.A=Dr(mt(h)),a.u=m,a.R=!0,Rr(a,null)}function Rr(a,h){a.F=Date.now(),zn(a),a.B=mt(a.A);var m=a.B,A=a.S;Array.isArray(A)||(A=[String(A)]),Ba(m.i,"t",A),a.C=0,m=a.j.L,a.h=new xa,a.g=Bi(a.j,m?h:null,!a.u),a.P>0&&(a.O=new Qs(f(a.Y,a,a.g),a.P)),h=a.V,m=a.g,A=a.ba;var C="readystatechange";Array.isArray(C)||(C&&($e[0]=C.toString()),C=$e);for(let N=0;N<C.length;N++){let q=Sa(m,C[N],A||h.handleEvent,!1,h.h||h);if(!q)break;h.g[q.key]=q}h=a.J?ba(a.J):{},a.u?(a.v||(a.v="POST"),h["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,h)):(a.v="GET",a.g.ea(a.B,a.v,null,h)),Fn(),Si(a.i,a.v,a.B,a.l,a.S,a.u)}Bt.prototype.ba=function(a){a=a.target;let h=this.O;h&&pe(a)==3?h.j():this.Y(a)},Bt.prototype.Y=function(a){try{if(a==this.g)e:{let J=pe(this.g),o=this.g.ya(),l=this.g.ca();if(!(J<3)&&(J!=3||this.g&&(this.h.h||this.g.la()||Wa(this.g)))){this.K||J!=4||o==7||(o==8||l<=0?Fn(3):Fn(2)),Ci(this);var h=this.g.ca();this.X=h;var m=qt(this);if(this.o=h==200,Na(this.i,this.v,this.B,this.l,this.S,J,h),this.o){if(this.U&&!this.L){t:{if(this.g){var A,C=this.g;if((A=C.g?C.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(A)){var N=A;break t}}N=null}if(a=N)Et(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Kn(this,a);else{this.o=!1,this.m=3,je(12),un(this),Gn(this);break e}}if(this.R){a=!0;let p;for(;!this.K&&this.C<m.length;)if(p=Oa(this,m),p==Ri){J==4&&(this.m=4,je(14),a=!1),Et(this.i,this.l,null,"[Incomplete Response]");break}else if(p==br){this.m=4,je(15),Et(this.i,this.l,m,"[Invalid Chunk]"),a=!1;break}else Et(this.i,this.l,p,null),Kn(this,p);if(Xs(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),J!=4||m.length!=0||this.h.h||(this.m=1,je(16),a=!1),this.o=this.o&&a,!a)Et(this.i,this.l,m,"[Invalid Chunked Response]"),un(this),Gn(this);else if(m.length>0&&!this.W){this.W=!0;var q=this.j;q.g==this&&q.aa&&!q.P&&(q.j.info("Great, no buffering proxy detected. Bytes received: "+m.length),Mi(q),q.P=!0,je(11))}}else Et(this.i,this.l,m,null),Kn(this,m);J==4&&un(this),this.o&&!this.K&&(J==4?ho(this.j,this):(this.o=!1,zn(this)))}else ul(this.g),h==400&&m.indexOf("Unknown SID")>0?(this.m=3,je(12)):(this.m=0,je(13)),un(this),Gn(this)}}}catch(J){}};function qt(a){if(!Xs(a))return a.g.la();let h=Wa(a.g);if(h==="")return"";let m="",A=h.length,C=pe(a.g)==4;if(!a.h.i){if(typeof TextDecoder>"u")return un(a),Gn(a),"";a.h.i=new c.TextDecoder}for(let N=0;N<A;N++)a.h.h=!0,m+=a.h.i.decode(h[N],{stream:!(C&&N==A-1)});return h.length=0,a.h.g+=m,a.C=0,a.h.g}function Xs(a){return a.g?a.v=="GET"&&a.M!=2&&a.j.Aa:!1}function Oa(a,h){var m=a.C,A=h.indexOf(`
`,m);return A==-1?Ri:(m=Number(h.substring(m,A)),isNaN(m)?br:(A+=1,A+m>h.length?Ri:(h=h.slice(A,A+m),a.C=A+m,h)))}Bt.prototype.cancel=function(){this.K=!0,un(this)};function zn(a){a.T=Date.now()+a.H,Pi(a,a.H)}function Pi(a,h){if(a.D!=null)throw Error("WatchDog timer not null");a.D=pt(f(a.aa,a),h)}function Ci(a){a.D&&(c.clearTimeout(a.D),a.D=null)}Bt.prototype.aa=function(){this.D=null;let a=Date.now();a-this.T>=0?(Va(this.i,this.B),this.M!=2&&(Fn(),je(17)),un(this),this.m=2,Gn(this)):Pi(this,this.T-a)};function Gn(a){a.j.I==0||a.K||ho(a.j,a)}function un(a){Ci(a);var h=a.O;h&&typeof h.dispose=="function"&&h.dispose(),a.O=null,We(a.V),a.g&&(h=a.g,a.g=null,h.abort(),h.dispose())}function Kn(a,h){try{var m=a.j;if(m.I!=0&&(m.g==a||Pr(m.h,a))){if(!a.L&&Pr(m.h,a)&&m.I==3){try{var A=m.Ba.g.parse(h)}catch(l){A=null}if(Array.isArray(A)&&A.length==3){var C=A;if(C[0]==0){e:if(!m.v){if(m.g)if(m.g.F+3e3<a.F)Fi(m),ln(m);else break e;er(m),je(18)}}else m.xa=C[1],0<m.xa-m.K&&C[2]<37500&&m.F&&m.A==0&&!m.C&&(m.C=pt(f(m.Va,m),6e3));$t(m.h)<=1&&m.ta&&(m.ta=void 0)}else zt(m,11)}else if((a.L||m.g==a)&&Fi(m),!_(h))for(C=m.Ba.g.parse(h),h=0;h<C.length;h++){let l=C[h],p=l[0];if(!(p<=m.K))if(m.K=p,l=l[1],m.I==2)if(l[0]=="c"){m.M=l[1],m.ba=l[2];let v=l[3];v!=null&&(m.ka=v,m.j.info("VER="+m.ka));let D=l[4];D!=null&&(m.za=D,m.j.info("SVER="+m.za));let V=l[5];V!=null&&typeof V=="number"&&V>0&&(A=1.5*V,m.O=A,m.j.info("backChannelRequestTimeoutMs_="+A)),A=m;let B=a.g;if(B){let he=B.g?B.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(he){var N=A.h;N.g||he.indexOf("spdy")==-1&&he.indexOf("quic")==-1&&he.indexOf("h2")==-1||(N.j=N.l,N.g=new Set,N.h&&(Zs(N,N.h),N.h=null))}if(A.G){let Pe=B.g?B.g.getResponseHeader("X-HTTP-Session-Id"):null;Pe&&(A.wa=Pe,_e(A.J,A.G,Pe))}}m.I=3,m.l&&m.l.ra(),m.aa&&(m.T=Date.now()-a.F,m.j.info("Handshake RTT: "+m.T+"ms")),A=m;var q=a;if(A.na=Ui(A,A.L?A.ba:null,A.W),q.L){eo(A.h,q);var J=q,o=A.O;o&&(J.H=o),J.D&&(Ci(J),zn(J)),A.g=q}else Li(A);m.i.length>0&&dt(m)}else l[0]!="stop"&&l[0]!="close"||zt(m,7);else m.I==3&&(l[0]=="stop"||l[0]=="close"?l[0]=="stop"?zt(m,7):Oi(m):l[0]!="noop"&&m.l&&m.l.qa(l),m.A=0)}}Fn(4)}catch(l){}}var La=class{constructor(a,h){this.g=a,this.map=h}};function Di(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=a.length>0&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Wn(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function $t(a){return a.h?1:a.g?a.g.size:0}function Pr(a,h){return a.h?a.h==h:a.g?a.g.has(h):!1}function Zs(a,h){a.g?a.g.add(h):a.h=h}function eo(a,h){a.h&&a.h==h?a.h=null:a.g&&a.g.has(h)&&a.g.delete(h)}Di.prototype.cancel=function(){if(this.i=to(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function to(a){if(a.h!=null)return a.i.concat(a.h.G);if(a.g!=null&&a.g.size!==0){let h=a.i;for(let m of a.g.values())h=h.concat(m.G);return h}return k(a.i)}var no=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ro(a,h){if(a){a=a.split("&");for(let m=0;m<a.length;m++){let A=a[m].indexOf("="),C,N=null;A>=0?(C=a[m].substring(0,A),N=a[m].substring(A+1)):C=a[m],h(C,N?decodeURIComponent(N.replace(/\+/g," ")):"")}}}function wt(a){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let h;a instanceof wt?(this.l=a.l,Hn(this,a.j),this.o=a.o,this.g=a.g,Cr(this,a.u),this.h=a.h,io(this,qa(a.i)),this.m=a.m):a&&(h=String(a).match(no))?(this.l=!1,Hn(this,h[1]||"",!0),this.o=kr(h[2]||""),this.g=kr(h[3]||"",!0),Cr(this,h[4]),this.h=kr(h[5]||"",!0),io(this,h[6]||"",!0),this.m=kr(h[7]||"")):(this.l=!1,this.i=new Pt(null,this.l))}wt.prototype.toString=function(){let a=[];var h=this.j;h&&a.push(gt(h,Nr,!0),":");var m=this.g;return(m||h=="file")&&(a.push("//"),(h=this.o)&&a.push(gt(h,Nr,!0),"@"),a.push(Ar(m).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m=this.u,m!=null&&a.push(":",String(m))),(m=this.h)&&(this.g&&m.charAt(0)!="/"&&a.push("/"),a.push(gt(m,m.charAt(0)=="/"?Ma:ki,!0))),(m=this.i.toString())&&a.push("?",m),(m=this.m)&&a.push("#",gt(m,Ni)),a.join("")},wt.prototype.resolve=function(a){let h=mt(this),m=!!a.j;m?Hn(h,a.j):m=!!a.o,m?h.o=a.o:m=!!a.g,m?h.g=a.g:m=a.u!=null;var A=a.h;if(m)Cr(h,a.u);else if(m=!!a.h){if(A.charAt(0)!="/")if(this.g&&!this.h)A="/"+A;else{var C=h.h.lastIndexOf("/");C!=-1&&(A=h.h.slice(0,C+1)+A)}if(C=A,C==".."||C==".")A="";else if(C.indexOf("./")!=-1||C.indexOf("/.")!=-1){A=C.lastIndexOf("/",0)==0,C=C.split("/");let N=[];for(let q=0;q<C.length;){let J=C[q++];J=="."?A&&q==C.length&&N.push(""):J==".."?((N.length>1||N.length==1&&N[0]!="")&&N.pop(),A&&q==C.length&&N.push("")):(N.push(J),A=!0)}A=N.join("/")}else A=C}return m?h.h=A:m=a.i.toString()!=="",m?io(h,qa(a.i)):m=!!a.m,m&&(h.m=a.m),h};function mt(a){return new wt(a)}function Hn(a,h,m){a.j=m?kr(h,!0):h,a.j&&(a.j=a.j.replace(/:$/,""))}function Cr(a,h){if(h){if(h=Number(h),isNaN(h)||h<0)throw Error("Bad port number "+h);a.u=h}else a.u=null}function io(a,h,m){h instanceof Pt?(a.i=h,Vr(a.i,a.l)):(m||(h=gt(h,Ie)),a.i=new Pt(h,a.l))}function _e(a,h,m){a.i.set(h,m)}function Dr(a){return _e(a,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),a}function kr(a,h){return a?h?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function gt(a,h,m){return typeof a=="string"?(a=encodeURI(a).replace(h,Rt),m&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Rt(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Nr=/[#\/\?@]/g,ki=/[#\?:]/g,Ma=/[#\?]/g,Ie=/[#\?@]/g,Ni=/#/g;function Pt(a,h){this.h=this.g=null,this.i=a||null,this.j=!!h}function _t(a){a.g||(a.g=new Map,a.h=0,a.i&&ro(a.i,function(h,m){a.add(decodeURIComponent(h.replace(/\+/g," ")),m)}))}n=Pt.prototype,n.add=function(a,h){_t(this),this.i=null,a=Qn(this,a);let m=this.g.get(a);return m||this.g.set(a,m=[]),m.push(h),this.h+=1,this};function Fa(a,h){_t(a),h=Qn(a,h),a.g.has(h)&&(a.i=null,a.h-=a.g.get(h).length,a.g.delete(h))}function so(a,h){return _t(a),h=Qn(a,h),a.g.has(h)}n.forEach=function(a,h){_t(this),this.g.forEach(function(m,A){m.forEach(function(C){a.call(h,C,A,this)},this)},this)};function Ua(a,h){_t(a);let m=[];if(typeof h=="string")so(a,h)&&(m=m.concat(a.g.get(Qn(a,h))));else for(a=Array.from(a.g.values()),h=0;h<a.length;h++)m=m.concat(a[h]);return m}n.set=function(a,h){return _t(this),this.i=null,a=Qn(this,a),so(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[h]),this.h+=1,this},n.get=function(a,h){return a?(a=Ua(this,a),a.length>0?String(a[0]):h):h};function Ba(a,h,m){Fa(a,h),m.length>0&&(a.i=null,a.g.set(Qn(a,h),k(m)),a.h+=m.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],h=Array.from(this.g.keys());for(let A=0;A<h.length;A++){var m=h[A];let C=Ar(m);m=Ua(this,m);for(let N=0;N<m.length;N++){let q=C;m[N]!==""&&(q+="="+Ar(m[N])),a.push(q)}}return this.i=a.join("&")};function qa(a){let h=new Pt;return h.i=a.i,a.g&&(h.g=new Map(a.g),h.h=a.h),h}function Qn(a,h){return h=String(h),a.j&&(h=h.toLowerCase()),h}function Vr(a,h){h&&!a.j&&(_t(a),a.i=null,a.g.forEach(function(m,A){let C=A.toLowerCase();A!=C&&(Fa(this,A),Ba(this,C,m))},a)),a.j=h}function jt(a,h){let m=new Bn;if(c.Image){let A=new Image;A.onload=I(Ct,m,"TestLoadImage: loaded",!0,h,A),A.onerror=I(Ct,m,"TestLoadImage: error",!1,h,A),A.onabort=I(Ct,m,"TestLoadImage: abort",!1,h,A),A.ontimeout=I(Ct,m,"TestLoadImage: timeout",!1,h,A),c.setTimeout(function(){A.ontimeout&&A.ontimeout()},1e4),A.src=a}else h(!1)}function $a(a,h){let m=new Bn,A=new AbortController,C=setTimeout(()=>{A.abort(),Ct(m,"TestPingServer: timeout",!1,h)},1e4);fetch(a,{signal:A.signal}).then(N=>{clearTimeout(C),N.ok?Ct(m,"TestPingServer: ok",!0,h):Ct(m,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(C),Ct(m,"TestPingServer: error",!1,h)})}function Ct(a,h,m,A,C){try{C&&(C.onload=null,C.onerror=null,C.onabort=null,C.ontimeout=null),A(m)}catch(N){}}function ja(){this.g=new Ca}function Dt(a){this.i=a.Sb||null,this.h=a.ab||!1}S(Dt,Da),Dt.prototype.g=function(){return new Vi(this.i,this.h)};function Vi(a,h){Be.call(this),this.H=a,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}S(Vi,Be),n=Vi.prototype,n.open=function(a,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=h,this.readyState=1,ht(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let h={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(h.body=a),(this.H||c).fetch(new Request(this.D,h)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,xr(this)),this.readyState=0},n.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ht(this)),this.g&&(this.readyState=3,ht(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;za(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))};function za(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}n.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var h=a.value?a.value:new Uint8Array(0);(h=this.B.decode(h,{stream:!a.done}))&&(this.response=this.responseText+=h)}a.done?xr(this):ht(this),this.readyState==3&&za(this)}},n.Oa=function(a){this.g&&(this.response=this.responseText=a,xr(this))},n.Na=function(a){this.g&&(this.response=a,xr(this))},n.ga=function(){this.g&&xr(this)};function xr(a){a.readyState=4,a.l=null,a.j=null,a.B=null,ht(a)}n.setRequestHeader=function(a,h){this.A.append(a,h)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],h=this.h.entries();for(var m=h.next();!m.done;)m=m.value,a.push(m[0]+": "+m[1]),m=h.next();return a.join(`\r
`)};function ht(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Vi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Ga(a){let h="";return Vn(a,function(m,A){h+=A,h+=":",h+=m,h+=`\r
`}),h}function oo(a,h,m){e:{for(A in m){var A=!1;break e}A=!0}A||(m=Ga(m),typeof a=="string"?m!=null&&Ar(m):_e(a,h,m))}function ye(a){Be.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}S(ye,Be);var xi=/^https?$/i,Ka=["POST","PUT"];n=ye.prototype,n.Fa=function(a){this.H=a},n.ea=function(a,h,m,A){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);h=h?h.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():$n.g(),this.g.onreadystatechange=R(f(this.Ca,this));try{this.B=!0,this.g.open(h,String(a),!0),this.B=!1}catch(N){Jn(this,N);return}if(a=m||"",m=new Map(this.headers),A)if(Object.getPrototypeOf(A)===Object.prototype)for(var C in A)m.set(C,A[C]);else if(typeof A.keys=="function"&&typeof A.get=="function")for(let N of A.keys())m.set(N,A.get(N));else throw Error("Unknown input type for opt_headers: "+String(A));A=Array.from(m.keys()).find(N=>N.toLowerCase()=="content-type"),C=c.FormData&&a instanceof c.FormData,!(Array.prototype.indexOf.call(Ka,h,void 0)>=0)||A||C||m.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[N,q]of m)this.g.setRequestHeader(N,q);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(N){Jn(this,N)}};function Jn(a,h){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=h,a.o=5,Yn(a),Xn(a)}function Yn(a){a.A||(a.A=!0,qe(a,"complete"),qe(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,qe(this,"complete"),qe(this,"abort"),Xn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xn(this,!0)),ye.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ao(this):this.Xa())},n.Xa=function(){ao(this)};function ao(a){if(a.h&&typeof s<"u"){if(a.v&&pe(a)==4)setTimeout(a.Ca.bind(a),0);else if(qe(a,"readystatechange"),pe(a)==4){a.h=!1;try{let N=a.ca();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var m;if(!(m=h)){var A;if(A=N===0){let q=String(a.D).match(no)[1]||null;!q&&c.self&&c.self.location&&(q=c.self.location.protocol.slice(0,-1)),A=!xi.test(q?q.toLowerCase():"")}m=A}if(m)qe(a,"complete"),qe(a,"success");else{a.o=6;try{var C=pe(a)>2?a.g.statusText:""}catch(q){C=""}a.l=C+" ["+a.ca()+"]",Yn(a)}}finally{Xn(a)}}}}function Xn(a,h){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);let m=a.g;a.g=null,h||qe(a,"ready");try{m.onreadystatechange=null}catch(A){}}}n.isActive=function(){return!!this.g};function pe(a){return a.g?a.g.readyState:0}n.ca=function(){try{return pe(this)>2?this.g.status:-1}catch(a){return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch(a){return""}},n.La=function(a){if(this.g){var h=this.g.responseText;return a&&h.indexOf(a)==0&&(h=h.substring(a.length)),Pa(h)}};function Wa(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(h){return null}}function ul(a){let h={};a=(a.g&&pe(a)>=2&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let A=0;A<a.length;A++){if(_(a[A]))continue;var m=jn(a[A]);let C=m[0];if(m=m[1],typeof m!="string")continue;m=m.trim();let N=h[C]||[];h[C]=N,N.push(m)}Aa(h,function(A){return A.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Zn(a,h,m){return m&&m.internalChannelParams&&m.internalChannelParams[a]||h}function co(a){this.za=0,this.i=[],this.j=new Bn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Zn("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Zn("baseRetryDelayMs",5e3,a),this.Za=Zn("retryDelaySeedMs",1e4,a),this.Ta=Zn("forwardChannelMaxRetries",2,a),this.va=Zn("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new Di(a&&a.concurrentRequestLimit),this.Ba=new ja,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=co.prototype,n.ka=8,n.I=1,n.connect=function(a,h,m,A){je(0),this.W=a,this.H=h||{},m&&A!==void 0&&(this.H.OSID=m,this.H.OAID=A),this.F=this.X,this.J=Ui(this,null,this.W),dt(this)};function Oi(a){if(uo(a),a.I==3){var h=a.V++,m=mt(a.J);if(_e(m,"SID",a.M),_e(m,"RID",h),_e(m,"TYPE","terminate"),kt(a,m),h=new Bt(a,a.j,h),h.M=2,h.A=Dr(mt(m)),m=!1,c.navigator&&c.navigator.sendBeacon)try{m=c.navigator.sendBeacon(h.A.toString(),"")}catch(A){}!m&&c.Image&&(new Image().src=h.A,m=!0),m||(h.g=Bi(h.j,null),h.g.ea(h.A)),h.F=Date.now(),zn(h)}fo(a)}function ln(a){a.g&&(Mi(a),a.g.cancel(),a.g=null)}function uo(a){ln(a),a.v&&(c.clearTimeout(a.v),a.v=null),Fi(a),a.h.cancel(),a.m&&(typeof a.m=="number"&&c.clearTimeout(a.m),a.m=null)}function dt(a){if(!Wn(a.h)&&!a.m){a.m=!0;var h=a.Ea;Ae||g(),ne||(Ae(),ne=!0),T.add(h,a),a.D=0}}function Ha(a,h){return $t(a.h)>=a.h.j-(a.m?1:0)?!1:a.m?(a.i=h.G.concat(a.i),!0):a.I==1||a.I==2||a.D>=(a.Sa?0:a.Ta)?!1:(a.m=pt(f(a.Ea,a,h),tr(a,a.D)),a.D++,!0)}n.Ea=function(a){if(this.m)if(this.m=null,this.I==1){if(!a){this.V=Math.floor(Math.random()*1e5),a=this.V++;let C=new Bt(this,this.j,a),N=this.o;if(this.U&&(N?(N=ba(N),Ue(N,this.U)):N=this.U),this.u!==null||this.R||(C.J=N,N=null),this.S)e:{for(var h=0,m=0;m<this.i.length;m++){t:{var A=this.i[m];if("__data__"in A.map&&(A=A.map.__data__,typeof A=="string")){A=A.length;break t}A=void 0}if(A===void 0)break;if(h+=A,h>4096){h=m;break e}if(h===4096||m===this.i.length-1){h=m+1;break e}}h=1e3}else h=1e3;h=lo(this,C,h),m=mt(this.J),_e(m,"RID",a),_e(m,"CVER",22),this.G&&_e(m,"X-HTTP-Session-Id",this.G),kt(this,m),N&&(this.R?h="headers="+Ar(Ga(N))+"&"+h:this.u&&oo(m,this.u,N)),Zs(this.h,C),this.Ra&&_e(m,"TYPE","init"),this.S?(_e(m,"$req",h),_e(m,"SID","null"),C.U=!0,Sr(C,m,null)):Sr(C,m,h),this.I=2}}else this.I==3&&(a?Qa(this,a):this.i.length==0||Wn(this.h)||Qa(this))};function Qa(a,h){var m;h?m=h.l:m=a.V++;let A=mt(a.J);_e(A,"SID",a.M),_e(A,"RID",m),_e(A,"AID",a.K),kt(a,A),a.u&&a.o&&oo(A,a.u,a.o),m=new Bt(a,a.j,m,a.D+1),a.u===null&&(m.J=a.o),h&&(a.i=h.G.concat(a.i)),h=lo(a,m,1e3),m.H=Math.round(a.va*.5)+Math.round(a.va*.5*Math.random()),Zs(a.h,m),Sr(m,A,h)}function kt(a,h){a.H&&Vn(a.H,function(m,A){_e(h,A,m)}),a.l&&Vn({},function(m,A){_e(h,A,m)})}function lo(a,h,m){m=Math.min(a.i.length,m);let A=a.l?f(a.l.Ka,a.l,a):null;e:{var C=a.i;let J=-1;for(;;){let o=["count="+m];J==-1?m>0?(J=C[0].g,o.push("ofs="+J)):J=0:o.push("ofs="+J);let l=!0;for(let p=0;p<m;p++){var N=C[p].g;let v=C[p].map;if(N-=J,N<0)J=Math.max(0,C[p].g-100),l=!1;else try{N="req"+N+"_"||"";try{var q=v instanceof Map?v:Object.entries(v);for(let[D,V]of q){let B=V;u(V)&&(B=xn(V)),o.push(N+D+"="+encodeURIComponent(B))}}catch(D){throw o.push(N+"type="+encodeURIComponent("_badmap")),D}}catch(D){A&&A(v)}}if(l){q=o.join("&");break e}}q=void 0}return a=a.i.splice(0,m),h.G=a,q}function Li(a){if(!a.g&&!a.v){a.Y=1;var h=a.Da;Ae||g(),ne||(Ae(),ne=!0),T.add(h,a),a.A=0}}function er(a){return a.g||a.v||a.A>=3?!1:(a.Y++,a.v=pt(f(a.Da,a),tr(a,a.A)),a.A++,!0)}n.Da=function(){if(this.v=null,Or(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=pt(f(this.Wa,this),a)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,je(10),ln(this),Or(this))};function Mi(a){a.B!=null&&(c.clearTimeout(a.B),a.B=null)}function Or(a){a.g=new Bt(a,a.j,"rpc",a.Y),a.u===null&&(a.g.J=a.o),a.g.P=0;var h=mt(a.na);_e(h,"RID","rpc"),_e(h,"SID",a.M),_e(h,"AID",a.K),_e(h,"CI",a.F?"0":"1"),!a.F&&a.ia&&_e(h,"TO",a.ia),_e(h,"TYPE","xmlhttp"),kt(a,h),a.u&&a.o&&oo(h,a.u,a.o),a.O&&(a.g.H=a.O);var m=a.g;a=a.ba,m.M=1,m.A=Dr(mt(h)),m.u=null,m.R=!0,Rr(m,a)}n.Va=function(){this.C!=null&&(this.C=null,ln(this),er(this),je(19))};function Fi(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function ho(a,h){var m=null;if(a.g==h){Fi(a),Mi(a),a.g=null;var A=2}else if(Pr(a.h,h))m=h.G,eo(a.h,h),A=1;else return;if(a.I!=0){if(h.o)if(A==1){m=h.u?h.u.length:0,h=Date.now()-h.F;var C=a.D;A=Mn(),qe(A,new bi(A,m)),dt(a)}else Li(a);else if(C=h.m,C==3||C==0&&h.X>0||!(A==1&&Ha(a,h)||A==2&&er(a)))switch(m&&m.length>0&&(h=a.h,h.i=h.i.concat(m)),C){case 1:zt(a,5);break;case 4:zt(a,10);break;case 3:zt(a,6);break;default:zt(a,2)}}}function tr(a,h){let m=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(m*=2),m*h}function zt(a,h){if(a.j.info("Error code "+h),h==2){var m=f(a.bb,a),A=a.Ua;let C=!A;A=new wt(A||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Hn(A,"https"),Dr(A),C?jt(A.toString(),m):$a(A.toString(),m)}else je(2);a.I=0,a.l&&a.l.pa(h),fo(a),uo(a)}n.bb=function(a){a?(this.j.info("Successfully pinged google.com"),je(2)):(this.j.info("Failed to ping google.com"),je(1))};function fo(a){if(a.I=0,a.ja=[],a.l){let h=to(a.h);(h.length!=0||a.i.length!=0)&&(x(a.ja,h),x(a.ja,a.i),a.h.i.length=0,k(a.i),a.i.length=0),a.l.oa()}}function Ui(a,h,m){var A=m instanceof wt?mt(m):new wt(m);if(A.g!="")h&&(A.g=h+"."+A.g),Cr(A,A.u);else{var C=c.location;A=C.protocol,h=h?h+"."+C.hostname:C.hostname,C=+C.port;let N=new wt(null);A&&Hn(N,A),h&&(N.g=h),C&&Cr(N,C),m&&(N.h=m),A=N}return m=a.G,h=a.wa,m&&h&&_e(A,m,h),_e(A,"VER",a.ka),kt(a,A),A}function Bi(a,h,m){if(h&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return h=a.Aa&&!a.ma?new ye(new Dt({ab:m})):new ye(a.ma),h.Fa(a.L),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function po(){}n=po.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function hn(){}hn.prototype.g=function(a,h){return new Xe(a,h)};function Xe(a,h){Be.call(this),this.g=new co(h),this.l=a,this.h=h&&h.messageUrlParams||null,a=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(a?a["X-WebChannel-Content-Type"]=h.messageContentType:a={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.sa&&(a?a["X-WebChannel-Client-Profile"]=h.sa:a={"X-WebChannel-Client-Profile":h.sa}),this.g.U=a,(a=h&&h.Qb)&&!_(a)&&(this.g.u=a),this.A=h&&h.supportsCrossDomainXhr||!1,this.v=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!_(h)&&(this.g.G=h,a=this.h,a!==null&&h in a&&(a=this.h,h in a&&delete a[h])),this.j=new dn(this)}S(Xe,Be),Xe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Xe.prototype.close=function(){Oi(this.g)},Xe.prototype.o=function(a){var h=this.g;if(typeof a=="string"){var m={};m.__data__=a,a=m}else this.v&&(m={},m.__data__=xn(a),a=m);h.i.push(new La(h.Ya++,a)),h.I==3&&dt(h)},Xe.prototype.N=function(){this.g.l=null,delete this.j,Oi(this.g),delete this.g,Xe.Z.N.call(this)};function mo(a){Ai.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var h=a.__sm__;if(h){e:{for(let m in h){a=m;break e}a=void 0}(this.i=a)&&(a=this.i,h=h!==null&&a in h?h[a]:void 0),this.data=h}else this.data=a}S(mo,Ai);function Gt(){Tr.call(this),this.status=1}S(Gt,Tr);function dn(a){this.g=a}S(dn,po),dn.prototype.ra=function(){qe(this.g,"a")},dn.prototype.qa=function(a){qe(this.g,new mo(a))},dn.prototype.pa=function(a){qe(this.g,new Gt)},dn.prototype.oa=function(){qe(this.g,"b")},hn.prototype.createWebChannel=hn.prototype.g,Xe.prototype.send=Xe.prototype.o,Xe.prototype.open=Xe.prototype.m,Xe.prototype.close=Xe.prototype.close,Af=bn.createWebChannelTransport=function(){return new hn},vf=bn.getStatEventTarget=function(){return Mn()},Tf=bn.Event=cn,_u=bn.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},vr.NO_ERROR=0,vr.TIMEOUT=8,vr.HTTP_ERROR=6,na=bn.ErrorCode=vr,qn.COMPLETE="complete",wf=bn.EventType=qn,On.EventType=Ln,Ln.OPEN="a",Ln.CLOSE="b",Ln.ERROR="c",Ln.MESSAGE="d",Be.prototype.listen=Be.prototype.J,Ts=bn.WebChannel=On,A0=bn.FetchXmlHttpFactory=Dt,ye.prototype.listenOnce=ye.prototype.K,ye.prototype.getLastError=ye.prototype.Ha,ye.prototype.getLastErrorCode=ye.prototype.ya,ye.prototype.getStatus=ye.prototype.ca,ye.prototype.getResponseJson=ye.prototype.La,ye.prototype.getResponseText=ye.prototype.la,ye.prototype.send=ye.prototype.ea,ye.prototype.setWithCredentials=ye.prototype.Fa,Ef=bn.XhrIo=ye}).apply(typeof gu<"u"?gu:typeof self<"u"?self:typeof window<"u"?window:{});var Qe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Qe.UNAUTHENTICATED=new Qe(null),Qe.GOOGLE_CREDENTIALS=new Qe("google-credentials-uid"),Qe.FIRST_PARTY=new Qe("first-party-uid"),Qe.MOCK_USER=new Qe("mock-user");var qs="12.9.0";function CI(n){qs=n}var ni=new Wt("@firebase/firestore");function vs(){return ni.logLevel}function z(n,...e){if(ni.logLevel<=se.DEBUG){let t=e.map(qp);ni.debug(`Firestore (${qs}): ${n}`,...t)}}function ri(n,...e){if(ni.logLevel<=se.ERROR){let t=e.map(qp);ni.error(`Firestore (${qs}): ${n}`,...t)}}function ii(n,...e){if(ni.logLevel<=se.WARN){let t=e.map(qp);ni.warn(`Firestore (${qs}): ${n}`,...t)}}function qp(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch(e){return n}}function ee(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,DI(n,r,t)}function DI(n,e,t){let r=`FIRESTORE (${qs}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch(i){r+=" CONTEXT: "+t}throw ri(r),new Error(r)}function Re(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||DI(e,i,r)}function Ee(n,e){return n}var L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},G=class extends Tt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Sn=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Au=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},bu=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Qe.UNAUTHENTICATED))}shutdown(){}},Cf=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Su=class{constructor(e){this.t=e,this.currentUser=Qe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Re(this.o===void 0,42304);let r=this.i,i=d=>this.i!==r?(r=this.i,t(d)):Promise.resolve(),s=new Sn;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Sn,e.enqueueRetryable(()=>i(this.currentUser))};let c=()=>{let d=s;e.enqueueRetryable(()=>P(this,null,function*(){yield d.promise,yield i(this.currentUser)}))},u=d=>{z("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit(d=>u(d)),setTimeout(()=>{if(!this.auth){let d=this.t.getImmediate({optional:!0});d?u(d):(z("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Sn)}},0),c()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(z("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Re(typeof r.accessToken=="string",31837,{l:r}),new Au(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Re(e===null||typeof e=="string",2055,{h:e}),new Qe(e)}},Df=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Qe.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}},kf=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new Df(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Qe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ru=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Pu=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,pn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Re(this.o===void 0,3512);let r=s=>{s.error!=null&&z("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let c=s.token!==this.m;return this.m=s.token,z("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{z("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):z("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ru(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Re(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ru(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function b0(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var si=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=b0(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function ge(n,e){return n<e?-1:n>e?1:0}function Nf(n,e){let t=Math.min(n.length,e.length);for(let r=0;r<t;r++){let i=n.charAt(r),s=e.charAt(r);if(i!==s)return bf(i)===bf(s)?ge(i,s):bf(i)?1:-1}return ge(n.length,e.length)}var S0=55296,R0=57343;function bf(n){let e=n.charCodeAt(0);return e>=S0&&e<=R0}function Ps(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var Jy="__name__",Cu=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&ee(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ee(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return ge(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):Nf(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return mu.fromString(e.substring(4,e.length-2))}},Se=class n extends Cu{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new G(L.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},P0=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ft=class n extends Cu{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return P0.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Jy}static keyField(){return new n([Jy])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new G(L.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},c=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new G(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let d=e[i+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new G(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else u==="`"?(c=!c,i++):u!=="."||c?(r+=u,i++):(s(),i++)}if(s(),c)throw new G(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var te=class n{constructor(e){this.path=e}static fromPath(e){return new n(Se.fromString(e))}static fromName(e){return new n(Se.fromString(e).popFirst(5))}static empty(){return new n(Se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Se.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new Se(e.slice()))}};function kI(n,e,t){if(!t)throw new G(L.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function NI(n,e,t,r){if(e===!0&&r===!0)throw new G(L.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Yy(n){if(!te.isDocumentKey(n))throw new G(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Xy(n){if(te.isDocumentKey(n))throw new G(L.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function VI(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Yu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ee(12329,{type:typeof n})}function _a(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new G(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Yu(n);throw new G(L.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ke(n,e){let t={typeString:n};return e&&(t.value=e),t}function $s(n,e){if(!VI(n))throw new G(L.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let c=n[r];if(i&&typeof c!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&c!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new G(L.INVALID_ARGUMENT,t);return!0}var Zy=-62135596800,eI=1e6,Fe=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*eI);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new G(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new G(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Zy)throw new G(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new G(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/eI}_compareTo(e){return this.seconds===e.seconds?ge(this.nanoseconds,e.nanoseconds):ge(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if($s(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Zy;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};Fe._jsonSchemaVersion="firestore/timestamp/1.0",Fe._jsonSchema={type:ke("string",Fe._jsonSchemaVersion),seconds:ke("number"),nanoseconds:ke("number")};var be=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new Fe(0,0))}static max(){return new n(new Fe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ca=-1,Du=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};Du.UNKNOWN_ID=-1;function C0(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=be.fromTimestamp(r===1e9?new Fe(t+1,0):new Fe(t,r));return new oi(i,te.empty(),e)}function D0(n){return new oi(n.readTime,n.key,ca)}var oi=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(be.min(),te.empty(),ca)}static max(){return new n(be.max(),te.empty(),ca)}};function k0(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=te.comparator(n.documentKey,e.documentKey),t!==0?t:ge(n.largestBatchId,e.largestBatchId))}var N0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Vf=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function $p(n){return P(this,null,function*(){if(n.code!==L.FAILED_PRECONDITION||n.message!==N0)throw n;z("LocalStore","Unexpectedly lost primary lease")})}var F=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ee(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,c=!1;e.forEach(u=>{++i,u.next(()=>{++s,c&&s===i&&t()},d=>r(d))}),c=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,c=new Array(s),u=0;for(let d=0;d<s;d++){let f=d;t(e[f]).next(I=>{c[f]=I,++u,u===s&&r(c)},I=>i(I))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};function V0(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ya(n){return n.name==="IndexedDbTransactionError"}var xI=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>r.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}n.ce=-1;return n})(),jp=-1;function zp(n){return n==null}function ua(n){return n===0&&1/n==-1/0}function x0(n){return typeof n=="number"&&Number.isInteger(n)&&!ua(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var OI="";function O0(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=tI(e)),e=L0(n.get(t),e);return tI(e)}function L0(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case OI:t+="";break;default:t+=s}}return t}function tI(n){return n+OI+""}var M0="remoteDocuments",LI="owner";var MI="mutationQueues";var FI="mutations";var UI="documentMutations",F0="remoteDocumentsV14";var BI="remoteDocumentGlobal";var qI="targets";var $I="targetDocuments";var jI="targetGlobal",zI="collectionParents";var GI="clientMetadata";var KI="bundles";var WI="namedQueries";var U0="indexConfiguration";var B0="indexState";var q0="indexEntries";var HI="documentOverlays";var $0="globals";var j0=[MI,FI,UI,M0,qI,LI,jI,$I,GI,BI,zI,KI,WI],_k=[...j0,HI],z0=[MI,FI,UI,F0,qI,LI,jI,$I,GI,BI,zI,KI,WI,HI],G0=z0,K0=[...G0,U0,B0,q0];var yk=[...K0,$0];function nI(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function pi(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function QI(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var It=class n{constructor(e,t){this.comparator=e,this.root=t||tn.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tn.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new bs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new bs(this.root,e,this.comparator,!1)}getReverseIterator(){return new bs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new bs(this.root,e,this.comparator,!0)}},bs=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},tn=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ee(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ee(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw ee(27949);return e+(this.isRed()?0:1)}};tn.EMPTY=null,tn.RED=!0,tn.BLACK=!1;tn.EMPTY=new class{constructor(){this.size=0}get key(){throw ee(57766)}get value(){throw ee(16141)}get color(){throw ee(16727)}get left(){throw ee(29726)}get right(){throw ee(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new tn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var ot=class n{constructor(e){this.comparator=e,this.data=new It(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ku(this.data.getIterator())}getIteratorFrom(e){return new ku(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ku=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var en=class n{constructor(e){this.fields=e,e.sort(ft.comparator)}static empty(){return new n([])}unionWith(e){let t=new ot(ft.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ps(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var xf=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var nn=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new xf("Invalid base64 string: "+s):s}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let s="";for(let c=0;c<i.length;++c)s+=String.fromCharCode(i[c]);return s})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ge(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};nn.EMPTY_BYTE_STRING=new nn("");var W0=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mr(n){if(Re(!!n,39018),typeof n=="string"){let e=0,t=W0.exec(n);if(Re(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Me(n.seconds),nanos:Me(n.nanos)}}function Me(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ai(n){return typeof n=="string"?nn.fromBase64String(n):nn.fromUint8Array(n)}var JI="server_timestamp",YI="__type__",XI="__previous_value__",ZI="__local_write_time__";function Xu(n){return(n?.mapValue?.fields||{})[YI]?.stringValue===JI}function Gp(n){let e=n.mapValue.fields[XI];return Xu(e)?Gp(e):e}function Nu(n){let e=mr(n.mapValue.fields[ZI].timestampValue);return new Fe(e.seconds,e.nanos)}var Of=class{constructor(e,t,r,i,s,c,u,d,f,I,S){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=c,this.autoDetectLongPolling=u,this.longPollingOptions=d,this.useFetchStreams=f,this.isUsingEmulator=I,this.apiKey=S}},Vu="(default)",xu=class n{constructor(e,t){this.projectId=e,this.database=t||Vu}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Vu}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function eE(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new G(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xu(n.options.projectId,e)}var Kp="__type__",tE="__max__",yu={mapValue:{fields:{__type__:{stringValue:tE}}}},Wp="__vector__",la="value";function ci(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Xu(n)?4:rE(n)?9007199254740991:nE(n)?10:11:ee(28295,{value:n})}function rn(n,e){if(n===e)return!0;let t=ci(n);if(t!==ci(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Nu(n).isEqual(Nu(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let c=mr(i.timestampValue),u=mr(s.timestampValue);return c.seconds===u.seconds&&c.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return ai(i.bytesValue).isEqual(ai(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return Me(i.geoPointValue.latitude)===Me(s.geoPointValue.latitude)&&Me(i.geoPointValue.longitude)===Me(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return Me(i.integerValue)===Me(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let c=Me(i.doubleValue),u=Me(s.doubleValue);return c===u?ua(c)===ua(u):isNaN(c)&&isNaN(u)}return!1})(n,e);case 9:return Ps(n.arrayValue.values||[],e.arrayValue.values||[],rn);case 10:case 11:return(function(i,s){let c=i.mapValue.fields||{},u=s.mapValue.fields||{};if(nI(c)!==nI(u))return!1;for(let d in c)if(c.hasOwnProperty(d)&&(u[d]===void 0||!rn(c[d],u[d])))return!1;return!0})(n,e);default:return ee(52216,{left:n})}}function ha(n,e){return(n.values||[]).find(t=>rn(t,e))!==void 0}function Cs(n,e){if(n===e)return 0;let t=ci(n),r=ci(e);if(t!==r)return ge(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ge(n.booleanValue,e.booleanValue);case 2:return(function(s,c){let u=Me(s.integerValue||s.doubleValue),d=Me(c.integerValue||c.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1})(n,e);case 3:return rI(n.timestampValue,e.timestampValue);case 4:return rI(Nu(n),Nu(e));case 5:return Nf(n.stringValue,e.stringValue);case 6:return(function(s,c){let u=ai(s),d=ai(c);return u.compareTo(d)})(n.bytesValue,e.bytesValue);case 7:return(function(s,c){let u=s.split("/"),d=c.split("/");for(let f=0;f<u.length&&f<d.length;f++){let I=ge(u[f],d[f]);if(I!==0)return I}return ge(u.length,d.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,c){let u=ge(Me(s.latitude),Me(c.latitude));return u!==0?u:ge(Me(s.longitude),Me(c.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return iI(n.arrayValue,e.arrayValue);case 10:return(function(s,c){let u=s.fields||{},d=c.fields||{},f=u[la]?.arrayValue,I=d[la]?.arrayValue,S=ge(f?.values?.length||0,I?.values?.length||0);return S!==0?S:iI(f,I)})(n.mapValue,e.mapValue);case 11:return(function(s,c){if(s===yu.mapValue&&c===yu.mapValue)return 0;if(s===yu.mapValue)return 1;if(c===yu.mapValue)return-1;let u=s.fields||{},d=Object.keys(u),f=c.fields||{},I=Object.keys(f);d.sort(),I.sort();for(let S=0;S<d.length&&S<I.length;++S){let R=Nf(d[S],I[S]);if(R!==0)return R;let k=Cs(u[d[S]],f[I[S]]);if(k!==0)return k}return ge(d.length,I.length)})(n.mapValue,e.mapValue);default:throw ee(23264,{he:t})}}function rI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ge(n,e);let t=mr(n),r=mr(e),i=ge(t.seconds,r.seconds);return i!==0?i:ge(t.nanos,r.nanos)}function iI(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Cs(t[i],r[i]);if(s)return s}return ge(t.length,r.length)}function Ds(n){return Lf(n)}function Lf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=mr(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return ai(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return te.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Lf(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let c of r)s?s=!1:i+=",",i+=`${c}:${Lf(t.fields[c])}`;return i+"}"})(n.mapValue):ee(61005,{value:n})}function wu(n){switch(ci(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Gp(n);return e?16+wu(e):16;case 5:return 2*n.stringValue.length;case 6:return ai(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,s)=>i+wu(s),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return pi(r.fields,(s,c)=>{i+=s.length+wu(c)}),i})(n.mapValue);default:throw ee(13486,{value:n})}}function Mf(n){return!!n&&"integerValue"in n}function Hp(n){return!!n&&"arrayValue"in n}function Tu(n){return!!n&&"mapValue"in n}function nE(n){return(n?.mapValue?.fields||{})[Kp]?.stringValue===Wp}function sa(n){if(n.geoPointValue)return{geoPointValue:fe({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:fe({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return pi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=sa(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=sa(n.arrayValue.values[t]);return e}return fe({},n)}function rE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===tE}var Ek={mapValue:{fields:{[Kp]:{stringValue:Wp},[la]:{arrayValue:{}}}}};var bt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Tu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sa(t)}setAll(e){let t=ft.emptyPath(),r={},i=[];e.forEach((c,u)=>{if(!t.isImmediateParentOf(u)){let d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=u.popLast()}c?r[u.lastSegment()]=sa(c):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Tu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Tu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){pi(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(sa(this.value))}};function iE(n){let e=[];return pi(n.fields,(t,r)=>{let i=new ft([t]);if(Tu(r)){let s=iE(r.mapValue).fields;if(s.length===0)e.push(i);else for(let c of s)e.push(i.child(c))}else e.push(i)}),new en(e)}var ks=class n{constructor(e,t,r,i,s,c,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=c,this.documentState=u}static newInvalidDocument(e){return new n(e,0,be.min(),be.min(),be.min(),bt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,be.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,be.min(),be.min(),bt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,be.min(),be.min(),bt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(be.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=bt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=be.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ui=class{constructor(e,t){this.position=e,this.inclusive=t}};function sI(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],c=n.position[i];if(s.field.isKeyField()?r=te.comparator(te.fromName(c.referenceValue),t.key):r=Cs(c,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function oI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!rn(n.position[t],e.position[t]))return!1;return!0}var li=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function H0(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ou=class{},Ke=class n extends Ou{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Uf(e,t,r):t==="array-contains"?new $f(e,r):t==="in"?new jf(e,r):t==="not-in"?new zf(e,r):t==="array-contains-any"?new Gf(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Bf(e,r):new qf(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Cs(t,this.value)):t!==null&&ci(this.value)===ci(t)&&this.matchesComparison(Cs(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ee(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Dn=class n extends Ou{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n(e,t)}matches(e){return sE(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function sE(n){return n.op==="and"}function oE(n){return Q0(n)&&sE(n)}function Q0(n){for(let e of n.filters)if(e instanceof Dn)return!1;return!0}function Ff(n){if(n instanceof Ke)return n.field.canonicalString()+n.op.toString()+Ds(n.value);if(oE(n))return n.filters.map(e=>Ff(e)).join(",");{let e=n.filters.map(t=>Ff(t)).join(",");return`${n.op}(${e})`}}function aE(n,e){return n instanceof Ke?(function(r,i){return i instanceof Ke&&r.op===i.op&&r.field.isEqual(i.field)&&rn(r.value,i.value)})(n,e):n instanceof Dn?(function(r,i){return i instanceof Dn&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,c,u)=>s&&aE(c,i.filters[u]),!0):!1})(n,e):void ee(19439)}function cE(n){return n instanceof Ke?(function(t){return`${t.field.canonicalString()} ${t.op} ${Ds(t.value)}`})(n):n instanceof Dn?(function(t){return t.op.toString()+" {"+t.getFilters().map(cE).join(" ,")+"}"})(n):"Filter"}var Uf=class extends Ke{constructor(e,t,r){super(e,t,r),this.key=te.fromName(r.referenceValue)}matches(e){let t=te.comparator(e.key,this.key);return this.matchesComparison(t)}},Bf=class extends Ke{constructor(e,t){super(e,"in",t),this.keys=uE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},qf=class extends Ke{constructor(e,t){super(e,"not-in",t),this.keys=uE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function uE(n,e){return(e.arrayValue?.values||[]).map(t=>te.fromName(t.referenceValue))}var $f=class extends Ke{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Hp(t)&&ha(t.arrayValue,this.value)}},jf=class extends Ke{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ha(this.value.arrayValue,t)}},zf=class extends Ke{constructor(e,t){super(e,"not-in",t)}matches(e){if(ha(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ha(this.value.arrayValue,t)}},Gf=class extends Ke{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Hp(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ha(this.value.arrayValue,r))}};var Kf=class{constructor(e,t=null,r=[],i=[],s=null,c=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=c,this.endAt=u,this.Te=null}};function aI(n,e=null,t=[],r=[],i=null,s=null,c=null){return new Kf(n,e,t,r,i,s,c)}function Qp(n){let e=Ee(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ff(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(s){return s.field.canonicalString()+s.dir})(r)).join(","),zp(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ds(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ds(r)).join(",")),e.Te=t}return e.Te}function Jp(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!H0(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!aE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!oI(n.startAt,e.startAt)&&oI(n.endAt,e.endAt)}var Ns=class{constructor(e,t=null,r=[],i=[],s=null,c="F",u=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=c,this.startAt=u,this.endAt=d,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}};function J0(n,e,t,r,i,s,c,u){return new Ns(n,e,t,r,i,s,c,u)}function lE(n){return new Ns(n)}function cI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Y0(n){return te.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function hE(n){return n.collectionGroup!==null}function Ss(n){let e=Ee(n);if(e.Ie===null){e.Ie=[];let t=new Set;for(let s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let u=new ot(ft.comparator);return c.filters.forEach(d=>{d.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new li(s,r))}),t.has(ft.keyField().canonicalString())||e.Ie.push(new li(ft.keyField(),r))}return e.Ie}function ti(n){let e=Ee(n);return e.Ee||(e.Ee=X0(e,Ss(n))),e.Ee}function X0(n,e){if(n.limitType==="F")return aI(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new li(i.field,s)});let t=n.endAt?new ui(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ui(n.startAt.position,n.startAt.inclusive):null;return aI(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Lu(n,e,t){return new Ns(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function dE(n,e){return Jp(ti(n),ti(e))&&n.limitType===e.limitType}function fE(n){return`${Qp(ti(n))}|lt:${n.limitType}`}function ra(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>cE(i)).join(", ")}]`),zp(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(c){return`${c.field.canonicalString()} (${c.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Ds(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Ds(i)).join(",")),`Target(${r})`})(ti(n))}; limitType=${n.limitType})`}function Yp(n,e){return e.isFoundDocument()&&(function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):te.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(let s of Ss(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(c,u,d){let f=sI(c,u,d);return c.inclusive?f<=0:f<0})(r.startAt,Ss(r),i)||r.endAt&&!(function(c,u,d){let f=sI(c,u,d);return c.inclusive?f>=0:f>0})(r.endAt,Ss(r),i))})(n,e)}function Z0(n){return(e,t)=>{let r=!1;for(let i of Ss(n)){let s=eR(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function eR(n,e,t){let r=n.field.isKeyField()?te.comparator(e.key,t.key):(function(s,c,u){let d=c.data.field(s),f=u.data.field(s);return d!==null&&f!==null?Cs(d,f):ee(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ee(19790,{direction:n.dir})}}var kn=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){pi(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return QI(this.inner)}size(){return this.innerSize}};var tR=new It(te.comparator);function Mu(){return tR}var pE=new It(te.comparator);function Iu(...n){let e=pE;for(let t of n)e=e.insert(t.key,t);return e}function mE(n){let e=pE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ei(){return oa()}function gE(){return oa()}function oa(){return new kn(n=>n.toString(),(n,e)=>n.isEqual(e))}var nR=new It(te.comparator),rR=new ot(te.comparator);function Ye(...n){let e=rR;for(let t of n)e=e.add(t);return e}var iR=new ot(ge);function sR(){return iR}function Xp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ua(e)?"-0":e}}function _E(n){return{integerValue:""+n}}function oR(n,e){return x0(e)?_E(e):Xp(n,e)}var Vs=class{constructor(){this._=void 0}};function aR(n,e,t){return n instanceof xs?(function(i,s){let c={fields:{[YI]:{stringValue:JI},[ZI]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Xu(s)&&(s=Gp(s)),s&&(c.fields[XI]=s),{mapValue:c}})(t,e):n instanceof hi?IE(n,e):n instanceof di?EE(n,e):(function(i,s){let c=yE(i,s),u=uI(c)+uI(i.Ae);return Mf(c)&&Mf(i.Ae)?_E(u):Xp(i.serializer,u)})(n,e)}function cR(n,e,t){return n instanceof hi?IE(n,e):n instanceof di?EE(n,e):t}function yE(n,e){return n instanceof Os?(function(r){return Mf(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}var xs=class extends Vs{},hi=class extends Vs{constructor(e){super(),this.elements=e}};function IE(n,e){let t=wE(e);for(let r of n.elements)t.some(i=>rn(i,r))||t.push(r);return{arrayValue:{values:t}}}var di=class extends Vs{constructor(e){super(),this.elements=e}};function EE(n,e){let t=wE(e);for(let r of n.elements)t=t.filter(i=>!rn(i,r));return{arrayValue:{values:t}}}var Os=class extends Vs{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function uI(n){return Me(n.integerValue||n.doubleValue)}function wE(n){return Hp(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function uR(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof hi&&i instanceof hi||r instanceof di&&i instanceof di?Ps(r.elements,i.elements,rn):r instanceof Os&&i instanceof Os?rn(r.Ae,i.Ae):r instanceof xs&&i instanceof xs})(n.transform,e.transform)}var Wf=class{constructor(e,t){this.version=e,this.transformResults=t}},fr=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function vu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Ls=class{};function TE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new da(n.key,fr.none()):new Ms(n.key,n.data,fr.none());{let t=n.data,r=bt.empty(),i=new ot(ft.comparator);for(let s of e.fields)if(!i.has(s)){let c=t.field(s);c===null&&s.length>1&&(s=s.popLast(),c=t.field(s)),c===null?r.delete(s):r.set(s,c),i=i.add(s)}return new Nn(n.key,r,new en(i.toArray()),fr.none())}}function lR(n,e,t){n instanceof Ms?(function(i,s,c){let u=i.value.clone(),d=hI(i.fieldTransforms,s,c.transformResults);u.setAll(d),s.convertToFoundDocument(c.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Nn?(function(i,s,c){if(!vu(i.precondition,s))return void s.convertToUnknownDocument(c.version);let u=hI(i.fieldTransforms,s,c.transformResults),d=s.data;d.setAll(vE(i)),d.setAll(u),s.convertToFoundDocument(c.version,d).setHasCommittedMutations()})(n,e,t):(function(i,s,c){s.convertToNoDocument(c.version).setHasCommittedMutations()})(0,e,t)}function aa(n,e,t,r){return n instanceof Ms?(function(s,c,u,d){if(!vu(s.precondition,c))return u;let f=s.value.clone(),I=dI(s.fieldTransforms,d,c);return f.setAll(I),c.convertToFoundDocument(c.version,f).setHasLocalMutations(),null})(n,e,t,r):n instanceof Nn?(function(s,c,u,d){if(!vu(s.precondition,c))return u;let f=dI(s.fieldTransforms,d,c),I=c.data;return I.setAll(vE(s)),I.setAll(f),c.convertToFoundDocument(c.version,I).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(S=>S.field))})(n,e,t,r):(function(s,c,u){return vu(s.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):u})(n,e,t)}function hR(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=yE(r.transform,i||null);s!=null&&(t===null&&(t=bt.empty()),t.set(r.field,s))}return t||null}function lI(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Ps(r,i,(s,c)=>uR(s,c))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Ms=class extends Ls{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Nn=class extends Ls{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function vE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function hI(n,e,t){let r=new Map;Re(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let i=0;i<t.length;i++){let s=n[i],c=s.transform,u=e.data.field(s.field);r.set(s.field,cR(c,u,t[i]))}return r}function dI(n,e,t){let r=new Map;for(let i of n){let s=i.transform,c=t.data.field(i.field);r.set(i.field,aR(s,c,e))}return r}var da=class extends Ls{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Hf=class extends Ls{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Qf=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&lR(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=aa(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=aa(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=gE();return this.mutations.forEach(i=>{let s=e.get(i.key),c=s.overlayedDocument,u=this.applyToLocalView(c,s.mutatedFields);u=t.has(i.key)?null:u;let d=TE(c,u);d!==null&&r.set(i.key,d),c.isValidDocument()||c.convertToNoDocument(be.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ye())}isEqual(e){return this.batchId===e.batchId&&Ps(this.mutations,e.mutations,(t,r)=>lI(t,r))&&Ps(this.baseMutations,e.baseMutations,(t,r)=>lI(t,r))}},Jf=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Re(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let i=(function(){return nR})(),s=e.mutations;for(let c=0;c<s.length;c++)i=i.insert(s[c].key,r[c].version);return new n(e,t,r,i)}};var Yf=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Oe,ue;function dR(n){switch(n){case L.OK:return ee(64938);case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0;default:return ee(15467,{code:n})}}function fR(n){if(n===void 0)return ri("GRPC error has no .code"),L.UNKNOWN;switch(n){case Oe.OK:return L.OK;case Oe.CANCELLED:return L.CANCELLED;case Oe.UNKNOWN:return L.UNKNOWN;case Oe.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case Oe.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case Oe.INTERNAL:return L.INTERNAL;case Oe.UNAVAILABLE:return L.UNAVAILABLE;case Oe.UNAUTHENTICATED:return L.UNAUTHENTICATED;case Oe.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case Oe.NOT_FOUND:return L.NOT_FOUND;case Oe.ALREADY_EXISTS:return L.ALREADY_EXISTS;case Oe.PERMISSION_DENIED:return L.PERMISSION_DENIED;case Oe.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case Oe.ABORTED:return L.ABORTED;case Oe.OUT_OF_RANGE:return L.OUT_OF_RANGE;case Oe.UNIMPLEMENTED:return L.UNIMPLEMENTED;case Oe.DATA_LOSS:return L.DATA_LOSS;default:return ee(39323,{code:n})}}(ue=Oe||(Oe={}))[ue.OK=0]="OK",ue[ue.CANCELLED=1]="CANCELLED",ue[ue.UNKNOWN=2]="UNKNOWN",ue[ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ue[ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ue[ue.NOT_FOUND=5]="NOT_FOUND",ue[ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",ue[ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",ue[ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",ue[ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ue[ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ue[ue.ABORTED=10]="ABORTED",ue[ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",ue[ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",ue[ue.INTERNAL=13]="INTERNAL",ue[ue.UNAVAILABLE=14]="UNAVAILABLE",ue[ue.DATA_LOSS=15]="DATA_LOSS";var wk=new mu([4294967295,4294967295],0);var Xf=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Zf(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function pR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function mR(n,e){return Zf(n,e.toTimestamp())}function Rs(n){return Re(!!n,49232),be.fromTimestamp((function(t){let r=mr(t);return new Fe(r.seconds,r.nanos)})(n))}function AE(n,e){return ep(n,e).canonicalString()}function ep(n,e){let t=(function(i){return new Se(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function gR(n){let e=Se.fromString(n);return Re(AR(e),10190,{key:e.toString()}),e}function tp(n,e){return AE(n.databaseId,e.path)}function _R(n){let e=gR(n);return e.length===4?Se.emptyPath():IR(e)}function yR(n){return new Se(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function IR(n){return Re(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function fI(n,e,t){return{name:tp(n,e),fields:t.value.mapValue.fields}}function ER(n,e){let t;if(e instanceof Ms)t={update:fI(n,e.key,e.value)};else if(e instanceof da)t={delete:tp(n,e.key)};else if(e instanceof Nn)t={update:fI(n,e.key,e.data),updateMask:vR(e.fieldMask)};else{if(!(e instanceof Hf))return ee(16599,{dt:e.type});t={verify:tp(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(s,c){let u=c.transform;if(u instanceof xs)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof hi)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof di)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Os)return{fieldPath:c.field.canonicalString(),increment:u.Ae};throw ee(20930,{transform:c.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:mR(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:ee(27497)})(n,e.precondition)),t}function wR(n,e){return n&&n.length>0?(Re(e!==void 0,14353),n.map(t=>(function(i,s){let c=i.updateTime?Rs(i.updateTime):Rs(s);return c.isEqual(be.min())&&(c=Rs(s)),new Wf(c,i.transformResults||[])})(t,e))):[]}function TR(n){let e=_R(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Re(r===1,65062);let I=t.from[0];I.allDescendants?i=I.collectionId:e=e.child(I.collectionId)}let s=[];t.where&&(s=(function(S){let R=bE(S);return R instanceof Dn&&oE(R)?R.getFilters():[R]})(t.where));let c=[];t.orderBy&&(c=(function(S){return S.map(R=>(function(x){return new li(As(x.field),(function(O){switch(O){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(x.direction))})(R))})(t.orderBy));let u=null;t.limit&&(u=(function(S){let R;return R=typeof S=="object"?S.value:S,zp(R)?null:R})(t.limit));let d=null;t.startAt&&(d=(function(S){let R=!!S.before,k=S.values||[];return new ui(k,R)})(t.startAt));let f=null;return t.endAt&&(f=(function(S){let R=!S.before,k=S.values||[];return new ui(k,R)})(t.endAt)),J0(e,i,c,s,u,"F",d,f)}function bE(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=As(t.unaryFilter.field);return Ke.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=As(t.unaryFilter.field);return Ke.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=As(t.unaryFilter.field);return Ke.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let c=As(t.unaryFilter.field);return Ke.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ee(61313);default:return ee(60726)}})(n):n.fieldFilter!==void 0?(function(t){return Ke.create(As(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ee(58110);default:return ee(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Dn.create(t.compositeFilter.filters.map(r=>bE(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return ee(1026)}})(t.compositeFilter.op))})(n):ee(30097,{filter:n})}function As(n){return ft.fromServerFormat(n.fieldPath)}function vR(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function AR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function SE(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}var np=class{constructor(e){this.yt=e}};function RE(n){let e=TR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Lu(e,e.limit,"L"):e}var Fu=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Me(e.integerValue));else if("doubleValue"in e){let r=Me(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),ua(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),typeof r=="string"&&(r=mr(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(ai(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?rE(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):nE(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):ee(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};this.Ft(t,55);for(let i of Object.keys(r))this.Ot(i,t),this.Ct(r[i],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let i=la,s=r[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(Me(s)),this.Ot(i,t),this.Ct(r[i],t)}qt(e,t){let r=e.values||[];this.Ft(t,50);for(let i of r)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),te.fromName(e).path.forEach(r=>{this.Ft(t,60),this.$t(r,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};Fu.Wt=new Fu;var rp=class{constructor(){this.Sn=new ip}addToCollectionParentIndex(e,t){return this.Sn.add(t),F.resolve()}getCollectionParents(e,t){return F.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return F.resolve()}deleteFieldIndex(e,t){return F.resolve()}deleteAllFieldIndexes(e){return F.resolve()}createTargetIndexes(e,t){return F.resolve()}getDocumentsMatchingTarget(e,t){return F.resolve(null)}getIndexType(e,t){return F.resolve(0)}getFieldIndexes(e,t){return F.resolve([])}getNextCollectionGroupToUpdate(e){return F.resolve(null)}getMinOffset(e,t){return F.resolve(oi.min())}getMinOffsetFromCollectionGroup(e,t){return F.resolve(oi.min())}updateCollectionGroup(e,t,r){return F.resolve()}updateIndexEntries(e,t){return F.resolve()}},ip=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ot(Se.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ot(Se.comparator)).toArray()}};var Tk=new Uint8Array(0);var pI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},PE=41943040,At=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};At.DEFAULT_COLLECTION_PERCENTILE=10,At.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,At.DEFAULT=new At(PE,At.DEFAULT_COLLECTION_PERCENTILE,At.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),At.DISABLED=new At(-1,0,0);var fa=class n{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new n(0)}static ar(){return new n(-1)}};var mI="LruGarbageCollector",bR=1048576;function gI([n,e],[t,r]){let i=ge(n,t);return i===0?ge(e,r):i}var sp=class{constructor(e){this.Pr=e,this.buffer=new ot(gI),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();gI(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},op=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){z(mI,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>P(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){ya(t)?z(mI,"Ignoring IndexedDB error during garbage collection: ",t):yield $p(t)}yield this.Ar(3e5)}))}},ap=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return F.resolve(xI.ce);let r=new sp(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.mr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(z("LruGarbageCollector","Garbage collection skipped; disabled"),F.resolve(pI)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(z("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),pI):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,i,s,c,u,d,f,I=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(S=>(S>this.params.maximumSequenceNumbersToCollect?(z("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${S}`),i=this.params.maximumSequenceNumbersToCollect):i=S,c=Date.now(),this.nthSequenceNumber(e,i))).next(S=>(r=S,u=Date.now(),this.removeTargets(e,r,t))).next(S=>(s=S,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(S=>(f=Date.now(),vs()<=se.DEBUG&&z("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-I}ms
	Determined least recently used ${i} in `+(u-c)+`ms
	Removed ${s} targets in `+(d-u)+`ms
	Removed ${S} documents in `+(f-d)+`ms
Total Duration: ${f-I}ms`),F.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:S})))}};function SR(n,e){return new ap(n,e)}var cp=class{constructor(){this.changes=new kn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ks.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?F.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var up=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var lp=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&aa(r.mutation,i,en.empty(),Fe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ye()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ye()){let i=ei();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let c=Iu();return s.forEach((u,d)=>{c=c.insert(u,d.overlayedDocument)}),c}))}getOverlayedDocuments(e,t){let r=ei();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ye()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((c,u)=>{t.set(c,u)})})}computeViews(e,t,r,i){let s=Mu(),c=oa(),u=(function(){return oa()})();return t.forEach((d,f)=>{let I=r.get(f.key);i.has(f.key)&&(I===void 0||I.mutation instanceof Nn)?s=s.insert(f.key,f):I!==void 0?(c.set(f.key,I.mutation.getFieldMask()),aa(I.mutation,f,I.mutation.getFieldMask(),Fe.now())):c.set(f.key,en.empty())}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((f,I)=>c.set(f,I)),t.forEach((f,I)=>u.set(f,new up(I,c.get(f)??null))),u))}recalculateAndSaveOverlays(e,t){let r=oa(),i=new It((c,u)=>c-u),s=Ye();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(c=>{for(let u of c)u.keys().forEach(d=>{let f=t.get(d);if(f===null)return;let I=r.get(d)||en.empty();I=u.applyToLocalView(f,I),r.set(d,I);let S=(i.get(u.batchId)||Ye()).add(d);i=i.insert(u.batchId,S)})}).next(()=>{let c=[],u=i.getReverseIterator();for(;u.hasNext();){let d=u.getNext(),f=d.key,I=d.value,S=gE();I.forEach(R=>{if(!s.has(R)){let k=TE(t.get(R),r.get(R));k!==null&&S.set(R,k),s=s.add(R)}}),c.push(this.documentOverlayCache.saveOverlays(e,f,S))}return F.waitFor(c)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return Y0(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):hE(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let c=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):F.resolve(ei()),u=ca,d=s;return c.next(f=>F.forEach(f,(I,S)=>(u<S.largestBatchId&&(u=S.largestBatchId),s.get(I)?F.resolve():this.remoteDocumentCache.getEntry(e,I).next(R=>{d=d.insert(I,R)}))).next(()=>this.populateOverlays(e,f,s)).next(()=>this.computeViews(e,d,f,Ye())).next(I=>({batchId:u,changes:mE(I)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new te(t)).next(r=>{let i=Iu();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,c=Iu();return this.indexManager.getCollectionParents(e,s).next(u=>F.forEach(u,d=>{let f=(function(S,R){return new Ns(R,null,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,S.startAt,S.endAt)})(t,d.child(s));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next(I=>{I.forEach((S,R)=>{c=c.insert(S,R)})})}).next(()=>c))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(c=>(s=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(c=>{s.forEach((d,f)=>{let I=f.getKey();c.get(I)===null&&(c=c.insert(I,ks.newInvalidDocument(I)))});let u=Iu();return c.forEach((d,f)=>{let I=s.get(d);I!==void 0&&aa(I.mutation,f,en.empty(),Fe.now()),Yp(t,f)&&(u=u.insert(d,f))}),u})}};var hp=class{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return F.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Rs(i.createTime)}})(t)),F.resolve()}getNamedQuery(e,t){return F.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(i){return{name:i.name,query:RE(i.bundledQuery),readTime:Rs(i.readTime)}})(t)),F.resolve()}};var dp=class{constructor(){this.overlays=new It(te.comparator),this.Lr=new Map}getOverlay(e,t){return F.resolve(this.overlays.get(t))}getOverlays(e,t){let r=ei();return F.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.bt(e,t,s)}),F.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Lr.delete(r)),F.resolve()}getOverlaysForCollection(e,t,r){let i=ei(),s=t.length+1,c=new te(t.child("")),u=this.overlays.getIteratorFrom(c);for(;u.hasNext();){let d=u.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return F.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new It((f,I)=>f-I),c=this.overlays.getIterator();for(;c.hasNext();){let f=c.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let I=s.get(f.largestBatchId);I===null&&(I=ei(),s=s.insert(f.largestBatchId,I)),I.set(f.getKey(),f)}}let u=ei(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((f,I)=>u.set(f,I)),!(u.size()>=i)););return F.resolve(u)}bt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let c=this.Lr.get(i.largestBatchId).delete(r.key);this.Lr.set(i.largestBatchId,c)}this.overlays=this.overlays.insert(r.key,new Yf(t,r));let s=this.Lr.get(t);s===void 0&&(s=Ye(),this.Lr.set(t,s)),this.Lr.set(t,s.add(r.key))}};var fp=class{constructor(){this.sessionToken=nn.EMPTY_BYTE_STRING}getSessionToken(e){return F.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,F.resolve()}};var pa=class{constructor(){this.kr=new ot(Le.Kr),this.qr=new ot(Le.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new Le(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new Le(e,t))}Qr(e,t){e.forEach(r=>this.removeReference(r,t))}Gr(e){let t=new te(new Se([])),r=new Le(t,e),i=new Le(t,e+1),s=[];return this.qr.forEachInRange([r,i],c=>{this.Wr(c),s.push(c.key)}),s}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new te(new Se([])),r=new Le(t,e),i=new Le(t,e+1),s=Ye();return this.qr.forEachInRange([r,i],c=>{s=s.add(c.key)}),s}containsKey(e){let t=new Le(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Le=class{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return te.comparator(e.key,t.key)||ge(e.Hr,t.Hr)}static Ur(e,t){return ge(e.Hr,t.Hr)||te.comparator(e.key,t.key)}};var pp=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new ot(Le.Kr)}checkEmpty(e){return F.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let c=new Qf(s,t,r,i);this.mutationQueue.push(c);for(let u of i)this.Jr=this.Jr.add(new Le(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return F.resolve(c)}lookupMutationBatch(e,t){return F.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return F.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return F.resolve(this.mutationQueue.length===0?jp:this.Yn-1)}getAllMutationBatches(e){return F.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Le(t,0),i=new Le(t,Number.POSITIVE_INFINITY),s=[];return this.Jr.forEachInRange([r,i],c=>{let u=this.Zr(c.Hr);s.push(u)}),F.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ot(ge);return t.forEach(i=>{let s=new Le(i,0),c=new Le(i,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([s,c],u=>{r=r.add(u.Hr)})}),F.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;te.isDocumentKey(s)||(s=s.child(""));let c=new Le(new te(s),0),u=new ot(ge);return this.Jr.forEachWhile(d=>{let f=d.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(u=u.add(d.Hr)),!0)},c),F.resolve(this.Yr(u))}Yr(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Re(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return F.forEach(t.mutations,i=>{let s=new Le(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new Le(t,0),i=this.Jr.firstAfterOrEqual(r);return F.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,F.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var mp=class{constructor(e){this.ti=e,this.docs=(function(){return new It(te.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,c=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:c}),this.size+=c-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return F.resolve(r?r.document.mutableCopy():ks.newInvalidDocument(t))}getEntries(e,t){let r=Mu();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ks.newInvalidDocument(i))}),F.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Mu(),c=t.path,u=new te(c.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(u);for(;d.hasNext();){let{key:f,value:{document:I}}=d.getNext();if(!c.isPrefixOf(f.path))break;f.path.length>c.length+1||k0(D0(I),r)<=0||(i.has(I.key)||Yp(t,I))&&(s=s.insert(I.key,I.mutableCopy()))}return F.resolve(s)}getAllFromCollectionGroup(e,t,r,i){ee(9500)}ni(e,t){return F.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new gp(this)}getSize(e){return F.resolve(this.size)}},gp=class extends cp{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Mr.addEntry(e,i)):this.Mr.removeEntry(r)}),F.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}};var _p=class{constructor(e){this.persistence=e,this.ri=new kn(t=>Qp(t),Jp),this.lastRemoteSnapshotVersion=be.min(),this.highestTargetId=0,this.ii=0,this.si=new pa,this.targetCount=0,this.oi=fa._r()}forEachTarget(e,t){return this.ri.forEach((r,i)=>t(i)),F.resolve()}getLastRemoteSnapshotVersion(e){return F.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return F.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),F.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),F.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new fa(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,F.resolve()}updateTargetData(e,t){return this.lr(t),F.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,F.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ri.forEach((c,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ri.delete(c),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),F.waitFor(s).next(()=>i)}getTargetCount(e){return F.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return F.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),F.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(c=>{s.push(i.markPotentiallyOrphaned(e,c))}),F.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),F.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return F.resolve(r)}containsKey(e,t){return F.resolve(this.si.containsKey(t))}};var Uu=class{constructor(e,t){this._i={},this.overlays={},this.ai=new xI(0),this.ui=!1,this.ui=!0,this.ci=new fp,this.referenceDelegate=e(this),this.li=new _p(this),this.indexManager=new rp,this.remoteDocumentCache=(function(i){return new mp(i)})(r=>this.referenceDelegate.hi(r)),this.serializer=new np(t),this.Pi=new hp(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new dp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new pp(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){z("MemoryPersistence","Starting transaction:",e);let i=new yp(this.ai.next());return this.referenceDelegate.Ti(),r(i).next(s=>this.referenceDelegate.Ii(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return F.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}},yp=class extends Vf{constructor(e){super(),this.currentSequenceNumber=e}},Ip=class n{constructor(e){this.persistence=e,this.Ri=new pa,this.Ai=null}static Vi(e){return new n(e)}get di(){if(this.Ai)return this.Ai;throw ee(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),F.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),F.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),F.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(i=>this.di.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.di.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return F.forEach(this.di,r=>{let i=te.fromPath(r);return this.mi(e,i).next(s=>{s||t.removeEntry(i,be.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return F.or([()=>F.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},Bu=class n{constructor(e,t){this.persistence=e,this.fi=new kn(r=>O0(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=SR(this,t)}static Vi(e,t){return new n(e,t)}Ti(){}Ii(e){return F.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}pr(e){let t=0;return this.mr(e,r=>{t++}).next(()=>t)}mr(e,t){return F.forEach(this.fi,(r,i)=>this.wr(e,r,i).next(s=>s?F.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ni(e,c=>this.wr(e,c,t).next(u=>{u||(r++,s.removeEntry(c,be.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),F.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),F.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),F.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),F.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wu(e.data.value)),t}wr(e,t,r){return F.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.fi.get(t);return F.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var Ep=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=i}static Es(e,t){let r=Ye(),i=Ye();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var wp=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Tp=class{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return Cm()?8:V0(yt())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.gs(e,t).next(c=>{s.result=c}).next(()=>{if(!s.result)return this.ps(e,t,i,r).next(c=>{s.result=c})}).next(()=>{if(s.result)return;let c=new wp;return this.ys(e,t,c).next(u=>{if(s.result=u,this.As)return this.ws(e,t,c,u.size)})}).next(()=>s.result)}ws(e,t,r,i){return r.documentReadCount<this.Vs?(vs()<=se.DEBUG&&z("QueryEngine","SDK will not create cache indexes for query:",ra(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),F.resolve()):(vs()<=se.DEBUG&&z("QueryEngine","Query:",ra(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ds*i?(vs()<=se.DEBUG&&z("QueryEngine","The SDK decides to create cache indexes for query:",ra(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ti(t))):F.resolve())}gs(e,t){if(cI(t))return F.resolve(null);let r=ti(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Lu(t,null,"F"),r=ti(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let c=Ye(...s);return this.fs.getDocuments(e,c).next(u=>this.indexManager.getMinOffset(e,r).next(d=>{let f=this.bs(t,u);return this.Ss(t,f,c,d.readTime)?this.gs(e,Lu(t,null,"F")):this.Ds(e,f,t,d)}))})))}ps(e,t,r,i){return cI(t)||i.isEqual(be.min())?F.resolve(null):this.fs.getDocuments(e,r).next(s=>{let c=this.bs(t,s);return this.Ss(t,c,r,i)?F.resolve(null):(vs()<=se.DEBUG&&z("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ra(t)),this.Ds(e,c,t,C0(i,ca)).next(u=>u))})}bs(e,t){let r=new ot(Z0(e));return t.forEach((i,s)=>{Yp(e,s)&&(r=r.add(s))}),r}Ss(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ys(e,t,r){return vs()<=se.DEBUG&&z("QueryEngine","Using full collection scan to execute query:",ra(t)),this.fs.getDocumentsMatchingQuery(e,t,oi.min(),r)}Ds(e,t,r,i){return this.fs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(c=>{s=s.insert(c.key,c)}),s))}};var RR="LocalStore";var vp=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.vs=new It(ge),this.Fs=new kn(s=>Qp(s),Jp),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lp(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}};function PR(n,e,t,r){return new vp(n,e,t,r)}function CE(n,e){return P(this,null,function*(){let t=Ee(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let c=[],u=[],d=Ye();for(let f of i){c.push(f.batchId);for(let I of f.mutations)d=d.add(I.key)}for(let f of s){u.push(f.batchId);for(let I of f.mutations)d=d.add(I.key)}return t.localDocuments.getDocuments(r,d).next(f=>({Ns:f,removedBatchIds:c,addedBatchIds:u}))})})})}function CR(n,e){let t=Ee(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.xs.newChangeBuffer({trackRemovals:!0});return(function(u,d,f,I){let S=f.batch,R=S.keys(),k=F.resolve();return R.forEach(x=>{k=k.next(()=>I.getEntry(d,x)).next(U=>{let O=f.docVersions.get(x);Re(O!==null,48541),U.version.compareTo(O)<0&&(S.applyToRemoteDocument(U,f),U.isValidDocument()&&(U.setReadTime(f.commitVersion),I.addEntry(U)))})}),k.next(()=>u.mutationQueue.removeMutationBatch(d,S))})(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let d=Ye();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(d=d.add(u.batch.mutations[f].key));return d})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function DR(n){let e=Ee(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function kR(n,e){let t=Ee(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=jp),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}var qu=class{constructor(){this.activeTargetIds=sR()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var Ap=class{constructor(){this.vo=new qu,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new qu,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var bp=class{Mo(e){}shutdown(){}};var _I="ConnectivityMonitor",$u=class{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){z(_I,"Network connectivity changed: AVAILABLE");for(let e of this.Lo)e(0)}Bo(){z(_I,"Network connectivity changed: UNAVAILABLE");for(let e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Eu=null;function Sp(){return Eu===null?Eu=(function(){return 268435456+Math.round(2147483648*Math.random())})():Eu++,"0x"+Eu.toString(16)}var Sf="RestConnection",NR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"},Rp=class{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.$o=this.databaseId.database===Vu?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let c=Sp(),u=this.Qo(e,t.toUriEncodedString());z(Sf,`Sending RPC '${e}' ${c}:`,u,r);let d={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(d,i,s);let{host:f}=new URL(u),I=Mr(f);return this.zo(e,u,d,r,I).then(S=>(z(Sf,`Received RPC '${e}' ${c}: `,S),S),S=>{throw ii(Sf,`RPC '${e}' ${c} failed with error: `,S,"url: ",u,"request:",r),S})}jo(e,t,r,i,s,c){return this.Wo(e,t,r,i,s)}Go(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+qs})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Qo(e,t){let r=NR[e],i=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(i=`${i}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),i}terminate(){}};var Pp=class{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}};var st="WebChannelConnection",ia=(n,e,t)=>{n.listen(e,r=>{try{t(r)}catch(i){setTimeout(()=>{throw i},0)}})},ju=class n extends Rp{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!n.c_){let e=vf();ia(e,Tf.STAT_EVENT,t=>{t.stat===_u.PROXY?z(st,"STAT_EVENT: detected buffering proxy"):t.stat===_u.NOPROXY&&z(st,"STAT_EVENT: detected no buffering proxy")}),n.c_=!0}}zo(e,t,r,i,s){let c=Sp();return new Promise((u,d)=>{let f=new Ef;f.setWithCredentials(!0),f.listenOnce(wf.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case na.NO_ERROR:let S=f.getResponseJson();z(st,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(S)),u(S);break;case na.TIMEOUT:z(st,`RPC '${e}' ${c} timed out`),d(new G(L.DEADLINE_EXCEEDED,"Request time out"));break;case na.HTTP_ERROR:let R=f.getStatus();if(z(st,`RPC '${e}' ${c} failed with status:`,R,"response text:",f.getResponseText()),R>0){let k=f.getResponseJson();Array.isArray(k)&&(k=k[0]);let x=k?.error;if(x&&x.status&&x.message){let U=(function(W){let K=W.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(K)>=0?K:L.UNKNOWN})(x.status);d(new G(U,x.message))}else d(new G(L.UNKNOWN,"Server responded with status "+f.getStatus()))}else d(new G(L.UNAVAILABLE,"Connection failed."));break;default:ee(9055,{l_:e,streamId:c,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{z(st,`RPC '${e}' ${c} completed.`)}});let I=JSON.stringify(i);z(st,`RPC '${e}' ${c} sending request:`,i),f.send(t,"POST",I,r,15)})}T_(e,t,r){let i=Sp(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let f=s.join("");z(st,`Creating RPC '${e}' stream ${i}: ${f}`,u);let I=c.createWebChannel(f,u);this.I_(I);let S=!1,R=!1,k=new Pp({Ho:x=>{R?z(st,`Not sending because RPC '${e}' stream ${i} is closed:`,x):(S||(z(st,`Opening RPC '${e}' stream ${i} transport.`),I.open(),S=!0),z(st,`RPC '${e}' stream ${i} sending:`,x),I.send(x))},Jo:()=>I.close()});return ia(I,Ts.EventType.OPEN,()=>{R||(z(st,`RPC '${e}' stream ${i} transport opened.`),k.i_())}),ia(I,Ts.EventType.CLOSE,()=>{R||(R=!0,z(st,`RPC '${e}' stream ${i} transport closed`),k.o_(),this.E_(I))}),ia(I,Ts.EventType.ERROR,x=>{R||(R=!0,ii(st,`RPC '${e}' stream ${i} transport errored. Name:`,x.name,"Message:",x.message),k.o_(new G(L.UNAVAILABLE,"The operation could not be completed")))}),ia(I,Ts.EventType.MESSAGE,x=>{if(!R){let U=x.data[0];Re(!!U,16349);let O=U,W=O?.error||O[0]?.error;if(W){z(st,`RPC '${e}' stream ${i} received error:`,W);let K=W.status,Q=(function(ne){let T=Oe[ne];if(T!==void 0)return fR(T)})(K),ie=W.message;K==="NOT_FOUND"&&ie.includes("database")&&ie.includes("does not exist")&&ie.includes(this.databaseId.database)&&ii(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),Q===void 0&&(Q=L.INTERNAL,ie="Unknown error status: "+K+" with message "+W.message),R=!0,k.o_(new G(Q,ie)),I.close()}else z(st,`RPC '${e}' stream ${i} received:`,U),k.__(U)}}),n.u_(),setTimeout(()=>{k.s_()},0),k}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Af()}};function VR(n){return new ju(n)}function Rf(){return typeof document<"u"?document:null}function Ia(n){return new Xf(n,!0)}ju.c_=!1;var zu=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=i,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-r);i>0&&z("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}};var yI="PersistentStream",Cp=class{constructor(e,t,r,i,s,c,u,d){this.Ci=e,this.b_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=u,this.listener=d,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new zu(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return P(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}k_(){return P(this,null,function*(){if(this.O_())return this.close(0)})}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return P(this,null,function*(){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===L.RESOURCE_EXHAUSTED?(ri(t.toString()),ri("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===L.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.t_(t)})}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.D_===t&&this.G_(r,i)},r=>{e(()=>{let i=new G(L.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(i)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(i=>{r(()=>this.z_(i))}),this.stream.onMessage(i=>{r(()=>++this.F_==1?this.H_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(()=>P(this,null,function*(){this.state=0,this.start()}))}z_(e){return z(yI,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(z(yI,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}};var Dp=class extends Cp{constructor(e,t,r,i,s,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,c),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return Re(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Re(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Re(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=wR(e.writeResults,e.commitTime),r=Rs(e.commitTime);return this.listener.na(r,t)}ra(){let e={};e.database=yR(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>ER(this.serializer,r))};this.K_(t)}};var kp=class{},Np=class extends kp{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new G(L.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,c])=>this.connection.Wo(e,ep(t,r),i,s,c)).catch(s=>{throw s.name==="FirebaseError"?(s.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new G(L.UNKNOWN,s.toString())})}jo(e,t,r,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,u])=>this.connection.jo(e,ep(t,r),i,c,u,s)).catch(c=>{throw c.name==="FirebaseError"?(c.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new G(L.UNKNOWN,c.toString())})}terminate(){this.ia=!0,this.connection.terminate()}};function xR(n,e,t,r){return new Np(n,e,t,r)}var Vp=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ri(t),this.aa=!1):z("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var Ea="RemoteStore",xp=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo(c=>{r.enqueueAndForget(()=>P(this,null,function*(){Ta(this)&&(z(Ea,"Restarting streams for network reachability change."),yield(function(d){return P(this,null,function*(){let f=Ee(d);f.Ea.add(4),yield wa(f),f.Va.set("Unknown"),f.Ea.delete(4),yield Zu(f)})})(this))}))}),this.Va=new Vp(r,i)}};function Zu(n){return P(this,null,function*(){if(Ta(n))for(let e of n.Ra)yield e(!0)})}function wa(n){return P(this,null,function*(){for(let e of n.Ra)yield e(!1)})}function Ta(n){return Ee(n).Ea.size===0}function DE(n,e,t){return P(this,null,function*(){if(!ya(e))throw e;n.Ea.add(1),yield wa(n),n.Va.set("Offline"),t||(t=()=>DR(n.localStore)),n.asyncQueue.enqueueRetryable(()=>P(null,null,function*(){z(Ea,"Retrying IndexedDB access"),yield t(),n.Ea.delete(1),yield Zu(n)}))})}function kE(n,e){return e().catch(t=>DE(n,t,e))}function el(n){return P(this,null,function*(){let e=Ee(n),t=gr(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:jp;for(;OR(e);)try{let i=yield kR(e.localStore,r);if(i===null){e.Ta.length===0&&t.L_();break}r=i.batchId,LR(e,i)}catch(i){yield DE(e,i)}NE(e)&&VE(e)})}function OR(n){return Ta(n)&&n.Ta.length<10}function LR(n,e){n.Ta.push(e);let t=gr(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function NE(n){return Ta(n)&&!gr(n).x_()&&n.Ta.length>0}function VE(n){gr(n).start()}function MR(n){return P(this,null,function*(){gr(n).ra()})}function FR(n){return P(this,null,function*(){let e=gr(n);for(let t of n.Ta)e.ea(t.mutations)})}function UR(n,e,t){return P(this,null,function*(){let r=n.Ta.shift(),i=Jf.from(r,e,t);yield kE(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield el(n)})}function BR(n,e){return P(this,null,function*(){e&&gr(n).Y_&&(yield(function(r,i){return P(this,null,function*(){if((function(c){return dR(c)&&c!==L.ABORTED})(i.code)){let s=r.Ta.shift();gr(r).B_(),yield kE(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield el(r)}})})(n,e)),NE(n)&&VE(n)})}function II(n,e){return P(this,null,function*(){let t=Ee(n);t.asyncQueue.verifyOperationInProgress(),z(Ea,"RemoteStore received new credentials");let r=Ta(t);t.Ea.add(3),yield wa(t),r&&t.Va.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield Zu(t)})}function qR(n,e){return P(this,null,function*(){let t=Ee(n);e?(t.Ea.delete(2),yield Zu(t)):e||(t.Ea.add(2),yield wa(t),t.Va.set("Unknown"))})}function gr(n){return n.fa||(n.fa=(function(t,r,i){let s=Ee(t);return s.sa(),new Dp(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:MR.bind(null,n),t_:BR.bind(null,n),ta:FR.bind(null,n),na:UR.bind(null,n)}),n.Ra.push(e=>P(null,null,function*(){e?(n.fa.B_(),yield el(n)):(yield n.fa.stop(),n.Ta.length>0&&(z(Ea,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}var Op=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Sn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(c=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let c=Date.now()+r,u=new n(e,t,c,i,s);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new G(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function xE(n,e){if(ri("AsyncQueue",`${e}: ${n}`),ya(n))return new G(L.UNAVAILABLE,`${e}: ${n}`);throw n}var Lp=class{constructor(){this.queries=EI(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){let i=Ee(t),s=i.queries;i.queries=EI(),s.forEach((c,u)=>{for(let d of u.ba)d.onError(r)})})(this,new G(L.ABORTED,"Firestore shutting down"))}};function EI(){return new kn(n=>fE(n),dE)}function $R(n){n.Ca.forEach(e=>{e.next()})}var wI,TI;(TI=wI||(wI={})).Ma="default",TI.Cache="cache";var jR="SyncEngine";var Mp=class{constructor(e,t,r,i,s,c){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new kn(u=>fE(u),dE),this.Iu=new Map,this.Eu=new Set,this.Ru=new It(te.comparator),this.Au=new Map,this.Vu=new pa,this.du={},this.mu=new Map,this.fu=fa.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function zR(n,e,t){return P(this,null,function*(){let r=HR(n);try{let i=yield(function(c,u){let d=Ee(c),f=Fe.now(),I=u.reduce((k,x)=>k.add(x.key),Ye()),S,R;return d.persistence.runTransaction("Locally write mutations","readwrite",k=>{let x=Mu(),U=Ye();return d.xs.getEntries(k,I).next(O=>{x=O,x.forEach((W,K)=>{K.isValidDocument()||(U=U.add(W))})}).next(()=>d.localDocuments.getOverlayedDocuments(k,x)).next(O=>{S=O;let W=[];for(let K of u){let Q=hR(K,S.get(K.key).overlayedDocument);Q!=null&&W.push(new Nn(K.key,Q,iE(Q.value.mapValue),fr.exists(!0)))}return d.mutationQueue.addMutationBatch(k,f,W,u)}).next(O=>{R=O;let W=O.applyToLocalDocumentSet(S,U);return d.documentOverlayCache.saveOverlays(k,O.batchId,W)})}).then(()=>({batchId:R.batchId,changes:mE(S)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(c,u,d){let f=c.du[c.currentUser.toKey()];f||(f=new It(ge)),f=f.insert(u,d),c.du[c.currentUser.toKey()]=f})(r,i.batchId,t),yield tl(r,i.changes),yield el(r.remoteStore)}catch(i){let s=xE(i,"Failed to persist write");t.reject(s)}})}function vI(n,e,t){let r=Ee(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Tu.forEach((s,c)=>{let u=c.view.va(e);u.snapshot&&i.push(u.snapshot)}),(function(c,u){let d=Ee(c);d.onlineState=u;let f=!1;d.queries.forEach((I,S)=>{for(let R of S.ba)R.va(u)&&(f=!0)}),f&&$R(d)})(r.eventManager,e),i.length&&r.Pu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function GR(n,e){return P(this,null,function*(){let t=Ee(n),r=e.batch.batchId;try{let i=yield CR(t.localStore,e);LE(t,r,null),OE(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield tl(t,i)}catch(i){yield $p(i)}})}function KR(n,e,t){return P(this,null,function*(){let r=Ee(n);try{let i=yield(function(c,u){let d=Ee(c);return d.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let I;return d.mutationQueue.lookupMutationBatch(f,u).next(S=>(Re(S!==null,37113),I=S.keys(),d.mutationQueue.removeMutationBatch(f,S))).next(()=>d.mutationQueue.performConsistencyCheck(f)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(f,I,u)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,I)).next(()=>d.localDocuments.getDocuments(f,I))})})(r.localStore,e);LE(r,e,t),OE(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield tl(r,i)}catch(i){yield $p(i)}})}function OE(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function LE(n,e,t){let r=Ee(n),i=r.du[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.du[r.currentUser.toKey()]=i}}function tl(n,e,t){return P(this,null,function*(){let r=Ee(n),i=[],s=[],c=[];r.Tu.isEmpty()||(r.Tu.forEach((u,d)=>{c.push(r.pu(d,e,t).then(f=>{if((f||t)&&r.isPrimaryClient){let I=f?!f.fromCache:t?.targetChanges.get(d.targetId)?.current;r.sharedClientState.updateQueryState(d.targetId,I?"current":"not-current")}if(f){i.push(f);let I=Ep.Es(d.targetId,f);s.push(I)}}))}),yield Promise.all(c),r.Pu.J_(i),yield(function(d,f){return P(this,null,function*(){let I=Ee(d);try{yield I.persistence.runTransaction("notifyLocalViewChanges","readwrite",S=>F.forEach(f,R=>F.forEach(R.Ts,k=>I.persistence.referenceDelegate.addReference(S,R.targetId,k)).next(()=>F.forEach(R.Is,k=>I.persistence.referenceDelegate.removeReference(S,R.targetId,k)))))}catch(S){if(!ya(S))throw S;z(RR,"Failed to update sequence numbers: "+S)}for(let S of f){let R=S.targetId;if(!S.fromCache){let k=I.vs.get(R),x=k.snapshotVersion,U=k.withLastLimboFreeSnapshotVersion(x);I.vs=I.vs.insert(R,U)}}})})(r.localStore,s))})}function WR(n,e){return P(this,null,function*(){let t=Ee(n);if(!t.currentUser.isEqual(e)){z(jR,"User change. New user:",e.toKey());let r=yield CE(t.localStore,e);t.currentUser=e,(function(s,c){s.mu.forEach(u=>{u.forEach(d=>{d.reject(new G(L.CANCELLED,c))})}),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield tl(t,r.Ns)}})}function HR(n){let e=Ee(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=GR.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=KR.bind(null,e),e}var Zp=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return P(this,null,function*(){this.serializer=Ia(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)})}Fu(t,r){return null}Mu(t,r){return null}vu(t){return PR(this.persistence,new Tp,t.initialUser,this.serializer)}Cu(t){return new Uu(Ip.Vi,this.serializer)}Du(t){return new Ap}terminate(){return P(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Gu=class extends Zp{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Re(this.persistence.referenceDelegate instanceof Bu,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new op(r,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?At.withCacheSize(this.cacheSizeBytes):At.DEFAULT;return new Uu(r=>Bu.Vi(r,t),this.serializer)}};var ME=(()=>{class n{initialize(t,r){return P(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>vI(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=WR.bind(null,this.syncEngine),yield qR(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new Lp})()}createDatastore(t){let r=Ia(t.databaseInfo.databaseId),i=VR(t.databaseInfo);return xR(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,s,c,u,d){return new xp(i,s,c,u,d)})(this.localStore,this.datastore,t.asyncQueue,r=>vI(this.syncEngine,r,0),(function(){return $u.v()?new $u:new bp})())}createSyncEngine(t,r){return(function(s,c,u,d,f,I,S){let R=new Mp(s,c,u,d,f,I);return S&&(R.gu=!0),R})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return P(this,null,function*(){yield(function(r){return P(this,null,function*(){let i=Ee(r);z(Ea,"RemoteStore shutting down."),i.Ea.add(5),yield wa(i),i.Aa.shutdown(),i.Va.set("Unknown")})})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return n.provider={build:()=>new n},n})();var _r="FirestoreClient",Fp=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=i,this.user=Qe.UNAUTHENTICATED,this.clientId=si.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,c=>P(this,null,function*(){z(_r,"Received user=",c.uid),yield this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(r,c=>(z(_r,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Sn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=xE(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Pf(n,e){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),z(_r,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>P(null,null,function*(){r.isEqual(i)||(yield CE(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function AI(n,e){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield QR(n);z(_r,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>II(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>II(e.remoteStore,i)),n._onlineComponents=e})}function QR(n){return P(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){z(_r,"Using user provided OfflineComponentProvider");try{yield Pf(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===L.FAILED_PRECONDITION||i.code===L.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;ii("Error using user provided cache. Falling back to memory cache: "+t),yield Pf(n,new Zp)}}else z(_r,"Using default OfflineComponentProvider"),yield Pf(n,new Gu(void 0));return n._offlineComponents})}function JR(n){return P(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(z(_r,"Using user provided OnlineComponentProvider"),yield AI(n,n._uninitializedComponentsProvider._online)):(z(_r,"Using default OnlineComponentProvider"),yield AI(n,new ME))),n._onlineComponents})}function YR(n){return JR(n).then(e=>e.syncEngine)}function FE(n,e){let t=new Sn;return n.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return zR(yield YR(n),e,t)})),t.promise}function UE(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var XR="ComponentProvider",bI=new Map;function ZR(n,e,t,r,i){return new Of(n,e,t,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,UE(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator,r)}var BE="firestore.googleapis.com",SI=!0,Ku=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new G(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=BE,this.ssl=SI}else this.host=e.host,this.ssl=e.ssl??SI;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=PE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<bR)throw new G(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}NI("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=UE(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new G(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new G(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new G(L.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Fs=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ku({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new G(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new G(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ku(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new bu;switch(r.type){case"firstParty":return new kf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new G(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return P(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=bI.get(t);r&&(z(XR,"Removing Datastore"),bI.delete(t),r.terminate())})(this),Promise.resolve()}};function em(n,e,t,r={}){n=_a(n,Fs);let i=Mr(e),s=n._getSettings(),c=Vt(fe({},s),{emulatorOptions:n._getEmulatorOptions()}),u=`${e}:${t}`;i&&(wl(`https://${u}`),Tl("Firestore",!0)),s.host!==BE&&s.host!==u&&ii("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Vt(fe({},s),{host:u,ssl:i,emulatorOptions:r});if(!ir(d,c)&&(n._setSettings(d),r.mockUserToken)){let f,I;if(typeof r.mockUserToken=="string")f=r.mockUserToken,I=Qe.MOCK_USER;else{f=Am(r.mockUserToken,n._app?.options.projectId);let S=r.mockUserToken.sub||r.mockUserToken.user_id;if(!S)throw new G(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");I=new Qe(S)}n._authCredentials=new Cf(new Au(f,I))}}var ma=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},at=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if($s(t,n._jsonSchema))return new n(e,r||null,new te(Se.fromString(t.referencePath)))}};at._jsonSchemaVersion="firestore/documentReference/1.0",at._jsonSchema={type:ke("string",at._jsonSchemaVersion),referencePath:ke("string")};var Rn=class n extends ma{constructor(e,t,r){super(e,t,lE(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new at(this.firestore,null,new te(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function tm(n,e,...t){if(n=tt(n),kI("collection","path",e),n instanceof Fs){let r=Se.fromString(e,...t);return Xy(r),new Rn(n,null,r)}{if(!(n instanceof at||n instanceof Rn))throw new G(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Se.fromString(e,...t));return Xy(r),new Rn(n.firestore,null,r)}}function nl(n,e,...t){if(n=tt(n),arguments.length===1&&(e=si.newId()),kI("doc","path",e),n instanceof Fs){let r=Se.fromString(e,...t);return Yy(r),new at(n,null,new te(r))}{if(!(n instanceof at||n instanceof Rn))throw new G(L.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Se.fromString(e,...t));return Yy(r),new at(n.firestore,n instanceof Rn?n.converter:null,new te(r))}}var RI="AsyncQueue",Wu=class{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new zu(this,"async_queue_retry"),this._c=()=>{let r=Rf();r&&z(RI,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;let t=Rf();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=Rf();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new Sn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}lc(){return P(this,null,function*(){if(this.Yu.length!==0){try{yield this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!ya(e))throw e;z(RI,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,ri("INTERNAL UNHANDLED ERROR: ",PI(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=Op.createAndSchedule(this,e,t,r,s=>this.hc(s));return this.tc.push(i),i}uc(){this.nc&&ee(47125,{Pc:PI(this.nc)})}verifyOperationInProgress(){}Tc(){return P(this,null,function*(){let e;do e=this.ac,yield e;while(e!==this.ac)})}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function PI(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}var Us=class extends Fs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Wu,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return P(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Wu(e),this._firestoreClient=void 0,yield e}})}};function nm(n,e){let t=typeof n=="object"?n:ji(),r=typeof n=="string"?n:e||Vu,i=uc(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Tm("firestore");s&&em(i,...s)}return i}function rm(n){if(n._terminated)throw new G(L.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||eP(n),n._firestoreClient}function eP(n){let e=n._freezeSettings(),t=ZR(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Fp(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(i){let s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}})(n._componentsProvider))}var Pn=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(nn.fromBase64String(e))}catch(t){throw new G(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(nn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if($s(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Pn._jsonSchemaVersion="firestore/bytes/1.0",Pn._jsonSchema={type:ke("string",Pn._jsonSchemaVersion),bytes:ke("string")};var fi=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new G(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ft(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Bs=class{constructor(e){this._methodName=e}};var pr=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new G(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new G(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ge(this._lat,e._lat)||ge(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if($s(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};pr._jsonSchemaVersion="firestore/geoPoint/1.0",pr._jsonSchema={type:ke("string",pr._jsonSchemaVersion),latitude:ke("number"),longitude:ke("number")};var Cn=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if($s(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new G(L.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Cn._jsonSchemaVersion="firestore/vectorValue/1.0",Cn._jsonSchema={type:ke("string",Cn._jsonSchemaVersion),vectorValues:ke("object")};var tP=/^__.*__$/;var Hu=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Nn(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function qE(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ee(40011,{dataSource:n})}}var Up=class n{constructor(e,t,r,i,s,c){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=c||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(fe(fe({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Ju(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(qE(this.dataSource)&&tP.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},Bp=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ia(e)}createContext(e,t,r,i=!1){return new Up({dataSource:e,methodName:t,targetDoc:r,path:ft.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function $E(n){let e=n._freezeSettings(),t=Ia(n._databaseId);return new Bp(n._databaseId,!!e.ignoreUndefinedProperties,t)}var Qu=class n extends Bs{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function jE(n,e,t,r){let i=n.createContext(1,e,t);KE("Data must be an object, but it was:",i,r);let s=[],c=bt.empty();pi(r,(d,f)=>{let I=im(e,d,t);f=tt(f);let S=i.childContextForFieldPath(I);if(f instanceof Qu)s.push(I);else{let R=rl(f,S);R!=null&&(s.push(I),c.set(I,R))}});let u=new en(s);return new Hu(c,u,i.fieldTransforms)}function zE(n,e,t,r,i,s){let c=n.createContext(1,e,t),u=[ga(e,r,t)],d=[i];if(s.length%2!=0)throw new G(L.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let R=0;R<s.length;R+=2)u.push(ga(e,s[R])),d.push(s[R+1]);let f=[],I=bt.empty();for(let R=u.length-1;R>=0;--R)if(!iP(f,u[R])){let k=u[R],x=d[R];x=tt(x);let U=c.childContextForFieldPath(k);if(x instanceof Qu)f.push(k);else{let O=rl(x,U);O!=null&&(f.push(k),I.set(k,O))}}let S=new en(f);return new Hu(I,S,c.fieldTransforms)}function rl(n,e){if(GE(n=tt(n)))return KE("Unsupported field value:",e,n),nP(n,e);if(n instanceof Bs)return(function(r,i){if(!qE(i.dataSource))throw i.createError(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.createError(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(r,i){let s=[],c=0;for(let u of r){let d=rl(u,i.childContextForArray(c));d==null&&(d={nullValue:"NULL_VALUE"}),s.push(d),c++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=tt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return oR(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=Fe.fromDate(r);return{timestampValue:Zf(i.serializer,s)}}if(r instanceof Fe){let s=new Fe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Zf(i.serializer,s)}}if(r instanceof pr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Pn)return{bytesValue:pR(i.serializer,r._byteString)};if(r instanceof at){let s=i.databaseId,c=r.firestore._databaseId;if(!c.isEqual(s))throw i.createError(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:AE(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Cn)return(function(c,u){let d=c instanceof Cn?c.toArray():c;return{mapValue:{fields:{[Kp]:{stringValue:Wp},[la]:{arrayValue:{values:d.map(I=>{if(typeof I!="number")throw u.createError("VectorValues must only contain numeric values.");return Xp(u.serializer,I)})}}}}}})(r,i);if(SE(r))return r._toProto(i.serializer);throw i.createError(`Unsupported field value: ${Yu(r)}`)})(n,e)}function nP(n,e){let t={};return QI(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):pi(n,(r,i)=>{let s=rl(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function GE(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Fe||n instanceof pr||n instanceof Pn||n instanceof at||n instanceof Bs||n instanceof Cn||SE(n))}function KE(n,e,t){if(!GE(t)||!VI(t)){let r=Yu(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function ga(n,e,t){if((e=tt(e))instanceof fi)return e._internalPath;if(typeof e=="string")return im(n,e);throw Ju("Field path arguments must be of type string or ",n,!1,void 0,t)}var rP=new RegExp("[~\\*/\\[\\]]");function im(n,e,t){if(e.search(rP)>=0)throw Ju(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new fi(...e.split("."))._internalPath}catch(r){throw Ju(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ju(n,e,t,r,i){let s=r&&!r.isEmpty(),c=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let d="";return(s||c)&&(d+=" (found",s&&(d+=` in field ${r}`),c&&(d+=` in document ${i}`),d+=")"),new G(L.INVALID_ARGUMENT,u+n+d)}function iP(n,e){return n.some(t=>t.isEqual(e))}var WE="@firebase/firestore",HE="4.11.0";var il=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new at(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new sm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(ga("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},sm=class extends il{data(){return super.data()}};var js=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},zs=class n extends il{constructor(e,t,r,i,s,c){super(e,t,r,i,c),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Gs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(ga("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new G(L.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};zs._jsonSchemaVersion="firestore/documentSnapshot/1.0",zs._jsonSchema={type:ke("string",zs._jsonSchemaVersion),bundleSource:ke("string","DocumentSnapshot"),bundleName:ke("string"),bundle:ke("string")};var Gs=class extends zs{data(e={}){return super.data(e)}},va=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new js(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Gs(this._firestore,this._userDataWriter,r.key,r,new js(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new G(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let c=0;return i._snapshot.docChanges.map(u=>{let d=new Gs(i._firestore,i._userDataWriter,u.doc.key,u.doc,new js(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:d,oldIndex:-1,newIndex:c++}})}{let c=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let d=new Gs(i._firestore,i._userDataWriter,u.doc.key,u.doc,new js(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),f=-1,I=-1;return u.type!==0&&(f=c.indexOf(u.doc.key),c=c.delete(u.doc.key)),u.type!==1&&(c=c.add(u.doc),I=c.indexOf(u.doc.key)),{type:wP(u.type),doc:d,oldIndex:f,newIndex:I}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new G(L.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=si.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function wP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ee(61501,{type:n})}}va._jsonSchemaVersion="firestore/querySnapshot/1.0",va._jsonSchema={type:ke("string",va._jsonSchemaVersion),bundleSource:ke("string","QuerySnapshot"),bundleName:ke("string"),bundle:ke("string")};function XE(n,e,t,...r){n=_a(n,at);let i=_a(n.firestore,Us),s=$E(i),c;return c=typeof(e=tt(e))=="string"||e instanceof fi?zE(s,"updateDoc",n._key,e,t,r):jE(s,"updateDoc",n._key,e),TP(i,[c.toMutation(n._key,fr.exists(!0))])}function TP(n,e){let t=rm(n);return FE(t,e)}(function(e,t=!0){CI($i),Ot(new ct("firestore",(r,{instanceIdentifier:i,options:s})=>{let c=r.getProvider("app").getImmediate(),u=new Us(new Su(r.getProvider("auth-internal")),new Pu(c,r.getProvider("app-check-internal")),eE(c,i),c);return s=fe({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Ce(WE,HE,e),Ce(WE,HE,"esm2020")})();var mi=class{constructor(e){return e}},ZE="firestore",om=class{constructor(){return Gi(ZE)}};var am=new Xa("angularfire2.firestore-instances");function vP(n,e){let t=dc(ZE,n,e);return t&&new mi(t)}function AP(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new mi(r)}}var bP={provide:om,deps:[[new rr,am]]},SP={provide:mi,useFactory:vP,deps:[[new rr,am],$r]};function bV(n,...e){return Ce("angularfire",Br.full,"fst"),Za([SP,bP,{provide:am,useFactory:AP(n),multi:!0,deps:[nr,tc,qr,To,[new rr,Sc],[new rr,pc],...e]}])}var ew=Qt(Ky,!0);var tw=Qt(tm,!0,2);var sl=Qt(nl,!0,2);var SV=Qt(nm,!0);var ol=Qt(XE,!0,2);var xV=(()=>{class n{constructor(){if(this.initPlayers={},this.players={},this.isBrowser=mm(Kt(nc)),this.firestore=null,this.isBrowser){this.firestore=Kt(mi);let t=tw(this.firestore,"players");this.playersArray$=ew(t),this.playersSub=this.playersArray$.subscribe(r=>{this.players=r[0],this.initPlayers=r[0]})}else this.playersArray$=lm([])}getInitialStats(){return this.initPlayers}getStats(){return this.playersArray$}addHumanWin(){this.players.humanWins&&this.firestore&&(this.players.humanWins=+this.players.humanWins+1+"",ol(sl(this.firestore,"players/0as5g7EZpksHb74yeGBc"),{humanWins:this.players.humanWins}))}addRobotWin(){this.players.robotWins&&this.firestore&&(this.players.robotWins=+this.players.robotWins+1+"",ol(sl(this.firestore,"players/0as5g7EZpksHb74yeGBc"),{robotWins:this.players.robotWins}))}addDraw(){this.players.draw&&this.firestore&&(this.players.draw=+this.players.draw+1+"",ol(sl(this.firestore,"players/0as5g7EZpksHb74yeGBc"),{draw:this.players.draw}))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=Ya({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{_C as a,yC as b,bV as c,SV as d,xV as e};
